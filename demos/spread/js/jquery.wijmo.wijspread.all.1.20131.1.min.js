/*
 *
 * SpreadJS Library 1.0.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the Wijmo Commercial License. Also available under the GNU GPL Version 3 license.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 *
 **/
(function(n,t){"use strict";function a(n){if(t.browser.safari)return n.font;var i=n.fontStyle;return i+=" "+n.fontVariant,i+=" "+n.fontWeight,i+=" "+n.fontSize,i+="/"+n.lineHeight,i+=" "+n.fontFamily}function y(n){var t=r.createElement("span");return t.style.visibility="hidden",t.style.top="-10000px",t.style.left="-10000px",t.style.position="absolute",t.className="gcFontDetectSpanStyle",t.setAttribute(s,"gcFontDetectSpan"),r.body.insertBefore(t,null),{span:t,dispose:function(){r.body.removeChild(t),delete this.span}}}function o(n){return n&&n instanceof i.LineBorder?new i.LineBorder(n.color,n.style):n}function p(n,t){var i,u;return t?(f||(i=r.createElement("span"),i.style.visibility="hidden",i.style.top="-10000px",i.style.left="-10000px",r.body.insertBefore(i,null),f=i),n?f.style.font=n:f.style.fontSize="10pt",f.style.fontFamily=t,u=f.currentStyle,r.defaultView&&r.defaultView.getComputedStyle&&(u=r.defaultView.getComputedStyle(f,"")),a(u)):n}var u="undefined",h="function",e=n.GrapeCity,i,r,s,v,f,c,l;typeof e===u&&(e=n.GrapeCity={Version:"1.0.0"}),i=e.UI,typeof i===u&&(i=e.UI={}),r=n.document,typeof t.event.special.gcmousewheel===u&&function(t){function r(r){var f=[].slice.call(arguments,1),u=0,e=!0;return r=t.event.fix(r||n.event),r.type="gc"+i,(r.wheelDelta===undefined||r.wheelDelta===null)&&(r.detail===undefined||r.detail===null)&&(r.wheelDelta=r.originalEvent.wheelDelta,r.detail=r.originalEvent.detail),r.wheelDelta&&(u=r.wheelDelta/120),r.detail&&(u=-r.detail/3),f.unshift(r,u),t.event.handle.apply(r.target||r.srcElement,f)}var f="DOMMouseScroll",i="mousewheel",u=[f,i];t.event.special.gcmousewheel={setup:function(){var t,n;if(this.addEventListener)for(t=u.length;t;)n=u[--t],n===i&&this.addEventListener(f,r,!1),this.addEventListener(n,r,!1);else this.attachEvent("on"+i,r)},teardown:function(){var t,n;if(this.removeEventListener)for(t=u.length;t;)n=u[--t],n===i&&this.removeEventListener(f,r,!1),this.removeEventListener(n,r,!1);else this.detachEvent("on"+i,r)}},t.fn.extend({handlegcmousewheel:function(n){return n?this.bind(i,n):this.trigger(i)},unhandlegcmousewheel:function(n){return this.unbind(i,n)}})}(jQuery),s="gcUIElement",i.Global=function(){typeof n.gcGlobal===u&&this._init()},i.Global.prototype={activeElement:null,_eventSuspended:0,keyDown:function(t){var u,r;if(i.Global.prototype._isEditingWrap(t,!0))return;u=n.gcGlobal;if(u._eventSuspended>0)return;r=u.activeElement,r&&r.doKeyDown&&(r.doKeyDown(t),(t.keyCode===i.Key.z||t.keyCode===i.Key.y)&&t.ctrlKey&&!t.altKey&&i.cancelDefault(t))},keyUp:function(t){var u,r;if(i.Global.prototype._isEditingWrap(t,!1))return;u=n.gcGlobal;if(u._eventSuspended>0)return;r=u.activeElement,r&&r.doKeyUp&&r.doKeyUp(t)},_isEditingWrap:function(t,r){var u=t.srcElement||t.target,h,e;if(u){h=u.getAttribute(s);if(h==="gcEditingInput")if(t.keyCode===i.Key.enter&&(t.ctrlKey||t.altKey)){if(r){var f=u.selectionStart,o=u.value,c=o.substr(0,f),l=o.substr(f,o.length-f);u.value=c+"\n"+l,u.selectionStart=f+1,u.selectionEnd=f+1,e=n.gcGlobal.activeElement,e&&e._updateEditingInputSize&&e._updateEditingInputSize(null,null)}return i.cancelDefault(t),!0}else if(t.keyCode===i.Key.z&&t.ctrlKey&&!t.altKey||t.keyCode===i.Key.y&&t.ctrlKey&&!t.altKey)return!0}return!1},docSelectStart:function(t){return!r.all&&n.gcGlobal&&n.gcGlobal.activeElement&&i.cancelDefault(t),!1},getUIElement:function(n){var t=n,i;while(t&&t.tagName!=="BODY"){if(typeof t.getAttribute!==h)break;i=t.getAttribute(s),i||(i=t.gcUIElement);if(i)return t;t=t.parentNode}return null},_init:function(){n.gcGlobal=this,this._eventSuspended=0;var u=i.Global;t.browser.msie&&r.documentMode!==undefined&&r.documentMode!==null&&r.documentMode<9?(n.attachEvent("keydown",u.prototype.keyDown),n.attachEvent("keyup",u.prototype.keyUp),r.attachEvent("selectstart",u.prototype.docSelectStart)):(n.addEventListener("keydown",u.prototype.keyDown,!0),n.addEventListener("keyup",u.prototype.keyUp,!0),r.addEventListener("selectstart",u.prototype.docSelectStart,!0)),t(r).mousedown(function(t){var i=n.gcGlobal.activeElement,r;i&&(r=u.prototype.getUIElement(t.target),!r&&i.endEdit&&(i.endEdit(),i.repaint()),r||(n.gcGlobal.activeElement=null))}),t(r).ready(function(){e.UI.Global.prototype._createDummyObjects()})},_createDummyObjects:function(){var t=e.UI.Global,n;t.prototype._dummyContent||(n=function(n){var t=r.createElement("span");return t.className=n,t.style.display="none",r.body.insertBefore(t,null),t},t.prototype._dummyHeader=n("ui-widget-header ui-state-default"),t.prototype._dummyContent=n("ui-widget-content"),t.prototype._dummyHover=n("ui-state-hover"),t.prototype._dummyHighlight=n("ui-state-highlight"))},getWijmoThemeStyle:function(n){var f=i.Global,e=i.VisualState,t=f.prototype._dummyHeader,u;return n===e.Highlight||n===e.Selected?t=f.prototype._dummyHighlight:n===e.Hover&&(t=f.prototype._dummyHover),u=t.currentStyle,r.defaultView&&r.defaultView.getComputedStyle&&(u=r.defaultView.getComputedStyle(t,"")),u},suspendEvent:function(){var t=n.gcGlobal;t._eventSuspended++},resumeEvent:function(){var t=n.gcGlobal;t._eventSuspended--,t._eventSuspended<0&&(t._eventSuspended=0)}},n.gcGlobal=new i.Global,i.Key={left:37,right:39,up:38,down:40,tab:9,enter:13,shift:16,ctrl:17,space:32,altkey:18,home:36,end:35,pup:33,pdn:34,backspace:8,del:46,esc:27,c:67,v:86,x:88,z:90,y:89},i.KeyMap=function(n,t,i,r,u){this.key=n,this.ctrl=t,this.shift=i,this.alt=r,this.action=u},Array.prototype.remove=function(n){for(var t=0;t<this.length;t++)if(this[t]===n){this.splice(t,1);return}},Array.prototype.contains=function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return!0;return!1},Array.prototype.indexOf=function(n,t){(t===undefined||t===null||isNaN(t))&&(t=0);for(var i=t;i<this.length;i++)if(this[i]===n)return i;return-1},Array.prototype.map||(Array.prototype.map=function(t,i){var s,f,r,u=n.Object(this),h=u.length>>>0,e,o;if(typeof t!="function")throw new TypeError(t+" is not a function");i&&(s=i),f=new Array(h),r=0;while(r<h)r in u&&(e=u[r],o=t.call(s,e,r,u),f[r]=o),r++;return f}),i.Point=function(n,t){this.x=n,this.y=t,this.clone=function(){return new i.Point(this.x,this.y)}},i.Rect=function(n,t,i,r){this.x=n,this.y=t,this.width=i,this.height=r},i.Rect.prototype.intersect=function(n,t,i,r){return n<this.x+this.width&&this.x<n+i&&t<this.y+this.height&&this.y<t+r},i.Rect.prototype.intersectRect=function(n){return n.x<this.x+this.width&&this.x<n.x+n.width&&n.y<this.y+this.height&&this.y<n.y+n.height},i.Rect.prototype.contains=function(n,t){return n<this.x+this.width&&this.x<n&&t<this.y+this.height&&this.y<t},i.Rect.prototype.getIntersectRect=function(n){if(this.intersectRect(n)){var c=this.x,p=this.y,w=this.x+this.width,b=this.y+this.height,y=n.x,v=n.y,a=n.x+n.width,h=n.y+n.height,t=Math.max(c,y),f=Math.max(p,v),s=Math.min(w,a),o=Math.min(b,h),e=t,l=f,u=s-t,r=o-f;if(u>0&&r>0)return new i.Rect(e,l,u,r)}return null},i.Direction={up:1,down:2,left:3,right:4},i.HorizontalAlign={left:0,center:1,right:2,general:3},i.VerticalAlign={top:0,center:1,bottom:2},i.HorizontalPosition={left:0,center:1,right:2,nearest:3},i.VerticalPosition={top:0,center:1,bottom:2,nearest:3},i.HeaderAutoText={blank:0,numbers:1,letters:2},i.ClipboardPasteOptions={All:0,Values:1,Formatting:2,Formulas:3},i.TextFileOpenFlags={None:0,IncludeRowHeader:1,IncludeColumnHeader:2,UnFormatted:8,ImportFormula:16},i.VisualState={Normal:0,Highlight:1,Selected:2,Active:3,Hover:4},i.ReferenceStyle={A1:0,R1C1:1},i.LineStyle={empty:0,thin:1,medium:2,dashed:3,dotted:4,thick:5,double:6,hair:7,mediumDashed:8,dashDot:9,mediumDashDot:10,dashDotDot:11,mediumDashDotDot:12,slantedDashDot:13},i.LineBorder=function(n,t){this.color=n,this.style=t},i.LineBorder.prototype={color:"black",style:i.LineStyle.empty,width:function(n){if(n&&n.style){var t=i.LineStyle;switch(n.style){case t.dashDot:case t.thin:case t.dashed:case t.dotted:case t.hair:case t.dashDotDot:return 1;case t.medium:case t.mediumDashDot:case t.mediumDashDotDot:case t.mediumDashed:case t.slantedDashDot:return 2;case t.thick:case t.double:return 3}}return 0},_weight:function(n){if(n&&n.style){var t=i.LineStyle;switch(n.style){case t.dashDot:case t.dashed:case t.dotted:case t.dashDotDot:case t.hair:return 100;case t.thin:return 101;case t.slantedDashDot:case t.mediumDashed:case t.mediumDashDot:case t.mediumDashDotDot:return 198;case t.medium:return 199;case t.thick:return 300;case t.double:return 90;case t.empty:return 0}}return-2}},v=function(){var n={};return n["font-style"]=function(n,t){n&&(t.style.fontStyle=n)},n["font-variant"]=function(n,t){n&&(t.style.fontVariant=n)},n["font-weight"]=function(n,t){n&&(t.style.fontWeight=n)},n["font-size"]=function(n,t){n&&(t.style.fontSize=n)},n["line-height"]=function(n,t){n&&(t.style.lineHeight=n)},n["font-family"]=function(n,t){n&&(t.style.fontFamily=n)},n}(),i.FontFactory=function(n){this._sheet=n},i.FontFactory.prototype={buildFont:function(n,i){var e="",u,f;if(n){u=y(this.sheet);try{i&&(u.span.style.font=i),t.each(v,function(t,i){i(n.hasOwnProperty(t)?n[t]:null,u.span)})}finally{f=u.span.currentStyle,r.defaultView&&r.defaultView.getComputedStyle&&(f=r.defaultView.getComputedStyle(u.span,"")),e=a(f),u.dispose()}}return e}},i.Style=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){this.backColor=n,this.foreColor=t,this.hAlign=i,this.vAlign=r,this.font=u,this.themeFont=f,this.formatter=e,this.borderLeft=o,this.borderTop=s,this.borderRight=h,this.borderBottom=c,this.locked=l,this.textIndent=a,this.wordWrap=v,this.shrinkToFit=y,this.validator=undefined},i.Style.prototype._initDefault=function(){this.backColor=undefined,this.foreColor=undefined,this.hAlign=undefined,this.vAlign=undefined,this.font=undefined,this.themeFont=undefined,this.formatter=undefined,this.validator=undefined,this.borderLeft=undefined,this.borderTop=undefined,this.borderRight=undefined,this.borderBottom=undefined,this.locked=undefined,this.textIndent=undefined,this.wordWrap=undefined,this.shrinkToFit=undefined},i.Style.prototype.copyFrom=function(n){this.backColor=n.backColor,this.foreColor=n.foreColor,this.hAlign=n.hAlign,this.vAlign=n.vAlign,this.font=n.font,this.themeFont=n.themeFont,this.formatter=n.formatter,this._autoFormatter=n._autoFormatter,this.validator=n.validator,this.borderLeft=n.borderLeft,this.borderTop=n.borderTop,this.borderRight=n.borderRight,this.borderBottom=n.borderBottom,this.locked=n.locked,this.textIndent=n.textIndent,this.wordWrap=n.wordWrap,this.shrinkToFit=n.shrinkToFit},i.Style.prototype.compose=function(n,t){(t||typeof this.backColor===u)&&(this.backColor=n.backColor),(t||typeof this.foreColor===u)&&(this.foreColor=n.foreColor),(t||typeof this.hAlign===u)&&(this.hAlign=n.hAlign),(t||typeof this.vAlign===u)&&(this.vAlign=n.vAlign),(t||typeof this.font===u)&&(this.font=n.font),(t||typeof this.themeFont===u)&&(this.themeFont=n.themeFont),(t||typeof this.formatter===u)&&(this.formatter=n.formatter),(t||typeof this.validator===u)&&(this.validator=n.validator),(t||typeof this._autoFormatter===u)&&(this._autoFormatter=n._autoFormatter),(t||typeof this.borderLeft===u)&&(this.borderLeft=o(n.borderLeft)),(t||typeof this.borderTop===u)&&(this.borderTop=o(n.borderTop)),(t||typeof this.borderRight===u)&&(this.borderRight=o(n.borderRight)),(t||typeof this.borderBottom===u)&&(this.borderBottom=o(n.borderBottom)),(t||typeof this.locked===u)&&(this.locked=n.locked),(t||typeof this.textIndent===u)&&(this.textIndent=n.textIndent),(t||typeof this.wordWrap===u)&&(this.wordWrap=n.wordWrap),(t||typeof this.shrinkToFit===u)&&(this.shrinkToFit=n.shrinkToFit)},i.Style.prototype.clear=function(n){if(arguments.length===0){this._initDefault();return}n==="dataValidator"&&(n="validator"),this[n]=undefined},i.Style.prototype._normalize=function(n){var r,i,t,u;for(t in this)n&&(t==="foreColor"||t==="backColor")?(r=this[t],r&&n.getColor&&(i=n.getColor(r),i&&(this[t]=i))):n&&(t==="borderLeft"||t==="borderTop"||t==="borderRight"||t==="borderBottom")&&(u=this[t],u&&(r=u.color,r&&n.getColor&&(i=n.getColor(r),i&&(this[t].color=i))));return this.themeFont&&n&&n.getFont&&(this.font=p(this.font,n.getFont(this.themeFont))),this},i.NameInfo=function(n,t,i,r){this._name=n,this._baseRow=i,this._baseColumn=r,this._expr=t},i.NameInfo.prototype={getName:function(){return this._name},getRow:function(){return this._baseRow},getColumn:function(){return this._baseColumn},getExpression:function(){return this._expr}},i.createEventHandler=function(n,t){return function(){return t.apply(n,arguments)}},i.cancelDefault=function(n){return n.preventDefault?(n.preventDefault(),n.stopPropagation()):(n.cancelBubble=!1,n.returnValue=!1),!1},i._isStandardCanvas=function(){return typeof c===u&&(c=typeof r.createElement("canvas").getContext!==u),c},i._isSilverlightCanvas=function(){return i._isStandardCanvas()?!0:(typeof l===u&&(l=typeof n.slcanvas!==u),l)},i._useDoubleBuffer=function(){return i._isStandardCanvas()||i._isSilverlightCanvas()},i.GcUIElement=function(n,t,i,r,u){this._init(n,t,i,r,u)},i.GcUIElement.prototype={_init:function(n,t,r,u,f){this._bounds=new i.Rect(n,t,r,u),this._name=f},getBounds:function(){return this._bounds},setBounds:function(n){this._bounds.x=n.x,this._bounds.y=n.y,this._bounds.width=n.width,this._bounds.height=n.height},_draw:function(n){var i,t;if(!n)return;n.save(),i=n.createLinearGradient(this._bounds.x,this._bounds.y,this._bounds.x,this._bounds.y+40),i.addColorStop(0,"#00ABEB"),i.addColorStop(1,"#fff"),n.fillStyle=i,n.fillRect(this._bounds.x,this._bounds.y,this._bounds.width,this._bounds.height),t=this._name,t&&t.length>0&&(n.fillStyle="darkblue",n.font="20pt Arial",n.fillText(t,this._bounds.x+36,this._bounds.y+28)),n.strokeStyle="black",n.strokeRect(this._bounds.x,this._bounds.y,this._bounds.width,this._bounds.height),n.restore()},size:function(n,t){this._bounds.width=n,this._bounds.height=t},move:function(n,t){this._bounds.x=n,this._bounds.y=t}},i._ThemeContext=function(n){this._owner=n,n&&(this._currentTheme=n.currentTheme())},i._ThemeContext.prototype={owner:function(n){return arguments.length===0?this._owner:(this._owner=n,this._owner&&(this._currentTheme=this._owner.currentTheme()),this)},getColor:function(n){if(this._currentTheme){var t=this._currentTheme.colors();if(t)return t.getColor(n)}return n},getFont:function(n){if(n){if(this._currentTheme){var t=n;if(t==="Body")return this._currentTheme.bodyFont();else if(t==="Headings")return this._currentTheme.headerFont()}return n}return null}},i.Timer=function(n){this.host=n,this.interval=null,this.action=null,this.intervalId=null,this.result=null,this.working=!1},i.Timer.prototype={setAction:function(n){typeof n===h&&(this.action=n)},setInterval:function(n){if(!isNaN(n)&&n>0){var t=this.interval;this.interval=n,t!==n&&this.start()}else this.stop()},start:function(){this.clear();if(!isNaN(this.interval)){var t=this;this.intervalId=n.setInterval(function(){t.run()},this.interval)}},run:function(){this.working=!0,typeof this.action===h&&(this.result=this.action.call(this.host))},stop:function(){this.clear(),this.interval=null,this.action=null,this.intervalId=null,this.result=null,this.working=!1},clear:function(){this.intervalId&&n.clearInterval(this.intervalId)},_dispose:function(){this.stop(),this.host=null}}})(window,jQuery);(function(n,t){"use strict";function c(n,t,i,r){throw new Error("Invalid "+n+": "+t+" (must be between "+i+" and "+r+").");}function bt(n,t,i){for(var r in g)g[r]&&(n=n.replace(g[r],g[r].source));return t===!0?(n=n.replace(/~\?/g,dt.source),n=n.replace(/~\*/g,gt.source),n=n.replace(/\?/g,"."),n=i?n.replace(/\*/g,"((.|\\n)+)"):n.replace(/\*/g,"((.|\\n)*)"),n=n.replace(dt,"\\?"),n=n.replace(gt,"\\*")):(n=n.replace(/\?/g,"\\?"),n=n.replace(/\*/g,"\\*")),n}var o="undefined",e="function",s="number",w="string",v="boolean",u=n.GrapeCity;typeof u===o&&(u=n.GrapeCity={}),typeof u.UI===o&&(u.UI={});var i=u.UI,l=n.document,k=n.ko,lt=function(n){var t=i.TextFileOpenFlags,f=t.IncludeRowHeader,e=t.IncludeColumnHeader,r=t.UnFormatted,u=t.ImportFormula;this.rowHeader=(n&f)===f,this.columnHeader=(n&e)===e,this.unFormatted=(n&r)===r,this.formula=(n&u)===u,this.expandRows=!0,this.expandColumns=!0};lt.prototype={fixOptions:function(n){var t=i.SheetArea;if(!n)return;n.getColumnCount(t.rowHeader)>0||(this.rowHeader=!1),n.getRowCount(t.colHeader)>0||(this.columnHeader=!1)}};var r={copyTo:function(n,t,u,f,e,o,s,h,c){r.checkArguments(n,t,u,f,e,o,s,h);var l=i.CopyToOption;n.suspendCalcService(),f.suspendCalcService();try{(c&l.Value)>0&&(r.copyValue(n,t,u,f,e,o,s,h),(c&l.Formula)==0&&r.clearFormula(f,e,o,s,h)),(c&l.Formula)>0&&r.copyFormula(n,t,u,f,e,o,s,h)}finally{n.resumeCalcService(),f.resumeCalcService()}(c&l.Style)>0&&r.copyStyle(n,t,u,f,e,o,s,h),(c&l.Sparkline)>0&&r.copySparkline(n,t,u,f,e,o,s,h),(c&l.RangeGroup)>0&&(t<0&&r.copyColumnRangeGroup(n,u,f,o,h),u<0&&r.copyRowRangeGroup(n,t,f,e,s)),(c&l.Span)>0&&r.copySpan(n,t,u,f,e,o,s,h),t<0&&r.copyColumnAxis(n,u,f,o,h,c),u<0&&r.copyRowAxis(n,t,f,e,s,c),t<0&&e<0&&u<0&&o<0&&r.copySheetInfo(n,f,c),f._raisePropertyChanged("[CopyTo]")},checkArguments:function(n,t,i,r,u,f,e,o){var h,a,s,l;if(!n)throw new Error("src");if(!r)throw new Error("dest");(t<-1||t>=n.getRowCount())&&c("from row index",t,"-1",n.getRowCount()-1),(i<-1||i>=n.getColumnCount())&&c("from column index",i,"-1",n.getColumnCount()-1),(u<-1||u>=r.getRowCount())&&c("to row index",u,"-1",r.getRowCount()-1),(f<-1||f>=r.getColumnCount())&&c("to column index",f,"-1",r.getColumnCount()-1),h=i,i<0&&(h=0,o=n.getColumnCount()),a=f<0?0:f,(o<1||h+o>n.getColumnCount()||a+o>r.getColumnCount())&&c("column count",o,"1",Math.min(n.getColumnCount()-h,r.getColumnCount()-a)),s=t,t<0&&(s=0,e=n.getRowCount()),l=u<0?0:u,(e<1||s+e>n.getRowCount()||l+e>r.getRowCount())&&c("row count",e,"1",Math.min(n.getRowCount()-s,r.getRowCount()-l))},copyValue:function(n,t,u,f,e,o,s,h){var ut=!(n===f&&n._name===f._name),v=i.SheetArea,y,p,c,l,a,w,g,rt,it,k,ot,ft;if(t<0){w=u,g=o,y=Math.min(n.getRowCount(v.colHeader),f.getRowCount(v.colHeader)),p=h,u<0&&(w=0,p=n.getColumnCount()),o<0&&(g=0);if(ut)for(c=0;c<y;c++)for(l=0;l<p;l++)a=n.getValue(c,w+l,v.colHeader),(a===undefined||a===null)&&n.isColumnBound(w+l)&&(c===n.colHeaderAutoTextIndex||c===y-1&&n.colHeaderAutoTextIndex===-1)&&(a=n.getDataColumnName(w+l)),a===undefined||a===null?f._setValueInternal(c,g+l,v.colHeader,null,!0):f._setValueInternal(c,g+l,v.colHeader,r.cloneObject(a),!0);else{for(rt=new i._GcSheetModel(y,p,null),c=0;c<y;c++)for(l=0;l<p;l++)a=n._getModel(v.colHeader).getValue(c,w+l),(a===undefined||a===null)&&n.isColumnBound(w+l)&&(c===n.colHeaderAutoTextIndex||c===y-1&&n.colHeaderAutoTextIndex===-1)&&(a=n.getDataColumnName(w+l)),a!==undefined&&a!==null&&rt.setValue(c,l,r.cloneObject(a));for(c=0;c<y;c++)for(l=0;l<p;l++)f._setValueInternal(c,g+l,v.colHeader,rt.getValue(c,l),!0)}}if(u<0){it=t,k=e,y=s,p=Math.min(n.getColumnCount(v.rowHeader),f.getColumnCount(v.rowHeader)),t<0&&(it=0,y=n.getRowCount()),e<0&&(k=0);if(ut)for(c=0;c<y;c++)for(l=0;l<p;l++)a=n.getValue(it+c,l,v.rowHeader),a===undefined||a===null?f._setValueInternal(k+c,l,v.rowHeader,null,!0):f._setValueInternal(k+c,l,v.rowHeader,r.cloneObject(a),!0);else{for(ot=new i._GcSheetModel(y,p,null),c=0;c<y;c++)for(l=0;l<p;l++)a=n._getModel(v.rowHeader).getValue(it+c,l),a!==undefined&&a!==null&&ot.setValue(c,l,r.cloneObject(a));for(c=0;c<y;c++)for(l=0;l<p;l++)f._setValueInternal(k+c,l,v.rowHeader,ot.getValue(c,l),!0)}}var st=t,et=u,nt=e,tt=o,b=s,d=h;t<0&&(st=0,b=Math.min(n.getRowCount(),f.getRowCount())),u<0&&(et=0,d=Math.min(n.getColumnCount(),f.getColumnCount())),e<0&&(nt=0),o<0&&(tt=0);if(ut)for(c=0;c<b;c++)for(l=0;l<d;l++)a=n.getValue(st+c,et+l,v.viewport),a===undefined||a===null?f._setValueInternal(nt+c,tt+l,v.viewport,null,!0):f._setValueInternal(nt+c,tt+l,v.viewport,r.cloneObject(a),!0);else{for(ft=new i._GcSheetModel(b,d,null),c=0;c<b;c++)for(l=0;l<d;l++)a=n.getValue(st+c,et+l,v.viewport),a!==undefined&&a!==null&&ft.setValue(c,l,r.cloneObject(a));for(c=0;c<b;c++)for(l=0;l<d;l++)f._setValueInternal(nt+c,tt+l,v.viewport,ft.getValue(c,l),!0)}},cloneObject:function(n){var t,i;if(typeof n===s||typeof n===w||typeof n===v||typeof n===o)return t=n;else if(n instanceof Date)return t=new Date(n);else t=n instanceof Object?new n.constructor:new n.constructor(n.valueOf());for(i in n)n.hasOwnProperty(i)&&t[i]!==n[i]&&(t[i]=typeof this[i]=="object"?r.cloneObject(n[i]):n[i]);return t.toString=n.toString,t.valueOf=n.valueOf,t},clearFormula:function(n,t,i,r,u){var e,f;for(t<0&&(t=0,r=n.getRowCount()),i<0&&(i=0,u=n.getColumnCount()),e=t;e<r;e++)for(f=i;f<u;f++)n.setFormula(e,f,null)},_copyExpression:function(n,t,i){var l=u.Calc,o=l.Expressions,f=l.Parser,e=l.Errors.Reference,h=o.ErrorExpression,s=o.ExternalErrorExpression,c;if(n instanceof o.ParenthesesExpression)n.argument=r._copyExpression(n.argument,t,i);else if(n instanceof o.CellExpression){if(n.rowRelative&&(n.row+t<0||n.row+t>f.maxRowCount))return new h(e);if(n.columnRelative&&(n.column+i<0||n.column+i>f.maxColumnCount))return new h(e)}else if(n instanceof o.ExternalCellExpression){if(n.rowRelative&&(n.row+t<0||n.row+t>f.maxRowCount))return new s(n.source,e);if(n.columnRelative&&(n.column+i<0||n.column+i>f.maxColumnCount))return new s(n.source,e)}else if(n instanceof o.RangeExpression){if(n.startRowRelative&&(n.startRow+t<0||n.startRow+t>f.maxRowCount))return new h(e);if(n.startColumnRelative&&(n.startColumn+i<0||n.startColumn+i>f.maxColumnCount))return new h(e);if(n.endRowRelative&&(n.endRow+t<0||n.endRow+t>f.maxRowCount))return new h(e);if(n.endColumnRelative&&(n.endColumn+i<0||n.endColumn+i>f.maxColumnCount))return new h(e)}else if(n instanceof o.ExternalRangeExpression){if(n.startRowRelative&&(n.startRow+t<0||n.startRow+t>f.maxRowCount))return new s(n.source,e);if(n.startColumnRelative&&(n.startColumn+i<0||n.startColumn+i>f.maxColumnCount))return new s(n.source,e);if(n.endRowRelative&&(n.endRow+t<0||n.endRow+t>f.maxRowCount))return new s(n.source,e);if(n.endColumnRelative&&(n.endColumn+i<0||n.endColumn+i>f.maxColumnCount))return new s(n.source,e)}else if(n instanceof o.UnaryOperatorExpression)n.operand=r._copyExpression(n.operand,t,i);else if(n instanceof o.BinaryOperatorExpression)n.left=r._copyExpression(n.left,t,i),n.right=r._copyExpression(n.right,t,i);else if(n instanceof o.FunctionExpression)if(n.args&&n.args.length>0)for(c=0;c<n.args.length;c++)n.args[c]=r._copyExpression(n.args[c],t,i);return n},copyFormula:function(n,t,u,f,e,o,s,h){var d=t,g=u,y=e,p=o,a=s,v=h,tt,w,nt,b,c,l,k;for(t<0&&(d=0,a=Math.min(n.getRowCount(),f.getRowCount())),u<0&&(g=0,v=Math.min(n.getColumnCount(),f.getColumnCount())),e<0&&(y=0),o<0&&(p=0),tt=!(n===f&&n._name===f._name),w=f._getSheetSource(),w&&w.unlinkCellExpression(y,p,a,v),nt=new i._GcSheetModel(a,v,null),b=new i._GcSheetModel(a,v,null),c=0;c<a;c++)for(l=0;l<v;l++)b.setFormula(c,l,n._calcDataModel.getFormula(c+d,l+g));for(c=0;c<a;c++)for(l=0;l<v;l++)k=r._copyExpression(b.getFormula(c,l),c+y,l+p),f._dataModel.setFormula(c+y,l+p,f.getCalcService().unparse(k,c+y,l+p)),f._calcDataModel.setFormula(c+y,l+p,k);w&&(w.linkCellExpression(y,p,a,v),w._addCellsToDirty(y,p,a,v))},copyStyle:function(n,t,u,f,e,o,s,h){var ut=!(n===f&&n._name===f._name),a=i.SheetArea,y,p,c,l,v,tt,w,ft,it,b,st,rt;if(t<0){tt=u,w=o,y=Math.min(n.getRowCount(a.colHeader),f.getRowCount(a.colHeader)),p=h,u<0&&(tt=0,p=n.getColumnCount()),o<0&&(w=0);if(ut)for(c=0;c<y;c++)for(l=0;l<p;l++)v=n.getActualStyle(c,tt+l,a.colHeader),v?f.setStyle(c,w+l,r.cloneObject(v),a.colHeader):f.setStyle(c,w+l,null,a.colHeader);else{for(ft=new i._GcSheetModel(y,p,null),c=0;c<y;c++)for(l=0;l<p;l++)v=n.getActualStyle(c,tt+l,a.colHeader),v&&ft.setValue(c,l,r.cloneObject(v));for(c=0;c<y;c++)for(l=0;l<p;l++)f.setStyle(c,w+l,ft.getValue(c,l),a.colHeader)}}if(u<0){it=t,b=e,y=s,p=Math.min(n.getColumnCount(a.rowHeader),f.getColumnCount(a.rowHeader)),t<0&&(it=0,y=n.getRowCount()),e<0&&(b=0);if(ut)for(c=0;c<y;c++)for(l=0;l<p;l++)v=n.getActualStyle(it+c,l,a.rowHeader),v?f.setStyle(b+c,l,r.cloneObject(v),a.rowHeader):f.setStyle(b+c,l,null,a.rowHeader);else{for(st=new i._GcSheetModel(y,p,null),c=0;c<y;c++)for(l=0;l<p;l++)v=n.getActualStyle(it+c,l,a.rowHeader),v&&st.setValue(c,l,r.cloneObject(v));for(c=0;c<y;c++)for(l=0;l<p;l++)f.setStyle(b+c,l,st.getValue(c,l),a.rowHeader)}}var et=t,ot=u,nt=e,g=o,d=s,k=h;t<0&&(et=0,d=Math.min(n.getRowCount(),f.getRowCount())),u<0&&(ot=0,k=Math.min(n.getColumnCount(),f.getColumnCount())),e<0&&(nt=0),o<0&&(g=0);if(ut)for(c=0;c<d;c++)for(l=0;l<k;l++)v=n.getActualStyle(et+c,ot+l,a.viewport),v?f.setStyle(nt+c,g+l,r.cloneObject(v),a.viewport):f.setStyle(nt+c,g+l,null,a.viewport);else{for(rt=new i._GcSheetModel(d,k,null),c=0;c<d;c++)for(l=0;l<k;l++)v=n.getActualStyle(et+c,ot+l,a.viewport),v&&rt.setValue(c,l,r.cloneObject(v));for(c=0;c<d;c++)for(l=0;l<k;l++)f.setStyle(nt+c,g+l,rt.getValue(c,l),a.viewport)}},copyColumnRangeGroup:function(n,t,i,u,f){var e=t,h=u,s=f,c,o;e<0&&(e=0,s=Math.min(n.getColumnCount(),i.getColumnCount())),u<0&&(h=0),c=!(n===i&&n._name===i._name),c?r.crossSheetCopyRangeGroup(n.colRangeGroup,e,i.colRangeGroup,h,s):(o=n.colRangeGroup,o&&o._copy(e,h,s))},crossSheetCopyRangeGroup:function(n,t,r,u,f){var o,e,s,h;t<0&&(t=0),u<0&&(u=0),o={};if(n){e=n.items.nextNonEmptyIndex(t-1);while(e>=0&&e<t+f)o[e-t]=new i.RangeGroupItemInfo(n.items[e]),e=n.items.nextNonEmptyIndex(e)}if(r){r.items.clear(u,f);if(o.length>0)for(s in o)o.hasOwnProperty(s)&&(h=o[s],r.items[u+s]=h)}},copySparkline:function(n,t,i,r,u,f,e,o){var l=t,a=i,v=u,y=f,h=e,c=o,p,s;t<0&&(l=0,h=Math.min(n.getRowCount(),r.getRowCount())),i<0&&(a=0,c=Math.min(n.getColumnCount(),r.getColumnCount())),u<0&&(v=0),f<0&&(y=0),p=!(n===r&&n._name===r._name),p?(s=r._sparklineGroupManager,s&&s._exCopy(n,l,a,v,y,h,c)):(s=n._sparklineGroupManager,s&&s._copy(l,a,v,y,h,c))},copyRowRangeGroup:function(n,t,i,u,f){var s=t,h=u,e=f,c,o;t<0&&(s=0,e=Math.min(n.getRowCount(),i.getRowCount())),u<0&&(h=0),c=!(n===i&&n._name===i._name),c?r.crossSheetCopyRangeGroup(n.rowRangeGroup,s,i.rowRangeGroup,h,e):(o=n.rowRangeGroup,o&&o._copy(s,h,e))},copySpan:function(n,t,u,f,e,o,s,h){var d=i.SheetArea,y=t,c=u,p=e,l=o,v=s,a=h,w,g,b,k;t<0&&(y=0,v=Math.min(n.getRowCount(),f.getRowCount())),c<0&&(c=0,a=Math.min(n.getColumnCount(),f.getColumnCount())),e<0&&(p=0),o<0&&(l=0),w=!(n===f&&n._name===f._name),t<0&&(w?r.crossSheetCopySpans(n._colHeaderSpanModel,-1,c,f._colHeaderSpanModel,-1,l,-1,a):(g=n._getSpanModel(d.colHeader),g&&g.copy(-1,c,-1,l,-1,a))),u<0&&(w?r.crossSheetCopySpans(n._rowHeaderSpanModel,y,-1,f._rowHeaderSpanModel,p,-1,v,-1):(b=n._getSpanModel(d.rowHeader),b&&b.copy(y,-1,p,-1,v,-1))),w?r.crossSheetCopySpans(n._spanModel,y,c,f._spanModel,p,l,v,a):(k=n._getSpanModel(d.viewport),k&&k.copy(y,c,p,l,v,a))},crossSheetCopySpans:function(n,t,u,f,e,o,s,h){var v=r.getSpans(n),y=r.getSpans(f),w=[],l,a,c,p,b;if(t===-1){if(v&&v.length>0)for(l=0;l<v.length;l++)c=v[l],c.col<u||c.col+c.colCount>u+h||w.push(new i.Range(c.row,o+c.col-u,c.rowCount,c.colCount));if(y&&y.length>0)for(l=0;l<y.length;l++){c=y[l];if(c.col>=o&&c.col<o+h)for(a=0;a<f.length;a++){p=f[a];if(p.row===c.row&&p.col===c.col){f.splice(a,1);break}}}}else if(u===-1){if(v&&v.length>0)for(l=0;l<v.length;l++)c=v[l],t>c.row||c.row+c.rowCount>t+s||w.push(new i.Range(e+c.row-t,c.col,c.rowCount,c.colCount));if(y&&y.length>0)for(l=0;l<y.length;l++){c=y[l];if(c.row>=e&&c.row<e+s)for(a=0;a<f.length;a++){p=f[a];if(p.row===c.row&&p.col===c.col){f.splice(a,1);break}}}}else{if(v&&v.length>0)for(l=0;l<v.length;l++)c=v[l],t<=c.row&&c.row<t+s&&u<=c.col&&c.col<u+h&&w.push(new i.Range(e+c.row-t,o+c.col-u,c.rowCount,c.colCount));if(y&&y.length>0)for(l=0;l<y.length;l++){c=y[l];if(c.row>=e&&c.row<e+s&&c.col>=o&&c.col<o+h)for(a=0;a<f.length;a++){p=f[a];if(p.row===c.row&&p.col===c.col){f.splice(a,1);break}}}}if(w.length>0&&f)for(l=0;l<w.length;l++)b=w[l],f.push(b)},getSpans:function(n){return n&&n.length>0?n.slice(0):null},copyColumnAxis:function(n,t,u,f,e,o){var a=t,c=f,b=e,h,s,w,y,l,k,v,p;for(t<0&&(a=0,b=Math.min(n.getColumnCount(),u.getColumnCount())),f<0&&(c=0),h=i.SheetArea.colHeader,s=0;s<b;s++)w=n._getActualColumnWidth(s+a),w!==undefined&&w!==null&&u.setColumnWidth(s+c,w),y=n.getColumnVisible(s+a),y!==undefined&&y!==null&&u.setColumnVisible(s+c,y),(o&i.CopyToOption.Style)>0&&(l=n.getActualStyle(-1,s+a),l?u.setStyle(-1,s+c,r.cloneObject(l)):u.setStyle(-1,s+c,null),l=n.getActualStyle(-1,s+a,h),l?u.setStyle(-1,s+c,r.cloneObject(l),h):u.setStyle(-1,s+c,null,h));for(k=Math.min(n.getRowCount(h),u.getRowCount(h)),v=0;v<k;v++)p=n._getActualRowHeight(v,h),p!==undefined&&p!==null&&u.setRowHeight(v,p,h)},cloneAxisInfo:function(n,t,i){for(var e=[],r,o,f,u=0;u<i;u++){r=n[t+u];if(r){o={};for(f in r)r.hasOwnProperty(f)&&(o[f]=r[f]);e.push(o)}else e.push(null)}return e},getAxisInfo:function(n,t,i){for(var u=[],r=0;r<i;r++)u.push(n[t+r]);return u},setAxisInfo:function(n,t,i){if(t)for(var r=0;r<n.length;r++)t[i+r]=n[r]},copyRowAxis:function(n,t,u,f,e,o){var a=t,c=f,b=e,h,s,w,y,l,k,v,p;for(t<0&&(a=0,b=Math.min(n.getRowCount(),u.getRowCount())),f<0&&(c=0),h=i.SheetArea.rowHeader,s=0;s<b;s++)w=n._getActualRowHeight(s+a),w!==undefined&&w!==null&&u.setRowHeight(s+c,w),y=n.getRowVisible(s+a),y!==undefined&&y!==null&&u.setRowVisible(s+c,y),(o&i.CopyToOption.Style)>0&&(l=n.getActualStyle(s+a,-1),l?u.setStyle(s+c,-1,r.cloneObject(l)):u.setStyle(s+c,-1,null),l=n.getActualStyle(s+a,-1,h),l?u.setStyle(s+c,-1,r.cloneObject(l),h):u.setStyle(s+c,-1,null,h));for(k=Math.min(n.getColumnCount(h),u.getColumnCount(h)),v=0;v<k;v++)p=n._getActualColumnWidth(v,h),p!==undefined&&p!==null&&u.setColumnWidth(v,p,h)},copySheetInfo:function(n,t,u){if(!(n===t&&n._name===t._name)){if((u&i.CopyToOption.Style)>0){var o=i.SheetArea,e=o.colHeader,f=o.rowHeader;t.setDefaultStyle(r.cloneObject(n.getDefaultStyle())),t.setDefaultStyle(r.cloneObject(n.getDefaultStyle(e)),e),t.setDefaultStyle(r.cloneObject(n.getDefaultStyle(f)),f)}t.defaults.colWidth=n.defaults.colWidth,t.defaults.rowHeight=n.defaults.rowHeight,t.defaults.rowHeaderColWidth=n.defaults.rowHeaderColWidth}},moveTo:function(n,t,u,f,e,o,s,h,c){var l,v,p,a,y;r.checkArguments(n,t,u,f,e,o,s,h),l=i.CopyToOption,n.suspendCalcService(),f.suspendCalcService();try{(c&l.Value)>0&&(r.moveValue(n,t,u,f,e,o,s,h),(c&l.Formula)==0&&r.clearFormula(f,e,o,s,h)),(c&l.Formula)>0&&r.moveFormula(n,t,u,f,e,o,s,h)}finally{n.resumeCalcService(),f.resumeCalcService()}(c&l.Style)>0&&r.moveStyle(n,t,u,f,e,o,s,h),(c&l.Sparkline)>0&&r.moveSparkline(n,t,u,f,e,o,s,h),(c&l.RangeGroup)>0&&(t<0&&r.moveColumnRangeGroup(n,u,f,o,h),u<0&&r.moveRowRangeGroup(n,t,f,e,s)),(c&l.Span)>0&&r.moveSpan(n,t,u,f,e,o,s,h),t<0&&r.moveColumnAxis(n,u,f,o,h,c),u<0&&r.moveRowAxis(n,t,f,e,s,c),t<0&&e<0&&u<0&&o<0&&r.moveSheetInfo(n,f,c);if(t<0)for(v=u,p=h,u<0&&(v=0,p=Math.min(n.getColumnCount(),f.getColumnCount())),a=0;a<p;a++)n.isColumnBound(v+a)&&(n._colInfos[v+a]=null);y="[MoveTo]",n._raisePropertyChanged(y),f._raisePropertyChanged(y)},moveValue:function(n,t,r,u,f,e,o,s){var et=!(n===u&&n._name===u._name),w=i.SheetArea.colHeader,a,v,c,h,l,y,nt,st,p,k,tt,ot,ft;if(t<0){y=r,nt=e,a=Math.min(n.getRowCount(w),u.getRowCount(w)),v=s,r<0&&(y=0,v=n.getColumnCount()),e<0&&(nt=0);if(et)for(c=0;c<a;c++)for(h=0;h<v;h++)l=n._getModel(w).getValue(c,y+h),(l===undefined||l===null)&&n.isColumnBound(y+h)&&(c===n.colHeaderAutoTextIndex||c===a-1&&n.colHeaderAutoTextIndex===-1)&&(l=n.getDataColumnName(y+h)),l===undefined||l===null?u._setValueInternal(c,nt+h,w,null,!0):(u._setValueInternal(c,nt+h,w,l,!0),n._setValueInternal(c,y+h,w,null,!0));else{for(st=new i._GcSheetModel(a,v,null),c=0;c<a;c++)for(h=0;h<v;h++)l=n._getModel(w).getValue(c,y+h),(l===undefined||l===null)&&n.isColumnBound(y+h)&&(c===n.colHeaderAutoTextIndex||c===a-1&&n.colHeaderAutoTextIndex===-1)&&(l=n.getDataColumnName(y+h)),l!==undefined&&l!==null&&st.setValue(c,h,l),n._setValueInternal(c,y+h,w,null,!0);for(c=0;c<a;c++)for(h=0;h<v;h++)u._setValueInternal(c,nt+h,w,st.getValue(c,h),!0)}}p=i.SheetArea.rowHeader;if(r<0){k=t,tt=f,a=o,v=Math.min(n.getColumnCount(p),u.getColumnCount(p)),t<0&&(k=0,a=n.getRowCount()),f<0&&(tt=0);if(et)for(c=0;c<a;c++)for(h=0;h<v;h++)l=n.getValue(k+c,h,p),l===undefined||l===null?u._setValueInternal(tt+c,h,p,null,!0):(u._setValueInternal(tt+c,h,p,l,!0),n._setValueInternal(k+c,h,p,null,!0));else{for(ot=new i._GcSheetModel(a,v,null),c=0;c<a;c++)for(h=0;h<v;h++)l=n._getModel(p).getValue(k+c,h),l!==undefined&&l!==null&&ot.setValue(c,h,l),n._setValueInternal(k+c,h,p,null,!0);for(c=0;c<a;c++)for(h=0;h<v;h++)u._setValueInternal(tt+c,h,p,ot.getValue(c,h),!0)}}var g=t,it=r,rt=f,ut=e,d=o,b=s;t<0&&(g=0,d=Math.min(n.getRowCount(),u.getRowCount())),r<0&&(it=0,b=Math.min(n.getColumnCount(),u.getColumnCount())),f<0&&(rt=0),e<0&&(ut=0);if(et)for(c=0;c<d;c++)for(h=0;h<b;h++)l=n.getValue(g+c,it+h),l===undefined||l===null?u._setValueInternal(rt+c,ut+h,null,null,!0):(u._setValueInternal(rt+c,ut+h,null,l,!0),n._setValueInternal(g+c,it+h,null,null,!0));else{for(ft=new i._GcSheetModel(d,b,null),c=0;c<d;c++)for(h=0;h<b;h++)l=n.getValue(g+c,it+h),l!==undefined&&l!==null&&ft.setValue(c,h,l);for(c=0;c<d;c++)for(h=0;h<b;h++)n._setValueInternal(g+c,it+h,null,null,!0);for(c=0;c<d;c++)for(h=0;h<b;h++)u._setValueInternal(rt+c,ut+h,null,ft.getValue(c,h),!0)}},moveFormula:function(n,t,i,r,u,f,e,o){var p=t,w=i,a=u,b=f,c=e,l=o,g,k;t<0&&(p=0,c=Math.min(n.getRowCount(),r.getRowCount())),i<0&&(w=0,l=Math.min(n.getColumnCount(),r.getColumnCount())),u<0&&(a=0),f<0&&(b=0);var it=!(n===r&&n._name===r._name),v=n._getSheetSource(),y=r._getSheetSource();v&&(v.unlinkCellExpression(p,w,c,l),v._addDependentsToAdjust(p,w,c,l)),y&&(y.unlinkCellExpression(a,a,c,l),y._addDependentsToAdjust(a,a,c,l));for(var ut=n._getModel(),nt=n._getCalcModel(),tt=r._getModel(),rt=r._getCalcModel(),d=[],h,s=0;s<c;s++)for(h=0;h<l;h++)d.push(nt.getFormula(s+p,h+w)),ut.setFormula(s+p,h+w,null),nt.setFormula(s+p,h+w,null);for(g=r.getCalcService(),s=0;s<c;s++)for(h=0;h<l;h++)k=d.shift(),tt.setFormula(s+a,h+b,g.unparse(k,s+a,h+b)),rt.setFormula(s+a,h+b,k);v&&v._addCellsToAdjust(p,w,c,l),y&&y._addCellsToAdjust(a,b,c,l),v&&v._controller&&v._controller.adjustFormulasOnMove(v,p,w,y,a,b,c,l),it===!0&&y&&y._controller&&y._controller.adjustFormulasOnMove(v,p,w,y,a,b,c,l)},moveStyle:function(n,t,u,f,e,o,s,h){var st=!(n===f&&n._name===f._name),w=i.SheetArea.colHeader,v,y,l,c,a,k,rt,ot,p,b,it,ht,et;if(t<0){k=u,rt=o,v=Math.min(n.getRowCount(w),f.getRowCount(w)),y=h,u<0&&(k=0,y=n.getColumnCount()),o<0&&(rt=0);if(st)for(l=0;l<v;l++)for(c=0;c<y;c++)a=n.getActualStyle(l,k+c,w),a?(f.setStyle(l,rt+c,r.cloneObject(a),w),n.setStyle(l,k+c,null,w)):f.setStyle(l,rt+c,null,w);else{for(ot=new i._GcSheetModel(v,y,null),l=0;l<v;l++)for(c=0;c<y;c++)a=n.getActualStyle(l,k+c,w),a&&ot.setValue(l,c,r.cloneObject(a)),n.setStyle(l,k+c,null,w);for(l=0;l<v;l++)for(c=0;c<y;c++)f.setStyle(l,rt+c,ot.getValue(l,c),w)}}p=i.SheetArea.rowHeader;if(u<0){b=t,it=e,v=s,y=Math.min(n.getColumnCount(p),f.getColumnCount(p)),t<0&&(b=0,v=n.getRowCount()),e<0&&(it=0);if(st)for(l=0;l<v;l++)for(c=0;c<y;c++)a=n.getActualStyle(b+l,c,p),a?(f.setStyle(it+l,c,r.cloneObject(a),p),n.setStyle(b+l,c,null,p)):f.setStyle(it+l,c,null,p);else{for(ht=new i._GcSheetModel(v,y,null),l=0;l<v;l++)for(c=0;c<y;c++)a=n.getActualStyle(b+l,c,p),a&&ht.setValue(l,c,r.cloneObject(a)),n.setStyle(b+l,c,null,p);for(l=0;l<v;l++)for(c=0;c<y;c++)f.setStyle(it+l,c,ht.getValue(l,c),p)}}var g=t,d=u,ft=e,ut=o,nt=s,tt=h;t<0&&(g=0,nt=Math.min(n.getRowCount(),f.getRowCount())),u<0&&(d=0,tt=Math.min(n.getColumnCount(),f.getColumnCount())),e<0&&(ft=0),o<0&&(ut=0);if(st)for(l=0;l<nt;l++)for(c=0;c<tt;c++)a=n.getActualStyle(g+l,d+c),a?(f.setStyle(ft+l,ut+c,r.cloneObject(a)),n.setStyle(g+l,d+c,null)):f.setStyle(ft+l,ut+c,null);else{for(et=new i._GcSheetModel(nt,tt,null),l=0;l<nt;l++)for(c=0;c<tt;c++)a=n.getActualStyle(g+l,d+c),a&&et.setValue(l,c,r.cloneObject(a)),n.setStyle(g+l,d+c,null);for(l=0;l<nt;l++)for(c=0;c<tt;c++)f.setStyle(ft+l,ut+c,et.getValue(l,c))}},moveSparkline:function(n,t,i,r,u,f,e,o){var l=t,a=i,v=u,y=f,h=e,c=o,p,s;t<0&&(l=0,h=Math.min(n.getRowCount(),r.getRowCount())),i<0&&(a=0,c=Math.min(n.getColumnCount(),r.getColumnCount())),u<0&&(v=0),f<0&&(y=0),p=!(n===r&&n._name===r._name),p?(s=r._sparklineGroupManager,s&&s._exMove(n,l,a,v,y,h,c)):(s=n._sparklineGroupManager,s&&s._move(l,a,v,y,h,c))},moveColumnRangeGroup:function(n,t,i,u,f){var e=t,h=u,o=f,c,s;e<0&&(e=0,o=Math.min(n.getColumnCount(),i.getColumnCount())),u<0&&(h=0),c=!(n===i&&n._name===i._name),c?(r.crossSheetCopyRangeGroup(n.colRangeGroup,e,i.colRangeGroup,h,o),n.colRangeGroup&&n.colRangeGroup.items.clear(e,o)):(s=n.colRangeGroup,s&&s._move(e,h,o))},moveRowRangeGroup:function(n,t,i,u,f){var o=t,h=u,e=f,c,s;t<0&&(o=0,e=Math.min(n.getRowCount(),i.getRowCount())),u<0&&(h=0),c=!(n===i&&n._name===i._name),c?(r.crossSheetCopyRangeGroup(n.rowRangeGroup,o,i.rowRangeGroup,h,e),n.rowRangeGroup&&n.rowRangeGroup.items.clear(o,e)):(s=n.rowRangeGroup,s&&s._move(o,h,e))},moveSpan:function(n,t,u,f,e,o,s,h){var v=t,c=u,p=e,y=o,l=s,a=h,w,d,g,b,k;t<0&&(v=0,l=Math.min(n.getRowCount(),f.getRowCount())),c<0&&(c=0,a=Math.min(n.getColumnCount(),f.getColumnCount())),e<0&&(p=0),o<0&&(y=0),w=!(n===f&&n._name===f._name),d=i.SheetArea,t<0&&(w?(r.crossSheetCopySpans(n._colHeaderSpanModel,-1,c,f._colHeaderSpanModel,-1,y,-1,a),n._colHeaderSpanModel&&n._colHeaderSpanModel.clear(-1,c,-1,a)):(g=n._getSpanModel(d.colHeader),g&&g.move(-1,c,-1,y,-1,a))),u<0&&(w?(r.crossSheetCopySpans(n._rowHeaderSpanModel,v,-1,f._rowHeaderSpanModel,p,-1,l,-1),n._rowHeaderSpanModel&&n._rowHeaderSpanModel.clear(v,-1,l,-1)):(b=n._getSpanModel(d.rowHeader),b&&b.move(v,-1,p,-1,l,-1))),w?(r.crossSheetCopySpans(n._spanModel,v,c,f._spanModel,p,y,l,a),n._spanModel&&n._spanModel.clear(v,c,l,a)):(k=n._getSpanModel(),k&&k.move(v,c,p,y,l,a))},moveColumnAxis:function(n,t,u,f,e,o){var c=t,l=f,b=e,h,s,w,y,a,k,v,p;for(t<0&&(c=0,b=Math.min(n.getColumnCount(),u.getColumnCount())),f<0&&(l=0),h=i.SheetArea.colHeader,s=0;s<b;s++)w=n._getActualColumnWidth(s+c),w!==undefined&&w!==null&&(n.setColumnWidth(s+c,n.defaults.colWidth),u.setColumnWidth(s+l,w)),y=n.getColumnVisible(s+c),y!==undefined&&y!==null&&(n.setColumnVisible(s+c,!0),u.setColumnVisible(s+l,y)),(o&i.CopyToOption.Style)>0&&(a=n.getActualStyle(-1,s+c),a?(u.setStyle(-1,s+l,r.cloneObject(a)),n.setStyle(-1,s+c,null)):u.setStyle(-1,s+l,null),a=n.getActualStyle(-1,s+c,h),a?(u.setStyle(-1,s+l,r.cloneObject(a),h),n.setStyle(-1,s+c,null,h)):u.setStyle(-1,s+l,null,h));for(k=Math.min(n.getRowCount(h),u.getRowCount(h)),v=0;v<k;v++)p=n._getActualRowHeight(v,h),p!==undefined&&p!==null&&(n.setRowHeight(v,n.defaults.colHeaderRowHeight,h),u.setRowHeight(v,p,h))},moveRowAxis:function(n,t,u,f,e,o){var c=t,l=f,b=e,h,s,w,y,a,k,v,p;for(t<0&&(c=0,b=Math.min(n.getRowCount(),u.getRowCount())),f<0&&(l=0),h=i.SheetArea.rowHeader,s=0;s<b;s++)w=n._getActualRowHeight(s+c),w!==undefined&&w!==null&&(n.setRowHeight(s+c,n.defaults.rowHeight),u.setRowHeight(s+l,w)),y=n.getRowVisible(s+c),y!==undefined&&y!==null&&(n.setRowVisible(s+c,!0),u.setRowVisible(s+l,y)),(o&i.CopyToOption.Style)>0&&(a=n.getActualStyle(s+c,-1),a?(u.setStyle(s+l,-1,r.cloneObject(a)),n.setStyle(s+c,-1,null)):u.setStyle(s+l,-1,null),a=n.getActualStyle(s+c,-1,h),a?(u.setStyle(s+l,-1,r.cloneObject(a),h),n.setStyle(s+c,-1,null,h)):u.setStyle(s+l,-1,null,h));for(k=Math.min(n.getColumnCount(h),u.getColumnCount(h)),v=0;v<k;v++)p=n._getActualColumnWidth(v,h),p!==undefined&&p!==null&&(n.setColumnWidth(v,n.defaults.rowHeaderColWidth,h),u.setColumnWidth(v,p,h))},moveSheetInfo:function(n,t,r){if(!(n===t&&n._name===t._name)){if((r&i.CopyToOption.Style)>0){var e=i.SheetArea,f=e.colHeader,u=e.rowHeader;t.setDefaultStyle(n.getDefaultStyle()),t.setDefaultStyle(n.getDefaultStyle(f),f),t.setDefaultStyle(n.getDefaultStyle(u),u),n.setDefaultStyle(null),n.setDefaultStyle(null,f),n.setDefaultStyle(null,u)}t.defaults.colWidth=n.defaults.colWidth,t.defaults.rowHeight=n.defaults.rowHeight,t.defaults.rowHeaderColWidth=n.defaults.rowHeaderColWidth,n.defaults.colWidth=62,n.defaults.rowHeight=20,n.defaults.rowHeaderColWidth=40}},setRangeText:function(n,t,i,u,f,e,o,s){if(!n)throw new Error("sheet");(t<-1||t>=n.getRowCount())&&c("row",t,"-1",n.getRowCount()-1),(i<-1||i>=n.getColumnCount())&&c("column",i,"-1",n.getColumnCount()-1);if(u===undefined||u===null||u==="")return;t===-1&&(t=0),i===-1&&(i=0);var h=r.parseText(u,f,e,o);h&&h.length>0&&r.setSheetData(n,t,i,h,s)},getRangeText:function(n,t,i,r,u,f,e,o,s,h){var y,p,l,v,k,a,b,w;if(!n)throw new Error("sheet");for((t<-1||t>=n.getRowCount())&&c("row",t,"-1",n.getRowCount()-1),(i<-1||t+i>n.getRowCount())&&c("rowCount",t,"-1",n.getRowCount()-t),(r<-1||r>=n.getColumnCount())&&c("column",r,"-1",n.getColumnCount()-1),(u<-1||r+u>n.getColumnCount())&&c("columnCount",r,"-1",n.getColumnCount()-r),y=-1,p=-1,t===-1&&r===-1&&i===-1&&u===-1?(t=0,r=0,y=n.getRowCount()-1,p=n.getColumnCount()-1):(t===-1&&(t=0),r===-1&&(r=0),i===-1&&(i=n.getRowCount()-t),u===-1&&(u=n.getColumnCount()-r),y=t+i-1,p=r+u-1),(f===undefined||f===null||f==="")&&(f="\r\n"),(e===undefined||e===null||e==="")&&(e="\t"),(o===undefined||o===null||o==="")&&(o='"'),l="",v=t;v<=y;v++){for(k=!0,a=r;a<=p;a++)k||(l+=e),k=!1,b="",w=n.getValue(v,a),w&&(b=w.toString()),l+=b;l+=f}return l.toString()},parseText:function(n,t,r,u){var e;if(n===undefined||n===null||n==="")return null;(t===undefined||t===null||t==="")&&(t="\r\n"),(r===undefined||r===null||r==="")&&(r="\t"),(u===undefined||u===null||u==="")&&(u='"'),i.StringHelper.EndsWith(n,t)||(n+=t);var l=[],c=[],f=new i.StringBuilder,a=!1,o=u.length,s=t.length,h=r.length;for(e=0;e<n.length;e++)f.Append(n[e]),f.Length()<o||u!==f.ToString(f.Length()-o,o)?f.Length()<h||r!==f.ToString(f.Length()-h,h)?f.Length()<s||t!==f.ToString(f.Length()-s,s)||(f.Remove(f.Length()-s,s),c.push(f.toString()),l.push(c),c=[],f.Remove(0,f.Length())):(f.Remove(f.Length()-h,h),c.push(f.toString()),f.Remove(0,f.Length())):a&&n.length>=e+1+o&&u===n.substr(e+1,o)&&(e+=o);return l},setSheetData:function(n,t,u,f,e){var s=f.length,h=r.getMaxLength(f),o,l,c,a;if(s===0||h===0)return;o=new lt(e),o.fixOptions(n);var v=i.SheetArea,p=o.rowHeader?n.getColumnCount(v.rowHeader):0,y=o.columnHeader?n.getRowCount(v.colHeader):0,w=0;for(h-=p,h>0||(h=0),s-=y,s>0||(w=0),s-=w,s>0||(s=0),o.expandRows&&t+s>n.getRowCount()&&n.setRowCount(t+s),o.expandColumns&&u+h>n.getColumnCount()&&n.setColumnCount(u+h),l=0,c=0;l<f.length;l++,c++){a=f[l];if(a.length<=0)continue;y>0&&l<y?r.setRowData(n,a,c,u,h,v.colHeader,o):s>0&&c<n.getRowCount()&&(l===y&&(c=t),r.setRowData(n,a,c,0,p,v.rowHeader,o),a.splice(0,p),r.setRowData(n,a,c,u,h,v.viewport,o))}},setRowData:function(n,t,i,u,f,e,o){for(var h=0,s=u;h<t.length;h++,s++)f>0&&s<n.getColumnCount(e)&&r.setCellData(n,e,i,s,t[h],o)},setCellData:function(n,t,r,u,f,e){var o=f,l=null,h,s,c;e.unFormatted===!1&&(h={value:f},l=(new i.GeneralFormatter).GetPreferredDisplayFormatter(f,h),o=h.value);if(o===undefined||o===null)n.setValue(r,u,o,t);else if(f!=="")if(e.formula&&f[0]==="=")try{n.setFormula(r,u,f.substr(1),t)}catch(a){n.setText(r,u,f,t)}else s=n.getActualStyle(r,u,t),s&&(e.unFormatted===!1?s.formatter?s.formatter.toString()==="@"&&(o=f.toString()):(c=new i.AutoFormatter(l),n.getCell(r,u,t)._setStyleProperty("_autoFormatter",c)):s.formatter&&n.getCell(r,u,t).formatter(null)),n.setValue(r,u,o,t);else n.setValue(r,u,null,t)},getMaxLength:function(n){var i,t,r;if(n===undefined||n===null)return 0;for(i=0,t=0;t<n.length;t++)r=n[t],i=Math.max(r.length,i);return i},parseCsv:function(n,t,i,u){var h=null,o=r.parseText(n,t,i,u),f,e;if(o){var c=o.length,l=r.getMaxLength(o),s=[];for(f=0;f<c;f++)for(s[f]=[],e=0;e<l;e++)s[f][e]=e<o[f].length?o[f][e]:null;h=s}return h}},g=[/\\/g,/\(/g,/\[/g,/\{/g,/\^/g,/\$/g,/\|/g,/\)/g,/\+/g,/\./g],dt=new RegExp("{113E2532-EAF5-444c-A5CB-3D7446971C4D}","g"),gt=new RegExp("{E21523B3-0F1F-458f-B547-23D25713D0EC}","g");i.DataContext=function(n,t,i,r){this.read=n,this.create=t,this.update=i,this.remove=r};var a=".gcSheet",et=".gcSheetInternal",ft="mousedown"+a,ut="mousemove"+a,st="mouseup"+a,ht="mouseout"+a,ot="dblclick"+a,tt="gcmousewheel"+a,it="resize"+a,d=".gcEditingInput",ni="keydown"+d,ri="keyup"+d,ii="paste"+d,rt="value",p="left",kt="right",nt="top",h="width",f="height",b="text-align",at="font",ct="center",y="hidden",pt="visibility",vt="POST",yt="json",wt="application/json;charset=UTF-8",ti=new RegExp("^/Date\\(-?\\d+\\)/\\s*$");i.GcSheet=function(n){this._init(n)},i.GcSheet.prototype={getDataSource:function(){return this._dataSource},setDataSource:function(n,t){this._bindToAutoRefresh(function(n,t){var i,r;(!n||t)&&this.reset(),this._dataSource=n,this._dataItemType=this._getDataItemType(n);if(n&&!isNaN(n.length)){this.setRowCount(n.length);if(n.length>0)if(this.autoGenerateColumns){i=this._getProperties(n[0]);if(i&&i.length>0)for(this.setColumnCount(i.length),this._colInfos={},r=0;r<i.length;r++)this._colInfos[r]={name:i[r]}}else this._colInfos||(this._colInfos={})}this.doDataItemChanged()})(n,t)},bindColumn:function(n,t){typeof t===w&&(t={name:t}),this._colInfos||(this._colInfos={}),this._colInfos[n]=t,t&&t.formatter&&this.setFormatter(-1,n,t.formatter)},bindColumns:function(n){var i,t;this._colInfos={};if(n)for(isNaN(n.length)||this.setColumnCount(n.length),i=0;i<n.length;i++)t=n[i],typeof t===w&&(t={name:t}),this._colInfos[i]=t,t&&t.formatter&&this.setFormatter(-1,i,t.formatter)},getDataContext:function(){return this.dataContext},setDataContext:function(n){this.dataContext=n,this.load()},_getDataItemType:function(n){if(n&&!isNaN(n.length)&&n.length>0)for(var t=0;t<n.length;t++)if(n[t])return n[t].constructor;return null},getDataItem:function(n){var f=this.getDataSource(),t,i,r;if(!f||f.length===0)return null;var s=this.getColumnCount(),o={},u=f[n];if(u)for(t in u)u.hasOwnProperty(t)&&typeof t!==e&&(o[t]=u[t]);for(i=0;i<s;i++)r=this._colInfos[i],r&&r.name&&r.name.length>0&&(o[r.name]=this.getValue(n,i));return o},getDirtyRows:function(){var i=[],t=this._dataModel.dirtyNodes,n;if(t)for(n in t)t.hasOwnProperty(n)&&t[n]&&t[n].rs==="e"&&i.push({row:n,item:this.getDataItem(n),originalItem:this._dataSource?this._dataSource[n]:null});return i},getInsertRows:function(){var i=[],t=this._dataModel.dirtyNodes,n;if(t)for(n in t)t.hasOwnProperty(n)&&t[n]&&t[n].rs==="n"&&i.push({row:n,item:this.getDataItem(n)});return i},_getDeleteRows:function(){var n=[];return this.deletedRows&&t.each(this.deletedRows,function(t,i){typeof i!==e&&i&&i.data!==undefined&&i.data!==null&&n.push({row:t,originalItem:i.data})}),n},hasPendingChanges:function(){var t=this._dataModel.dirtyNodes,n,i;if(t)for(n in t)if(t[n]&&(t[n].rs==="e"||t[n].rs==="n"))return!0;if(this.deletedRows)for(n in this.deletedRows)if(this.deletedRows[n]){i=this.deletedRows[n];if(typeof i!==e)return!0}return!1},clearPendingChanges:function(){function n(n){t.each(n,function(n,t){typeof n!==e&&t&&t.dirty&&(t.dirty=null)})}this._dataModel.dirtyNodes={},this.deletedRows=[],n(this._rowInfos),n(this._colInfos)},load:function(){if(!this.dataContext||!this.dataContext.read)return;var n=this;this._dataReceivedDelegate=function(t){return n._onDataReceived(t)},t.getJSON(this.dataContext.read,this._dataReceivedDelegate)},updateRecord:function(){var r,u,n,f,i;if(!this.autoUpdate||!this.dataContext||!this.dataContext.update||this.dataContext.update==="")return;r=this.getDataSource();if(!r||r.length===0)return;u=this,this._dataUpdatedDelegate=function(n){return u._onDataUpdated(n)},n=this._activeRowIndex,n<0||(f=this.getDataItem(n),i=this.dataContext.update,this._dataModel.dataTable&&this._dataModel.dataTable[n]&&this._dataModel.dataTable[n].rs==="n"&&(i=this.dataContext.create),t.ajax({url:i,type:vt,data:JSON.stringify(f),dataType:yt,contentType:wt,success:this._dataUpdatedDelegate}))},_onDataUpdated:function(n){},_onDataReceived:function(t){var r,u,i;if(!t)return;r=t.data;if(!r)return;this.setDataSource(r),isNaN(t.total)||this.setRowCount(t.total);if(n.localStorage)for(u=this.getColumnCount(),i=0;i<u;i++)n.localStorage["col,"+i]&&this.setColumnWidth(i,parseInt(n.localStorage["col,"+i],10));this.parent&&this.parent._doResize(),this.invalidateLayout(),this.repaint()},_getProperties:function(n){var i=[],t;for(t in n)typeof n[t]!==e?i.push(t):typeof k!==o&&k.isObservable(n[t])&&i.push(t);return i},referenceStyle:function(n){var t=i.ReferenceStyle;return arguments.length===0?this.getCalcService().useR1C1?t.R1C1:t.A1:(this.getCalcService().useR1C1=n===t.R1C1,this)},recalcAll:function(){var n=this.getCalcService();n.recalculateAll()},_recalcCell:function(n,t,i){var r=this.getCalcService();r.recalculate({target:this,model:n},t,i)},getCalcService:function(){return this.calcService||(this.calcService=new u.Calc.Service(this)),this.calcService},_getCalcContexts:function(){var n=[],t=this._getModel();return n.push({name:this._name,target:this,refModel:t}),n},updateCalcContexts:function(){var n=this.getCalcService();n.contextChanged()},suspendCalcService:function(){this.calcService&&this.calcService.suspend()},resumeCalcService:function(){this.calcService&&this.calcService.resume()},_getSheetSource:function(n){return n===undefined||n===null||n===i.SheetArea.viewport?this._vpSheetSource:null},getCustomFunction:function(n){return this._functions&&n&&n!==""?this._functions[n.toUpperCase()]:null},addCustomFunction:function(n){if(!n||!(n instanceof u.Calc.Functions.Function))throw new Error("invalid custom function");var t=n.name.toUpperCase();this._functions||(this._functions={}),this._functions[t]=n,this.recalcAll()},removeCustomFunction:function(n){this._functions&&n&&n!==""&&(n=n.toUpperCase(),this._functions.hasOwnProperty(n)&&(delete this._functions[n],this.recalcAll()))},clearCustomFunctions:function(){this._functions&&(delete this._functions,this.recalcAll())},_findCustomFunction:function(n){if(!n||n==="")return null;var t=this.getCustomFunction(n);return!t&&this.parent&&this.parent.getCustomFunction&&(t=this.parent.getCustomFunction(n)),t},getCustomName:function(n){return this._names?this._names[n]:null},addCustomName:function(n,t,r,u){var e,o,f;if(!n||n===""||!t||t==="")throw new Error("invalid custom name");this._names||(this._names={}),e=this.getCalcService(),o=e.parse(t,r,u),this._names[n]=new i.NameInfo(n,o,r,u),f=this._getSheetSource()._getNameCalc(n,!0),f&&(f.updateListening(!0,!0),f.addToDirty()),this.recalcAll()},removeCustomName:function(n){if(this._names&&n&&n!==""&&this._names.hasOwnProperty(n)){delete this._names[n];var t=this._getSheetSource()._getNameCalc(n);t&&(t.updateListening(!0,!1),t.addToDirty()),this.recalcAll()}},clearCustomNames:function(){var i,r,n,t;if(this._names){for(i=this._names,delete this._names,r=this._getSheetSource(),n=0;n<i.length;n++)t=r._getNameCalc(i[n]),t&&(t.updateListening(!0,!1),t.addToDirty());this.recalcAll()}},_findCustomName:function(n){if(!n||n==="")return null;var t=this.getCustomName(n);return!t&&this.parent&&this.parent.getCustomName&&(t=this.parent.getCustomName(n)),t},setFormula:function(n,t,r,u){var o=i.SheetArea,e,f;if(u===o.colHeader||u===o.rowHeader)return;(u===undefined||u===null)&&(u=o.viewport),e=i.Events;if(n<0||n>=this.getRowCount()||t<0||t>=this.getColumnCount()){this._trigger(e.InvalidOperation,{sheet:this,sheetName:this._name});return}f=this._getSheetSource(),f&&(f.setFormula(n,t,r),this._eventHandler._eventSuspended<1&&this._trigger(e.CellChanged,{sheet:this,sheetName:this._name,row:n,col:t,sheetArea:u,propertyName:"formula"}))},getFormula:function(n,t,r){if(r===undefined||r===null||r===i.SheetArea.viewport){var u=this._getSheetSource();if(u)return u.getFormula(n,t)}return null},hasFormula:function(n,t,r){if(r===undefined||r===null||r===i.SheetArea.viewport){var u=this._getSheetSource();if(u)return u.hasFormula(n,t)}return!1},_findFormulas:function(n,t,i,r){},_rebuildCalcNodes:function(){var t=this._getCalcModel(),u,i,r;if(!t)return;u=this._getSheetSource();if(!u)return;var n=t.nextNonNullRow(-1),f=t.getRowCount(),e=t.getColumnCount();while(0<=n&&n<f){i=t.nextNonNullColumn(n,-1);while(0<=i&&i<e)r=u._getCellCalc(n,i),r&&(r.stopListening(),r.startListening()),i=t.nextNonNullColumn(n,i);n=t.nextNonNullRow(n)}},_name:"",defaults:null,gridline:null,borderColor:"black",borderWidth:1,_zoomFactor:1,frozenRowCount:0,frozenColCount:0,rowHeaderVisible:!0,colHeaderVisible:!0,rowHeaderAutoText:i.HeaderAutoText.numbers,colHeaderAutoText:i.HeaderAutoText.letters,rowHeaderAutoTextIndex:-1,colHeaderAutoTextIndex:-1,rowRangeGroup:null,colRangeGroup:null,_activeRowIndex:0,_activeColIndex:0,activeRowViewportIndex:0,activeColViewportIndex:0,_allowCellOverflow:!1,maxCellOverflowDistance:100,showEditingLocator:!0,keyMap:null,isProtected:!1,_allowUndo:!0,_paintSuspended:!1,_layoutSuspended:0,checkingChanges:!0,autoGenerateColumns:!0,toJSON:function(){var n=this;return{name:n._name,columns:n._colInfos,rows:n._rowInfos,frozenRowCount:n.frozenRowCount,frozenColCount:n.frozenColCount,rowCount:n.getRowCount(),columnCount:n.getColumnCount(),data:n._dataModel,spans:n._getSpanModel(),selections:n.getSelections(),activeRow:n._activeRowIndex,activeCol:n._activeColIndex,gridline:n.gridline,allowCellOverflow:n._allowCellOverflow,dataSource:n._dataSource,rowHeaderAutoText:n.rowHeaderAutoText,colHeaderAutoText:n.colHeaderAutoText,referenceStyle:n.referenceStyle(),_zoomFactor:n._zoomFactor,theme:n.currentTheme()}},fromJSON:function(n){var lt,y,l,et,p,s,h,c,r,v,ct,ht,a;if(!n)return;lt=this.isPaintSuspended(),this.isPaintSuspended(!0);try{var t=this,ei=n.columns,ot=n.rowCount,at=n.columnCount;t._name=t._dataModel.name=n.name,t.setRowCount(ot),t.setColumnCount(at),t.setActiveCell(n.activeRow,n.activeCol),t.frozenRowCount=n.frozenRowCount,t.frozenColCount=n.frozenColCount,t.gridline=n.gridline,t._allowCellOverflow=n.allowCellOverflow,n.dataSource&&(t._dataSource=n.dataSource,t._dataItemType=t._getDataItemType(n.dataSource)),n.rows&&(t._rowInfos=n.rows,t._rowInfos.length=ot),n.columns&&(t._colInfos=n.columns,t._colInfos.length=at);if(n.spans)for(l=0;l<n.spans.length;l++)p=n.spans[l],t._addSpanImp(p.row,p.col,p.rowCount,p.colCount);if(n.colStyles)for(y in n.colStyles)isNaN(y)||(c=parseInt(y,10),t.setStyle(-1,c,n.colStyles[y],u.UI.SheetArea.viewport));if(n.rowStyles)for(y in n.rowStyles)isNaN(y)||(h=parseInt(y,10),t.setStyle(h,-1,n.rowStyles[y],u.UI.SheetArea.viewport));n.rowHeaderAutoText!==null&&n.rowHeaderAutoText!==undefined&&(t.rowHeaderAutoText=n.rowHeaderAutoText),n.colHeaderAutoText!==null&&n.colHeaderAutoText!==undefined&&(t.colHeaderAutoText=n.colHeaderAutoText),n.referenceStyle!==null&&n.referenceStyle!==undefined&&t.referenceStyle(n.referenceStyle),n._zoomFactor&&(t._zoomFactor=n._zoomFactor);if(n.data){t._dataModel.dataTable.length=ot,s=new u.UI._GcSheetModel,s.dataTable=n.data.dataTable,s.dataTable.length=ot,h=s.nextNonNullRow(-1);while(h>=0){c=s.nextNonNullColumn(h,-1);while(c>=0)r=s.getNode(h,c),r&&(r.sparkline&&(v=r.sparkline,ct=new u.UI.SparklineSetting(v.setting),t.setSparkline(v.row,v.col,v.data,v.orientation,v.type,ct,v.axisReference,v.axisOrientation)),typeof r.value!==o&&t.setValue(h,c,r.value),typeof r.style!==o&&t.setStyle(h,c,r.style),typeof r.visualState!==o&&t._dataModel.setVisualState(h,c,r.visualState)),c=s.nextNonNullColumn(h,c);h=s.nextNonNullRow(h)}if(s.dataTable)for(l in s.dataTable)if(typeof l!==e)for(et in s.dataTable[l])typeof et!==e&&(r=s.dataTable[l][et],ht=r.formula,ht&&(r.formula=null,t.setFormula(parseInt(l,10),parseInt(et,10),ht)))}if(n.theme){a=n.theme;if(typeof a=="string"||typeof a===o)t.currentTheme(a);else{var f=a._themeColor,kt=0,dt=1,gt=2,pt=3,wt=4,bt=5,ri=6,ui=7,fi=8,ni=9,ti=10,ii=11,ft=f._colorList[gt],rt=f._colorList[pt],nt=f._colorList[kt],g=f._colorList[dt],tt=f._colorList[wt],it=f._colorList[bt],d=f._colorList[ri],k=f._colorList[ui],b=f._colorList[fi],w=f._colorList[ni],ut=f._colorList[ti],st=f._colorList[ii],yt=new i.ThemeColor(a._name,new i._Color(ft.a,ft.r,ft.g,ft.b),new i._Color(rt.a,rt.r,rt.g,rt.b),new i._Color(nt.a,nt.r,nt.g,nt.b),new i._Color(g.a,g.r,g.g,g.b),new i._Color(tt.a,tt.r,tt.g,tt.b),new i._Color(it.a,it.r,it.g,it.b),new i._Color(d.a,d.r,d.g,d.b),new i._Color(k.a,k.r,k.g,k.b),new i._Color(b.a,b.r,b.g,b.b),new i._Color(w.a,w.r,w.g,w.b),new i._Color(ut.a,ut.r,ut.g,ut.b),new i._Color(st.a,st.r,st.g,st.b)),vt=new i.SpreadTheme(a._name,yt,a._headingFont,a._bodyFont);t.currentTheme(vt)}}}finally{this.isPaintSuspended(lt)}},isPaintSuspended:function(n){return arguments.length===0?this._paintSuspended:(this._paintSuspended!==n&&(this._paintSuspended=n,n||this._layoutSuspended>0||(this.invalidateLayout(),this.repaint())),this)},getName:function(){return this._name},setName:function(n){if(!this._isValidSheetName(n))throw"NotSupportedException";this._name=n,this.parent&&this.parent._doTabHSResize&&this.parent._doTabHSResize()},allowCellOverflow:function(n){if(arguments.length===0)return this._allowCellOverflow;var t=this;return this._bindToAutoRefresh(function(n){return t._allowCellOverflow=n,t})(n)},allowUndo:function(n){if(arguments.length===0)return this._allowUndo;this._allowUndo=n;var t=this.undoManager();return t&&(t._allowUndo=n),this},addRows:function(n,t){if(t<=0)return;this._bindToAutoRefresh(function(n,t){var r,o,f,s,h,e,c,u;(n<0||n>this.getRowCount())&&(n=this.getRowCount()),r=this._getSheetSource();if(r)r.onBeforeAddRemoveRows(n);o=this._getModel(),o.addRows(n,t);if(this._dataSource)for(f=this._dataItemType,s=0;s<t;s++)f?this._dataSource.splice(n,0,new f):this._dataSource.splice(n,0,null);h=this._getCalcModel(),h.addRows(n,t),e=i.SheetArea,c=this._getModel(e.rowHeader),c.addRows(n,t),o.addElements(this._rowInfos,this.getRowCount(),n,t),u=this._getSpanModel(e.rowHeader),u.addRows(n,t),u=this._getSpanModel(),u.addRows(n,t),this._rowFilter&&this._rowFilter._addRows(n,t),this.rowRangeGroup&&this.rowRangeGroup._add(n,t),this._sparklineGroupManager&&this._sparklineGroupManager._addRows(n,t),this._conditionalFormats&&this._conditionalFormats._addRows(n,t);if(r)r.onAfterAddRows(n,t);this._syncScrollbarSize(),this.invalidateLayout()})(n,t)},_onDataDeleted:function(n){},deleteRows:function(n,r){if(0>n||n>=this.getRowCount()||r<=0)return;this._bindToAutoRefresh(function(n,r){var c=this._getSheetSource(),e,a,d,y,b,u,p,v,w,l,k,h,s,f,o;if(c)c.onBeforeAddRemoveRows(n);for(e=this._getModel(),this.autoUpdate&&this.dataContext&&this.dataContext.remove&&(a=this.getDataSource(),a&&a.length>0&&(d=this,this._dataDeleteDelegate=function(n){return d._onDataDeleted(n)},y=n,y<0||(b=this.getDataItem(y),t.ajax({url:this.dataContext.remove,type:vt,data:JSON.stringify(b),dataType:yt,contentType:wt,success:this._dataDeleteDelegate})))),this.deletedRows||(this.deletedRows=[]),u=0;u<r&&n+u<e.rowCount;u++)p=null,this._dataSource&&n+u<this._dataSource.length&&(p=this._dataSource[n+u]),v=null,e.dataTable&&e.dataTable[n+u]&&(v=e.dataTable[n+u].key),this.deletedRows.push({row:n+u,data:p,key:v});this._dataSource&&n<this._dataSource.length&&this._dataSource.splice(n,r),e.deleteRows(n,r),w=this._getCalcModel(),w.deleteRows(n,r),l=i.SheetArea,k=this._getModel(l.rowHeader),k.deleteRows(n,r),e.deleteElements(this._rowInfos,this.getRowCount(),n,r),h=this._getSpanModel(l.rowHeader),h.removeRows(n,r),h=this._getSpanModel(),h.removeRows(n,r),this._rowFilter&&this._rowFilter._removeRows(n,r),this.rowRangeGroup&&this.rowRangeGroup._remove(n,r),this._sparklineGroupManager&&this._sparklineGroupManager._removeRows(n,r),this._conditionalFormats&&this._conditionalFormats._removeRows(n,r),s=this._scrollTopRow;if(s>=0){for(f=-1,o=s;o>=this.frozenRowCount;o--)if(this.getRowVisible(o)&&this._getZoomRowHeight(o)>0){f=o;break}f===-1&&(f=0),s!==f&&(this._trigger(i.Events.TopRowChanged,{sheet:this,sheetName:this._name,oldTopRow:s,newTopRow:f}),this._scrollTopRow=f,this._syncVScrollbarPosition())}if(c)c.onAfterRemoveRows(n,r);this._syncScrollbarSize(),this.invalidateLayout()})(n,r)},addColumns:function(n,t){if(t<=0)return;this._bindToAutoRefresh(function(n,t){var r,f,o,e,s,u;(n<0||n>this.getColumnCount())&&(n=this.getColumnCount());if(this.parent&&this.parent.gcSpreadsheet)return;r=this._getSheetSource();if(r)r.onBeforeAddRemoveColumns(n);f=this._getModel(),f.addColumns(n,t),o=this._getCalcModel(),o.addColumns(n,t),e=i.SheetArea,s=this._getModel(e.colHeader),s.addColumns(n,t),f.addElements(this._colInfos,this.getColumnCount(),n,t),u=this._getSpanModel(e.colHeader),u.addColumns(n,t),u=this._getSpanModel(),u.addColumns(n,t),this._rowFilter&&this._rowFilter._addColumns(n,t),this._allowCellOverflow===!0&&this._clearCellOverflowModelCache(),this.colRangeGroup&&this.colRangeGroup._add(n,t),this._sparklineGroupManager&&this._sparklineGroupManager._addColumns(n,t),this._conditionalFormats&&this._conditionalFormats._addColumns(n,t);if(r)r.onAfterAddColumns(n,t);this._syncScrollbarSize(),this.invalidateLayout()})(n,t)},deleteColumns:function(n,t){if(0>n||n>=this.getColumnCount()||t<=0)return;if(this.parent&&this.parent.gcSpreadsheet)return;this._bindToAutoRefresh(function(n,t){var o=this._getSheetSource(),h,c,e,l,s,f,r,u;if(o)o.onBeforeAddRemoveColumns(n);h=this._getModel(),h.deleteColumns(n,t),c=this._getCalcModel(),c.deleteColumns(n,t),e=i.SheetArea,l=this._getModel(e.colHeader),l.deleteColumns(n,t),h.deleteElements(this._colInfos,this.getColumnCount(),n,t),s=this._getSpanModel(e.colHeader),s.removeColumns(n,t),s=this._getSpanModel(e.viewport),s.removeColumns(n,t),this._rowFilter&&this._rowFilter._removeColumns(n,t),this._allowCellOverflow===!0&&this._clearCellOverflowModelCache(),this.colRangeGroup&&this.colRangeGroup._remove(n,t),this._sparklineGroupManager&&this._sparklineGroupManager._removeColumns(n,t),this._conditionalFormats&&this._conditionalFormats._removeColumns(n,t),f=this._scrollLeftCol;if(f>=0){for(r=-1,u=f;u>=this.frozenColCount;u--)if(this.getColumnVisible(u)&&this._getZoomColumnWidth(u)>0){r=u;break}r===-1&&(r=0),f!==r&&(this._trigger(i.Events.LeftColumnChanged,{sheet:this,sheetName:this._name,oldLeftCol:f,newLeftCol:r}),this._scrollLeftCol=r,this._syncHScollbarPosition())}if(o)o.onAfterRemoveColumns(n,t);this._syncScrollbarSize(),this.invalidateLayout()})(n,t)},setFrozenCount:function(n,t){(n===undefined||n===null||n<0||isNaN(n))&&(n=0),(t===undefined||t===null||t<0||isNaN(t))&&(t=0),this._bindToAutoRefresh(function(n,t){var i=!1;this.frozenRowCount!==n&&(this._scrollTopRow+=n-this.frozenRowCount,this.frozenRowCount=n,i=!0),this.frozenColCount!==t&&(this._scrollLeftCol+=t-this.frozenColCount,this.frozenColCount=t,i=!0),i&&(this.invalidateLayout(),this._syncScrollbarSize())})(n,t)},getRowCount:function(n){var t=this._getModel(n);return t?t.rowCount:0},getColumnCount:function(n){var t=this._getModel(n);return t?t.colCount:0},setRowCount:function(n,t){n=parseInt(n,10);if(isNaN(n))return;if(n<0)return;this._bindToAutoRefresh(function(n,t){var r=i.SheetArea;t===undefined||t===null||t===r.viewport||t===r.rowHeader?(this._dataModel.rowCount>n&&this.deleteRows(n,this._dataModel.rowCount-n),this._dataModel.rowCount=this._calcDataModel.rowCount=this._rowHeaderModel.rowCount=n,this.frozenRowCount>n&&this.setFrozenCount(n,this.frozenColCount),this._rowInfos||(this._rowInfos={}),this.rowRangeGroup&&this.rowRangeGroup._setCount(n)):t===r.colHeader&&(this._colHeaderRowInfos||(this._colHeaderRowInfos={}),this._colHeaderModel.rowCount=n),this.rowRangeGroup&&this.rowRangeGroup.refresh(),this._syncScrollbarSize(),this._activeRowIndex<n||(this._clearSelectionImp(),this._setActiveCellImp(-1,-1,this.activeRowViewportIndex,this.activeColViewportIndex))})(n,t)},setColumnCount:function(n,t){n=parseInt(n,10);if(isNaN(n))return;if(n<0)return;this._bindToAutoRefresh(function(n,t){var r=i.SheetArea;t===undefined||t===null||t===r.viewport||t===r.colHeader?(this._dataModel.colCount>n&&this.deleteColumns(n,this._dataModel.colCount-n),this._dataModel.colCount=this._calcDataModel.colCount=this._colHeaderModel.colCount=this._colFooterModel.colCount=n,this.frozenColCount>n&&this.setFrozenCount(this.frozenRowCount,n),this._colInfos||(this._colInfos={}),this.colRangeGroup&&this.colRangeGroup._setCount(n)):t===r.rowHeader&&(this._rowHeaderColInfos||(this._rowHeaderColInfos={}),this._rowHeaderModel.colCount=n),this.colRangeGroup&&this.colRangeGroup.refresh(),this._syncScrollbarSize(),this._activeColIndex<n||(this._clearSelectionImp(),this._setActiveCellImp(-1,-1,this.activeRowViewportIndex,this.activeColViewportIndex))})(n,t)},getText:function(n,t,r){var u;(r===undefined||r===null)&&(r=i.SheetArea.viewport),u=this.getValue(n,t,r);if(u===undefined||u===null)return"";else{var o=this._getCellType(n,t,r),f=this.getActualStyle(n,t,r),e=f.formatter?f.formatter:f._autoFormatter;return u=o.format(u,e)}},setText:function(n,t,r,u){this._bindToAutoRefresh(function(n,t,r,u){(u===undefined||u===null)&&(u=i.SheetArea.viewport);var o=r,e=this._getCellType(n,t,u),f=this.getCell(n,t,u).formatter();e&&f&&(o=e.parse(r,f)),this.setValue(n,t,o,u)})(n,t,r,u)},getValue:function(n,t,r){var h=i.SheetArea,e,u,o,f,c,s;return(r===undefined||r===null)&&(r=h.viewport),e=this._getModel(r),e?(u=this._getValueImp(e,n,t,r),o=i.HeaderAutoText,r===h.colHeader?(u===undefined||u===null)&&(c=this.getDataSource(),c&&c.length>0&&(s=this._colInfos[t],s&&(this.colHeaderAutoTextIndex>=0&&n===this.colHeaderAutoTextIndex||this.colHeaderAutoTextIndex===-1&&n===e.rowCount-1)&&(u=s.displayName||s.name)),(u===undefined||u===null)&&(f=this.colHeaderAutoTextIndex,(f<0||f>=e.rowCount)&&(f=e.rowCount-1),n===f&&(this.colHeaderAutoText===o.letters?u=this._indexToLetters(t+1):this.colHeaderAutoText===o.numbers&&(u=t+1)))):r===h.rowHeader&&(u===undefined||u===null)&&(f=this.rowHeaderAutoTextIndex,(f<0||f>=e.colCount)&&(f=e.colCount-1),t===f&&(this.rowHeaderAutoText===o.letters?u=this._indexToLetters(n+1):this.rowHeaderAutoText===o.numbers&&(u=n+1))),u):null},setValue:function(n,t,r,u,f){this._bindToAutoRefresh(function(n,t,r,u,f){var h,v,y,a,l,p,c,s;(u===undefined||u===null)&&(u=i.SheetArea.viewport),h=this._getModel(u);if(!h)return;v=h.rowCount,y=h.colCount;if(n<0||n>=v||t<0||t>=y)return;r!==undefined&&r!==null&&r.constructor===Date&&(r="/Date("+r.getTime()+")/"),a=this._getValueImp(h,n,t,u),u===undefined||u===null||u===i.SheetArea.viewport?(l=!1,this._dataSource&&(p=this._dataSource.length,n<p&&(c=this._dataSource[n],c&&(s=this._colInfos[t],s&&s.name&&s.name.length>0&&(typeof s.value===e?s.value(c,r):typeof k!==o&&k.isWriteableObservable(c[s.name])?c[s.name](r):c[s.name]=r,l=!0)))),(!l||this.checkingChanges)&&(h.setValue(n,t,r),this._activeRowDirty=!0)):h.setValue(n,t,r),u!==undefined&&u!==null&&u!==i.SheetArea.viewport||f||this._recalcCell(h,n,t),this._allowCellOverflow&&this._clearCellOverflowModelCachebyRow(n,u),a!==r&&this._trigger(i.Events.CellChanged,{sheet:this,sheetName:this._name,row:n,col:t,sheetArea:u,propertyName:rt,_oldValue:a})})(n,t,r,u,f)},sortRange:function(n,t,u,f,e,o){return this._bindToAutoRefresh(function(n,t,u,f,e,o){var ct=this.isPaintSuspended(),st,ot,et,w,b,h,s,y,v,ft,ut,it,k,d,nt,tt;this.isPaintSuspended(!0);try{st=this.getSpans(new i.Range(n,t,u,f));if(st&&st.length>0)return!1;ot=this.getRowCount(),et=this.getColumnCount(),n===-1&&(n=0),u===-1&&(u=ot),t===-1&&(t=0),f===-1&&(f=et);if(n<0||n>=ot||t<0||t>=et||u<0||n+u>ot||f<0||t+f>et||!o)return!1;ft=this._quickSort(n,t,u,f,e,o);if(ft){var ht=this._getModel(),c=this._getCalcModel(),p=this._getSheetSource(),g,a,l;if(e)for(b=n;b<n+u;b++){g=this._getSwapIndex(ft,n,b,u,!0);if(b===g)continue;for(h=b,y=g,w=t;w<t+f;w++)s=w,ut=this.getValue(h,s),it=this.getValue(y,s),k=p._getCellCalc(h,s,!1),k&&k.hasListeners()&&k.addListenersToAdjust(),d=p._getCellCalc(y,s,!1),d&&d.hasListeners()&&d.addListenersToAdjust(),c.swapNode(h,s,y,s),a=r._copyExpression(c.getFormula(h,s),h,s),c.setFormula(h,s,a),l=p._getCellCalc(h,s,!!a),l&&l.startListening(),a=r._copyExpression(c.getFormula(y,s),y,s),c.setFormula(y,s,a),l=p._getCellCalc(y,s,!!a),l&&l.startListening(),p._controller.adjustFormulasOnSwap(c,h,s,c,y,s,1,1),ht.swapNode(h,s,y,s),this.setValue(h,s,it),this.setValue(y,s,ut)}else for(w=t;w<t+f;w++){g=this._getSwapIndex(ft,t,w,f,!1);if(w===g)continue;for(s=w,v=g,b=n;b<n+u;b++)h=b,ut=this.getValue(h,s),it=this.getValue(h,v),k=p._getCellCalc(h,s,!1),k&&k.hasListeners()&&k.addListenersToAdjust(),d=p._getCellCalc(h,v,!1),d&&d.hasListeners()&&d.addListenersToAdjust(),c.swapNode(h,s,h,v),a=r._copyExpression(c.getFormula(h,s),h,s),c.setFormula(h,s,a),l=p._getCellCalc(h,s,!!a),l&&l.startListening(),a=r._copyExpression(c.getFormula(h,v),h,v),c.setFormula(h,v,a),l=p._getCellCalc(h,v,!!a),l&&l.startListening(),p._controller.adjustFormulasOnSwap(c,h,s,c,h,v,1,1),ht.swapNode(h,s,h,v),this.setValue(h,s,it),this.setValue(h,v,ut)}return!0}return!1}finally{for(this.resumeCalcService(),this.resumeEvent(),nt=0;nt<u;nt++)for(tt=0;tt<f;tt++)this._raiseCellChanged(rt,n+nt,t+tt,1,1,i.SheetArea.viewport);this._raisePropertyChanged("[sort]"),this.isPaintSuspended(ct)}})(n,t,u,f,e,o)},getActualStyle:function(n,t,r,u){var f,v,o,l,a,c,s,e,y,h;(r===undefined||r===null)&&(r=i.SheetArea.viewport),f=new i.Style,v=this.getCompositeStyle(n,t,r);if(r===i.SheetArea.viewport)if(!u){o=v.formatter,o&&o.HasFormatedColor&&o.HasFormatedColor()&&(l={},o.Format(this.getValue(n,t),l),l.value&&(f.foreColor=l.value)),a=this._conditionalFormats;if(a&&a.count()>0)for(c=a.getRules(n,t),s=0;s<c.length;s++)e=c[c.length-1-s],e&&(e.isScaleRule()?(y=e.evaluate(this,n,t,this.getValue(n,t,r)),y&&(f.backColor=y)):(h=e.evaluate(this,n,t,this.getValue(n,t,r)),h!==null&&h!==undefined&&f.compose(h)))}return f.compose(v),(f.locked===undefined||f.locked===null)&&(f.locked=!0),f._normalize(new i._ThemeContext(this))},getStyle:function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getModel(r);return u?u.getStyle(n,t):null},setStyle:function(n,t,r,u){this._bindToAutoRefresh(function(n,t,r,u){var h=i.SheetArea,c,f,o,s;(u===undefined||u===null)&&(u=h.viewport),c=this._getModel(u),c&&(c.setStyle(n,t,r),r&&r.formatter&&(f=r.formatter,typeof f===w&&(f=new i.GeneralFormatter(f)),f&&typeof f.Init===e&&f.Init()),o=i.Events,s="[styleinfo]",n!==-1&&t!==-1?this._trigger(o.CellChanged,{sheet:this,sheetName:this._name,row:n,col:t,sheetArea:u,propertyName:s}):n!==-1&&t===-1?this._trigger(o.RowChanged,{sheet:this,sheetName:this._name,row:n,sheetArea:u,propertyName:s}):n===-1&&t!==-1&&this._trigger(o.ColumnChanged,{sheet:this,sheetName:this._name,col:t,sheetArea:u,propertyName:s})),this._allowCellOverflow&&(u===h.colHeader||n===-1?this._clearCellOverflowModelCache():(u===h.viewport||t===-1)&&this._clearCellOverflowModelCachebyRow(n,u))})(n,t,r,u)},getDefaultStyle:function(n){var f=i.SheetArea,r,u,t;return(n===undefined||n===null)&&(n=f.viewport),r=this._getModel(n),r?(u=r.getStyle(-1,-1),t=new i.Style,n===f.colHeader||n===f.rowHeader?(t.foreColor="black",t.hAlign=i.HorizontalAlign.center,t.vAlign=i.VerticalAlign.center):(t.foreColor="black",t.hAlign=i.HorizontalAlign.general,t.vAlign=i.VerticalAlign.top),u?(u.compose(t),u):(r.setStyle(-1,-1,t),t)):null},setDefaultStyle:function(n,t){(t===undefined||t===null)&&(t=i.SheetArea.viewport);var r=this._getModel(t);r&&r.setStyle(-1,-1,n)},getCompositeStyle:function(n,t,r){var e,u,h,c,f,s,o;return(r===undefined||r===null)&&(r=i.SheetArea.viewport),e=new i.Style,u=this._getModel(r),u&&(h=u.rowCount,c=u.colCount,0<=n&&n<h&&0<=t&&t<c&&(s=u.getStyle(n,t),s&&e.compose(s)),0<=n&&n<h&&(f=u.getStyle(n,-1),f&&e.compose(f)),0<=t&&t<c&&(f=u.getStyle(-1,t),f&&e.compose(f))),o=this.getDefaultStyle(r),o&&e.compose(o),e},getFormatter:function(n,t,i){var r=this.getActualStyle(n,t,i);return r?r.formatter:undefined},setFormatter:function(n,t,r,u){var f=this.getStyle(n,t,u);f||(f=new i.Style),f.formatter=r,this.setStyle(n,t,f,u)},getDataValidator:function(n,t,i){var r=this.getActualStyle(n,t,i);return r?r.validator:undefined},setDataValidator:function(n,t,r,u){var f,o,e;(u===undefined||u===null)&&(u=i.SheetArea.viewport),f=this.getStyle(n,t,u),f||(f=new i.Style),f.validator=r,this.setStyle(n,t,f,u),r&&(r.condition instanceof i.FormulaCondition&&(r.condition._baseRow===undefined||r.condition._baseRow===null)&&(r.condition._baseRow=n!==-1?n:0),r.condition instanceof i.FormulaCondition&&(r.condition._baseCol===undefined||r.condition._baseCol===null)&&(r.condition._baseCol=t!==-1?t:0)),o=i.Events,e="validator",this._trigger(o.CellChanged,{sheet:this,sheetName:this._name,row:n,col:t,sheetArea:u,propertyName:e}),n!==-1&&t===-1?this._trigger(o.RowChanged,{sheet:this,sheetName:this._name,row:n,sheetArea:u,propertyName:e}):n===-1&&t!==-1&&this._trigger(o.ColumnChanged,{sheet:this,sheetName:this._name,col:t,sheetArea:u,propertyName:e})},isValid:function(n,t,i){try{this._validatingRow=n,this._validatingColumn=t,this._validatingValue=i,this._isValidatingCell=!0;var r=this.getDataValidator(n,t);if(r)return r.isValid(this,n,t,i)}finally{this._validatingRow=-1,this._validatingColumn=-1,this._validatingValue=null,this._isValidatingCell=!1}return!0},addSelection:function(n,t,r,u){this._bindToAutoRefresh(function(n,t,r,u){var o=n,s=t,c=r,h=u,e,f;o!==-1&&s!==-1&&(e=this._getSpanModel().slice(0),e&&e.length>0&&(f=this._cellRangeInflate(e,new i.Range(n,t,r,u)),o=f.row,s=f.col,c=f.rowCount,h=f.colCount)),this._selectionModel.add(o,s,c,h)})(n,t,r,u)},getSelections:function(){return this._selectionModel},_addSpanImp:function(n,t,r,u,f){this._bindToAutoRefresh(function(n,t,r,u,f){var h,e,c,s,o;(f===undefined||f===null)&&(f=i.SheetArea.viewport),h=this._getSpanModel(f),h.clear(n,t,r,u),e=new i.Range(n,t,r,u),c=this._getActualRange(e,f),h.push(c);if(this._allowCellOverflow)for(e=n;e<n+r;e++)this._clearCellOverflowModelCachebyRow(e,f);for(s=this.getSelections(),o=0;o<s.length;o++)s[o].intersect(n,t,r,u)&&(s[o]=s[o].union(e))})(n,t,r,u,f)},addSpan:function(n,t,r,u,f){var o,e;if(r===1&&u===1)return;if(f===i.SheetArea.corner)return;var c=this._getSpanModel(f),h=c.getEnumerator(n,t,r,u),s=!0;while(h.moveNext()){o=h.current(),e=new i.Range(n,t,r,u);if(!e.containsRange(o)){s=!1;break}}if(!s)throw new Error("Invalid range");this._addSpanImp(n,t,r,u,f)},removeSpan:function(n,t,r){this._bindToAutoRefresh(function(n,t,r){var o,f,u,e;for((r===undefined||r===null)&&(r=i.SheetArea.viewport),o=this._getSpanModel(r),f=0;f<o.length;f++){u=o[f];if(u.row===n&&u.col===t){o.splice(f,1);if(this._allowCellOverflow)for(e=u.row;e<u.row+u.rowCount;e++)this._clearCellOverflowModelCachebyRow(e,r);return}}})(n,t,r)},repaint:function(n){this._paintSuspended||this._render.repaint(n)},startEdit:function(n,t){this._startEditImp(this._getCanvas(),this._activeRowIndex,this._activeColIndex,null,null,n,t)},isEditing:function(){return this._isEditing},doKeyDown:function(n){this._eventHandler.doKeyDown(n)},doKeyUp:function(n){this._eventHandler.doKeyUp(n)},removeKeyMap:function(n,t,i,r,u){var e,f;if(!this.keyMap)return;for(e=0;e<this.keyMap.length;e++){f=this.keyMap[e];if(f&&f.key===n&&f.ctrl===t&&f.shift===i&&f.alt===r){this.keyMap.splice(e,1);break}}},addKeyMap:function(n,t,r,u,f){this.keyMap||(this.keyMap=[]);var e=this._getKeyAction(n,t,r,u);e?e.action=f:this.keyMap.push(new i.KeyMap(n,t,r,u,f))},moveActiveCell:function(n,t,r,u,f,e){var s={sheet:this,sheetName:this._name,row:this._activeRowIndex,col:this._activeColIndex,cancel:!1},h,c,o;return this._trigger(i.Events.LeaveCell,s),s&&s.cancel===!0?!1:this.endEdit()?(this._activeRowDirty&&(this.updateRecord(),this._activeRowDirty=!1),h=this._activeRowIndex,c=this._activeColIndex,(r===undefined||r===null)&&(r=this._activeRowIndex),(u===undefined||u===null)&&(u=this._activeColIndex),o=i.Direction,n===o.left?this._moveActiveCellLeft(r,u,t,!1,!1):n===o.right?this._moveActiveCellRight(r,u,t,!1,!1):n===o.up?this._moveActiveCellUp(r,u,t,!1,!1):n===o.down&&this._moveActiveCellDown(r,u,t,!1,!1),f=this.moveActiveCellEnd(n,h,c,f,e)):!1},_moveActiveCellInSelection:function(n){var t={sheet:this,sheetName:this._name,row:this._activeRowIndex,col:this._activeColIndex,cancel:!1},u,r;this._trigger(i.Events.LeaveCell,t);if(t&&t.cancel===!0)return;this.endEdit(),this._activeRowDirty&&(this.updateRecord(),this._activeRowDirty=!1),u=this._activeRowIndex,r=this._activeColIndex,n===i.Direction.left?this._moveActiveCellLeftInSelection(this._activeRowIndex,this._activeColIndex):n===i.Direction.right&&this._moveActiveCellRightInSelection(this._activeRowIndex,this._activeColIndex),this.moveActiveCellEnd(n,u,r)},subscriptionHandlers:[],doDataItemChanged:function(){var f=this,u,r,t,i;this.activeDataItemChangedhandler=function(n){f.repaint()},u=this.getDataSource();if(u&&typeof n.ko!==o){while(this.subscriptionHandlers.length>0)r=this.subscriptionHandlers.pop(),typeof r.dispose===e&&r.dispose();t=u[this._activeRowIndex];for(i in t)t[i]&&typeof t[i].subscribe===e&&this.subscriptionHandlers.push(t[i].subscribe(this.activeDataItemChangedhandler,null,null))}},moveActiveCellEnd:function(n,t,r,u,f){var it=this._selectionModel.toArray(),b,c,p,a,rt,nt,w,et,y,d,v,l,h,e,g;this.shift||this._isNavigateInSelection||(b=this._getActiveSelectedRange(),(this._selectionModel.length>1||b.rowCount>1||b.colCount>1)&&(u=!0),this._clearSelectionImp()),c=this._spanModel.find(this._activeRowIndex,this._activeColIndex),c?(this._activeRowCount=c.rowCount,this._activeColCount=c.colCount):(this._activeRowCount=1,this._activeColCount=1),this._isNavigateInSelection||(this._extendSelectedRange(this._activeRowIndex,this._activeColIndex,!1),p=this._selectionModel.toArray(),this._eventHandler._notEqualSelecions(it,p)&&(a=i.Events,this._trigger(a.SelectionChanging,{sheet:this,sheetName:this._name,oldSelections:it,newSelections:p}),this._trigger(a.SelectionChanged,{sheet:this,sheetName:this._name}))),rt=this.frozenColCount?this._getNextVisualColumn(this.frozenColCount-1):this._getFirstVisualColumn(),nt=this.frozenRowCount?this._getNextVisualRow(this.frozenRowCount-1):this._getFirstVisualRow(),this._activeColIndex<this._scrollLeftCol&&this._activeColIndex>=rt&&(f=this._setLeftColumn(this._getPrevVisualColumn(this._activeColIndex+1))||f);if(this._activeColIndex>this._getLastFullyVisibleColumn()&&this._activeColIndex<=this._getLastVisualColumn()){w=this._getColumnLayout(1);if(!w||w.length<=0)return!1;var tt=0,s=this._activeColIndex,ot=this._getSheetLayout();while(s>this._scrollLeftCol){tt+=this._getZoomColumnWidth(s);if(tt>ot.viewportWidth)break;s--}et=this._getNextVisualColumn(s),f=this._setLeftColumn(et)||f}this._activeRowIndex<this._scrollTopRow&&this._activeRowIndex>=nt&&(f=this._setTopRow(this._getPrevVisualRow(this._activeRowIndex+1))||f);if(this._activeRowIndex>this._getLastFullyVisibleRow()&&this._activeRowIndex<=this._getLastVisualRow()){y=this._getRowLayout(1);if(!y||y.length<=0)return!1;var ct=this.frozenRowCount?this._getNextVisualRow(this.frozenRowCount-1):this._getFirstVisualRow(),ft=0,o=this._activeRowIndex,ht=this._getSheetLayout();while(o>this._scrollTopRow){ft+=this._getZoomRowHeight(o);if(ft>ht.viewportHeight)break;o--}d=this._getNextVisualRow(o),f=this._setTopRow(d)||f}this._activeRowIndex===this._getLastVisualRow()&&(f=this._setTopRow(this._getLastPageTopRow())||f),this._activeColIndex===this._getLastVisualColumn()&&(f=this._setLeftColumn(this._getLastPageLeftColumn())||f),this.doDataItemChanged(),u&&!f?(this.invalidateLayout(),this.repaint(),u=!0):u||f||(h=this._spanModel.find(t,r),h?(v=h.rowCount,l=h.colCount):(v=1,l=1),this._render.repaintSelection(new i.Range(t,r,v,l)),this._render.repaintSelection(new i.Range(this._activeRowIndex,this._activeColIndex,this._activeRowCount,this._activeColCount))),e=this._eventHandler,g=e.oldTop!==this._scrollTopRow,e.oldTop=this._scrollTopRow,e.oldLeft=this._scrollLeftCol;if(g){var k=this.getViewportTopRow(1),st=this.getViewportBottomRow(1),ut=Math.max(0,k-60);ut<this.getRowCount()&&e._loadData(ut,2*st-k)}return this._trigger(i.Events.EnterCell,{sheet:this,sheetName:this._name,row:this._activeRowIndex,col:this._activeColIndex}),u||f},endEdit:function(n){var r=this._textBox,u,e,o;if(r&&r.parentNode){if(this._activeRowIndex>=0&&this._activeColIndex>=0&&!n){var f=this._getCellType(this._activeRowIndex,this._activeColIndex),s=f.getEditorValue(r),h=this._textBox._oldValue;if(h!==s){e={row:this._activeRowIndex,col:this._activeColIndex,newValue:s},u=new i.UndoRedo.CellEditUndoAction(this,e),this._doCommand(u),o=u.applyResult===i.DataValidationResult.Retry;if(o===!0)return!1}t(r).unbind(d),f.endEdit&&f.endEdit(r)}this._dirty=!0;if(r){try{this.showEditingLocator&&r._editingLocator&&r.parentNode.removeChild(r._editingLocator),r.parentNode.removeChild(r),r.value=""}catch(c){}this._trigger(i.Events.EditEnd,{sheet:this,sheetName:this._name,row:this._activeRowIndex,col:this._activeColIndex})}}return this._eventHandler._setFocus(),this._editingTimeValue=!1,this._isEditing=!1,u&&u.applyResult===i.DataValidationResult.Discard?!1:!0},hitTest:function(n,t,i){var r,f,u;return this._getSheetLayout(),r={x:n,y:t,rowViewportIndex:null,colViewportIndex:null,row:-1,col:-1,resizeInfo:null,hitTestType:null,groupHitInfo:null,filterButtonHitInfo:null},f=this._render.groupHitTest(n,t),f?r.groupHitInfo=f:(r.rowViewportIndex=this._getRowPane(t),r.colViewportIndex=this._getColumnPane(n),r.row=this._getRowIndex(t,r.rowViewportIndex),r.col=this._getColumnIndex(n,r.colViewportIndex),r.rowViewportIndex<0||r.rowViewportIndex>=2||r.colViewportIndex<0||(u=this._getCellLayout(r.rowViewportIndex,r.colViewportIndex).findCell(r.row,r.col),u&&i!==!0&&(r.row=u.row,r.col=u.col)),r.resizeInfo=this._eventHandler.getResizingRowCol(r,n,t),r.resizeInfo===null&&(r.dragInfo=this._eventHandler.getDragInfo(r,n,t)),r.hitTestType=this._getSheetAreaFromHitTest(r),r.resizeInfo||r.dragInfo||(r.filterButtonHitInfo=this._getFilterButtonHitInfo(r,n,t))),r},getCellRect:function(n,t,r,u){var c=i.SheetArea,e=c.viewport,h,f,s,a,l;r===-1?e=c.colHeader:u===-1?e=c.rowHeader:r===2&&(e=c.colFooter),h=i.Rect,f=this._getSheetLayout();if(r===-1&&u===-1)return new h(f.headerX,f.headerY,f.rowHeaderWidth,f.colHeaderHeight);s=this._bounds,(r===undefined||r===null)&&(r=n<this.frozenRowCount?0:1),(u===undefined||u===null)&&(u=t<this.frozenColCount?0:1);var v=this._getRowLayout(r,e).findRow(n),y=this._getColumnLayout(u,e).findCol(t),o=this._getCellLayout(r,u,e).findCell(n,t);return o?(a=o.x-s.x,l=o.y-s.y,new h(a>=0?a:f.frozenX,l>=0?l:f.frozenY,o.width,o.height)):v&&y?new h(y.x-s.x,v.y-s.y,y.width,v.height):new h},_setActiveCellImp:function(n,t,r,u){this._activeRowIndex!==n&&this._activeRowDirty&&(this.updateRecord(),this._activeRowDirty=!1);var f=this._spanModel.find(n,t);f?(this._activeRowCount=f.rowCount,this._activeColCount=f.colCount):(this._activeRowCount=1,this._activeColCount=1),this._render.repaintSelection(new i.Range(this._activeRowIndex,this._activeColIndex,1,1)),this._activeRowIndex=n,this._activeColIndex=t,this._leadingCellRow=n,this._leadingCellCol=t,this.activeRowViewportIndex=r,this.activeColViewportIndex=u,this._render.repaintSelection(new i.Range(n,t,1,1))},setActiveCell:function(n,t,i,r){this._bindToAutoRefresh(function(n,t,i,r){var f=this.getRowCount(),e=this.getColumnCount(),u;n<0?n=0:n<f||(n=f-1),t<0?t=0:t<e||(t=e-1),this._clearSelectionImp(),this._setActiveCellImp(n,t,i,r),u=this._spanModel.find(n,t),u?this._setSelectedRange(u.row,u.col,u.rowCount,u.colCount):this._setSelectedRange(n,t,1,1)})(n,t,i,r)},getActiveRowIndex:function(){return this._activeRowIndex},getActiveColumnIndex:function(){return this._activeColIndex},getRowResizable:function(n,t){(t===undefined||t===null)&&(t=i.SheetArea.viewport);var u=!0,r=this._getRowInfos(t);return r&&r[n]&&r[n].resizable!==undefined&&r[n].resizable!==null&&(u=r[n].resizable),u},setRowResizable:function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getRowInfos(r);u[n]||(u[n]={}),u[n].resizable=t,u[n].dirty=!0,this._trigger(i.Events.RowChanged,{sheet:this,sheetName:this._name,row:n,sheetArea:r,propertyName:"resizable"})},getColumnResizable:function(n,t){(t===undefined||t===null)&&(t=i.SheetArea.viewport);var u=!0,r=this._getColumnInfos(t);return r&&r[n]&&r[n].resizable!==undefined&&r[n].resizable!==null&&(u=r[n].resizable),u},setColumnResizable:function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getColumnInfos(r);u[n]||(u[n]={}),u[n].resizable=t,u[n].dirty=!0,this._trigger(i.Events.ColumnChanged,{sheet:this,sheetName:this._name,col:n,sheetArea:r,propertyName:"resizable"})},getRowHeight:function(n,t){var u,r;if(t===undefined||t===null||t===i.SheetArea.rowHeader||t===i.SheetArea.viewport){if(n<0||n>=this.getRowCount(t))return 0;if(this._rowFilter&&this._rowFilter.isHideRowFilter())if(this._rowFilter.isFiltered()&&this._rowFilter.isRowFilteredOut(n))return 0;if(this.rowRangeGroup&&!this.rowRangeGroup._isEmpty())if(this.rowRangeGroup.isCollapsed(n))return 0}u=this.defaults.rowHeight,t===i.SheetArea.colHeader&&(u=this.defaults.colHeaderRowHeight),r=this._getRowInfos(t);if(r&&r[n])if(r[n].visible===!1)return 0;else isNaN(r[n].size)||(u=parseInt(r[n].size,10));return u},_getActualRowHeight:function(n,t){var f=i.SheetArea,u,r;if(t===undefined||t===null||t===f.rowHeader||t===f.viewport)if(n<0||n>=this.getRowCount(t))return 0;return u=this.defaults.rowHeight,t===i.SheetArea.colHeader&&(u=this.defaults.colHeaderRowHeight),r=this._getRowInfos(t),r&&r[n]&&(isNaN(r[n].size)||(u=parseInt(r[n].size,10))),u},setRowHeight:function(n,t,r){this._bindToAutoRefresh(function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getRowInfos(r);u[n]||(u[n]={}),u[n].size=t,u[n].dirty=!0,this._trigger(i.Events.RowChanged,{sheet:this,sheetName:this._name,row:n,sheetArea:r,propertyName:f})})(n,t,r)},getRowVisible:function(n,t){var f=i.SheetArea,u,r;if(t===undefined||t===null||t===f.viewport||t===f.rowHeader){if(this._rowFilter&&this._rowFilter.isHideRowFilter())if(this._rowFilter.isFiltered()&&this._rowFilter.isRowFilteredOut(n))return!1;if(this.rowRangeGroup&&!this.rowRangeGroup._isEmpty())if(0<=n&&n<this.getRowCount(t)&&this.rowRangeGroup.isCollapsed(n))return!1}return u=!0,r=this._getRowInfos(t),r&&r[n]&&r[n].visible!==undefined&&r[n].visible!==null&&(u=r[n].visible),u},setRowVisible:function(n,t,r){this._bindToAutoRefresh(function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getRowInfos(r);u[n]||(u[n]={});if(u[n].visible===t)return;u[n].visible=t,u[n].dirty=!0,this._trigger(i.Events.RowChanged,{sheet:this,sheetName:this._name,row:n,sheetArea:r,propertyName:"isVisible"})})(n,t,r)},getColumnWidth:function(n,t){var u=this.defaults.colWidth,f=i.SheetArea,r;t===f.rowHeader&&(u=this.defaults.rowHeaderColWidth);if(t===undefined||t===null||t===f.colHeader||t===f.viewport){if(n<0||n>=this.getColumnCount(t))return 0;if(this.colRangeGroup&&!this.colRangeGroup._isEmpty())if(this.colRangeGroup.isCollapsed(n))return 0}r=this._getColumnInfos(t);if(r&&r[n]){if(r[n].visible===!1)return 0;isNaN(r[n].size)||(u=parseInt(r[n].size,10))}return u},_getActualColumnWidth:function(n,t){var f=this.defaults.colWidth,u=i.SheetArea,r;t===u.rowHeader&&(f=this.defaults.rowHeaderColWidth);if(t===undefined||t===null||t===u.colHeader||t===u.viewport||t===u.colFooter)if(n<0||n>=this.getColumnCount(t))return 0;return r=this._getColumnInfos(t),r&&r[n]&&(isNaN(r[n].size)||(f=parseInt(r[n].size,10))),f},setColumnWidth:function(n,t,r){this._bindToAutoRefresh(function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getColumnInfos(r);u[n]||(u[n]={}),u[n].size=t,u[n].dirty=!0,this._trigger(i.Events.ColumnChanged,{sheet:this,sheetName:this._name,col:n,sheetArea:r,propertyName:h}),this._allowCellOverflow&&this._clearCellOverflowModelCache()})(n,t,r)},getColumnVisible:function(n,t){var f=i.SheetArea,u,r;if(t===undefined||t===null||t===f.colHeader||t===f.viewport)if(this.colRangeGroup&&!this.colRangeGroup._isEmpty())if(0<=n&&n<this.getColumnCount(t)&&this.colRangeGroup.isCollapsed(n))return!1;return u=!0,r=this._getColumnInfos(t),r&&r[n]&&r[n].visible!==undefined&&r[n].visible!==null&&(u=r[n].visible),u},setColumnVisible:function(n,t,r){this._bindToAutoRefresh(function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getColumnInfos(r);u[n]||(u[n]={});if(u[n].visible===t)return;u[n].visible=t,u[n].dirty=!0,this._allowCellOverflow===!0&&this._clearCellOverflowModelCache(),this._trigger(i.Events.ColumnChanged,{sheet:this,sheetName:this._name,col:n,sheetArea:r,propertyName:"isVisible"})})(n,t,r)},zoom:function(n){n=parseFloat(n);if(isNaN(n)||!isFinite(n))return;n>4?n=4:n<.25&&(n=.25),this._bindToAutoRefresh(function(n){this.showEditingLocator&&this._showEditingLocator(),this._allowCellOverflow&&this._zoomFactor!==n&&this._clearCellOverflowModelCache(),this._zoomFactor=n})(n)},invalidateLayout:function(){this._layoutModel=null,this._cachedGroupLayout=null,this._rowLayoutCache={colHeader:[],viewport:[],colFooter:[]},this._colLayoutCache={rowHeader:[],viewport:[]},this._clearCellOverflowModelCache(),this._dirty=!0},getViewportHeight:function(n){var t=this._getSheetLayout();return n>0?t.viewportHeight:t.frozenHeight},getViewportWidth:function(n){var t=this._getSheetLayout();return n>0?t.viewportWidth:t.frozenWidth},getViewportTopRow:function(n){return n===0?0:Math.max(this.frozenRowCount,this._scrollTopRow)},getViewportBottomRow:function(n){var f=this.getViewportTopRow(n),e=this.getViewportHeight(n),r=0,u=0,i=this.getRowCount(),t;for(n===0&&(i=Math.min(this.frozenRowCount,i)),t=f;t<i&&r<e;t++,u++)r+=this._getZoomRowHeight(t);return f+u-1},getViewportLeftColumn:function(n){return n===0?0:Math.max(this.frozenColCount,this._scrollLeftCol)},getViewportRightColumn:function(n){var f=this.getViewportLeftColumn(n),e=this.getViewportWidth(n),r=0,u=0,i=this.getColumnCount(),t;for(n===0&&(i=Math.min(this.frozenColCount,i)),t=f;t<i&&u<e;t++,r++)u+=this._getZoomColumnWidth(t);return f+r-1},clearSelection:function(){this._bindToAutoRefresh(function(){this._clearSelectionImp(),this._setActiveCellImp(0,0)})()},_clearSelectionImp:function(){this._selectionModel.clear()},_validationError:function(n,t,r){var f=this.getDataValidator(n,t),u={sheet:this,sheetName:this._name,row:n,col:t,validator:f,validationResult:i.DataValidationResult.ForceApply};return this._trigger(i.Events.ValidationError,u),u.validationResult},getSpans:function(n,t){var u,e,r,f;(t===undefined||t===null)&&(t=i.SheetArea.viewport),u=this._getSpanModel(t);if(!n)return u.slice(0);for(e=[],r=0;r<u.length;r++)f=u[r],(!n||f.intersect(n.row,n.col,n.rowCount,n.colCount))&&e.push(f);return e},getCell:function(n,t,r){return new i.Cell(this,n,t,r)},getCells:function(n,t,i,r,u){var f=this.getCell(n,t,u);return f.row2=i,f.col2=r,f},getRow:function(n,t){return new i.Row(this,n,t)},getRows:function(n,t,i){var r=this.getRow(n,i);return r.index2=t,r},getColumn:function(n,t){return new i.Col(this,n,t)},getColumns:function(n,t,i){var r=this.getColumn(n,i);return r.index2=t,r},setBorder:function(n,t,r,u){var a;(u===undefined||u===null)&&(u=i.SheetArea.viewport),a=this.isPaintSuspended(),this.isPaintSuspended(!0);try{var l=this._getActualRange(n,u),s=l.row,o=l.col,c=l.rowCount,h=l.colCount,f,e;if(r.left||r.all||r.outline)for(f=0;f<c;f++)this.getCell(s+f,o,u).borderLeft(t);if(r.top||r.all||r.outline)for(e=0;e<h;e++)this.getCell(s,o+e,u).borderTop(t);if(r.right||r.all||r.outline)for(f=0;f<c;f++)this.getCell(s+f,o+h-1,u).borderRight(t);if(r.bottom||r.all||r.outline)for(e=0;e<h;e++)this.getCell(s+c-1,o+e,u).borderBottom(t);if(r.innerHorizontal||r.all||r.inside)for(f=0;f<c-1;f++)for(e=0;e<h;e++)this.getCell(s+f,o+e,u).borderBottom(t),this.getCell(s+f+1,o+e,u).borderTop(t);if(r.innerVertical||r.all||r.inside)for(e=0;e<h-1;e++)for(f=0;f<c;f++)this.getCell(s+f,o+e,u).borderRight(t),this.getCell(s+f,o+e+1,u).borderLeft(t)}finally{this.isPaintSuspended(a)}},search:function(n){var u,o,t,f,e,r;if(!n)return null;u=i.SearchFoundFlags,o=i.SearchResult;if(!n.searchString||n.searchTarget===u.None||this.getRowCount(n.sheetArea)<=0&&this.getColumnCount(n.sheetArea)<=0)return new o;n.rowStart===-1&&(n.rowStart=0),n.columnStart===-1&&(n.columnStart=0),n.findBeginRow===-1&&(n.findBeginRow=n.rowStart),n.findBeginColumn===-1&&(n.findBeginColumn=n.columnStart),n.rowEnd===-1&&(n.rowEnd=this.getRowCount(n.sheetArea)-1),n.columnEnd===-1&&(n.columnEnd=this.getColumnCount(n.sheetArea)-1),t=new o,f=new i.CellsEnumerator(this,n),(n.searchFlags&i.SearchFlags.BlockRange)>0&&(f.isBlockRange=!0);while(f.moveNext()){var c=f.currentRow,h=f.currentColumn,s=f.current();(n.searchTarget&u.CellText)>0&&(e=s.text(),this._trySearch(e,n.searchString,n.searchFlags)&&e!==""&&(t.searchFoundFlag|=u.CellText,t.foundString=e)),(n.searchTarget&u.CellFormula)>0&&(r=s.formula(),r=typeof r===w?r.toString():null,this._trySearch(r,n.searchString,n.searchFlags)&&r!==""&&(t.searchFoundFlag|=u.CellFormula,t.foundString=r));if(t.searchFoundFlag!==u.None)return t.foundRowIndex=c,t.foundColumnIndex=h,t}return new o},showCell:function(n,t,r,u){var o,f;if(n<0||n>=this.getRowCount())return;if(t<0||t>=this.getColumnCount())return;var y=isNaN(this.frozenRowCount)?0:this.frozenRowCount,v=isNaN(this.frozenColCount)?0:this.frozenColCount,s=this._scrollTopRow,c=this._scrollLeftCol,l=1,a=1,h=i.HorizontalPosition,e;if(u!==h.left)if(u===h.center)for(e=Math.floor((this.getViewportWidth(l)-Math.floor(this.getColumnWidth(t)*this._zoomFactor))/2);0<t;t--){e-=Math.floor(this.getColumnWidth(t-1)*this._zoomFactor);if(e<0)break}else if(u===h.right)for(e=this.getViewportWidth(l)-Math.floor(this.getColumnWidth(t)*this._zoomFactor);0<t;t--){e-=Math.floor(this.getColumnWidth(t-1)*this._zoomFactor);if(e<0)break}else if(u===h.nearest)if(t>=c)for(e=this.getViewportWidth(l)-Math.floor(this.getColumnWidth(t)*this._zoomFactor);c<t;t--){e-=Math.floor(this.getColumnWidth(t-1)*this._zoomFactor);if(e<0)break}o=i.VerticalPosition;if(r!==o.top)if(r===o.center)for(f=Math.floor((this.getViewportHeight(a)-Math.floor(this.getRowHeight(n)*this._zoomFactor))/2);0<n;n--){f-=Math.floor(this.getRowHeight(n-1)*this._zoomFactor);if(f<0)break}else if(r===o.bottom)for(f=this.getViewportHeight(a)-Math.floor(this.getRowHeight(n)*this._zoomFactor);0<n;n--){f-=Math.floor(this.getRowHeight(n-1)*this._zoomFactor);if(f<0)break}else if(r===o.nearest)if(!(n<s||s===-1))for(f=this.getViewportHeight(a)-Math.floor(this.getRowHeight(n)*this._zoomFactor);s<n;n--){f-=Math.floor(this.getRowHeight(n-1)*this._zoomFactor);if(f<0)break}n<y||n===s||(this._scrollTopRow=n,this._syncVScrollbarPosition()),t<v||t===c||(this._scrollLeftCol=t,this._syncHScollbarPosition()),(n!==s||t!==c)&&(this.invalidateLayout(),this.repaint())},showColumn:function(n,t){this.showCell(this._scrollTopRow,n,i.VerticalPosition.top,t)},showRow:function(n,t){this.showCell(n,this._scrollLeftCol,t,i.HorizontalPosition.left)},bind:function(n,t,i){this._eventHandler.bind(n+a,t,i)},unbind:function(n,t){this._eventHandler.unbind(n+a,t)},unbindAll:function(){this._eventHandler.unbind(a)},_bind:function(n,t,i){this._eventHandler.bind(n+et,t,i)},_unbind:function(n,t){this._eventHandler.unbind(n+et,t)},_unbindAll:function(){this._eventHandler.unbind(et)},suspendEvent:function(){this._eventHandler._eventSuspended++},resumeEvent:function(){this._eventHandler._eventSuspended--,this._eventHandler._eventSuspended<0&&(this._eventHandler._eventSuspended=0)},currentTheme:function(n){if(arguments.length===0)return this._currentTheme||(this._currentTheme=i.SpreadThemes.Office),this._currentTheme;var t=i.SpreadThemes;return typeof n===w&&(n=t.hasOwnProperty(n)?t[n]:new i.SpreadTheme(n)),this._bindToAutoRefresh(function(n){this._currentTheme=n})(n),this},reset:function(){var n,t;this.defaults={rowHeight:20,colWidth:62,rowHeaderColWidth:40,colHeaderRowHeight:20},this.gridline={color:"#D0D7E5",showVerticalGridline:!0,showHorizontalGridline:!0},this._rowLayoutCache={colHeader:[],viewport:[],colFooter:[]},this._colLayoutCache={rowHeader:[],viewport:[]},this._dragRect={},this._render=new i._SheetRender(this),this._eventHandler=new i._SheetEventHandler(this),n=i._GcSheetModel,this._dataModel=new n,this._dataModel.name=this._name,this._calcDataModel=new n(this._dataModel.rowCount,this._dataModel.colCount,this._name+"_calc"),this._rowHeaderModel=new n(this._dataModel.rowCount,1),this._colHeaderModel=new n(1,this._dataModel.colCount),this._colFooterModel=new n(1,this._dataModel.colCount,this._name+"cf"),t=i._SpanModel,this._spanModel=new t,this._colHeaderSpanModel=new t,this._rowHeaderSpanModel=new t,this._selectionModel=new i._SelectionModel,this._vpSheetSource=new u.Calc._SheetSource(this,i.SheetArea.viewport),this._cellOverflowModelCache=null,typeof i.RangeGroup!==o&&(this.rowRangeGroup=new i.RangeGroup(this.getRowCount()),this.colRangeGroup=new i.RangeGroup(this.getColumnCount())),this._rowInfos=null,this._colInfos=null,this._dataSource=null,this._dataItemType=null,this.dataContext=null,this.autoGenerateColumns=!0,this.autoUpdate=!0,this._rowFilter=null,typeof i.HideRowFilter!==o&&(this._filterButtonsModel=null),this._initDefaultKeyMap(),this._scrollTopRow=0,this._scrollLeftCol=0,this.frozenRowCount=0,this.frozenColCount=0,i.WorksheetSparklineGroupManager&&(this._sparklineGroupManager=new i.WorksheetSparklineGroupManager(this,this)),this._syncScrollbarSize(),this.invalidateLayout(),this._dirty=!0},undoManager:function(){return this._undoManager||(this._undoManager=this.parent&&this.parent._undoManager?this.parent._undoManager:new i._UndoManager(this,-1,this.allowUndo())),this._undoManager},clipBoardOptions:function(n){return arguments.length===0?((this._clipBoardOptions===undefined||this._clipBoardOptions===null)&&(this._clipBoardOptions=i.ClipboardPasteOptions.All),this._clipBoardOptions):(this._clipBoardOptions=n,this)},doCommand:function(n){this._doCommand(n)},copyTo:function(n,t,i,u,f,e,o){var s=this.isPaintSuspended();this.isPaintSuspended(!0),this.suspendEvent(),r.copyTo(this,n,t,this,i,u,f,e,o),this.resumeEvent(),this.isPaintSuspended(s)},moveTo:function(n,t,i,u,f,e,o){var s=this.isPaintSuspended();this.isPaintSuspended(!0),this.suspendEvent(),r.moveTo(this,n,t,this,i,u,f,e,o),this.resumeEvent(),this.isPaintSuspended(s)},setCsv:function(n,t,i,u,f,e){var o=this.isPaintSuspended();this.isPaintSuspended(!0),this.suspendEvent(),r.setRangeText(this,n,t,i,u,f,'"',e),this.resumeEvent(),this.isPaintSuspended(o)},getCsv:function(n,t,u,f,e,o){return r.getRangeText(this,n,u,t,f,e,o,'"',!1,i.TextFileOpenFlags.None)},canUserDragDrop:function(n){return arguments.length===0?(this.parent&&this.parent.canUserDragDrop?this._allowDragDrop=this.parent.canUserDragDrop():(this._allowDragDrop===undefined||this._allowDragDrop===null)&&(this._allowDragDrop=!0),this._allowDragDrop):(this.parent&&this.parent.canUserDragDrop?this.parent.canUserDragDrop(n):this._allowDragDrop=n,this)},canUserDragFill:function(n){if(arguments.length===0)return this.parent&&this.parent.canUserDragFill?this._allowDragFill=this.parent.canUserDragFill():(this._allowDragFill===undefined||this._allowDragFill===null)&&(this._allowDragFill=!0),this._allowDragFill;else{var t=this.canUserDragFill();return t!==n&&(this.parent&&this.parent.canUserDragFill?this.parent.canUserDragFill(n):this._allowDragFill=n,this.getSelections().length===1&&this._render.repaintSelection(this.getSelections().toArray()[0])),this}},isColumnBound:function(n){var t,i;if(n<0||n>=this.getColumnCount())return!1;t=this.getDataSource();if(t&&t.length>0)if(this._colInfos)return i=this._colInfos[n],!!i;return!1},getDataColumnName:function(n){var i,t;if(n<0||n>=this.getColumnCount())return null;i=this.getDataSource();if(i&&i.length>0)if(this._colInfos)return t=this._colInfos[n],t.displayName||t.name;return null},getSparkline:function(n,t){var u=i.SheetArea.viewport,r=this._getModel(u);return r.getSparkline(n,t)},setSparkline:function(n,t,r,u,f,e,o,s){return this._bindToAutoRefresh(function(n,t,r,u,f,e,o,s){var l=r,h=new i.Sparkline(n,t,l,u,f,e),c;return o&&s!==undefined&&s!==null&&(h.dateAxisData(o),h.dateAxisOrientation(s),h.group().displayDateAxis=!0),this.removeSparkline(n,t),c=this._getModel(),c.setSparkline(n,t,h),this._sparklineGroupManager.add(h.group()),this._raiseCellChanged("sparkline",n,t,1,1,i.SheetArea.viewport),h})(n,t,r,u,f,e,o,s)},removeSparkline:function(n,t){this._bindToAutoRefresh(function(n,t){var e=i.SheetArea.viewport,f=this._getModel(e),u=f.getSparkline(n,t),r;u&&(r=u.group(),r.remove(u),r.count()>0||this._sparklineGroupManager.remove(r)),f.setSparkline(n,t,null)})(n,t)},groupSparkline:function(n){this._bindToAutoRefresh(function(n){for(var r=null,t,i,u=0;u<n.length;u++){t=n[u];if(!t)continue;if(!r){r=t.group();continue}i=t.group(),i.remove(t),r.add(t),i.count()>0||this._sparklineGroupManager.remove(i)}return r})(n)},ungroupSparkline:function(n){this._bindToAutoRefresh(function(n){var t,r,i,u;if(!n)return;for(t=[],t=t.concat(n._innerList),r=0;r<t.length;r++)i=t[r],i&&(n.remove(i),u=n.clone(),u.add(i),this._sparklineGroupManager.add(u));this._sparklineGroupManager.remove(n)})(n)},fillAuto:function(n,t,r){if(!t)throw new Error("range");if(!this._checkFillRange(n,t,r))return;this._bindToAutoRefresh(function(n,t,r){n&&(this._eventHandler._dragFillStartRange=n);var u=new i.FillImp(this);u.fillAuto(t,r)})(n,t,r)},fillAutobyDirection:function(n,t,r){if(!t)throw new Error("range");if(!this._checkFillRange(n,t,null,r))return;this._bindToAutoRefresh(function(n,t,r){n&&(this._eventHandler._dragFillStartRange=n);var u=new i.FillImp(this);u.fillAutobyDirection(t,r)})(n,t,r)},fillLinear:function(n,t,r,u,f){if(!t)throw new Error("range");if(!this._checkFillRange(n,t,r))return;this._bindToAutoRefresh(function(n,t,r,u,f){n&&(this._eventHandler._dragFillStartRange=n);var e=new i.FillImp(this);e.fillLinear(t,r,u,f)})(n,t,r,u,f)},fillGrowth:function(n,t,r,u,f){if(!t)throw new Error("range");if(!this._checkFillRange(n,t,r))return;this._bindToAutoRefresh(function(n,t,r,u,f){n&&(this._eventHandler._dragFillStartRange=n);var e=new i.FillImp(this);e.fillGrowth(t,r,u,f)})(n,t,r,u,f)},fillDate:function(n,t,r,u,f,e){if(!t)throw new Error("range");if(!this._checkFillRange(n,t,r))return;this._bindToAutoRefresh(function(n,t,r,u,f,e){n&&(this._eventHandler._dragFillStartRange=n);var s=new i.FillImp(this),o=null;e!==undefined&&e!==null&&(o=new i._DateTimeHelper(e).toOADate()),s.fillDate(t,r,u,f,o)})(n,t,r,u,f,e)},_checkFillRange:function(n,t,r,u){var e,f;if(!n||!t)return!1;if(!t.containsRange(n))return!1;if(r!==undefined&&r!==null){e=i.FillSeries;if(r===e.Row){if(n.row===t.row&&n.rowCount===t.rowCount)return!0}else if(r===e.Column)if(n.col===t.col&&n.colCount===t.colCount)return!0}if(u!==undefined&&u!==null){f=i.FillDirection;if(u===f.Up||u===f.Down){if(n.col===t.col&&n.colCount===t.colCount)return!0}else if(u===f.Left||u===f.Right)if(n.row===t.row&&n.rowCount===t.rowCount)return!0}return!1},clear:function(n,t,r,u,f,e){this._bindToAutoRefresh(function(n,t,r,u,f,e){var c,l,s,o,w,h,y,p,a,v;this.suspendCalcService();try{w=i.SheetArea.viewport,h=i.StorageType;if(f===undefined||f===null||f===w){if((e&h.Data)===h.Data){if(this._dataSource||this.dataContext){for(this.suspendEvent(),c=n;c<n+r;c++)for(l=t;l<t+u;l++)this.setValue(c,l,null,f);this.resumeEvent()}this._rowFilter&&this._rowFilter.range&&this._rowFilter._clear(n,t,r,u)}(e&h.Sparkline)===h.Sparkline&&this._sparklineGroupManager&&this._sparklineGroupManager.clear(n,t,r,u)}y=this._getModel(f),p=this._getCalcModel(f);if(y){c=n===-1?0:n,a=n===-1?y.rowCount:r,l=t===-1?0:t,v=t===-1?y.colCount:u,y.clear(c,l,a,v,e),p&&p.clear(c,l,a,v,e);if((e&h.Style)===h.Style)if(!(n>=0&&t>=0))if(t<0)if(n<0)this.setStyle(-1,-1,null,f);else for(s=0;s<a;s++)this.setStyle(c+s,-1,null,f);else for(o=0;o<v;o++)this.setStyle(-1,l+o,null,f);if((e&h.Axis)===h.Axis)if(!(n>=0&&t>=0))if(t<0)if(n<0){for(o=0;o<v;o++)this.setColumnVisible(l+o,!0,f),this.setColumnResizable(l+o,!0,f),this.setColumnWidth(l+o,f===i.SheetArea.rowHeader?this.defaults.rowHeaderColWidth:this.defaults.colWidth,f);for(s=0;s<a;s++)this.setRowVisible(c+s,!0,f),this.setRowResizable(c+s,!0,f),this.setRowHeight(c+s,f===i.SheetArea.colHeader?this.defaults.colHeaderRowHeight:this.defaults.rowHeight,f)}else for(s=0;s<a;s++)this.setRowVisible(c+s,!0,f),this.setRowResizable(c+s,!0,f),this.setRowHeight(c+s,f===i.SheetArea.colHeader?this.defaults.colHeaderRowHeight:this.defaults.rowHeight,f);else for(o=0;o<v;o++)this.setColumnVisible(l+o,!0,f),this.setColumnResizable(l+o,!0,f),this.setColumnWidth(l+o,f===i.SheetArea.rowHeader?this.defaults.rowHeaderColWidth:this.defaults.colWidth,f);for(s=0;s<a;s++)for(o=0;o<v;o++)c=n+s,l=t+o,(e&h.Data)===h.Data&&this._raiseCellChanged(rt,c,l,1,1,f),(e&h.Style)===h.Style&&this._raiseCellChanged("style",c,l,1,1,f),(e&h.Sparkline)===h.Sparkline&&this._raiseCellChanged("sparkline",c,l,1,1,f),(e&h.Axis)===h.Axis&&this._raiseCellChanged("axis",c,l,1,1,f)}(f===undefined||f===null||f===w)&&(e&h.Data)===h.Data&&this._getSheetSource()._addCellsToDirty(n,t,r,u)}finally{this.resumeCalcService()}})(n,t,r,u,f,e)},getConditionalFormats:function(){return this._conditionalFormats||(this._conditionalFormats=new i.ConditionalFormats(this)),this._conditionalFormats},rowFilter:function(n){return arguments.length===0?this._rowFilter:this._bindToAutoRefresh(function(n){return this._rowFilter&&this._rowFilter.reset(),this._rowFilter=n,this._rowFilter&&(this._rowFilter.sheet=this),this})(n)},autoFitColumn:function(n){if(n<0||n>=this.getColumnCount())return;var t=new i.UndoRedo.ColumnAutoFitUndoAction(this,[{col:n}],!1);t.execute(this)},autoFitRow:function(n){if(n<0||n>=this.getRowCount())return;var t=new i.UndoRedo.RowAutoFitUndoAction(this,[{row:n}],!1);t.execute(this)},_GROUPBUTTON_WIDTH:15,_GROUPBUTTON_HEIGHT:15,_GROUPPADDING:2,_rowLayoutCache:null,_colLayoutCache:null,_scrollCallback:null,_dragRect:null,_scrollTopRow:0,_scrollLeftCol:0,_activeRowDirty:!1,_initPaint:function(){var r=u.UI._isStandardCanvas(),t,i;if(r)return;t=this._getCanvas(),t&&t.firstChild&&t.firstChild.loaded?(this.invalidateLayout(),this.repaint()):(i=this,n.setTimeout(function(){i.initPaint.call(i)},10))},_bindToAutoRefresh:function(n,t){return t||(t=this),function(){var i=n.apply(t,arguments);return t._paintSuspended||(typeof t.invalidateLayout===e&&t.invalidateLayout(),typeof t.repaint===e&&t.repaint()),i}},_isValidSheetName:function(n){var r,t,i;if(!n||n==="")return!1;if(!this.parent)return!0;for(r=this.parent.sheets.length,t=0;t<r;t++){i=this.parent.sheets[t];if(i!==this)if(n===i._name)return!1}return!0},_init:function(n){this._name=n,this._bounds=new i.Rect(0,0,0,0),this.reset()},applyOptions:function(n){if(!n)return;typeof n.name===w&&n.name.length>0&&(this._name=n.name),n.data&&this.setDataSource(n.data),typeof n.defaultRowHeight===s&&(this.defaults.rowHeight=n.defaultRowHeight),typeof n.defaultColWidth===s&&(this.defaults.colWidth=n.defaultColWidth),typeof n.defaultRowHeaderColWidth===s&&(this.defaults.rowHeaderColWidth=n.defaultRowHeaderColWidth),typeof n.defaultColHeaderRowHeight===s&&(this.defaults.colHeaderRowHeight=n.defaultColHeaderRowHeight),typeof n.rowCount===s&&this.setRowCount(n.rowCount),typeof n.colCount===s&&this.setColumnCount(n.colCount),typeof n.frozenRowCount===s&&(this.frozenRowCount=n.frozenRowCount),typeof n.frozenColCount===s&&(this.frozenColCount=n.frozenColCount),n.gridlineColor&&(this.gridline.color=n.gridlineColor),typeof n.showVerticalGridline===v&&(this.gridline.showVerticalGridline=n.showVerticalGridline),typeof n.showHorizontalGridline===v&&(this.gridline.showHorizontalGridline=n.showHorizontalGridline),n.borderColor&&(this.borderColor=n.borderColor),typeof n.borderWidth===s&&(this.borderWidth=n.borderWidth),typeof n._zoomFactor===s&&(this._zoomFactor=n._zoomFactor),typeof n.rowHeaderVisible===v&&(this.rowHeaderVisible=n.rowHeaderVisible),typeof n.colHeaderVisible===v&&(this.colHeaderVisible=n.colHeaderVisible),typeof n.autoUpdate===v&&(this.autoUpdate=n.autoUpdate),typeof n.autoGenerateColumns===v&&(this.autoGenerateColumns=n.autoGenerateColumns),n.rowHeaderAutoText&&(this.rowHeaderAutoText=n.rowHeaderAutoText),n.colHeaderAutoText&&(this.colHeaderAutoText=n.colHeaderAutoText),typeof n._activeRowIndex===s&&(this._activeRowIndex=n._activeRowIndex),typeof n._activeColIndex===s&&(this._activeColIndex=n._activeColIndex),typeof n._allowCellOverflow===v&&(this._allowCellOverflow=n._allowCellOverflow),typeof n.isProtected===v&&(this.isProtected=n.isProtected),typeof n.allowUndo===v&&this.allowUndo(n.allowUndo),n.columns&&n.columns.length>0&&this.bindColumns(n.columns);if(n.dataContext){var t=new i.DataContext(n.dataContext.read,n.dataContext.create,n.dataContext.update,n.dataContext.remove);this.setDataContext(t)}},_initDefaultKeyMap:function(){var t=i.SpreadActions,n=i.Key;this.addKeyMap(n.left,!1,!1,!1,t.navigationLeft),this.addKeyMap(n.left,!0,!1,!1,t.navigationHome2),this.addKeyMap(n.right,!1,!1,!1,t.navigationRight),this.addKeyMap(n.right,!0,!1,!1,t.navigationEnd),this.addKeyMap(n.up,!1,!1,!1,t.navigationUp),this.addKeyMap(n.up,!0,!1,!1,t.navigationTop),this.addKeyMap(n.down,!1,!1,!1,t.navigationDown),this.addKeyMap(n.down,!0,!1,!1,t.navigationBottom),this.addKeyMap(n.home,!1,!1,!1,t.navigationHome),this.addKeyMap(n.home,!0,!1,!1,t.navigationFirst),this.addKeyMap(n.end,!1,!1,!1,t.navigationEnd),this.addKeyMap(n.end,!0,!1,!1,t.navigationLast),this.addKeyMap(n.tab,!1,!1,!1,t.commitInputNavigationTabNext),this.addKeyMap(n.tab,!1,!0,!1,t.commitInputNavigationTabPrevious),this.addKeyMap(n.pup,!1,!1,!1,t.navigationPageUp),this.addKeyMap(n.pup,!0,!1,!1,t.navigationPreviousSheet),this.addKeyMap(n.pdn,!1,!1,!1,t.navigationPageDown),this.addKeyMap(n.pdn,!0,!1,!1,t.navigationNextSheet),this.addKeyMap(n.del,!1,!1,!1,t.clear),this.addKeyMap(n.backspace,!1,!1,!1,t.clearAndEditing),this.addKeyMap(n.enter,!1,!1,!1,t.commitInputNavigationDown),this.addKeyMap(n.enter,!1,!0,!1,t.commitInputNavigationUp),this.addKeyMap(n.esc,!1,!1,!1,t.cancelInput),this.addKeyMap(n.left,!1,!0,!1,t.selectionLeft),this.addKeyMap(n.right,!1,!0,!1,t.selectionRight),this.addKeyMap(n.up,!1,!0,!1,t.selectionUp),this.addKeyMap(n.down,!1,!0,!1,t.selectionDown),this.addKeyMap(n.home,!1,!0,!1,t.selectionHome),this.addKeyMap(n.end,!1,!0,!1,t.selectionEnd),this.addKeyMap(n.pup,!1,!0,!1,t.selectionPageUp),this.addKeyMap(n.pdn,!1,!0,!1,t.selectionPageDown),this.addKeyMap(n.left,!0,!0,!1,t.selectionHome),this.addKeyMap(n.right,!0,!0,!1,t.selectionEnd),this.addKeyMap(n.up,!0,!0,!1,t.selectionTop),this.addKeyMap(n.down,!0,!0,!1,t.selectionBottom),this.addKeyMap(n.home,!0,!0,!1,t.selectionFirst),this.addKeyMap(n.end,!0,!0,!1,t.selectionLast),this.addKeyMap(n.c,!0,!1,!1,t.copy),this.addKeyMap(n.x,!0,!1,!1,t.cut),this.addKeyMap(n.v,!0,!1,!1,t.paste),this.addKeyMap(n.z,!0,!1,!1,t.undo),this.addKeyMap(n.y,!0,!1,!1,t.redo)},_setHost:function(r){var u=l.createElement("canvas"),f;u.setAttribute("id",r.getAttribute("id")+"_vp"),t(u).html("You need a browser which full supports HTML5 Canvas to run SpreadJS"),r.appendChild(u),u.gcObject=!0,this._canvas&&(t(this._canvas).unbind(ft),t(this._canvas).unbind(ut),t(this._canvas).unbind(st),t(this._canvas).unbind(ht),t(this._canvas).unbind(ot),t(this._canvas).unbind(tt),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)),this._canvas=u,u.setAttribute("renderMethod","auto"),f=this,this._mouseDownDelegate=function(n){return f._eventHandler.doMouseDown(n)},this._mouseMoveDelegate=function(n){if(f._eventHandler._isMouseCapture)return;f._eventHandler.doMouseMove(n)},this._mouseUpDelegate=function(n){if(!f._continueMouseUpBubble)return f._eventHandler._isMouseCapture?void 0:f._eventHandler.doMouseUp(n)},this._mouseOutDelegate=function(n){return f._eventHandler.doMouseOut(n)},this._dblClickDelegate=function(n){var t=f,u,r,c,a=t._currentTarget,e,h,s,o,l;if(t._currentTarget){t._trigger(i.Events.CellDoubleClick,{sheet:t,sheetName:t._name,sheetArea:t._currentTarget.hitTestType,row:t._currentTarget.row,col:t._currentTarget.col}),e=a.resizeInfo;if(e){if(e.action==="sizeRow"){h=[];if(t._isRowSelected(e.index))for(u=0;u<t._selectionModel.length;u++){r=t._selectionModel[u];if(r.col===-1)for(r=t._getActualRange(r),s=0;s<r.rowCount;s++)h.push({row:r.row+s})}else h.push({row:e.index});c=new i.UndoRedo.RowAutoFitUndoAction(t,h,!1),t._doCommand(c)}else{o=[];if(t._isColumnSelected(e.index))for(u=0;u<t._selectionModel.length;u++){r=t._selectionModel[u];if(r.row===-1)for(r=t._getActualRange(r),l=0;l<r.colCount;l++)o.push({col:r.col+l})}else o.push({col:e.index});c=new i.UndoRedo.ColumnAutoFitUndoAction(t,o,!1),t._doCommand(c)}return}}return f._eventHandler.startEdit(n)},t(u).bind(ft,this._mouseDownDelegate),t(u).bind(ut,this._mouseMoveDelegate),t(u).bind(st,this._mouseUpDelegate),t(u).bind(ht,this._mouseOutDelegate),t(u).bind(ot,this._dblClickDelegate),this._mouseWheelDelegate=function(t){t=t?t:n.event;var r=t.detail?t.detail:t.wheelDelta/-40;return f._eventHandler.doMouseWheel(t,parseInt(r,10)),i.cancelDefault(t),!1},t(u).bind(tt,this._mouseWheelDelegate),t(n).unbind(it),t(n).bind(it,i.createEventHandler(this._eventHandler,this._eventHandler.doResize)),this._initializeActiveCell(),this._eventHandler.doResize()},_dispose:function(){this._isEditing&&this.endEdit();var i=this._canvas;i&&(t(i).unbind(ft),t(i).unbind(ut),t(i).unbind(st),t(i).unbind(ht),t(i).unbind(ot),t(i).unbind(tt),i.parentNode.removeChild(i)),this._eventHandler._dispose(),this._canvas=null,t(n).unbind(it)},_getModel:function(n){var t=i.SheetArea;if(n===undefined||n===null||n===t.viewport)return this._dataModel;else if(n===t.rowHeader)return this._rowHeaderModel;else if(n===t.colHeader)return this._colHeaderModel;return null},_getCalcModel:function(n){return n===undefined||n===null||n===i.SheetArea.viewport?this._calcDataModel:null},_getValueImp:function(t,r,u,f){var c,v,s,h,a,l;if(f===undefined||f===null||f===i.SheetArea.viewport)if(this.xSheet)return this.xSheet.getValue(r,u);c=t.getValue(r,u);if((c===undefined||c===null)&&this._dataSource&&(f===undefined||f===null||f===i.SheetArea.viewport)){v=this._dataSource.length;if(r<v){s=this._dataSource[r];if(s===undefined||s===null)return null;h=this._colInfos[u];if(h&&h.name&&h.name.length>0)if(typeof h.value===e)return h.value(s);else a=n.ko,c=typeof a!==o&&a.isObservable(s[h.name])?s[h.name]():s[h.name];else if(typeof s=="string"||!isNaN(s))if(u===0)return s}}return typeof c===w&&(l=c.match(ti),l&&l.length>0&&(l=l[0].substring(6),c=new Date(parseFloat(l)))),c},_getSwapIndex:function(n,t,i,r,u){var f=n[i-t];while(f.index<i)f=n[f.index-t];return f.index},_quickSortImp:function(n){var t,i;if(n.length<=1)return n;var o=Math.floor(n.length/2),e=n[o],r=[],u=[],f=[];for(t=0;t<n.length;t++)i=this._sortCompare(n[t],e),i<0?r.push(n[t]):i>0?u.push(n[t]):f.push(n[t]);return this._quickSortImp(r).concat(f,this._quickSortImp(u))},_quickSort:function(n,t,i,r,u,f){var s=u?i:r,o=[],e;if(u)for(e=0;e<s;e++)o[e]={sheet:this,index:n+e,byRows:u,sortInfo:f};else for(e=0;e<s;e++)o[e]={sheet:this,index:t+e,byRows:u,sortInfo:f};return o=this._quickSortImp(o)},_isEquals:function(n,t){return n instanceof Date&&t instanceof Date?new i._DateTimeHelper(n).toOADate()===new i._DateTimeHelper(t).toOADate():n===t},_isGreaterThan:function(n,t){return typeof n=="boolean"?n=n?1:0:n instanceof Date&&(n=new i._DateTimeHelper(n).toOADate()),typeof t=="boolean"?t=t?1:0:t instanceof Date&&(t=new i._DateTimeHelper(t).toOADate()),typeof n!=typeof t&&(typeof n=="number"||typeof t=="number")?typeof t=="number":n>t},_sortCompare:function(n,t){var i,u,r,e,f,s,h,o;if(n.sortInfo&&n.sortInfo.length>0){for(i=0,s=0;s<n.sortInfo.length;s++){n.sortInfo[s]&&(h=n.sortInfo[s].ascending,o=n.sortInfo[s].index,0>o||(n.byRows?(u=n.sheet.getValue(n.index,o),r=t.sheet.getValue(t.index,o),e=u===undefined||u===null||u==="",f=r===undefined||r===null||r==="",e||f?e&&f?i=0:e&&!f?i=1:!e&&f&&(i=-1):i=this._isEquals(u,r)?0:this._isGreaterThan(u,r)?h?1:-1:h?-1:1):(u=n.sheet.getValue(o,n.index),r=t.sheet.getValue(o,t.index),e=u===undefined||u===null||u==="",f=r===undefined||r===null||r==="",e||f?e&&f?i=0:e&&!f?i=1:!e&&f&&(i=-1):i=this._isEquals(u,r)?0:this._isGreaterThan(u,r)?h?1:-1:h?-1:1)));if(i!==0)break}return i}return 0},_getCellType:function(n,t,r){var u,f;this._defaultCellType||(this._defaultCellType=new i._TextCellType),u=i.SheetArea;if(r===undefined||r===null||r===u.viewport){f=this._getColumnCellType(t,r);if(f)return f}else if(r===u.colHeader)return new i._ColumnHeaderCellType;else if(r===u.rowHeader)return new i._RowHeaderCellType;else if(r===u.corner)return new i._CornerCellType;return this._defaultCellType},_getActualRange:function(n,t){(t===undefined||t===null)&&(t=i.SheetArea.viewport);var r=new i.Range;return n===null||n===undefined?r:(r.col=n.col,r.row=n.row,r.colCount=n.colCount,r.rowCount=n.rowCount,r.col===-1&&(r.col=0,r.colCount=this.getColumnCount(t)),r.row===-1&&(r.row=0,r.rowCount=this.getRowCount(t)),r)},_getRangeRect:function(n,t,r){var o=this._getSheetLayout(),h=0,c=0,u=new i.Rect(o.frozenX,o.frozenY,0,0),s=this._getActualRange(r),f,e;t>0&&(h=Math.max(isNaN(this.frozenColCount)?0:this.frozenColCount,this._scrollLeftCol),u.x=o.viewportX),n>0&&(c=Math.max(isNaN(this.frozenRowCount)?0:this.frozenRowCount,this._scrollTopRow),u.y=o.viewportY);if(s.col<h){for(e=h-1;e>=s.col;e--)if(this.getColumnVisible(e)){u.x-=this._getZoomColumnWidth(e);if(u.x<o.x){e--;break}}for(e=e+1;e<s.col+s.colCount;e++)if(this.getColumnVisible(e)){u.width+=this._getZoomColumnWidth(e);if(u.width+u.x>o.x+o.width)break}}else{for(e=h;e<s.col;e++)if(this.getColumnVisible(e)){u.x+=this._getZoomColumnWidth(e);if(u.x>o.x+o.width)return u}for(e=s.col;e<s.col+s.colCount;e++)if(this.getColumnVisible(e)){u.width+=this._getZoomColumnWidth(e);if(u.width+u.x>o.x+o.width)break}}if(s.row<c){for(f=c-1;f>=s.row;f--)if(this.getRowVisible(f)){u.y-=this._getZoomRowHeight(f);if(u.y<o.y){f--;break}}for(f=f+1;f<s.row+s.rowCount;f++)if(this.getRowVisible(f)){u.height+=this._getZoomRowHeight(f);if(u.height+u.y>o.y+o.height)break}}else{for(f=c;f<s.row;f++)if(this.getRowVisible(f)){u.y+=this._getZoomRowHeight(f);if(u.y>o.y+o.height)return u}for(f=s.row;f<s.row+s.rowCount;f++)if(this.getRowVisible(f)){u.height+=this._getZoomRowHeight(f);if(u.height+u.y>o.y+o.height)break}}return u},_getActiveSelectionRect:function(n,t){return this._getRangeRect(n,t,this._getActiveSelectedRange())},_getCanvas:function(){var n=this._canvas;return!n&&this.parent&&(n=this.parent.canvas),n&&!n.getContext&&n.firstChild&&(n.getContext=n.firstChild.getContext),n},_draw:function(n,t){var i=this._render._getCtx();i&&this._render.paint(i,t)},_updateEditingInputSize:function(n,i){var g,e,nt,et,u,s,k,w,ft;if(this._isEditing){var r=this._textBox,a=r.value,d=r.style.font;d||(d=this._render._getZoomFont(this._render._getDefaultFont())),g=this._getFontHeight(d);if(n)if(this._eventHandler.allowEnterEditing(n)){var ut=r.selectionStart,ht=a.substr(0,ut),st=a.substr(ut,a.length-ut);a=ht+String.fromCharCode(n.keyCode)+st}var rt=a.split(/\r\n|\r|\n/),v="word-wrap",c="overflow",it="normal",ot="break-word",o,l,tt;r.maxWidth<r.minWidth&&(r.minWidth=r.maxWidth),r.maxHeight<r.minHeight&&(r.minHeight=r.maxHeight);if(i&&i.wordWrap||rt.length>0){for(e=0,nt=[],o=0;o<rt.length;o++)et=rt[o],l=this._getStringWidth(et,d),nt.push(l),e=Math.max(e,l);u=rt.length*g;if(e>r.minWidth){if(e>r.minWidth&&e<=r.maxWidth)t(r).css(h,e),t(r).css(v,it),t(r).css(c,y);else if(e>r.maxWidth)for(t(r).css(h,r.maxWidth),t(r).css(v,ot),t(r).css(c,y),u=0,o=0;o<nt.length;o++)l=nt[o],l>r.maxWidth?l>r.maxWidth&&(tt=Math.ceil(l/r.maxWidth),u+=g*tt):u+=g}else t(r).css(h,r.minWidth),t(r).css(v,it),t(r).css(c,y);u>r.minHeight?u>r.minHeight&&u<=r.maxHeight?t(r).css(f,u):u>r.maxHeight&&(t(r).css(f,r.maxHeight),t(r).css("overflow-y","scroll")):t(r).css(f,r.minHeight)}else s=this._getStringWidth(a,d),s>r.minWidth&&s<=r.maxWidth?(t(r).css(h,s),t(r).css(f,r.minHeight),t(r).css(v,it),t(r).css(c,y)):s>r.minWidth?s>r.maxWidth&&(t(r).css(h,r.maxWidth),t(r).css(v,ot),tt=Math.ceil(s/r.maxWidth),k=g*tt,k>r.minHeight?k>r.maxHeight?k>r.maxHeight&&(t(r).css(f,r.maxHeight),t(r).css("overflow-y","scroll")):(t(r).css(f,k),t(r).css(c,y)):(t(r).css(f,r.minHeight),t(r).css(c,y))):(t(r).css(h,r.minWidth),t(r).css(f,r.minHeight),t(r).css(v,it),t(r).css(c,y));w=t(r).css(b),ft=t(r).width()-r.minWidth,w!==undefined&&w!==null&&w!==p&&(w===ct?t(r).css(p,r.originalLeft-ft/2):w===kt&&t(r).css(p,r.originalLeft-ft)),this._updateEditingLocator()}},_updateEditingLocator:function(){if(this._isEditing&&this.showEditingLocator){var n=this._textBox,i=n._editingLocator;t(i).css(nt,parseInt(t(n).css(nt),10)-18),t(i).css(p,parseInt(t(n).css(p),10))}},_getStringWidth:function(n,i){var u=this._getEditingSpan(),e,r,f;return u.style.font="",u.style.font=i?i:this._render._getZoomFont(this._render._getDefaultFont()),n=n+"",t(u).text(n),e=u.offsetWidth,r=this._getEditingPre(),r.style.font=i?i:this._render._getZoomFont(this._render._getDefaultFont()),t(r).text(n),f=r.offsetWidth,t.browser.mozilla?(e+=3,f+=3):t.browser.msie&&(e+=1,f+=1),Math.max(e,f)},_getFontHeight:function(n){var t=this._getEditingSpan();return t.style.font=n?n:this._render._getDefaultFont(),t.innerHTML="H",t.offsetHeight},_getEditingSpan:function(){if(!this._editingSpan){var n=l.createElement("span");n.style.visibility=y,n.style.top="-10000px",n.style.left="-10000px",n.style.position="absolute",n.className="gcStringWidthSpanStyle",n.setAttribute("gcUIElement","gcStringWidthSpan"),l.body.insertBefore(n,null),this._editingSpan=n}return this._editingSpan},_getEditingPre:function(){if(!this._editingPre){var n=l.createElement("pre");n.style.visibility=y,n.style.top="-10000px",n.style.left="-10000px",n.style.position="absolute",n.className="gcStringWidthPreStyle",n.setAttribute("gcUIElement","gcStringWidthPre"),l.body.insertBefore(n,null),this._editingPre=n}return this._editingPre},_getColumnPane:function(n){var t=this._getSheetLayout(),i=null;return t.headerX<n&&n<t.headerX+t.rowHeaderWidth?i=-1:t.frozenX<n&&n<t.frozenX+t.frozenWidth?i=0:t.viewportX<n&&n<t.viewportX+t.viewportWidth&&(i=1),i},_getRowPane:function(n){var t=this._getSheetLayout(),i=null;return t.headerY<n&&n<t.headerY+t.colHeaderHeight?i=-1:t.frozenY<n&&n<t.frozenY+t.frozenHeight?i=0:t.viewportY<n&&n<t.viewportY+t.viewportHeight&&(i=1),i},_getRowIndex:function(n,t){for(var u=null,r,u=t===-1?this._getRowLayout(0,i.SheetArea.colHeader):t===0?this._getRowLayout(0):this._getRowLayout(1),f=0;f<u.length;f++){r=u[f];if(r.y<=n&&n<r.y+r.height)return r.row}},_getColumnIndex:function(n,t){for(var u=null,r,u=t===-1?this._getColumnLayout(0,i.SheetArea.rowHeader):t===0?this._getColumnLayout(0):this._getColumnLayout(1),f=0;f<u.length;f++){r=u[f];if(r.x<=n&&n<r.x+r.width)return r.col}},_isActiveCell:function(n,t){return this._activeRowIndex<=n&&n<this._activeRowIndex+this._activeRowCount&&this._activeColIndex<=t&&t<this._activeColIndex+this._activeColCount},_isColumnSelected:function(n){for(var t,r,i=0;i<this._selectionModel.length;i++){t=this._selectionModel[i],r=t.col===-1?0:t.col;if(t.row===-1&&n>=r&&n<r+t.colCount)return!0}return!1},_isRowSelected:function(n){for(var t,r,i=0;i<this._selectionModel.length;i++){t=this._selectionModel[i],r=t.row===-1?0:t.row;if(t.col===-1&&n>=r&&n<r+t.rowCount)return!0}return!1},_isSelected:function(n,t,r){for(var f=!1,u,e,o=0;o<this._selectionModel.length;o++){u=this._getActualRange(this._selectionModel[o]),e=i.SheetArea,r===undefined||r===null||r===e.viewport?f=u.row<=n&&n<u.row+u.rowCount&&u.col<=t&&t<u.col+u.colCount:r===e.rowHeader?f=n===this._activeRowIndex||u.row<=n&&n<u.row+u.rowCount:r===e.colHeader||r===e.colFooter?f=t===this._activeColIndex||u.col<=t&&t<u.col+u.colCount||t<0&&u.row===0&&u.col===0&&u.rowCount===this.getRowCount()&&u.colCount===this.getColumnCount():r===e.corner&&(f=u.row===-1&&u.col===-1&&u.rowCount===this.getRowCount()&&u.colCount===this.getColumnCount());if(f)return f}return f},_isAllSelected:function(n,t,r){for(var f=!1,l=this.getRowCount(),c=this.getColumnCount(),e=i.SheetArea,u,s,h,o=0;o<this._selectionModel.length;o++){u=this._selectionModel[o],r!==undefined&&r!==null&&r!==e.viewport&&(r===e.rowHeader?(s=u.row===-1?0:u.row,f=u.col===-1&&n>=s&&n<s+u.rowCount):r===e.colHeader||r===e.colFooter?(h=u.col===-1?0:u.col,f=u.row===-1&&t>=h&&t<h+u.colCount):r===e.corner&&(f=u.row===-1&&u.col===-1&&u.rowCount===l&&u.colCount===c));if(f)return f}return f},_isHover:function(n,t,r){var h=!1,u=this._currentTarget,o=i.SheetArea,e,f,s;if(this._currentTarget&&r!==undefined&&r!==null)if(r===o.colHeader)return e=!1,f=this._colHeaderSpanModel.find(u.row,u.col),f&&(e=f.contains(n,t,1,1)),s=n===u.row&&t===u.col||e,u.hitTestType===r&&s;else if(r===o.rowHeader)return e=!1,f=this._rowHeaderSpanModel.find(u.row,u.col),f&&(e=f.contains(n,t,1,1)),s=n===u.row&&t===u.col||e,u.hitTestType===r&&s;else if(r===o.colFooter)return u.hitTestType===r&&n===u.row&&t===u.col;else if(r===o.viewport)return u.hitTestType===r&&n===u.row&&t===u.col;else if(r===o.corner)return u.hitTestType===r;return h},_indexToLetters:function(n){for(var u="A",r=u.charCodeAt(0),t="",i;n>0;n=(n-1)/26)i=parseInt((n-1)%26,10),(n===1||i>=0&&n>1)&&(t=String.fromCharCode(r+i)+t);return t},_doStartEdit:function(n,t,i){var r=this.hitTest(t,i);if(!r)return;r.row<0||r.col<0||r.rowViewportIndex<0||r.colViewportIndex<0||r.resizeInfo||r.dragInfo||r.row!==this._activeRowIndex||r.col!==this._activeColIndex||this._startEditImp(n,r.row,r.col)},_getSheetAreaFromHitTest:function(n){var t=null,r=i.SheetArea;return n.rowViewportIndex===2&&n.colViewportIndex<0||(n.rowViewportIndex<0&&n.colViewportIndex<0?t=r.corner:n.rowViewportIndex<0&&n.colViewportIndex>=0?t=r.colHeader:n.rowViewportIndex>=0&&n.rowViewportIndex<2&&n.colViewportIndex<0?t=r.rowHeader:n.rowViewportIndex<0||n.rowViewportIndex>=2||n.colViewportIndex<0||(t=r.viewport)),t},_startEditImp:function(r,u,e,o,s,c,a){var tt,ot,et,fi,vt,v,wt,ti,ut,lt,k,ui,rt,yt,pt,d,it,ht,oi,dt,gt,bt,si,ei,st;if(this._isEditing)return;if(this.getRowHeight(u)<=0||this.getColumnWidth(e)<=0)return;this.showCell(this._activeRowIndex,this._activeColIndex,i.VerticalPosition.nearest,i.HorizontalPosition.nearest),tt=this.getActualStyle(u,e);if(this.isProtected&&tt.locked!==!1)return;ot=u,et=e;if(ot>=0&&et>=0){fi=this._bounds,this._activeRowIndex=ot,this._activeColIndex=et,vt=this._getCellType(u,e);if(!vt)return;v=vt.getEditor();if(!v)return;this._textBox=v,wt={sheet:this,sheetName:this._name,row:ot,col:et,cancel:!1},this._trigger(i.Events.EditStarting,wt);if(wt&&wt.cancel===!0){this._isEditing=!1;return}this._isEditing=!0;var y=this.getCellRect(ot,et,o,s),g=this._getSheetLayout(),ft=r.currentStyle;l.defaultView&&l.defaultView.getComputedStyle&&(ft=l.defaultView.getComputedStyle(r,"")),ft||(ft=r.style),ft.borderTopWidth===undefined||ft.borderTopWidth===null||isNaN(ft.borderTopWidth)||(y.y+=parseFloat(ft.borderTopWidth)),ft.borderLeftWidth===undefined||ft.borderLeftWidth===null||isNaN(ft.borderLeftWidth)||(y.x+=parseFloat(ft.borderLeftWidth)),ti=this._eventHandler._getCanvasOffset(),v.originalTop=ti.top+fi.y+y.y-2,v.originalLeft=ti.left+fi.x+y.x-2,t(v).css(nt,v.originalTop),t(v).css(p,v.originalLeft),ut=this,this._gcEditingInputKeyDown=function(n){ut._updateEditingInputSize(n,tt)},lt=i.Key,this._gcEditingInputKeyUp=function(n){(n.keyCode===lt.del||n.keyCode===lt.backspace||(n.keyCode===lt.z||n.keyCode===lt.y)&&n.ctrlKey&&!n.altKey)&&ut._updateEditingInputSize(n,tt),(n.keyCode!==lt.enter&&n.keyCode!==lt.tab||n.ctrlKey||n.altKey)&&ut._trigger(i.Events.EditChange,{sheet:ut,sheetName:ut._name,row:ut._activeRowIndex,col:ut._activeColIndex})},this._gcEditingInputPaste=function(t){ut._pasteInputSizingToken=n.setTimeout(function(){ut._updateEditingInputSize(t,tt),ut._pasteInputSizingToken&&(n.clearTimeout(ut._pasteInputSizingToken),delete ut._pasteInputSizingToken)},10)},t(v).bind(ni,this._gcEditingInputKeyDown),t(v).bind(ri,this._gcEditingInputKeyUp),t(v).bind(ii,this._gcEditingInputPaste),k=this.getFormula(ot,et),k&&(k="="+k),ui=k;if(!k||k.length===0){k=this.getValue(ot,et),k&&k.length>0&&/^=/ig.test(k)&&(k="'"+k),ui=k,rt=tt.formatter?tt.formatter:tt._autoFormatter;if(k!==null&&k!==undefined)if(rt instanceof i.AutoFormatter&&rt._innerFormatter instanceof i.GeneralFormatter)k=rt._innerFormatter.GetPreferredEditingFormatter(k).Format(k);else{yt=null,typeof rt===w&&(yt=rt,rt=new i.GeneralFormatter(rt));if(rt)try{pt=rt.GetFormatType(k),pt===i.NumberFormatType.Number||pt===i.NumberFormatType.Text?rt=new i.GeneralFormatter("General"):pt===i.NumberFormatType.DateTime&&yt&&yt.indexOf("y")<0&&yt.indexOf("d")<0&&yt.indexOf("mmm")<0&&(rt=new i.GeneralFormatter("yyyy/mm/dd hh:mm:ss"),this._editingTimeValue=!0),k=rt.Format(k)}catch(hi){k=this.getText(ot,et)}else k=this.getText(ot,et)}}a!==null&&a!==undefined&&(k=a),vt.setEditorValue(v,k),this._textBox._oldValue=k,d=null,it=i.HorizontalAlign,tt&&(d=i._SheetRender.getHAlignByValueType(tt.hAlign,ui),d===it.left?t(v).css(b,p):d===it.center?t(v).css(b,ct):d===it.right?t(v).css(b,kt):t(v).css(b,p),tt.backColor&&t(v).css("background-color",tt.backColor),tt.foreColor&&t(v).css("color",tt.foreColor),ht=null,ht=tt.font?tt.font:this._render._getDefaultFont(),ht&&(this._zoomFactor>1&&(ht=this._render._getZoomFont(ht)),t(v).css(at,ht))),l.all||t.browser.msie||t.browser.opera?(t(v).css(h,y.width-3),t(v).css(f,y.height-3),d===undefined||d===null||d===it.left?v.maxWidth=g.width-y.x-3:d===it.center?v.maxWidth=Math.min(g.width-y.x-y.width-3,y.x-g.rowHeaderWidth-3)*2+y.width:d===it.right&&(v.maxWidth=y.x+y.width-g.rowHeaderWidth-3),v.maxHeight=g.height-y.y-3):t.browser.webkit?(t(v).css(h,y.width-5),t(v).css(f,y.height-5),d===undefined||d===null||d===it.left?v.maxWidth=g.width-y.x-5:d===it.center?v.maxWidth=Math.min(g.width-y.x-y.width-5,y.x-g.rowHeaderWidth-5)*2+y.width:d===it.right&&(v.maxWidth=y.x+y.width-g.rowHeaderWidth-5),v.maxHeight=g.height-y.y-5):t.browser.mozilla?(t(v).css(h,y.width-1),t(v).css(f,y.height-1),d===undefined||d===null||d===it.left?v.maxWidth=g.width-y.x-1:d===it.center?v.maxWidth=Math.min(g.width-y.x-y.width-1,y.x-g.rowHeaderWidth-1)*2+y.width:d===it.right&&(v.maxWidth=y.x+y.width-g.rowHeaderWidth-1),v.maxHeight=g.height-y.y-1):(t(v).css(h,y.width-3),t(v).css(f,y.height-3),d===undefined||d===null||d===it.left?v.maxWidth=g.width-y.x-3:d===it.center?v.maxWidth=Math.min(g.width-y.x-y.width-3,y.x-g.rowHeaderWidth-3)*2+y.width:d===it.right&&(v.maxWidth=y.x+y.width-g.rowHeaderWidth-3),v.maxHeight=g.height-y.y-3),v.minWidth=parseInt(v.style.width,10),v.minHeight=parseInt(v.style.height,10),oi=this._getStringWidth(k,t(v).css(at)),oi>v.minWidth&&this._updateEditingInputSize(null,tt),t(v).css(h,Math.min(v.maxWidth,parseInt(t(v).css(h),10))),t(v).css(f,Math.min(v.maxHeight,parseInt(t(v).css(f),10))),l.body.insertBefore(v,null),dt=i.SheetArea.colHeader,gt=i.SheetArea.rowHeader,this.showEditingLocator&&(bt=vt._getLocator(),v._editingLocator=bt,si=this.getValue(this._getModel(dt).rowCount-1,e,dt),ei=this.getValue(u,this._getModel(gt).colCount-1,gt),bt.innerHTML=si+""+ei,this._updateEditingLocator(),l.body.insertBefore(bt,null)),vt.focus(v),v.selectionStart=v.value.length,c&&v.select(),st=this.getCellRect(u,e,o,s),st.x-=2,st.y-=2,st.width+=4,st.height+=4,this._allowCellOverflow&&(st.x=g.frozenX,st.width=g.viewportWidth),this.repaint(st),n.gcGlobal.activeElement=this}},_showEditingLocator:function(){var r,u;if(this._isEditing===!1)return;if(this._textBox&&this._textBox._editingLocator){var f=t(this._textBox),n=parseInt(f.css(p),10)+this.getColumnWidth(this._activeColIndex)/2,i=parseInt(f.css(nt),10)+this.getRowHeight(this._activeRowIndex)/2,e=t(this._getCanvas()).offset();n-=e.left,i-=e.top,r=this._getRowIndex(i,this._getRowPane(i)),u=this._getColumnIndex(n,this._getColumnPane(n)),r===this._activeRowIndex&&u===this._activeColIndex?t(this._textBox._editingLocator).css(pt,y):t(this._textBox._editingLocator).css(pt,"visible")}},_getKeyAction:function(n,t,i,r){var e,f,u;if(!this.keyMap)return null;for(e=this.keyMap.length,f=0;f<e;f++){u=this.keyMap[f];if(u&&u.key===n&&u.ctrl===t&&u.shift===i&&u.alt===r)return u}return null},_moveActiveCellUp:function(n,t,i,r,u){var e,o,f;if(n===0&&!i)return;e=this.getRowCount(),o=this.getColumnCount(),(this._leadingCellCol===undefined||this._leadingCellCol===null)&&(this._leadingCellCol=0),f=this._getPrevRow(n,this._leadingCellCol,r,u),i||this._adjustCell(f),n=f.r,t=f.c,n<0&&i&&(t=this._getPrevVisualColumn(t),(t<0||t===undefined||t===null)&&(t=this._getPrevVisualColumn(o)),this._leadingCellCol=t,f=this._getPrevRow(e,t,r,u),n=f.r,t=f.c),this._canMoveCurrentTo(n,t)&&(this._leadingCellRow=n,this._activeRowIndex=n,this._activeColIndex=t)},_moveActiveCellDown:function(n,t,i,r,u){var e=this.getRowCount(),o=this.getColumnCount(),f;if(n===e-1&&!i)return;(this._leadingCellCol===undefined||this._leadingCellCol===null)&&(this._leadingCellCol=0),f=this._getNextRow(n,this._leadingCellCol,r,u),i||this._adjustCell(f),n=f.r,t=f.c,n===e&&i&&(t=this._getNextVisualColumn(t),t<o&&t!==undefined&&t!==null||(t=this._getNextVisualColumn(-1)),this._leadingCellCol=t,f=this._getNextRow(-1,t,r,u),n=f.r,t=f.c),this._canMoveCurrentTo(n,t)&&(this._leadingCellRow=n,this._activeRowIndex=n,this._activeColIndex=t)},_moveActiveCellLeft:function(n,t,i,r,u){var e,o,f;if(t===0&&!i)return;e=this.getRowCount(),o=this.getColumnCount(),(this._leadingCellRow===undefined||this._leadingCellRow===null)&&(this._leadingCellRow=0),f=this._getPrevColumn(this._leadingCellRow,t,r,u),i||this._adjustCell(f),n=f.r,t=f.c,t<0&&i&&(n=this._getPrevVisualRow(n),(n<0||n===undefined||n===null)&&(n=this._getPrevVisualRow(e)),this._leadingCellRow=n,f=this._getPrevColumn(n,o,r,u),n=f.r,t=f.c),this._canMoveCurrentTo(n,t)&&(this._leadingCellCol=t,this._activeRowIndex=n,this._activeColIndex=t)},_adjustCell:function(n){n.r<0?n.r=this._getFirstVisualRow():n.r<this.getRowCount()||(n.r=this._getLastVisualRow()),n.c<0?n.c=this._getFirstVisualColumn():n.c<this.getColumnCount()||(n.c=this._getLastVisualColumn())},_moveActiveCellLeftInSelection:function(n,t){var r=this._getActiveSelectedRange(),s=r.row,o=r.col,h=r.col+r.colCount-1,e=this._getPrevColumnInSelection(n,t,!1,!1),u,f;n=e.r,t=e.c;if(t<o){n-=1;if(n<s){r=this._getActiveSelectedRange(i.Direction.left),u=r.row+r.rowCount-1,f=r.col+r.colCount,f<this._scrollLeftCol?this._scrollLeftCol=f:f>this._getPageRightColumn()&&(this._scrollLeftCol=f,this._setLeftColumn(this._getPrevPageLeftColumn())),u<this._scrollTopRow?this._setTopRow(u):u>this._getPageBottomRow()&&(this._scrollTopRow=u,this._setTopRow(this._getPrevPageTopRow())),this._moveActiveCellLeftInSelection(u,f);return}this._moveActiveCellLeftInSelection(n,h+1);return}n<0||(this._activeRowIndex=n,this._activeColIndex=t,this._leadingCellRow=n,this._leadingCellCol=t)},_moveActiveCellRightInSelection:function(n,t){var r=this._getActiveSelectedRange(),s=r.col,o=r.row+r.rowCount-1,h=r.col+r.colCount-1,e=this._getNextColumnInSelection(n,t,!1,!1),u,f;n=e.r,t=e.c;if(t>h){n+=1;if(n>o){r=this._getActiveSelectedRange(i.Direction.right),u=r.row,f=r.col,f<this._scrollLeftCol?this._setLeftColumn(this._getNextVisualColumn(f-1)):f>this._getPageRightColumn()&&(this._scrollLeftCol=f,this._setLeftColumn(this._getPrevPageLeftColumn())),u<this._scrollTopRow?this._setTopRow(this._getNextVisualRow(u-1)):u>this._getPageBottomRow()&&(this._scrollTopRow=u,this._setTopRow(this._getPrevPageTopRow())),this._moveActiveCellRightInSelection(u,f-1);return}this._moveActiveCellRightInSelection(n,s-1);return}n<0||(this._activeRowIndex=n,this._activeColIndex=t,this._leadingCellRow=n,this._leadingCellCol=t)},_moveActiveCellRight:function(n,t,i,r,u){var o=this.getRowCount(),e=this.getColumnCount(),f;if(t===e-1&&!i)return;(this._leadingCellRow===undefined||this._leadingCellRow===null)&&(this._leadingCellRow=0),f=this._getNextColumn(this._leadingCellRow,t,r,u),i||this._adjustCell(f),n=f.r,t=f.c,t===e&&i&&(n=this._getNextVisualRow(n),n<o&&n!==undefined&&n!==null||(n=this._getNextVisualRow(-1)),this._leadingCellRow=n,f=this._getNextColumn(n,-1,r,u),n=f.r,t=f.c),this._canMoveCurrentTo(n,t)&&(this._leadingCellCol=t,this._activeRowIndex=n,this._activeColIndex=t)},_getPrevColumn:function(n,t,r,u){var o={r:n,c:t},e,f;while(t>=0){t--;if(t<0)break;e=this.getSpans(new i.Range(n,t,1,1)),e&&e.length>0&&(f=e[0],t<f.col||(t=f.col,n=f.row));if(this._canMoveCurrentTo(n,t,o))return{r:n,c:t}}return{r:n,c:t}},_getPrevColumnInSelection:function(n,t,i,r){var u,f;while(t>=0){t--;if(t<0)break;u=this._spanModel.find(n,t);if(u){f=this._getActiveSelectedRange();if(f.row>u.row||u.row+u.rowCount>f.row+f.rowCount||f.col>u.col||u.col+u.colCount>f.col+f.colCount)continue;else if(!(u.row===n&&u.col===t))continue;t<u.col||(t=u.col,n=u.row)}if(this._canMoveCurrentTo(n,t))return{r:n,c:t}}return{r:n,c:t}},_getNextColumn:function(n,t,r,u){var s=this.getColumnCount(),h={r:n,c:t},o,e,f;while(t<s){o=this._spanModel.find(n,t),o?t+=o.colCount:t++;if(t>=s)break;e=this.getSpans(new i.Range(n,t,1,1)),e&&e.length>0&&(f=e[0],t>f.col?t=Math.max(t,f.col+f.colCount):n=f.row);if(this._canMoveCurrentTo(n,t,h))return{r:n,c:t}}return{r:n,c:t}},_getNextColumnInSelection:function(n,t,i,r){var o=this.getColumnCount(),e,u,f;while(t<o){e=this._spanModel.find(n,t),e?t+=e.colCount:t++;if(t>=o)break;u=this._spanModel.find(n,t);if(u){f=this._getActiveSelectedRange();if(f.row>u.row||u.row+u.rowCount>f.row+f.rowCount||f.col>u.col||u.col+u.colCount>f.col+f.colCount)continue;else if(!(u.row===n&&u.col===t))continue;t>u.col?t=Math.max(t,u.col+u.colCount):n=u.row}if(this._canMoveCurrentTo(n,t))return{r:n,c:t}}return{r:n,c:t}},_canMoveCurrentTo:function(n,t,i){var r=!1,e=this.getRowVisible(n),o=this.getColumnVisible(t),u=this._getZoomRowHeight(n),f=this._getZoomColumnWidth(t);return r=n>=0&&n<this.getRowCount()&&t>=0&&t<this.getColumnCount()&&e&&o&&u>0&&f>0},_getPrevRow:function(n,t,r,u){var o={r:n,c:t},e,f;while(n>=0){n--;if(n<0)break;e=this.getSpans(new i.Range(n,t,1,1)),e&&e.length>0&&(f=e[0],n<f.row||(n=f.row,t=f.col));if(this._canMoveCurrentTo(n,t,o))return{r:n,c:t}}return{r:n,c:t}},_getNextRow:function(n,t,r,u){var s=this.getRowCount(),h={r:n,c:t},o,e,f;while(n<s){o=this._spanModel.find(n,t),o?n+=o.rowCount:n++;if(n>=s)break;e=this.getSpans(new i.Range(n,t,1,1)),e&&e.length>0&&(f=e[0],n>f.row?n=Math.max(n,f.row+f.rowCount):t=f.col);if(this._canMoveCurrentTo(n,t,h))return{r:n,c:t}}return{r:n,c:t}},_setSelectedRange:function(n,t,i,r,u){this._selectionModel.add(n,t,i,r),u&&this._render.repaintSelection()},_extendSelectedRange:function(n,t,i){var r=this._getExtendedRange(n,t);this._replaceActiveSelectedRange(r.row,r.col,r.rowCount,r.colCount,i)},_getExtendedRange:function(n,t){var s=new i.Range(this._activeRowIndex,this._activeColIndex,1,1),o=this._spanModel.find(this._activeRowIndex,this._activeColIndex),e,f,r,u;return o&&(s=o),e=new i.Range(n,t,1,1),f=this._spanModel.find(n,t),f&&(e=f),r=s.union(e),u=this.getSpans(),u&&u.length>0&&(r=this._inflateRangeToCoverSpans(u,r)),r},_replaceActiveSelectedRange:function(n,t,r,u,f){var o=this._getActiveSelectedRange(),e,s;this._selectionModel.length>0?this._selectionModel.splice(this._selectionModel.activeSelectedRangeIndex,1,new i.Range(n,t,r,u)):this._selectionModel.add(n,t,r,u);if(f){e=this._getActiveSelectedRange();if(e.row===o.row&&e.col===o.col&&e.rowCount===o.rowCount&&e.colCount===o.colCount)return;s=this._render,o.containsRange(e)?s.repaintSelection(o):e.containsRange(o)?s.repaintSelection(e):(s.repaintSelection(o),s.repaintSelection(e))}},_changeActiveSelectedRange:function(n,t){var e,r,u,f,h,s,o;if(this._selectionModel.length<=0)return;e=this._getActiveSelectedRange(),r=new i.Range(e.row,e.col,e.rowCount,e.colCount),r.row<0&&(r.row=0,r.rowCount=this.getRowCount()),r.col<0&&(r.col=0,r.colCount=this.getColumnCount()),u=null,f=i.Key,n===f.left?u=t?this._searchSelectedRangebyLeftCtrl(r):this._searchSelectedRangebyLeft(r):n===f.right?u=t?this._searchSelectedRangebyRightCtrl(r):this._searchSelectedRangebyRight(r):n===f.up?u=t?this._searchSelectedRangebyUpCtrl(r):this._searchSelectedRangebyUp(r):n===f.down?u=t?this._searchSelectedRangebyDownCtrl(r):this._searchSelectedRangebyDown(r):n===f.home?u=t?this._searchSelectedRangebyHomeCtrl(r):this._searchSelectedRangebyHome(r):n===f.end?u=t?this._searchSelectedRangebyEndCtrl(r):this._searchSelectedRangebyEnd(r):n===f.pup?u=this._searchSelectedRangebyPageUp(r):n===f.pdn&&(u=this._searchSelectedRangebyPageDown(r)),u&&(e.row<0&&(u.row=-1,u.rowCount=this.getRowCount()),e.col<0&&(u.col=-1,u.colCount=this.getColumnCount()),h=this._selectionModel.toArray(),this._replaceActiveSelectedRange(u.row,u.col,u.rowCount,u.colCount,!0),s=this._selectionModel.toArray(),this._eventHandler._notEqualSelecions(h,s)&&(o=i.Events,this._trigger(o.SelectionChanging,{sheet:this,sheetName:this._name,oldSelections:h,newSelections:s}),this._trigger(o.SelectionChanged,{sheet:this,sheetName:this._name})))},_searchSelectedRangebyLeft:function(n){var u=n.col+n.colCount-1,a=0,c={r:n.row+n.rowCount-1,c:u},t,e,r,l,h,o,s,f;while(u>a){u--;if(!this._canMoveCurrentTo(c.r,u,c))continue;t=this._getExtendedRange(c.r,u),e=Math.min(n.row,t.row),r=Math.min(n.col,t.col),l=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),h=Math.min(n.col+n.colCount-1,t.col+t.colCount-1),o=l-e+1,s=h-r+1;if(!(e===n.row&&r===n.col&&o===n.rowCount&&s===n.colCount))return f=this._getPrevVisualColumn(this._scrollLeftCol),(r===f||h===f)&&this._setLeftColumn(f),new i.Range(e,r,o,s)}return null},_searchSelectedRangebyLeftCtrl:function(n,t){var l=this.frozenColCount?this._getNextVisualColumn(this.frozenColCount-1):this._getFirstVisualColumn(),u=t?l:this._getFirstVisualColumn(),r,e,f,c,h,s,o;if(u===undefined||u===null)return;else(this.frozenColCount<=0||t)&&this._setLeftColumn(u);return r=this._getExtendedRange(n.row,u),e=Math.min(n.row,r.row),f=Math.min(n.col,r.col),c=Math.max(n.row+n.rowCount-1,r.row+r.rowCount-1),h=Math.min(n.col+n.colCount-1,r.col+r.colCount-1),s=c-e+1,o=h-f+1,new i.Range(e,f,s,o)},_searchSelectedRangebyRight:function(n){var f=n.col,v=this.getColumnCount()-1,l={r:n.row+n.rowCount-1,c:f},t,o,u,a,e,c,s,r,h;while(f<v){f++;if(!this._canMoveCurrentTo(l.r,f,l))continue;t=this._getExtendedRange(l.r,f),o=Math.min(n.row,t.row),u=Math.max(n.col,t.col),a=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),e=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),c=a-o+1,s=e-u+1;if(!(o===n.row&&u===n.col&&c===n.rowCount&&s===n.colCount))return r=this.frozenColCount?this._getNextVisualColumn(this.frozenColCount-1):null,h=this._getPageRightColumn(),r!==undefined&&r!==null&&(u===r||e===r)?this._setLeftColumn(r):(u===h||e===h)&&this._setLeftColumn(this._getNextVisualColumn(this._scrollLeftCol)),new i.Range(o,u,c,s)}return null},_searchSelectedRangebyRightCtrl:function(n){var f=this._getLastPageLeftColumn(),h,t,u,r,c,s,e,o;if(f===undefined||f===null)return;else this._setLeftColumn(f);return h=this._getLastVisualColumn(),t=this._getExtendedRange(n.row,h),u=Math.min(n.row,t.row),r=Math.max(n.col,t.col),c=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),s=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),e=c-u+1,o=s-r+1,new i.Range(u,r,e,o)},_searchSelectedRangebyUp:function(n){var u=n.row+n.rowCount-1,a=0,h={r:u,c:n.col+n.colCount-1},t,r,f,c,l,o,s,e;while(u>a){u--;if(!this._canMoveCurrentTo(u,h.c,h))continue;t=this._getExtendedRange(u,h.c),r=Math.min(n.row,t.row),f=Math.min(n.col,t.col),c=Math.min(n.row+n.rowCount-1,t.row+t.rowCount-1),l=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),o=c-r+1,s=l-f+1;if(!(r===n.row&&f===n.col&&o===n.rowCount&&s===n.colCount))return e=this._getPrevVisualRow(this._scrollTopRow),(r===e||c===e)&&this._setTopRow(e),new i.Range(r,f,o,s)}return null},_searchSelectedRangebyUpCtrl:function(n,t){var l=this.frozenRowCount?this._getNextVisualRow(this.frozenRowCount-1):this._getFirstVisualRow(),u=t?l:this._getFirstVisualRow(),r,e,f,c,h,s,o;if(u===undefined||u===null)return;else(this.frozenRowCount<=0||t)&&this._setTopRow(u);return r=this._getExtendedRange(u,n.col),e=Math.min(n.row,r.row),f=Math.min(n.col,r.col),c=Math.min(n.row+n.rowCount-1,r.row+r.rowCount-1),h=Math.max(n.col+n.colCount-1,r.col+r.colCount-1),s=c-e+1,o=h-f+1,new i.Range(e,f,s,o)},_searchSelectedRangebyDown:function(n){var f=n.row,v=this.getRowCount()-1,l={r:f,c:n.col+n.colCount-1},t,r,o,e,a,c,s,u,h;while(f<v){f++;if(!this._canMoveCurrentTo(f,l.c,l))continue;t=this._getExtendedRange(f,l.c),r=Math.max(n.row,t.row),o=Math.min(n.col,t.col),e=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),a=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),c=e-r+1,s=a-o+1;if(r===n.row&&o===n.col&&c===n.rowCount&&s===n.colCount)continue;else return u=this.frozenRowCount?this._getNextVisualRow(this.frozenRowCount-1):null,h=this._getPageBottomRow(),u!==undefined&&u!==null&&(r===u||e===u)?this._setTopRow(u):(r===h||e===h)&&this._setTopRow(this._getNextVisualRow(this._scrollTopRow)),new i.Range(r,o,c,s)}return null},_searchSelectedRangebyDownCtrl:function(n){var f=this._getLastPageTopRow(),h,t,u,r,c,s,e,o;if(f===undefined||f===null)return;else this._setTopRow(f);return h=this._getLastVisualRow(),t=this._getExtendedRange(h,n.col),u=Math.max(n.row,t.row),r=Math.min(n.col,t.col),c=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),s=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),e=c-u+1,o=s-r+1,new i.Range(u,r,e,o)},_searchSelectedRangebyHome:function(n){var r=this.frozenColCount?this.frozenColCount-1:-1,l=this._activeColIndex,e={r:n.row+n.rowCount-1,c:n.col},t,f,u,c,h,o,s;while(r<l){r++;if(!this._canMoveCurrentTo(e.r,r,e))continue;if(n.col<=r&&n.col+n.colCount-1===this._activeColIndex)break;return t=this._getExtendedRange(e.r,r),f=Math.min(n.row,t.row),u=Math.min(n.col,t.col),c=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),h=Math.min(n.col+n.colCount-1,t.col+t.colCount-1),o=c-f+1,s=h-u+1,this._setLeftColumn(this._getFirstVisualColumn()),new i.Range(f,u,o,s)}return null},_searchSelectedRangebyHomeCtrl:function(n){return n=this._searchSelectedRangebyLeftCtrl(n,!0),n=this._searchSelectedRangebyUpCtrl(n,!0)},_searchSelectedRangebyEnd:function(n){var r=this.getColumnCount(),l=this._activeColIndex,e={r:n.row+n.rowCount-1,c:n.col+n.colCount-1},t,f,u,c,h,o,s;while(r>l){r--;if(!this._canMoveCurrentTo(e.r,r,e))continue;if(n.col+n.colCount-1>=r&&n.col===this._activeColIndex)break;return t=this._getExtendedRange(e.r,r),f=Math.min(n.row,t.row),u=Math.max(n.col,t.col),c=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),h=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),o=c-f+1,s=h-u+1,this._setLeftColumn(this._getLastPageLeftColumn()),new i.Range(f,u,o,s)}return null},_searchSelectedRangebyEndCtrl:function(n){return n=this._searchSelectedRangebyRightCtrl(n),n=this._searchSelectedRangebyDownCtrl(n)},_searchSelectedRangebyPageUp:function(n){var u=this._getPrevPageTopRow(),r,f,e,h,o,s,c;if(u===undefined||u===null)return null;var a=this._getRowLayout(1),l=this._setTopRow(u),t=-1;return l?t=this._getNextVisualRow(n.row+n.rowCount-1-a.length):this.frozenRowCount>0||(t=this._getFirstVisualRow()),t<this._scrollTopRow?t=this._scrollTopRow:t<this._getPageBottomRow()||(t=this._getPrevVisualRow(this._getPageBottomRow())),r=this._getExtendedRange(t,n.col),f=Math.min(n.row,r.row),e=Math.min(n.col,r.col),h=Math.min(n.row+n.rowCount-1,r.row+r.rowCount-1),o=Math.max(n.col+n.colCount-1,r.col+r.colCount-1),s=h-f+1,c=o-e+1,new i.Range(f,e,s,c)},_searchSelectedRangebyPageDown:function(n){var e=this._getNextPageTopRow(),c,t,r,u,f,l,h,o,s;return e===undefined||e===null?null:(c=this._getRowLayout(1),this._setTopRow(e),t=this._getPrevVisualRow(n.row+n.rowCount-1+c.length),t<this._scrollTopRow?t=this._scrollTopRow:t<this._getPageBottomRow()||(t=this._scrollTopRow<this._getLastPageTopRow()?this._getPrevVisualRow(this._getPageBottomRow()):this._getPageBottomRow()),r=this._getExtendedRange(t,n.col),u=Math.max(n.row,r.row),f=Math.min(n.col,r.col),l=Math.max(n.row+n.rowCount-1,r.row+r.rowCount-1),h=Math.max(n.col+n.colCount-1,r.col+r.colCount-1),o=l-u+1,s=h-f+1,new i.Range(u,f,o,s))},_getPrevPageTopRow:function(){var i=this._getRowLayout(1);if(!i||i.length<=0)return null;var u=this.frozenRowCount?this._getNextVisualRow(this.frozenRowCount-1):this._getFirstVisualRow(),t=0,n=this._scrollTopRow,r=this._getSheetLayout();while(n>u){t+=this._getZoomRowHeight(n);if(t>r.viewportHeight)break;n--}return n},_getPrevPageLeftColumn:function(){var t=this._getColumnLayout(1);if(!t||t.length<=0)return null;if(t[0].col===this._getFirstVisualColumn())return t[0].col;var i=0,n=this._scrollLeftCol,r=this._getSheetLayout();while(n>0){i+=this._getZoomColumnWidth(n);if(i>r.viewportWidth)break;n--}return n},_getNextPageTopRow:function(){var n=this._getRowLayout(1);return!n||n.length<=0?null:this._getLastVisualRow()===n[n.length-1].row?this._scrollTopRow:n[n.length-1].row},_getLastPageTopRow:function(){var t,n;if(this._getLastVisualRow()===this._getPageBottomRow()){var u=this._getSheetLayout(),r=this._getRowLayout(1),i=r[r.length-1];if(i.y+i.height<=u.viewportHeight)return this._scrollTopRow}t=this._scrollTopRow;try{return this._scrollTopRow=this._getLastVisualRow(),n=this._getPrevPageTopRow(),n=this._getNextVisualRow(n)}catch(f){}finally{this._scrollTopRow=t}},_getLastPageLeftColumn:function(){var t,u,i,r,n;if(this._getLastVisualColumn()===this._getPageRightColumn()){t=this._getSheetLayout(),u=this._getColumnLayout(1),i=u[u.length-1];if(i.x+i.width<=t.width)return this._scrollLeftCol}t=this._getSheetLayout(),r=0,n=this._getLastVisualColumn();while(n>0){r+=this._getZoomColumnWidth(n);if(r>t.viewportWidth)break;n--}return n>0&&(n=this._getNextVisualColumn(n)),n},_getPageBottomRow:function(){var n=this._getRowLayout(1);return!n||n.length<=0?null:n[n.length-1].row},_getPageRightColumn:function(){var n=this._getColumnLayout(1);return!n||n.length<=0?null:n[n.length-1].col},_getLastFullyVisibleRow:function(){var n=this._getRowLayout(1),i,t;return!n||n.length<=0?null:(i=this._getSheetLayout(),t=n.length-1,n[t].y+n[t].height>i.viewportY+i.viewportHeight?n[Math.max(t-1,0)].row:n[t].row)},_getLastFullyVisibleColumn:function(){var n=this._getColumnLayout(1),i,t;return!n||n.length<=0?null:(i=this._getSheetLayout(),t=n.length-1,n[t].x+n[t].width>i.viewportX+i.viewportWidth?n[Math.max(t-1,0)].col:n[t].col)},_getFirstVisualRow:function(){return this._getNextVisualRow(-1)},_getLastVisualRow:function(n){return(n===undefined||n===null)&&(n=i.SheetArea.viewport),this._getPrevVisualRow(this.getRowCount(n),n)},_getFirstVisualColumn:function(){return this._getNextVisualColumn(-1)},_getLastVisualColumn:function(n){return(n===undefined||n===null)&&(n=i.SheetArea.viewport),this._getPrevVisualColumn(this.getColumnCount(n),n)},_getFirstPageLeftColumn:function(){var n=0,t=isNaN(this.frozenColCount)?0:this.frozenColCount;return n=t>0?this._getNextVisualColumn(t-1):this._getFirstVisualColumn()},_getFirstPageTopRow:function(){var n=0,t=isNaN(this.frozenRowCount)?0:this.frozenRowCount;return n=t>0?this._getNextVisualRow(t-1):this._getFirstVisualRow()},_getNextVisualRow:function(n){var t=this.getRowCount()-1;while(n<t){n++;if(this.getRowVisible(n)&&this._getZoomRowHeight(n)>0)return n}return null},_getPrevVisualRow:function(n,t){while(n>0){n--;if(this.getRowVisible(n,t)&&this._getZoomRowHeight(n,t)>0)return n}return null},_getNextVisualColumn:function(n){var t=this.getColumnCount()-1;while(n<t){n++;if(this.getColumnVisible(n)&&this._getZoomColumnWidth(n)>0)return n}return null},_getPrevVisualColumn:function(n,t){while(n>0){n--;if(this.getColumnVisible(n,t)&&this._getZoomColumnWidth(n,t)>0)return n}return null},_inflateRangeToCoverSpans:function(n,t){var r,i;if(n&&n.length>0)for(r=0;r<n.length;r++){i=n[r];if(t.intersect(i.row,i.col,i.rowCount,i.colCount))return n.splice(r--,1),this._inflateRangeToCoverSpans(n,t.union(i))}return t},_getActiveSelectedRange:function(n){var r=new i.Range(-1,-1,0,0),t;return this._selectionModel.length<=0?r:(t=i.Direction,n===t.left?(this._selectionModel.activeSelectedRangeIndex--,this._selectionModel.activeSelectedRangeIndex<0&&(this._selectionModel.activeSelectedRangeIndex=this._selectionModel.length-1)):n===t.right&&(this._selectionModel.activeSelectedRangeIndex++,this._selectionModel.activeSelectedRangeIndex<this._selectionModel.length||(this._selectionModel.activeSelectedRangeIndex=0)),this._selectionModel.activeSelectedRangeIndex<0||(r=this._selectionModel[this._selectionModel.activeSelectedRangeIndex]),r)},_initializeActiveCell:function(){var r;if(this._activeRowIndex===undefined||this._activeRowIndex===null||this._activeColIndex===undefined||this._activeColIndex===null||this._selectionModel.length<=0){var i=0,t=0,n=this._spanModel.find(i,t);n?(this._selectionModel.add(i,t,n.rowCount,n.colCount),this._activeRowIndex=i,this._activeColIndex=t,this._activeRowCount=n.rowCount,this._activeColCount=n.colCount):(this._selectionModel.add(i,t,1,1),this._activeRowIndex=i,this._activeColIndex=t,this._activeRowCount=1,this._activeColCount=1),this._selectionModel.length>0&&(r=this._selectionModel[0],this._render.repaintSelection(r))}},_setHoverCell:function(n){var e=!1,r=this._currentTarget,o,s,u;r||(e=!0),e||n||(e=!0),e||(e=n.col!==r.col||n.row!==r.row||n.colViewportIndex!==r.colViewportIndex||n.rowViewportIndex!==r.rowViewportIndex||n.hitTestType!==r.hitTestType),this._currentTarget=n;if(e){this._hoverCell=!0;var f=this._getSheetLayout(),t=null,h=i.SheetArea;r&&(t=this.getCellRect(r.row,r.col,r.rowViewportIndex,r.colViewportIndex),t&&t.width>0&&t.height>0&&(o=0,s=0,u=this._getGroupLayout(),u&&(o=u.width,s=u.height),(t.x<f.rowHeaderWidth+o||t.y<f.colHeaderHeight+s||t.y>=f.height-f.footerHeight)&&(r.colViewportIndex<0&&r.col===this.getColumnCount(h.rowHeader)-1?this._render.update(t.x-1,t.y-1,t.width+1,t.height+2):r.row===this.getRowCount(h.colHeader)-1?this._render.update(t.x-1,t.y-1,t.width+2,t.height+1):this._render.update(t.x-1,t.y-1,t.width+2,t.height+2)))),n&&(t=this.getCellRect(n.row,n.col,n.rowViewportIndex,n.colViewportIndex),t&&t.width>0&&t.height>0&&(o=0,s=0,u=this._getGroupLayout(),u&&(o=u.width,s=u.height),(t.x<f.rowHeaderWidth+o||t.y<f.colHeaderHeight+s||t.y>=f.height-f.footerHeight)&&(n.colViewportIndex<0&&n.col===this.getColumnCount(h.rowHeader)-1?this._render.update(t.x-1,t.y-1,t.width+1,t.height+2):n.row===this.getRowCount(h.colHeader)-1?this._render.update(t.x-1,t.y-1,t.width+2,t.height+1):this._render.update(t.x-1,t.y-1,t.width+2,t.height+2)))),this._hoverCell=!1}},_getAvailableActiveCell:function(n,t,i){var r=this._skipSpanCell(n,t,i);return this._skipInvisibleCell(r)},_skipSpanCell:function(n,t,r){var u=this._spanModel.find(n,t);if(u){if(r&&u.rowCount===1||!r&&u.colCount===1)return u}else return new i.Range(n,t,1,1);return r?t++:n++,this._skipSpanCell(n,t,r)},_skipInvisibleCell:function(n){for(var f=n.row,e=this.getRowCount(),r,u,t=f;t<e;t++)if(this.getRowVisible(t)===!0)break;for(t<e&&(f=t),r=n.col,u=this.getColumnCount(),t=r;t<u;t++)if(this.getColumnVisible(t)===!0)break;return t<u&&(r=t),new i.Range(f,r,n.rowCount,n.colCount)},_processKeyMap:function(n){var r=!0,t=this._getKeyAction(n.keyCode,n.ctrlKey,n.shiftKey,n.altKey);return t&&typeof t.action===e&&(r=t.action.call(this),n.keyCode===i.Key.enter&&n.ctrlKey===!1&&n.altKey===!1&&i.cancelDefault(n)),r},_getRowInfos:function(n){var t=i.SheetArea;if(n===undefined||n===null||n===t.viewport||n===t.rowHeader)return this._rowInfos||(this._rowInfos={}),this._rowInfos;else if(n===t.colHeader)return this._colHeaderRowInfos||(this._colHeaderRowInfos={}),this._colHeaderRowInfos},_getZoomRowHeight:function(n,t){return parseInt(this.getRowHeight(n,t)*this._zoomFactor,10)},_getColumnInfos:function(n){var t=i.SheetArea;if(n===undefined||n===null||n===t.viewport||n===t.colHeader)return this._colInfos||(this._colInfos={}),this._colInfos;else if(n===t.rowHeader)return this._rowHeaderColInfos||(this._rowHeaderColInfos={}),this._rowHeaderColInfos;return null},_getZoomColumnWidth:function(n,t){return parseInt(this.getColumnWidth(n,t)*this._zoomFactor,10)},_getColumnCellType:function(n,t){var r=null,i=this._getColumnInfos(t);return i&&i[n]&&(r=i[n].cellType),r},_setColumnCellType:function(n,t,r){(r===undefined||r===null)&&(r=i.SheetArea.viewport);var u=this._getColumnInfos(r);u[n]||(u[n]={}),u[n].cellType=t,u[n].dirty=!0,this._trigger(i.Events.ColumnChanged,{sheet:this,sheetName:this._name,col:n,sheetArea:r,propertyName:"celltype"})},_getGroupLayout:function(){return this._cachedGroupLayout||(this._cachedGroupLayout=this._createGroupLayout()),this._cachedGroupLayout},_createGroupLayout:function(){var i={x:0,y:0,width:0,height:0},t,u,n,r;return this.rowRangeGroup&&(t=this.rowRangeGroup.getMaxLevel(),t<0||(u=Math.min(this._GROUPBUTTON_WIDTH,this._GROUPBUTTON_WIDTH*this._zoomFactor),i.width=u*(t+2)+this._GROUPPADDING*2)),this.colRangeGroup&&(n=this.colRangeGroup.getMaxLevel(),n<0||(r=Math.min(this._GROUPBUTTON_HEIGHT,this._GROUPBUTTON_HEIGHT*this._zoomFactor),i.height=r*(n+2)+this._GROUPPADDING*2)),i},_createLayout:function(){var t=i.Rect,o=new t(this._bounds.x+this.borderWidth,this._bounds.y+this.borderWidth,Math.max(0,this._bounds.width-2*this.borderWidth),Math.max(0,this._bounds.height-2*this.borderWidth)),c=o.width,s=o.height,n={x:o.x,y:o.y,width:o.width,height:o.height,rowHeaderWidth:0,colHeaderHeight:0,frozenWidth:0,frozenHeight:0,footerHeight:0,footerWidth:0,headerCornerRect:function(){return new t(this.x,this.y,this.rowHeaderWidth,this.colHeaderHeight)},colHeaderRect:function(n){return n===0?new t(this.frozenX,this.y,this.frozenWidth,this.colHeaderHeight):n===1?new t(this.viewportX,this.y,this.viewportWidth,this.colHeaderHeight):new t(this.frozenX,this.y,this.frozenWidth+this.viewportWidth,this.colHeaderHeight)},rowHeaderRect:function(n){return n===0?new t(this.x,this.frozenY,this.rowHeaderWidth,this.frozenHeight):n===1?new t(this.x,this.viewportY,this.rowHeaderWidth,this.viewportHeight):new t(this.x,this.frozenY,this.rowHeaderWidth,this.frozenHeight+this.viewportHeight)},viewportRect:function(n,i){return n===0?i===0?new t(this.frozenX,this.frozenY,this.frozenWidth,this.frozenHeight):i===1?new t(this.viewportX,this.frozenY,this.viewportWidth,this.frozenHeight):new t(this.frozenX,this.frozenY,this.frozenWidth+this.viewportWidth,this.frozenHeight):n===1?i===0?new t(this.frozenX,this.viewportY,this.frozenWidth,this.viewportHeight):i===1?new t(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight):new t(this.frozenX,this.viewportY,this.frozenWidth+this.viewportWidth,this.viewportHeight):i===0?new t(this.frozenX,this.frozenY,this.frozenWidth,this.frozenHeight+this.viewportHeight):i===1?new t(this.viewportX,this.frozenY,this.viewportWidth,this.frozenHeight+this.viewportHeight):new t(this.frozenX,this.frozenY,this.frozenWidth+this.viewportWidth,this.frozenHeight+this.viewportHeight)},footerRect:function(n){return n===0?new t(this.frozenX,this.footerY,this.frozenWidth,this.footerHeight):n===1?new t(this.viewportX,this.footerY,this.viewportWidth,this.footerHeight):new t(this.frozenX,this.footerY,this.frozenWidth+this.viewportWidth,this.footerHeight)},footerCornerRect:function(){return new t(this.footerX,this.footerY,this.footerWidth,this.footerHeight)}},l=this._getGroupLayout(),f,r,e,u,h;n.x+=l.width,n.y+=l.height,f=i.SheetArea;if(this.rowHeaderVisible===null||this.rowHeaderVisible===undefined||this.rowHeaderVisible)for(h=this.getColumnCount(f.rowHeader),u=0;u<h;u++)n.rowHeaderWidth+=this._getZoomColumnWidth(u,f.rowHeader);if(this.colHeaderVisible===null||this.colHeaderVisible===undefined||this.colHeaderVisible)for(e=this.getRowCount(f.colHeader),r=0;r<e;r++)n.colHeaderHeight+=this._getZoomRowHeight(r,f.colHeader);if(this._colFooterVisible)for(e=this.getRowCount(f.colFooter),r=0;r<e;r++)n.footerHeight+=this._getZoomRowHeight(r,f.colFooter);n.footerWidth=n.rowHeaderWidth;if(this.frozenColCount>0)for(h=this.getColumnCount(),u=0;u<this.frozenColCount&&u<h;u++)this.getColumnVisible(u)&&(n.frozenWidth+=this._getZoomColumnWidth(u));n.frozenWidth>n.width&&(n.frozenWidth=n.width-n.rowHeaderWidth);if(this.frozenRowCount>0)for(e=this.getRowCount(),r=0;r<this.frozenRowCount&&r<e;r++)this.getRowVisible(r)&&(n.frozenHeight+=this._getZoomRowHeight(r));return n.frozenHeight>n.height-n.colHeaderHeight&&(n.frozenHeight=n.height-n.colHeaderHeight),c-=n.rowHeaderWidth,s-=n.colHeaderHeight,c-=n.frozenWidth,s-=n.frozenHeight,s-=n.footerHeight,n.viewportWidth=Math.max(0,c),n.viewportHeight=Math.max(0,s),n.headerX=n.x,n.headerY=n.y,n.frozenX=n.headerX+n.rowHeaderWidth,n.frozenY=n.headerY+n.colHeaderHeight,n.viewportX=n.frozenX+n.frozenWidth,n.viewportY=n.frozenY+n.frozenHeight,n.footerX=n.headerX,n.footerY=n.y+n.height-n.footerHeight,n},_getSheetLayout:function(){return this._layoutModel||(this._layoutModel=this._createLayout()),this._layoutModel},_getColumnLayout:function(n,t){var r=null,u=i.SheetArea;return t===undefined||t===null||t===u.viewport||t===u.colHeader?r=this._colLayoutCache.viewport[n]:t===u.rowHeader&&(r=this._colLayoutCache.rowHeader[n]),r?r:(r=this._createColumnLayout(n,t),t===u.viewport||t===u.colHeader?this._colLayoutCache.viewport[n]=r:t===u.rowHeader&&(this._colLayoutCache.rowHeader[n]=r),r)},_createColumnLayout:function(n,t){var a=new i._LayoutModel,u=this._getSheetLayout(),s=0,h=0,r,o=this.getColumnCount(t),e,f=0,l=isNaN(this.frozenColCount)?0:Math.min(this.frozenColCount,this.getColumnCount()),c=0;for(t===i.SheetArea.rowHeader?(s=u.headerX,h=u.rowHeaderWidth):(n===0?o=l:n>0&&(c=Math.max(l,this._scrollLeftCol)),s=n>0?u.viewportX:u.frozenX,h=n>0?u.viewportWidth:u.frozenWidth),this.colVisibleCount===0&&(o=0),r=c,e=0;r<o&&(t===i.SheetArea.rowHeader||n===0||e<=h);r++,e+=f){if(!this.getColumnVisible(r,t)){e-=f;continue}f=this._getZoomColumnWidth(r,t),f<0||a.push(new i._Layout(-1,r,s+e,-1,f,-1))}return a},_getRowLayout:function(n,t){var r=null,u=i.SheetArea;return t===undefined||t===null||t===u.viewport||t===u.rowHeader?r=this._rowLayoutCache.viewport[n]:t===u.colHeader?r=this._rowLayoutCache.colHeader[n]:t===u.colFooter&&(r=this._rowLayoutCache.colFooter[n]),r?r:(r=this._createRowLayout(n,t),t===u.viewport||t===u.rowHeader?this._rowLayoutCache.viewport[n]=r:t===u.colHeader?this._rowLayoutCache.colHeader[n]=r:t===u.colFooter&&(this._rowLayoutCache.colFooter[n]=r),r)},_createRowLayout:function(n,t){var l=new i._LayoutModel,r=this._getSheetLayout(),o=0,h=0,u,a=this.getRowCount(t),s,e=0,v=isNaN(this.frozenRowCount)?0:Math.min(this.frozenRowCount,this.getRowCount()),c=0,f=i.SheetArea;for(t===undefined||t===null||t===f.viewport||t===f.rowHeader?(n===0?a=v:n>0&&(c=Math.max(v,this._scrollTopRow)),o=n>0?r.viewportY:r.frozenY,h=n>0?r.viewportHeight:r.frozenHeight):t===f.colHeader?(o=r.headerY,h=r.colHeaderHeight):t===f.colFooter&&(o=r.footerY,h=r.footerHeight),u=c,s=o;u<a&&(t===f.colHeader||t===f.colFooter||n===0||s<o+h);u++,s+=e){if(!this.getRowVisible(u,t)){s-=e;continue}e=this._getZoomRowHeight(u,t),e<0||l.push(new i._Layout(u,-1,-1,s,-1,e))}return l},_getCellLayout:function(n,t,r){var u=this._getSheetLayout(),p=n>0?u.viewportY:u.frozenY,y=n>0?u.viewportHeight:u.frozenHeight,k=t>0?u.viewportX:u.frozenX,d=t>0?u.viewportWidth:u.frozenWidth,o=i.SheetArea;r===o.rowHeader?(k=u.headerX,d=u.rowHeaderWidth):r===o.colHeader?(p=u.headerY,y=u.colHeaderHeight):r===o.colFooter&&(p=u.footerY,y=u.footerHeight);var w=this.getRowCount(r),b=this.getColumnCount(r),e=this._getRowLayout(n,r),f=this._getColumnLayout(t,r),a=new i._LayoutModel;if(e.length>0&&f.length>0){var s=e[0].row,h=f[0].col,c=e[e.length-1].row,l=f[f.length-1].col,v=this.getSpans(new i.Range(s,h,c-s+1,l-h+1),r);this._addCellLayout(v,s,h,c,l,a,w,b,r,e,f),(r===undefined||r===null||r===o.viewport)&&(v=new i._SpanModel,this._addCellLayout(v,s,h,c,l,a,w,b,r,e,f))}return a},_addCellLayout:function(n,t,r,u,f,e,o,s,h,c,l){for(var a,p=0;p<n.length;p++){a=n[p];if(a.intersect(t,r,u-t+1,f-r+1)){for(var b=0,w=0,d=0,k=0,y,v=a.col;v<r;v++)b-=this._getZoomColumnWidth(v,h);for(v=r;v<a.col;v++)b+=this._getZoomColumnWidth(v,h);for(y=a.row;y<t;y++)w-=this._getZoomRowHeight(y,h);for(y=t;y<a.row;y++)w+=this._getZoomRowHeight(y,h);for(v=a.col;v<a.col+a.colCount&&v<s;v++)d+=this._getZoomColumnWidth(v,h);for(y=a.row;y<a.row+a.rowCount&&y<o;y++)k+=this._getZoomRowHeight(y,h);e.push(new i._Layout(a.row,a.col,l[0].x+b,c[0].y+w,d,k,a.rowCount,a.colCount))}}},_syncHScollbarPosition:function(){this._scrollCallback&&this._scrollCallback({action:"scroll",orientation:"horizontal"})},_syncVScrollbarPosition:function(){this._scrollCallback&&this._scrollCallback({action:"scroll",orientation:"vertical"})},_syncScrollbarSize:function(){this._scrollCallback&&this._scrollCallback({action:"resize"})},_setTopRow:function(n,t){var y,s,h,w,b,l,v,f;if(t||n!==undefined&&n!==null&&n>=this._getFirstPageTopRow()&&n<=this._getLastVisualRow()&&n!==this._scrollTopRow){this._trigger(i.Events.TopRowChanged,{sheet:this,sheetName:this._name,oldTopRow:this._scrollTopRow,newTopRow:n}),y=!1;if(u.UI._useDoubleBuffer()){var a=this._render._getBufferCtx(),c=this._scrollTopRow,r=null,e=this._getRowLayout(1,u.UI.SheetArea.viewport);this._scrollTopRow=n;if(this._scrollTopRow>c){s=e.findRow(this._scrollTopRow);if(s){y=!0,r=this._getSheetLayout();var f=e.length-1,b=e[f],o=e[f].height+2;e[f].y+e[f].height>r.viewportHeight&&(o+=e[f-1].height);if(r.viewportHeight-s.y-o>0){for(this._render.translateScreen(r.x,s.y,r.rowHeaderWidth+r.frozenWidth+r.viewportWidth,r.viewportHeight-s.y-o,r.x,r.viewportY),this._render._copyDoubleBufferRect(new i.Rect(r.x,s.y,r.rowHeaderWidth+r.frozenWidth+r.viewportWidth,r.viewportHeight-s.y-o),r.x,r.viewportY,null,a,a),f=c;f<this._scrollTopRow;f++)this._clearCellOverflowModelCachebyRow(f);for(l=this._cellOverflowModelCache,this.invalidateLayout(),this._cellOverflowModelCache=l,e=this._getRowLayout(1,u.UI.SheetArea.viewport),v=e[e.length-1],f=b.row+1;f<=v.row+1;f++)this._render._buildCellOverflowLayoutModel(f,u.UI.SheetArea.viewport);this._render.update(r.x,r.viewportY+r.viewportHeight-s.y-o,r.rowHeaderWidth+r.frozenWidth+r.viewportWidth,s.y+o,!1)}else this.invalidateLayout(),this.repaint()}}else{for(r=this._getSheetLayout(),h=0,f=this._scrollTopRow;f<c&&h<r.viewportHeight;f++)h+=this._getZoomRowHeight(f);if(h<r.viewportHeight){y=!0;var e=this._getRowLayout(1,u.UI.SheetArea.viewport),k=e.findRow(c),o=k.height+2,p=this.getActiveColumnIndex();for(p>=0&&p<this.getColumnCount()&&(w=this.getCellRect(k.row,p),w&&(o=w.height+2)),this._render.translateScreen(r.x,r.viewportY+o,r.rowHeaderWidth+r.frozenWidth+r.viewportWidth,r.viewportHeight-h-o,r.x,r.viewportY+h+o),this._render._copyDoubleBufferRect(new i.Rect(r.x,r.viewportY+o,r.rowHeaderWidth+r.frozenWidth+r.viewportWidth,r.viewportHeight-h-o),r.x,r.viewportY+h+o,null,a,a),f=this._scrollTopRow;f<c;f++)this._render._buildCellOverflowLayoutModel(f,u.UI.SheetArea.viewport);for(b=e[e.length-1],l=this._cellOverflowModelCache,this.invalidateLayout(),this._cellOverflowModelCache=l,e=this._getRowLayout(1,u.UI.SheetArea.viewport),v=e[e.length-1],f=v.row+1;f<=b.row;f++)this._clearCellOverflowModelCachebyRow(f);this._render.update(r.x,r.viewportY,r.rowHeaderWidth+r.frozenWidth+r.viewportWidth,h+o,!1)}}}else this._scrollTopRow=n;return y||(this.invalidateLayout(),this.repaint()),this._syncVScrollbarPosition(),!0}},_setLeftColumn:function(n,t){if(t||n!==undefined&&n!==null&&n>=this._getFirstPageLeftColumn()&&n<=this._getLastVisualColumn()&&n!==this._scrollLeftCol)return this._trigger(i.Events.LeftColumnChanged,{sheet:this,sheetName:this._name,oldLeftCol:this._scrollLeftCol,newLeftCol:n}),this._scrollLeftCol=n,this.invalidateLayout(),this.repaint(),this._syncHScollbarPosition(),!0},_getSpanModel:function(n){var t=i.SheetArea;if(n===undefined||n===null||n===t.viewport)return this._spanModel;else if(n===t.colHeader)return this._colHeaderSpanModel;else if(n===t.rowHeader)return this._rowHeaderSpanModel},_clipboardCopy:function(t,r){var o,f,e,s;if(!t)return;var h="\t",c="\r\n",a='"',u=new i.Range(t.row,t.col,t.rowCount,t.colCount);u.row===-1&&(u.row=0),u.col===-1&&(u.col=0),u.rowCount===-1&&(u.rowCount=this.getRowCount()-u.row),u.colCount===-1&&(u.colCount=this.getColumnCount()-u.col),o=this.getCsv(u.row,u.col,u.rowCount,u.colCount,c,h),f=this._getClipboardHelper(),f.fromSheet=this,f.range=t,f.isCutting=r;try{n.clipboardData&&n.clipboardData.setData&&(e={sheet:this,sheetName:this._name,copyData:o,cancel:!1},s=i.Events,this._trigger(s.ClipboardChanging,e),e&&e.cancel===!1?(n.clipboardData.setData("Text",o),this._trigger(s.ClipboardChanged,{sheet:this,sheetName:this._name,copyData:o})):(f.fromSheet=null,f.range=null))}catch(l){}},_trySearch:function(n,t,r){var u,f,h,l,c,s,o,e;return n?(u=i.SearchFlags,n=n.toString(),t=t.toString(),f=(r&u.ExactMatch)>0,f&&(r&u.UseWildCards)==0?(r&u.IgnoreCase)>0?(h=n.toLowerCase(),l=t.toLowerCase(),h===l):n===t:(c=(r&u.IgnoreCase)>0,s=(r&u.UseWildCards)>0,o=c?new RegExp(bt(t,s,f),"i"):new RegExp(bt(t,s,f)),e=n.search(o)>-1,f&&e&&t.search(/\*/)<=-1&&(e=n.length===t.length),e)):!1},_getFilterButtonHitInfo:function(n,t,i){var o,u,s,e,f,r;if(!this._rowFilter||!this._filterButtonsModel||this._filterButtonsModel.length===0)return null;for(o in this._filterButtonsModel)if(this._filterButtonsModel[o]){u=this._filterButtonsModel[o];for(s in u)if(u[s]){e=u[s];if(e.length>0)for(f=0;f<e.length;f++){r=e[f];if(n.row===r.row&&n.col===r.col&&n.hitTestType===r.sheetArea)if(t>=r.x&&t<=r.x+r.width&&i>=r.y&&i<=r.y+r.height)return r}}}return null},_clearCellOverflowModelCachebyRow:function(n,t){this._cellOverflowModelCache&&(t===undefined||t===null||t===i.SheetArea.viewport)&&(this._cellOverflowModelCache[n]=null)},_clearCellOverflowModelCache:function(){this._cellOverflowModelCache&&(this._cellOverflowModelCache=null)},_trigger:function(n,t){this._eventHandler.trigger(n,t)},_disposeUserEvents:function(){this.unbindAll(),this._unbindAll()},_doCommand:function(n){var t=this.undoManager();t.doAction(n)},_refreshTabStrip:function(){this.parent&&this.parent._tab&&this.parent._tab.repaint&&this.parent._tab.repaint()},_isAnyCellInRangeLocked:function(n){for(var t=this._getActualRange(n),i,u,r=t.row;r<t.row+t.rowCount;r++)for(i=t.col;i<t.col+t.colCount;i++){u=this.getActualStyle(r,i);if(u.locked===!0)return!0}return!1},_isValidRange:function(n,t,i,r,u,f){if(-1<=n&&n<u&&-1<=t&&t<f)if(n===-1&&t===-1)return!0;else if(n===-1){if(r!==0&&t+r<=f)return!0}else if(t===-1){if(i!==0&&n+i<=u)return!0}else if(r!==0&&t+r<=f&&i!==0&&n+i<=u)return!0;return!1},_setValueInternal:function(n,t,i,r,u){this.setValue(n,t,r,i,!1)},_hasPartSpans:function(n,t,i,r){var f,u,s,o,e,h;if(n<0&&t<0)return!1;else if(n<0){s=this._colHeaderSpanModel;if(s&&s.length!==0){f=s.getEnumerator(-1,t,-1,r),u=null;while(f.moveNext()){u=f.current();if(u.col<t||u.col+u.colCount>t+r)return!0}}}else if(t<0){o=this._rowHeaderSpanModel;if(o&&o.length!==0){f=o.getEnumerator(n,-1,i,-1),u=null;while(f.moveNext()){u=f.current();if(u.row<n||u.row+u.rowCount>n+i)return!0}}}e=this._spanModel;if(e&&e.length!==0){h=e.getEnumerator(n,t,i,r),u=null;while(h.moveNext()){u=h.current();if(n!==-1)if(u.row<n||u.row+u.rowCount>n+i)return!0;if(t!==-1)if(u.col<t||u.col+u.colCount>t+r)return!0}}return!1},_hasSpans:function(n,t,i,r){var f=this._spanModel,u,e;if(f)for(u=0;u<f.length;u++){e=f[u];if(e.intersect(n,t,i,r))return!0}return!1},_hasPartArrayFormulas:function(n,t,i,r){var e=this._getsArrayFormulas(n,t,i,r),o,f,u;if(e&&e.length>0)for(o=e.length,f=0;f<o;f++){u=e[f][0];if(n!==-1)if(u.row<n||u.row+u.rowCount>n+i)return!0;if(t!==-1)if(u.col<t||u.col+u.colCount>t+r)return!0}return!1},_getsArrayFormulas:function(n,t,i,r){var e=this._findFormulas(n,t,i,r),f,o;if(e&&e.length>0){for(var s=[],h=[],c=e.length,u=0;u<c;u++)f=e[u][1],f&&f!==""&&f[0]==="{"&&f[f.length-1]==="}"&&(h.push(e[u][0]),s.push(f));if(s.length>0){for(o={},u=0;u<s.length;u++)o[u][0]=h[u],o[u][1]=s[u];return o}}return null},_raiseDragDropBlock:function(n,t,r,u,f,e,o,s,h){var c={sheet:this,sheetName:this._name,fromRow:n,fromCol:t,toRow:r,toCol:u,rowCount:f,colCount:e,copy:o,insert:s,copyOption:h,cancel:!1};return this._trigger(i.Events.DragDropBlock,c),c&&c.cancel===!0},_raiseDragDropBlockCompleted:function(n,t,r,u,f,e,o,s,h){var c={sheet:this,sheetName:this._name,fromRow:n,fromCol:t,toRow:r,toCol:u,rowCount:f,colCount:e,copy:o,insert:s,copyOption:h};this._trigger(i.Events.DragDropBlockCompleted,c)},_raiseInvalidOperation:function(n){var t={sheet:this,sheetName:this._name,message:n};this._trigger(i.Events.InvalidOperation,t)},_suspendInvalidate:function(){this._layoutSuspended++},_resumeInvalidate:function(){this._layoutSuspended--,this._layoutSuspended>0||(this.isPaintSuspended()||(this.invalidateLayout(),this.repaint()),this._layoutSuspended=0)},_raiseSelectionChanging:function(n,t){var r=this._eventHandler._notEqualSelecions(n,t);return r===!0?(this._trigger(i.Events.SelectionChanging,{sheet:this,sheetName:this._name,oldSelections:n,newSelections:t}),!0):!1},_raiseSelectionChanged:function(){this._trigger(i.Events.SelectionChanged,{sheet:this,sheetName:this._name})},_raiseDragFillBlock:function(n,t,r){var u={sheet:this,sheetName:this._name,fillRange:n,autoFillType:r,fillDirection:t,cancel:!1};return this._trigger(i.Events.DragFillBlock,u),u&&u.cancel===!0},_raiseDragFillBlockCompleted:function(n,t,r){var u={sheet:this,sheetName:this._name,fillRange:n,autoFillType:r,fillDirection:t};this._trigger(i.Events.DragFillBlockCompleted,u)},_raiseCellChanged:function(n,t,r,u,f,e){var o={sheet:this,sheetName:this._name,row:t,col:r,rowCount:u,columnCount:f,sheetArea:e,propertyName:n};this._trigger(i.Events.CellChanged,o)},_raisePropertyChanged:function(n){},_nextNonNullRow:function(n,t){n++;var f=i.SheetArea,u=t?this._getModel(f.rowHeader):this._getModel(f.viewport),r=u.rowCount;t===!1&&this._dataSource&&(r=Math.max(r,this._dataSource.length));while(n>=0&&n<r){if(u.dataTable.hasOwnProperty(n)&&u.dataTable[n])break;if(t===!1&&this._dataSource)if(this._dataSource.hasOwnProperty(n)&&this._dataSource[n])break;n++}return n<r?n:-1},_nextNonNullColumn:function(n,t,r){var u=null,o=i.SheetArea,f=r?this._getModel(o.colHeader):this._getModel(o.viewport),e;n>=0&&n<f.rowCount&&f.dataTable.hasOwnProperty(n)&&(u=f.dataTable[n]),r===!1&&!u&&this._dataSource&&n>=0&&n<this._dataSource.length&&this._dataSource.hasOwnProperty(n)&&(u=this._dataSource[n]);if(!u)return-1;t++;while(t>=0&&(t<f.colCount||t<u.length)){if(u.hasOwnProperty(t)&&u[t])break;if(r===!1&&this._dataSource){e=this._getValueImp(f,n,t);if(e!==undefined&&e!==null)break}t++}return t<f.colCount||r===!1&&u&&t<u.length?t:-1},_closeDragFillPopup:function(){this._smartTag&&this._smartTag.close()},_cellRangeInflate:function(n,t){var r,i;if(n&&n.length>0)for(r=0;r<n.length;r++){i=n[r];if(t.intersect(i.row,i.col,i.rowCount,i.colCount))return n.splice(r--,1),this._cellRangeInflate(n,this._unionCellRange(t,i))}return t},_unionCellRange:function(n,t){var u=Math.min(n.row,t.row),r=Math.min(n.col,t.col),e=Math.max(n.row+n.rowCount-1,t.row+t.rowCount-1),o=Math.max(n.col+n.colCount-1,t.col+t.colCount-1),f=i.Range;return u<0||r<0?u<0?r<0?new f(-1,-1,-1,-1):new f(-1,r,-1,o-r+1):new f(u,-1,e-u+1,-1):new f(u,r,e-u+1,o-r+1)},_getClipboardHelper:function(){return!this._clipboardHelper&&this.parent&&this.parent._clipboardHelper?this._clipboardHelper=this.parent._clipboardHelper:this._clipboardHelper||(this._clipboardHelper={fromSheet:null,range:null,isCutting:!1}),this._clipboardHelper},_checkPastedRange:function(n,t,r,u,f,e){var tt="Source sheet's cells are locked.",d="The copy and paste areas are not the same size.",nt="The cell you are trying to change is protected and therefore read-only.",b="Cannot change part of a merged cell.",w="Cannot change part of an array.",o,l,c,g,k,v,y;e.pastedInternal=!1,e.pastedRange=null;if(!n&&(!f||f===""))return!1;o=this;if(this._isPastedInternal(n,t,o,f)||!f){e.pastedInternal=!0;if(u&&n.isProtected&&n._isAnyCellInRangeLocked(t))return this._raiseInvalidOperation(tt),!1;e.pastedRange=this._getPastedRange(n,t,o,r,u)}else e.pastedRange=this._getPastedRangefromText(r,f);if(!e.pastedRange)return this._raiseInvalidOperation(d),!1;if(o.isProtected&&o._isAnyCellInRangeLocked(e.pastedRange))return this._raiseInvalidOperation(nt),!1;if(e.pastedInternal){if(n._hasPartSpans(t.row,t.col,t.rowCount,t.colCount))return this._raiseInvalidOperation(b),!1;if(n._hasPartArrayFormulas(t.row,t.col,t.rowCount,t.colCount))return this._raiseInvalidOperation(w),!1;var p=e.pastedRange.row<0?o.getRowCount():e.pastedRange.rowCount,a=e.pastedRange.col<0?o.getColumnCount():e.pastedRange.colCount,h=t.row<0?n.getRowCount():t.rowCount,s=t.Column<0?n.getColumnCount():t.colCount;if(p>h||a>s)for(l=r.row,c=r.col,r.row<0&&h<o.getRowCount()&&(l=0),r.col<0&&s<o.getColumnCount()&&(c=0),(p%h!=0||a%s!=0)&&(p=h,a=s,e.pastedRange=new i.Range(l,c,p,a)),g=Math.floor(p/h),k=Math.floor(a/s),v=0;v<g;v++)for(y=0;y<k;y++){if(o._hasPartSpans(l<0?-1:l+v*h,c<0?-1:c+y*s,l<0?-1:h,c<0?-1:s))return this._raiseInvalidOperation(b),!1;if(o._hasPartArrayFormulas(l<0?-1:l+v*h,c<0?-1:c+y*s,l<0?-1:h,c<0?-1:s))return this._raiseInvalidOperation(w),!1}else{if(o._hasPartSpans(e.pastedRange.row,e.pastedRange.col,e.pastedRange.rowCount,e.pastedRange.colCount))return this._raiseInvalidOperation(b),!1;if(o._hasPartArrayFormulas(e.pastedRange.row,e.pastedRange.col,e.pastedRange.rowCount,e.pastedRange.colCount))return this._raiseInvalidOperation(w),!1}}else{if(o._hasPartSpans(e.pastedRange.row,e.pastedRange.col,e.pastedRange.rowCount,e.pastedRange.colCount))return this._raiseInvalidOperation(b),!1;if(o._hasPartArrayFormulas(e.pastedRange.row,e.pastedRange.col,e.pastedRange.rowCount,e.pastedRange.colCount))return this._raiseInvalidOperation(w),!1;if(e.pastedRange.row+e.pastedRange.rowCount>o.getRowCount()||e.pastedRange.col+e.pastedRange.colCount>o.getColumnCount())return this._raiseInvalidOperation(d),!1}return!0},_isPastedInternal:function(n,t,i,r){return n&&t&&i&&n.getCsv(t.row,t.col,t.rowCount,t.colCount,"\r\n","\t")===r},_getPastedRange:function(n,t,r,u,f){var a=t.row<0?0:t.row,v=t.col<0?0:t.col,e=t.row<0?n.getRowCount():t.rowCount,o=t.col<0?n.getColumnCount():t.colCount,l=u.row<0?0:u.row,c=u.col<0?0:u.col,h=u.row<0?r.getRowCount():u.rowCount,s=u.col<0?r.getColumnCount():u.colCount,y;(f||h%e!=0||s%o!=0)&&(h=e,s=o);if(!this._isValidRange(a,v,e,o,n.getRowCount(),n.getColumnCount()))return null;if(!this._isValidRange(l,c,h,s,r.getRowCount(),r.getColumnCount()))return null;y=new i.Range(l,c,h,s);if(!f&&n._name===r._name)if(y.contains(a,v,e,o)){if((a-l)%e!=0||(v-c)%o!=0)return null}else if(y.intersect(a,v,e,o))if(h>e||s>o)return null;return u.row===-1&&(l=-1,h=-1),u.col===-1&&(c=-1,s=-1),new i.Range(l,c,h,s)},_getPastedRangefromText:function(n,t){var f=null,u=r.parseCsv(t,"\r\n","\t",'"');if(u){var s=n.row<0?0:n.row,h=n.col<0?0:n.col,e=u.length,o=r.getMaxLength(u);f=new i.Range(s,h,e,o)}return f},_getClipboardData:function(){try{if(n.clipboardData&&n.clipboardData.getData)return n.clipboardData.getData("Text")}catch(t){return null}},_clearClipboard:function(){try{n.clipboardData&&n.clipboardData.clearData&&n.clipboardData.clearData("Text")}catch(t){}},_clipboardPaste:function(n,t,u,f,e,o,s){var l,a,h,c,y,v,b,w,p,nt,g,k,d;if(n&&u._name===n._name&&u.parent&&!u.parent.sheets.contains(n)){this._clearClipboard();return}if(n&&t){b=i.UndoRedo.ClipboardPasteRangeUndoAction.convertPasteOption;if(e)r.moveTo(n,t.row,t.col,u,f.row,f.col,t.rowCount,t.colCount,b(s)),this._clearClipboard();else{w=f.row<0?u.getRowCount():f.rowCount,p=f.col<0?u.getColumnCount():f.colCount,h=t.row<0?n.getRowCount():t.rowCount,c=t.col<0?n.getColumnCount():t.colCount;if(w>h||p>c){l=f.row,a=f.col,f.row<0&&h<u.getRowCount()&&(l=0),f.col<0&&c<u.getColumnCount()&&(a=0),(w%h!=0||p%c!=0)&&(w=h,p=c),nt=Math.floor(w/h),g=Math.floor(p/c),n.suspendCalcService(),u.suspendCalcService();try{for(y=0;y<nt;y++)for(v=0;v<g;v++)r.copyTo(n,t.row,t.col,u,l<0?-1:l+y*h,a<0?-1:a+v*c,l<0?-1:h,a<0?-1:c,b(s))}finally{n.resumeCalcService(),u.resumeCalcService()}}else r.copyTo(n,t.row,t.col,u,f.row,f.col,t.rowCount,t.colCount,b(s))}}else{l=f.row,a=f.col,h=f.rowCount,c=f.colCount,k=u._spanModel.getEnumerator(l,a,h,c);while(k.moveNext())d=k.current(),d&&u._spanModel.remove(d);if(o&&o!=="")u.setCsv(l,a,o,"\r\n","\t",i.TextFileOpenFlags.ImportFormula);else for(y=0;y<h;y++)for(v=0;v<c;v++)u.setValue(l+y,a+v,null)}},_raiseClipboardPasting:function(n,t){var r={sheet:this,sheetName:this._name,cellRange:n,pastOption:t,cancel:!1};return this._trigger(i.Events.ClipboardPasting,r),r.cancel===!0},_raiseClipboardPasted:function(n,t){var r={sheet:this,sheetName:this._name,cellRange:n,pastOption:t};this._trigger(i.Events.ClipboardPasted,r)},_raiseValueChanged:function(n,t){var r={sheet:this,sheetName:this._name,row:n,column:t};this._trigger(i.Events.ValueChanged,r)},_raiseRangeDataChanged:function(n,t,r,u){var f={sheet:this,sheetName:this._name,row:n,column:t,rowCount:r,columnCount:u};this._trigger(i.Events.RangeChanged,f)},_copyFormula:function(n,t,i,u,f,e){r.copyFormula(this,n,t,this,i,u,f,e)}}})(window,jQuery);(function(n){"use strict";function wt(){}function yt(n,t){n&&!n._isEditing&&n.moveActiveCell(t,!1)}function vt(n,t,i,r){n&&!n._isEditing&&n.moveActiveCell(t,!1,i,r)}function s(n,t,i){n&&!n._isEditing&&n._changeActiveSelectedRange(t,i)}function et(n,t,i){this.row=n,this.column=t,this.value=i}function e(n,t){this._rowCount=n,this._columnCount=t,this._init()}function at(n){this._columnCount=n,this._init()}function lt(n){this._rowCount=n,this._init()}function r(){this.canExecuteChanged=null}function k(n,t,i,r){this._sheet=n,this._columns=t,this._size=i,this._rowHeader=r,this._oldSizes=[],this._oldVisibles=[]}function b(n,t,i,r){this._sheet=n,this._rows=t,this._size=i,this._columnHeader=r,this._oldSizes=[],this._oldVisibles=[]}function w(n,t,i){this._sheet=n,this._columns=t,this._rowHeader=i,this._oldSizes=[],this._oldVisibles=[]}function p(n,t,i){this._sheet=n,this._rows=t,this._columnHeader=i,this._oldSizes=[],this._oldVisibles=[]}function gt(n,t){this.index=n,this.count=t}function st(n,t){this._sheet=n,this._columnGroupExtent=t}function rt(n,t){this._sheet=n,this._columnUngroupExtent=t,this._canUndo=!1}function ot(n,t){this._sheet=n,this._rowGroupExtent=t}function g(n,t){this._sheet=n,this._rowUngroupExtent=t,this._canUndo=!1}function c(n,t){this._sheet=n,this._columnExpandExtent=t}function a(n,t){this._sheet=n,this._rowExpandExtent=t}function ut(n,t){this._sheet=n,this._columnGroupHeaderExpandExtent=t,this._oldStatus={}}function ft(n,t){this._sheet=n,this._rowGroupHeaderExpandExtent=t,this._oldStatus={}}function kt(n,t,i,r,u,f){this.fromRow=n,this.fromColumn=t,this.toRow=i,this.toColumn=r,this.rowCount=u,this.columnCount=f}function nt(n,t,i,r,u){this._sheet=n,this._dragDropExtent=t,this._copy=i,this._insert=r,this._option=u}function y(n,t){this._sheet=n,this._cellEditInfo=t,this._canUndo=!1}function d(n,t){this._sheet=n,this._newName=t,this._oldName=null}function tt(n,t){this._sheet=n,t<.25?t=.25:t>4&&(t=4),this._zoomFactor=t,this._prevZoomFactor=-1}function it(n,t){this._sheet=n,this._clearRange=t,this._cachedFilteredColumns=null,this._cachedValues=null}function v(n,t){this._sheet=n,this._cachedActions=null;if(t&&t.length>0){this._cachedActions=[t.length];for(var i=0;i<t.length;i++)this._cachedActions[i]=new it(n,t[i])}}function u(n,t){this._workSheet=n,this._dragFillExtent=t,this._dragFillExtent.autoFillType===l.ClearValues?this._clearValueUndoAction=new v(n,[this._dragFillExtent.fillRange]):this.initWholeFilledRange(),this._fillSeries=this._dragFillExtent.fillDirection===f.Left||this._dragFillExtent.fillDirection===f.Right?ct.Row:ct.Column}function o(n,t,i,r,u){this._sheet=n,this._fromSheet=t,this._toSheet=i,this._pasteExtent=r,this._pasteOption=u}function h(n,t,i,r,u){var f,e;this._sheet=n;if(!i)throw new Error("destSheet");if(!r)throw new Error("pasteExtent");if(r.pastedRanges&&r.pastedRanges.length>0)for(this._cachedActions=new Array(r.pastedRanges.length),f=0;f<r.pastedRanges.length;f++)e={sourceRange:r.fromRange,targetRange:r.pastedRanges[f],isCutting:r.isCutting,clipboardText:r.clipboardText},this._cachedActions[f]=new o(n,t,i,e,u)}function bt(n,t){this.value=n,this.isFormula=t}var ht=n.GrapeCity,t,l,f,ct,pt,dt,i;typeof ht=="undefined"&&(ht=n.GrapeCity={}),typeof ht.UI=="undefined"&&(ht.UI={}),t=ht.UI,t.AutoFillType={CopyCells:0,FillSeries:1,FillFormattingOnly:2,FillWithoutFormatting:3,ClearValues:4},l=t.AutoFillType,t.FillDirection={Left:0,Right:1,Up:2,Down:3},f=t.FillDirection,t.FillSeries={Column:0,Row:1},ct=t.FillSeries,t.StorageType={Data:1,Style:2,Sparkline:16,Axis:32},pt=t.StorageType,t.DragFillDirection={Left:0,Right:1,Up:2,Down:3,LeftClear:4,UpClear:5},dt=t.DragFillDirection,e.prototype={_init:function(){this._values=[],this._formulas=[],this._sparklines=[],this._styles=[],this._tags=[],this._spans=null,this._arrayFormulas=null,this._valueSaved=!1,this._formulaSaved=!1,this._sparklineSaved=!1,this._styleSaved=!1,this._tagSaved=!1,this._spanSaved=!1,this._arrayFormulaSaved=!1},saveValue:function(n,t,i){i!==undefined&&i!==null&&this._values.push(new et(n,t,i)),this._valueSaved=!0},getValues:function(){return this._values},saveFormula:function(n,t,i){i&&i!==""&&this._formulas.push(new et(n,t,i)),this._formulaSaved=!0},getFormulas:function(){return this._formulas},saveArrayFormula:function(n){this._arrayFormulas=n,this._arrayFormulaSaved=!0},getArrayFormula:function(){return this._arrayFormulas},saveSparkline:function(n,t,i){i&&this._sparklines.push(new et(n,t,i)),this._sparklineSaved=!0},getSparklines:function(){return this._sparklines},saveStyle:function(n,t,i){i&&this._styles.push(new et(n,t,i)),this._styleSaved=!0},getStyles:function(){return this._styles},saveTag:function(n,t,i){i!==undefined&&i!==null&&this._tags.push(new et(n,t,i)),this._tagSaved=!0},getTags:function(){return this._tags},saveSpan:function(n){this._spans||(this._spans=[]),this._spans.push(n),this._spanSaved=!0},isValueSaved:function(){return this._valueSaved},isFormulaSaved:function(){return this._formulaSaved},isArrayFormulaSaved:function(){return this._arrayFormulaSaved},isSparklineSaved:function(){return this._sparklineSaved},isStyleSaved:function(){return this._styleSaved},isTagSaved:function(){return this._tagSaved},isSpanSaved:function(){return this._spanSaved}},at.prototype={_init:function(){this._widths={},this._visibles={},this._resizables={},this._tags={},this._viewportColumnStyles={},this._headerColumnStyles={},this._levels={},this._collapsed={},this._bindingFields={},this._widthSaved=!1,this._visibleSaved=!1,this._resizableSaved=!1,this._tagSaved=!1,this._viewportColumnStyleSaved=!1,this._headerColumnStyleSaved=!1,this._rangeGroupSaved=!1,this._bindingFieldSaved=!1},saveWidth:function(n,t){this._widths[n]!==null?this._widths[n]=t<0?null:t:t<0||(this._widths[n]=t),this._widthSaved=!0},getWidth:function(n){return this._widths[n]!==null?this._widths[n]:-1},saveVisible:function(n,t){this._visibles[n]!==null?this._visibles[n]=t?null:t:t||(this._visibles[n]=t),this._visibleSaved=!0},getVisible:function(n){return this._visibles[n]!==null?this._visibles[n]:!0},saveResizable:function(n,t){this._resizables[n]!==null?this._resizables[n]=t?null:t:t||(this._resizables[n]=t),this._resizableSaved=!0},getResizable:function(n){return this._resizables[n]!==null?this._resizables[n]:!0},saveTag:function(n,t){this._tags[n]!==null?this._tags[n]=t===undefined||t===null?null:t:t!==null&&(this._tags[n]=t),this._tagSaved=!0},getTag:function(n){return this._tags[n]!==null?this._tags[n]:null},saveViewportColumnStyle:function(n,t){this._viewportColumnStyles[n]?this._viewportColumnStyles[n]=t?t:null:t&&(this._viewportColumnStyles[n]=t),this._viewportColumnStyleSaved=!0},getViewportColumnStyle:function(n){return this._viewportColumnStyles[n]?this._viewportColumnStyles[n]:null},saveHeaderColumnStyle:function(n,t){this._headerColumnStyles[n]?this._headerColumnStyles[n]=t?t:null:t&&(this._headerColumnStyles[n]=t),this._headerColumnStyleSaved=!0},getHeaderColumnStyle:function(n){return this._headerColumnStyles[n]?this._headerColumnStyles[n]:null},saveRangeGroup:function(n,t,i){this._levels[n]!==null?this._levels[n]=t<0?null:t:t<0||(this._levels[n]=t),this._collapsed[n]!==null?this._collapsed[n]=i?i:null:i&&(this._collapsed[n]=i),this._rangeGroupSaved=!0},getRangeGroup:function(n,t){t.level=-1,t.collapsed=!1,this._levels[n]!==null&&(t.level=this._levels[n]),this._collapsed[n]!==null&&(t.collapsed=this._collapsed[n])},saveBindingField:function(n,t){this._bindingFields[n]=t,this._bindingFieldSaved=!0},getBindingField:function(n,t){return t.fieldName=null,this._bindingFields[n]!==null?(t.fieldName=this._bindingFields[n],!0):!1},isWidthSaved:function(){return this._widthSaved},isVisibleSaved:function(){return this._visibleSaved},isResizableSaved:function(){return this._resizableSaved},isTagSaved:function(){return this._tagSaved},isViewportColumnStyleSaved:function(){return this._viewportColumnStyleSaved},isHeaderColumnStyleSaved:function(){return this._headerColumnStyleSaved},isRangeGroupSaved:function(){return this._rangeGroupSaved},isBindingFieldSaved:function(){return this._bindingFieldSaved}},i={getStyleObject:function(n,t,i,r){return n.getStyle(t,i,r)},setStyleObject:function(n,t,i,r,u){typeof u!="string"&&n.setStyle(t,i,u,r)},saveSheetInfo:function(n,i,r){(r&t.CopyToOption.Style)>0&&(i.saveDefaultStyle(n.getDefaultStyle()),i.saveColumnHeaderDefaultStyle(n.getDefaultStyle(t.SheetArea.colHeader)),i.saveRowHeaderDefaultStyle(n.getDefaultStyle(t.SheetArea.rowHeader))),i.saveDefaultColumnWidth(n.defaults.colWidth),i.saveDefaultRowHeight(n.defaults.rowHeight),i.saveColumnHeaderDefaultRowHeight(n.defaults.rowHeight),i.saveRowHeaderDefaultColumnWidth(n.defaults.rowHeaderColWidth)},saveColumnHeaderInfo:function(n,r,u,f,e){for(var a=r._rowCount,h=r._columnCount,o,v,l,c,s=0;s<a;s++)for(o=0;o<h;o++)(e&t.CopyToOption.Value)>0&&(v=n._getModel(t.SheetArea.colHeader).getValue(s,f+o),r.saveValue(s,o,v)),(e&t.CopyToOption.Style)>0&&r.saveStyle(s,o,i.getStyleObject(n,s,f+o,t.SheetArea.colHeader));if((e&t.CopyToOption.Value)>0)for(o=0;o<h;o++)n.isColumnBound(f+o)&&u.saveBindingField(o,n.getDataColumnName(f+o));if((e&t.CopyToOption.Span)>0){l=n._colHeaderSpanModel.getEnumerator(0,f,a,h);while(l.moveNext())r.saveSpan(l.current())}for(h=u._columnCount,o=0;o<h;o++)u.saveWidth(o,n._getActualColumnWidth(f+o)),u.saveVisible(o,n.getColumnVisible(f+o)),u.saveResizable(o,n.getColumnResizable(f+o));if((e&t.CopyToOption.Style)>0)for(o=0;o<h;o++)u.saveViewportColumnStyle(o,i.getStyleObject(n,-1,f+o,t.SheetArea.viewport)),u.saveHeaderColumnStyle(o,i.getStyleObject(n,-1,f+o,t.SheetArea.colHeader));if((e&t.CopyToOption.RangeGroup)>0){c=n.colRangeGroup;if(c&&!c._isEmpty())for(o=0;o<h;o++)u.saveRangeGroup(o,c.getLevel(f+o),c.getCollapsed(f+o))}},saveRowHeaderInfo:function(n,r,u,f,e){var h,a,o,s,v,l,c;if((e&t.CopyToOption.All)<=0)return;for(h=r._rowCount,a=r._columnCount,o=0;o<h;o++)for(s=0;s<a;s++)(e&t.CopyToOption.Value)>0&&(v=n._getModel(t.SheetArea.rowHeader).getValue(f+o,s),r.saveValue(o,s,v)),(e&t.CopyToOption.Style)>0&&r.saveStyle(o,s,i.getStyleObject(n,f+o,s,t.SheetArea.rowHeader));if((e&t.CopyToOption.Span)>0){l=n._rowHeaderSpanModel.getEnumerator(f,0,h,a);while(l.moveNext())r.saveSpan(l.current())}for(h=u._rowCount,o=0;o<h;o++)u.saveHeight(o,n._getActualRowHeight(f+o)),u.saveVisible(o,n.getRowVisible(f+o)),u.saveResizable(o,n.getRowResizable(f+o));if((e&t.CopyToOption.Style)>0)for(o=0;o<h;o++)u.saveViewportRowStyle(o,i.getStyleObject(n,f+o,-1,t.SheetArea.viewport)),u.saveHeaderRowStyle(o,i.getStyleObject(n,f+o,-1,t.SheetArea.rowHeader));if((e&t.CopyToOption.RangeGroup)>0){c=n.rowRangeGroup;if(c&&!c._isEmpty())for(o=0;o<h;o++)u.saveRangeGroup(o,c.getLevel(f+o),c.getCollapsed(f+o))}},saveViewportInfo:function(n,r,u,f,e){var c,l,s,o,v,a;if((e&t.CopyToOption.All)<=0)return;for(c=r._rowCount,l=r._columnCount,s=0;s<c;s++)for(o=0;o<l;o++){(e&t.CopyToOption.Value)>0&&r.saveValue(s,o,n.getValue(u+s,f+o,t.SheetArea.viewport)),((e&t.CopyToOption.Value)>0||(e&t.CopyToOption.Formula)>0)&&(r.saveFormula(s,o,n.getFormula(u+s,f+o)),v=n._getsArrayFormulas(u,f,c,l),r.saveArrayFormula(v));if((e&t.CopyToOption.Sparkline)>0){var h=n.getSparkline(u+s,f+o),y=null,p=null;h&&(y=h.data(),p=h.dateAxisData()),h&&y?r.saveSparkline(s,o,h.clone()):r.saveSparkline(s,o,null)}(e&t.CopyToOption.Style)>0&&r.saveStyle(s,o,i.getStyleObject(n,u+s,f+o,t.SheetArea.viewport))}if((e&t.CopyToOption.Span)>0){a=n._spanModel.getEnumerator(u,f,c,l);while(a.moveNext())r.saveSpan(a.current())}},undoCellsInfo:function(n,r,u,f,e){var ut=r._rowCount,rt=r._columnCount,o,w,a,h,g,v,b,p,et,ft,tt,y,s,st,d,ot,k,c,l,nt,it;n.suspendCalcService();try{for(b=0;b<ut;b++)for(p=0;p<rt;p++)r.isFormulaSaved()&&e===t.SheetArea.viewport&&n.setFormula(u+b,f+p,null),r.isSparklineSaved()&&e===t.SheetArea.viewport&&n.removeSparkline(u+b,f+p),r.isValueSaved()&&n.setValue(u+b,f+p,null,e),r.isStyleSaved()&&i.setStyleObject(n,u+b,f+p,e,null);if(r.isFormulaSaved()&&e===t.SheetArea.viewport)for(et=r.getFormulas(),o=0;o<et.length;o++)h=et[o],n.setFormula(u+h.row,f+h.column,h.value);if(r.isSparklineSaved()&&e===t.SheetArea.viewport)for(ft=r.getSparklines(),tt=0;tt<ft.length;tt++)y=ft[tt],s=y.value,s?s.dateAxisData()?n.setSparkline(u+y.row,f+y.column,s.data(),s.dataOrientation(),s.sparklineType(),s.setting(),s.dateAxisData(),s.dateAxisOrientation()):n.setSparkline(u+y.row,f+y.column,s.data(),s.dataOrientation(),s.sparklineType(),s.setting()):n.removeSparkline(u+y.row,f+y.column);if(r.isValueSaved())for(st=r.getValues(),o=0;o<st.length;o++)d=st[o],n.setValue(u+d.row,f+d.column,d.value,e);if(r.isStyleSaved())for(ot=r.getStyles(),o=0;o<ot.length;o++)k=ot[o],i.setStyleObject(n,u+k.row,f+k.column,e,k.value);if(r.isArrayFormulaSaved()&&e===t.SheetArea.viewport){c=n._getsArrayFormulas(u,f,ut,rt);if(c&&c.length>0)for(g=c.getLength(0),v=0;v<g;v++)a=c[v][0],n.setFormula(a.row,a.col,a.rowCount,a.colCount,null);c=r.getArrayFormula();if(c&&c.length>0)for(g=c.getLength(0),v=0;v<g;v++)a=c[v][0],h=c[v][1],h.StartsWith("{")&&h.EndsWith("}")&&(h=h.substring(1,h.length-2)),n.setFormula(a.row,a.col,a.rowCount,a.colCount,h)}}finally{n.resumeCalcService()}l=null,e===t.SheetArea.viewport?l=n._spanModel:e===t.SheetArea.colHeader?l=n._colHeaderSpanModel:e===t.SheetArea.rowHeader&&(l=n._rowHeaderSpanModel);if(l&&l.length>0){nt=[],it=l.getEnumerator(u,f,ut,rt);while(it.moveNext())w=it.current(),w&&nt.push(w);for(o=0;o<nt.length;o++)w=nt[o],l.remove(w)}if(r.isSpanSaved())if(l)for(o=0;o<r._spans.length;o++)w=r._spans[o],l.push(w)},undoColumnsInfo:function(n,r,u){var e=r._columnCount,f,h,o,s;if(r.isBindingFieldSaved())for(h={fieldName:null},f=0;f<e;f++)r.getBindingField(f,h)&&n.bindColumn(u+f,h.fieldName);if(r.isWidthSaved())for(f=0;f<e;f++)n.setColumnWidth(u+f,r.getWidth(f),t.SheetArea.viewport);if(r.isVisibleSaved())for(f=0;f<e;f++)n.setColumnVisible(u+f,r.getVisible(f),t.SheetArea.viewport);if(r.isResizableSaved())for(f=0;f<e;f++)n.setColumnResizable(u+f,r.getResizable(f),t.SheetArea.viewport);if(r.isViewportColumnStyleSaved())for(f=0;f<e;f++)i.setStyleObject(n,-1,u+f,t.SheetArea.viewport,r.getViewportColumnStyle(f));if(r.isHeaderColumnStyleSaved())for(f=0;f<e;f++)i.setStyleObject(n,-1,u+f,t.SheetArea.colHeader,r.getHeaderColumnStyle(f));if(r.isRangeGroupSaved()){o=n.colRangeGroup;if(o)for(s={level:null,collapsed:null},f=0;f<e;f++)r.getRangeGroup(f,s),o._setLevel(u+f,s.level),o.setCollapsed(u+f,s.collapsed)}},undoRowsInfo:function(n,r,u){var e=r._rowCount,f,s,o;if(r.isHeightSaved())for(f=0;f<e;f++)n.setRowHeight(u+f,r.getHeight(f),t.SheetArea.viewport);if(r.isVisibleSaved())for(f=0;f<e;f++)n.setRowVisible(u+f,r.getVisible(f),t.SheetArea.viewport);if(r.isResizableSaved())for(f=0;f<e;f++)n.setRowResizable(u+f,r.getResizable(f),t.SheetArea.viewport);if(r.isViewportRowStyleSaved())for(f=0;f<e;f++)i.setStyleObject(n,u+f,-1,t.SheetArea.viewport,r.getViewportRowStyle(f));if(r.isHeaderRowStyleSaved())for(f=0;f<e;f++)i.setStyleObject(n,u+f,-1,t.SheetArea.rowHeader,r.getHeaderRowStyle(f));if(r.isRangeGroupSaved()){s=n.rowRangeGroup;if(s)for(o={level:null,collapsed:null},f=0;f<e;f++)r.getRangeGroup(f,o),s._setLevel(u+f,o.level),s.setCollapsed(u+f,o.collapsed)}},undoSheetInfo:function(n,i){i.isDefaultStyleSaved()&&n.setDefaultStyle(i.getDefaultStyle()),i.isDefaultColumnWidthSaved()&&(n.defaults.colWidth=i.getDefaultColumnWidth()),i.isDefaultRowHeightSaved()&&(n.defaults.rowHeight=i.getDefaultRowHeight()),i.isColumnHeaderDefaultStyleSaved()&&n.setDefaultStyle(i.getColumnHeaderDefaultStyle(),t.SheetArea.colHeader),i.isColumnHeaderDefaultRowHeightSaved()&&(n.defaults.rowHeight=i.getColumnHeaderDefaultRowHeight()),i.isRowHeaderDefaultStyleSaved()&&n.setDefaultStyle(i.getRowHeaderDefaultStyle(),t.SheetArea.rowHeader),i.isRowHeaderDefaultColumnWidthSaved()&&(n.defaults.rowHeaderColWidth=i.getRowHeaderDefaultColumnWidth())},getValues:function(n,t,i,r,u){var s,e,f,o;for(t<0&&(t=0,r=n.getRowCount()),i<0&&(i=0,u=n.getColumnCount()),s=[],e=0;e<r;e++)for(f=0;f<u;f++)o=n.getValue(t+e,i+f),o!==undefined&&o!==null&&s.push(new et(e,f,o));return s},raiseRangeDataChanged:function(n,t,i,r,u,f){if(!n)return;t<0&&(t=0,r=n.getRowCount()),i<0&&(i=0,u=n.getColumnCount()),n._raiseRangeDataChanged(t,i,r,u)},convertToKey:function(n,t){var i=0;return i=n,i<<=32,i|=t},remove:function(n,t,i){var f=null,u=-1,e=n.length,r;if(e>0)for(r=0;r<e;r++)if(n[r].row===t&&n[r].column===i){u=r;break}return u!==-1&&(f=n[u],n.splice(u,1)),f}},lt.prototype={_init:function(){this._heights={},this._visibles={},this._resizables={},this._tags={},this._viewportRowStyles={},this._headerRowStyles={},this._levels={},this._collapsed={},this._heightSaved=!1,this._visibleSaved=!1,this._resizableSaved=!1,this._tagSaved=!1,this._viewportRowStyleSaved=!1,this._headerRowStyleSaved=!1,this._rangeGroupSaved=!1},saveHeight:function(n,t){this._heights[n]!==null?this._heights[n]=t<0?null:t:t<0||(this._heights[n]=t),this._heightSaved=!0},getHeight:function(n){return this._heights[n]!==null?this._heights[n]:-1},saveVisible:function(n,t){this._visibles[n]!==null?this._visibles[n]=t?null:t:t||(this._visibles[n]=t),this._visibleSaved=!0},getVisible:function(n){return this._visibles[n]!==null?this._visibles[n]:!0},saveResizable:function(n,t){this._resizables[n]!==null?this._resizables[n]=t?null:t:t||(this._resizables[n]=t),this._resizableSaved=!0},getResizable:function(n){return this._resizables[n]!==null?this._resizables[n]:!0},saveTag:function(n,t){this._tags[n]!==null?this._tags[n]=t===undefined||t===null?null:t:t!==null&&(this._tags[n]=t),this._tagSaved=!0},getTag:function(n){return this._tags[n]!==null?this._tags[n]:null},saveViewportRowStyle:function(n,t){this._viewportRowStyles[n]?this._viewportRowStyles[n]=t?t:null:t&&(this._viewportRowStyles[n]=t),this._viewportRowStyleSaved=!0},getViewportRowStyle:function(n){return this._viewportRowStyles[n]?this._viewportRowStyles[n]:null},saveHeaderRowStyle:function(n,t){this._headerRowStyles[n]?this._headerRowStyles[n]=t?t:null:t&&(this._headerRowStyles[n]=t),this._headerRowStyleSaved=!0},getHeaderRowStyle:function(n){return this._headerRowStyles[n]?this._headerRowStyles[n]:null},saveRangeGroup:function(n,t,i){this._levels[n]!==null?this._levels[n]=t<0?null:t:t<0||(this._levels[n]=t),this._collapsed[n]!==null?this._collapsed[n]=i?i:null:i&&(this._collapsed[n]=i),this._rangeGroupSaved=!0},getRangeGroup:function(n,t){t.level=-1,t.collapsed=!1,this._levels[n]!==null&&(t.level=this._levels[n]),this._collapsed[n]!==null&&(t.collapsed=this._collapsed[n])},isHeightSaved:function(){return this._heightSaved},isVisibleSaved:function(){return this._visibleSaved},isResizableSaved:function(){return this._resizableSaved},isTagSaved:function(){return this._tagSaved},isViewportRowStyleSaved:function(){return this._viewportRowStyleSaved},isHeaderRowStyleSaved:function(){return this._headerRowStyleSaved},isRangeGroupSaved:function(){return this._rangeGroupSaved}},r.prototype={execute:function(n){},canExecute:function(n){},canUndo:function(){return!0},saveState:function(){},undo:function(n){},_raiseCanExecuteChanged:function(){this.canExecuteChanged&&typeof this.canExecuteChanged=="function"&&this.canExecuteChanged(this)},_suspendInvalidate:function(n){n&&n._suspendInvalidate&&n._suspendInvalidate()},_resumeInvalidate:function(n){n&&n._resumeInvalidate&&n._resumeInvalidate()}},k.prototype=new r,b.prototype=new r,w.prototype=new r,p.prototype=new r,st.prototype=new r,rt.prototype=new r,ot.prototype=new r,g.prototype=new r,c.prototype=new r,a.prototype=new r,ut.prototype=new r,ft.prototype=new r,nt.prototype=new r,y.prototype=new r,d.prototype=new r,tt.prototype=new r,it.prototype=new r,v.prototype=new r,u.prototype=new r,o.prototype=new r,h.prototype=new r,t.SpreadActions={navigationLeft:function(){yt(this,t.Direction.left)},navigationRight:function(){yt(this,t.Direction.right)},navigationUp:function(){yt(this,t.Direction.up)},navigationDown:function(){yt(this,t.Direction.down)},commitInputNavigationDown:function(){this.moveActiveCell(t.Direction.down,!1)},commitInputNavigationUp:function(){this.moveActiveCell(t.Direction.up,!1)},navigationHome:function(){vt(this,t.Direction.right,this._activeRowIndex,this.frozenColCount?this.frozenColCount-1:-1)},navigationHome2:function(){vt(this,t.Direction.right,this._activeRowIndex,-1)},navigationEnd:function(){vt(this,t.Direction.left,this._activeRowIndex,this.getColumnCount())},navigationTop:function(){vt(this,t.Direction.down,-1,this._activeColIndex)},navigationBottom:function(){vt(this,t.Direction.up,this.getRowCount(),this._activeColIndex)},navigationPageUp:function(){var i,u,n,r;if(this._isEditing)return;i=this._getPrevPageTopRow();if(i===null||i===this._scrollTopRow)return;u=this._getRowLayout(1,t.SheetArea.viewport),this._rowLayoutCache.viewport={},n=this._getNextVisualRow(this._activeRowIndex-u.length),n<i?n=i:n<this._getPageBottomRow()||(n=this._getPrevVisualRow(this._getPageBottomRow())),this._activeRowIndex=n,this._leadingCellRow=n,r=this.moveActiveCell(),r?this._setTopRow(i):this._setTopRow(i,!0)},navigationPageDown:function(){var i,u,n,r;if(this._isEditing)return;i=this._getNextPageTopRow();if(i===null||i===this._scrollTopRow)return;u=this._getRowLayout(1,t.SheetArea.viewport),this._rowLayoutCache.viewport={},n=this._getPrevVisualRow(this._activeRowIndex+u.length),n<i?n=i:n<this._getPageBottomRow()||(n=this._getPrevVisualRow(this._getPageBottomRow())),this._activeRowIndex=n,this._leadingCellRow=n,r=this.moveActiveCell(),r?this._setTopRow(i):this._setTopRow(i,!0)},navigationNextSheet:function(){var n=this.parent,r,i;(n||n instanceof t.GcSpread)&&(r=n.getSheetCount(),i=n.getActiveSheetIndex(),i<r-1&&(i++,n.setActiveSheetIndex(i),n.repaint()))},navigationPreviousSheet:function(){var n=this.parent,i;(n||n instanceof t.GcSpread)&&(i=n.getActiveSheetIndex(),i>0&&(i--,n.setActiveSheetIndex(i),n.repaint()))},navigationPrevious:function(){},navigationNext:function(){},navigationFirst:function(){if(this._isEditing)return;var i=this.frozenColCount?this.frozenColCount-1:-1,n=this.frozenRowCount?this.frozenRowCount-1:-1;this.moveActiveCell(t.Direction.right,!1,this._activeRowIndex,i),this.moveActiveCell(t.Direction.down,!1,n,this._activeColIndex)},navigationLast:function(){if(this._isEditing)return;this.moveActiveCell(t.Direction.left,!1,this._activeRowIndex,this.getColumnCount()),this.moveActiveCell(t.Direction.up,!1,this.getRowCount(),this._activeColIndex)},commitInputNavigationTabNext:function(){this._isNavigateInSelection?this._moveActiveCellInSelection(t.Direction.right):this.moveActiveCell(t.Direction.right,!0)},commitInputNavigationTabPrevious:function(){this._isNavigateInSelection?this._moveActiveCellInSelection(t.Direction.left):this.moveActiveCell(t.Direction.left,!0)},cancelInput:function(){if(this._isEditing){var n=this.getValue(this._activeRowIndex,this._activeColIndex,t.SheetArea.viewport);this.endEdit(!0),this.setValue(this._activeRowIndex,this._activeColIndex,n,t.SheetArea.viewport,!0)}},clear:function(){var t,n,r,i;if(!this._isEditing){for(t=this.getSelections(),n=0;n<t.length;n++)if(this.isProtected&&this._isAnyCellInRangeLocked(t[n]))return;r=t.toArray(),i=new v(this,r),i.canExecute(this)&&this._doCommand(i)}},clearAndEditing:function(){this._isEditing||this.startEdit(!0,"")},copy:function(){if(!this._isEditing){var n=this.getSelections();n&&n.length===1&&this._clipboardCopy(n[0],!1)}},cut:function(){if(!this._isEditing){var n=this.getSelections();n&&n.length===1&&this._clipboardCopy(n[0],!0)}},paste:function(){var w="The pasted area should have the same size as the copy or cut area.",n=this,l,v,y,p;if(n){if(n._isEditing)return;var o=n._getClipboardHelper(),f=o.fromSheet,e=o.range,a=n._getClipboardData(),u=o.isCutting;u&&(o.fromSheet=null,o.range=null,o.isCutting=!1),u&&f&&e&&f.isProtected&&f._isAnyCellInRangeLocked(e)&&(u=!1);var r={pastedRange:null,pastedInternal:!1},c=[],s=n.getSelections(),i;if(s.length>1)for(l=0;l<s.length;l++){i=s[l];if(!n._checkPastedRange(f,e,i,u,a,r))return;if(i.containsRange(r.pastedRange)&&!i.equals(r.pastedRange)){n._raiseInvalidOperation(w);return}c.push(r.pastedRange)}else if(s.length>0){i=s[0];if(!n._checkPastedRange(f,e,i,u,a,r))return;c.push(r.pastedRange)}else{i=n._getSpanModel().find(n._activeRowIndex,n._activeColIndex),i||(i=new t.Range(n._activeRowIndex,n._activeColIndex,1,1));if(!n._checkPastedRange(f,e,i,u,a,r))return;c.push(r.pastedRange)}c.length>0&&(r.pastedInternal||(f=null,e=null),v=n.clipBoardOptions(),u&&(v=t.ClipboardPasteOptions.All),y={fromRange:e,pastedRanges:c.slice(0),isCutting:u,clipboardText:a},p=new h(n,f,n,y,v),n._doCommand(p))}},selectionLeft:function(){s(this,t.Key.left)},selectionRight:function(){s(this,t.Key.right)},selectionUp:function(){s(this,t.Key.up)},selectionDown:function(){s(this,t.Key.down)},selectionHome:function(){s(this,t.Key.left,!0)},selectionEnd:function(){s(this,t.Key.right,!0)},selectionPageUp:function(){s(this,t.Key.pup)},selectionPageDown:function(){s(this,t.Key.pdn)},selectionTop:function(){s(this,t.Key.up,!0)},selectionBottom:function(){s(this,t.Key.down,!0)},selectionFirst:function(){s(this,t.Key.home,!0)},selectionLast:function(){s(this,t.Key.end,!0)},undo:function(){var n=this.undoManager();this.isProtected===!1&&n.canUndo()&&n.undo()},redo:function(){var n=this.undoManager();this.isProtected===!1&&n.canRedo()&&n.redo()}},k.prototype.canExecute=function(n){return!0},k.prototype.execute=function(n){var i=this._sheet,o,u,s,f,e,r;if(i&&this._columns&&this._columns.length>0){this._suspendInvalidate(n),o=this._getColumnsReiszed(this._columns),u={sheet:i,sheetName:i._name,colList:o,header:this._rowHeader,cancel:!1},i._trigger(t.Events.ColumnWidthChanging,u);if(u&&u.cancel===!0){this._canUndo=!1,this._resumeInvalidate(n);return}else this._canUndo=!0;for(this.saveState(),s=this._rowHeader?i.getColumnCount(t.SheetArea.rowHeader):i.getColumnCount(t.SheetArea.viewport),f=0;f<this._columns.length;f++)for(e=this._columns[f],r=e.firstCol;r<=e.lastCol;r++)0<=r&&r<s&&(this._rowHeader&&i.getColumnResizable(r,t.SheetArea.rowHeader)&&this._size!==i.getColumnWidth(r,t.SheetArea.rowHeader)?i.setColumnWidth(r,this._size,t.SheetArea.rowHeader):i.getColumnResizable(r,t.SheetArea.viewport)&&this._size!==i.getColumnWidth(r,t.SheetArea.viewport)&&i.setColumnWidth(r,this._size,t.SheetArea.viewport));this._resumeInvalidate(n),i.invalidateLayout(),i.repaint(),i._trigger(t.Events.ColumnWidthChanged,{sheet:i,sheetName:i._name,colList:o,header:this._rowHeader})}},k.prototype.saveState=function(){var e=null,f=null,u=this._sheet,o,r,i,n;if(u&&this._columns&&this._columns.length>0)for(o=this._rowHeader?u.getColumnCount(t.SheetArea.rowHeader):u.getColumnCount(t.SheetArea.viewport),e=[this._columns.length],f=[this._columns.length],r=0;r<this._columns.length;r++)for(i=this._columns[r],e[r]=[i.lastCol-i.firstCol+1],f[r]=[i.lastCol-i.firstCol+1],n=i.firstCol;n<=i.lastCol;n++)0<=n&&n<o?(e[r][n-i.firstCol]=this._rowHeader?u.getColumnWidth(n,t.SheetArea.rowHeader):u.getColumnWidth(n,t.SheetArea.viewport),f[r][n-i.firstCol]=this._rowHeader?u.getColumnVisible(n,t.SheetArea.rowHeader):u.getColumnVisible(n,t.SheetArea.viewport)):(e[r][n-i.firstCol]=-1,f[r][n-i.firstCol]=!1);this._oldSizes=e,this._oldVisibles=f},k.prototype.undo=function(n){var o=!1,i=this._sheet,c,h,l,s,e,u,f,r;if(i&&this._columns&&this._columns.length>0){this._suspendInvalidate(n),c=this._getColumnsReiszed(this._columns),h={sheet:i,sheetName:i._name,colList:c,header:this._rowHeader,cancel:!1},i._trigger(t.Events.ColumnWidthChanging,h);if(h&&h.cancel===!0)return this._resumeInvalidate(n),!1;for(l=this._rowHeader?i.getColumnCount(t.SheetArea.rowHeader):i.getColumnCount(t.SheetArea.viewport),u=0;u<this._columns.length;u++)for(f=this._columns[u],r=f.firstCol;r<=f.lastCol;r++)s=this._oldSizes[u][r-f.firstCol],e=this._oldVisibles[u][r-f.firstCol],0<=r&&r<l&&s!==-1&&(this._rowHeader&&i.getColumnResizable(r,t.SheetArea.rowHeader)?(i.setColumnWidth(r,s,t.SheetArea.rowHeader),o=!0):i.getColumnResizable(r,t.SheetArea.viewport)&&(i.setColumnWidth(r,s,t.SheetArea.viewport),o=!0),this._rowHeader&&i.getColumnVisible(r,t.SheetArea.rowHeader)!==e?(i.setColumnVisible(r,e,t.SheetArea.rowHeader),o=!0):i.getColumnVisible(r,t.SheetArea.viewport)!==e&&(i.setColumnVisible(r,e,t.SheetArea.viewport),o=!0));this._resumeInvalidate(n),i.invalidateLayout(),i.repaint(),i._trigger(t.Events.ColumnWidthChanged,{sheet:i,sheetName:i._name,colList:c,header:this._rowHeader})}return o},k.prototype._getColumnsReiszed=function(n){for(var u=[],r,t,i=0;i<n.length;i++)for(r=n[i],t=r.firstCol;t<=r.lastCol;t++)u.push(t);return u},k.prototype.canUndo=function(){return this._canUndo},b.prototype.canExecute=function(n){return!0},b.prototype.execute=function(n){var i=this._sheet,o,u,s,f,e,r;if(i&&this._rows&&this._rows.length>0){this._suspendInvalidate(n),o=this._getRowsReiszed(this._rows),u={sheet:i,sheetName:i._name,rowList:o,header:this._columnHeader,cancel:!1},i._trigger(t.Events.RowHeightChanging,u);if(u&&u.cancel===!0){this._canUndo=!1,this._resumeInvalidate(n);return}else this._canUndo=!0;for(this.saveState(),s=this._columnHeader?i.getRowCount(t.SheetArea.colHeader):i.getRowCount(t.SheetArea.viewport),f=0;f<this._rows.length;f++)for(e=this._rows[f],r=e.firstRow;r<=e.lastRow;r++)0<=r&&r<s&&(this._columnHeader&&i.getRowResizable(r,t.SheetArea.colHeader)&&this._size!==i.getRowHeight(r,t.SheetArea.colHeader)?i.setRowHeight(r,this._size,t.SheetArea.colHeader):i.getRowResizable(r,t.SheetArea.viewport)&&this._size!==i.getRowHeight(r,t.SheetArea.viewport)&&(i.setRowHeight(r,this._size,t.SheetArea.viewport),i.rowFilter()&&i.rowFilter()._addRowFilteredIn(r)));this._resumeInvalidate(n),i.invalidateLayout(),i.repaint(),i._trigger(t.Events.RowHeightChanged,{sheet:i,sheetName:i._name,rowList:o,header:this._columnHeader})}},b.prototype.saveState=function(){var e=null,f=null,u=this._sheet,o,r,i,n;if(u&&this._rows&&this._rows.length>0)for(o=this._columnHeader?u.getRowCount(t.SheetArea.colHeader):u.getRowCount(t.SheetArea.viewport),e=[this._rows.length],f=[this._rows.length],r=0;r<this._rows.length;r++)for(i=this._rows[r],e[r]=[i.lastRow-i.firstRow+1],f[r]=[i.lastRow-i.firstRow+1],n=i.firstRow;n<=i.lastRow;n++)0<=n&&n<o?(e[r][n-i.firstRow]=this._columnHeader?u.getRowHeight(n,t.SheetArea.colHeader):u.getRowHeight(n,t.SheetArea.viewport),f[r][n-i.firstRow]=this._columnHeader?u.getRowVisible(n,t.SheetArea.colHeader):u.getRowVisible(n,t.SheetArea.viewport)):(e[r][n-i.firstRow]=-1,f[r][n-i.firstRow]=!1);this._oldVisibles=f,this._oldSizes=e},b.prototype.undo=function(n){var o=!1,i=this._sheet,c,h,l,s,e,u,f,r;if(i&&this._rows&&this._rows.length>0){this._suspendInvalidate(n),c=this._getRowsReiszed(this._rows),h={sheet:i,sheetName:i._name,rowList:c,header:this._columnHeader,cancel:!1},i._trigger(t.Events.RowHeightChanging,h);if(h&&h.cancel===!0)return this._resumeInvalidate(n),!1;for(l=this._columnHeader?i.getRowCount(t.SheetArea.colHeader):i.getRowCount(t.SheetArea.viewport),u=0;u<this._rows.length;u++)for(f=this._rows[u],r=f.firstRow;r<=f.lastRow;r++)s=this._oldSizes[u][r-f.firstRow],e=this._oldVisibles[u][r-f.firstRow],0<=r&&r<l&&s!==-1&&(this._columnHeader&&i.getRowResizable(r,t.SheetArea.colHeader)?(i.setRowHeight(r,s,t.SheetArea.colHeader),o=!0):i.getRowResizable(r,t.SheetArea.viewport)&&(i.setRowHeight(r,s,t.SheetArea.viewport),o=!0),this._columnHeader&&i.getRowVisible(r,t.SheetArea.colHeader)!==e?(i.setRowVisible(r,e,t.SheetArea.colHeader),o=!0):i.getRowVisible(r,t.SheetArea.viewport)!==e&&(i.setRowVisible(r,e,t.SheetArea.viewport),o=!0));this._resumeInvalidate(n),i.invalidateLayout(),i.repaint(),i._trigger(t.Events.RowHeightChanged,{sheet:i,sheetName:i._name,rowList:c,header:this._columnHeader})}return o},b.prototype._getRowsReiszed=function(n){for(var u=[],r,t,i=0;i<n.length;i++)for(r=n[i],t=r.firstRow;t<=r.lastRow;t++)u.push(t);return u},b.prototype.canUndo=function(){return this._canUndo},w.prototype.canExecute=function(n){return this._sheet&&this._columns&&this._columns.length>0},w.prototype.execute=function(n){var i,s,e,o,h,u,f,r;if(this.canExecute(n)){i=this._sheet,this._suspendInvalidate(n),s=this._getColumnsReiszed(this._columns),e={sheet:i,sheetName:i._name,colList:s,header:this._rowHeader,cancel:!1},i._trigger(t.Events.ColumnWidthChanging,e);if(e&&e.cancel===!0){this._canUndo=!1,this._resumeInvalidate(n);return}else this._canUndo=!0;for(this.saveState(),o=this._rowHeader?i.getColumnCount(t.SheetArea.rowHeader):i.getColumnCount(t.SheetArea.viewport),h=i.isPaintSuspended(),i.isPaintSuspended(!0),f=0;f<this._columns.length;f++)r=this._columns[f],0<=r.col&&r.col<o&&(this._rowHeader&&i.getColumnResizable(r.col,t.SheetArea.rowHeader)?(u=this._getColumnAutoFitValue(r.col,!0),u!==i.getColumnWidth(r.col,t.SheetArea.rowHeader)&&(i.setColumnWidth(r.col,u,t.SheetArea.rowHeader),i._trigger(t.Events.ColumnWidthChanged,{sheet:i,sheetName:i._name,colomn:r.col,header:this._rowHeader}))):i.getColumnResizable(r.col,t.SheetArea.viewport)&&(u=this._getColumnAutoFitValue(r.col,!1),u!==i.getColumnWidth(r.col,t.SheetArea.viewport)&&(i.setColumnWidth(r.col,u,t.SheetArea.viewport),i._trigger(t.Events.ColumnWidthChanged,{sheet:i,sheetName:i._name,colomn:r.col,header:this._rowHeader}))));i.isPaintSuspended(h),this._resumeInvalidate(n),i.invalidateLayout(),i.repaint()}},w.prototype.saveState=function(){var u=null,f=null,r=this._sheet,e,n,i;if(r&&this._columns&&this._columns.length>0)for(e=this._rowHeader?r.getColumnCount(t.SheetArea.rowHeader):r.getColumnCount(t.SheetArea.viewport),u=[this._columns.length],f=[this._columns.length],n=0;n<this._columns.length;n++)i=this._columns[n],0<=i.col&&i.col<e?this._rowHeader?(u[n]=r.getColumnWidth(i.col,t.SheetArea.rowHeader),f[n]=r.getColumnVisible(i.col,t.SheetArea.rowHeader)):(u[n]=r.getColumnWidth(i.col,t.SheetArea.viewport),f[n]=r.getColumnVisible(i.col,t.SheetArea.viewport)):(u[n]=-1,f[n]=!1);this._oldSizes=u,this._oldVisibles=f},w.prototype.undo=function(n){var o=!1,i,h,e,c,f,s,l,r,u;if(this._sheet&&this._columns&&this._columns.length>0){i=this._sheet,this._suspendInvalidate(n),h=this._getColumnsReiszed(this._columns),e={sheet:i,sheetName:i._name,colList:h,header:this._rowHeader,cancel:!1},i._trigger(t.Events.ColumnWidthChanging,e);if(e&&e.cancel===!0)return this._resumeInvalidate(n),!1;for(c=this._rowHeader?i.getColumnCount(t.SheetArea.rowHeader):i.getColumnCount(t.SheetArea.viewport),l=i.isPaintSuspended(),i.isPaintSuspended(!0),r=0;r<this._columns.length;r++)u=this._columns[r],f=this._oldSizes[r],s=this._oldVisibles[r],0<=r&&r<c&&f!==-1&&(this._rowHeader&&i.getColumnResizable(u.col,t.SheetArea.rowHeader)?(i.setColumnWidth(u.col,f,t.SheetArea.rowHeader),i.setColumnVisible(u.col,s,t.SheetArea.rowHeader),o=!0):i.getColumnResizable(u.col,t.SheetArea.viewport)&&(i.setColumnWidth(u.col,f,t.SheetArea.viewport),i.setColumnVisible(u.col,s,t.SheetArea.viewport),o=!0));i.isPaintSuspended(l),this._resumeInvalidate(n),i.invalidateLayout(),i.repaint(),i._trigger(t.Events.ColumnWidthChanged,{sheet:i,sheetName:i._name,colList:h,header:this._rowHeader})}return o},w.prototype._getColumnsReiszed=function(n){for(var r=[],i,t=0;t<n.length;t++)i=n[t],r.push(i.col);return r},w.prototype._getColumnAutoFitValue=function(n,i){var r=this._sheet,s=0,u=0,l=i?t.SheetArea.rowHeader:t.SheetArea.viewport,h,o,a,c,y,v;while(u>=0){h=r.getText(u,n,l);if(h!==""&&h){o=r._getSpanModel(l).find(u,n);if(o&&(o.col<n||o.colCount>1)){u=o.row+o.rowCount;continue}var f=r.getActualStyle(u,n),p=!f||!f.font?r._render._getZoomFont(r._render._getDefaultFont(l)):r._render._getZoomFont(f.font),e=0;if(f.wordWrap)for(a=h.split(/\r\n|\r|\n/),c=0;c<a.length;c++)e=Math.max(e,r._getStringWidth(a[c],p)/r._zoomFactor);else e=r._getStringWidth(h,p)/r._zoomFactor;f.hAlign!==t.HorizontalAlign.center&&f.textIndent>0&&(e+=f.textIndent*8/r._zoomFactor),r.rowFilter()&&r.rowFilter().isFilterHeader(u,n,l)&&(y=r._zoomFactor>1?1:r._zoomFactor,v=parseInt(r.defaults.rowHeight*y,10),e+=v),e>s&&(s=e)}u=r._nextNonNullRow(u,i)}return s===0?s=r.defaults.colWidth:s+=Math.ceil(4/r._zoomFactor),s},w.prototype.canUndo=function(){return this._canUndo},p.prototype.canExecute=function(n){return this._sheet&&this._rows&&this._rows.length>0},p.prototype.execute=function(n){var i,s,e,o,h,u,f,r;if(this.canExecute(n)){i=this._sheet,this._suspendInvalidate(n),s=this._getRowsResized(this._rows),e={sheet:i,sheetName:i._name,rowList:s,header:this._columnHeader,cancel:!1},i._trigger(t.Events.RowHeightChanging,e);if(e&&e.cancel===!0){this._canUndo=!1,this._resumeInvalidate(n);return}else this._canUndo=!0;for(this.saveState(),o=this._columnHeader?i.getRowCount(t.SheetArea.colHeader):i.getRowCount(t.SheetArea.viewport),h=i.isPaintSuspended(),i.isPaintSuspended(!0),f=0;f<this._rows.length;f++)r=this._rows[f],0<=r.row&&r.row<o&&(this._columnHeader&&i.getRowResizable(r.row,t.SheetArea.colHeader)?(u=this._getRowAutoFitValue(r.row,!0),u!==i.getRowHeight(r.row,t.SheetArea.colHeader)&&(i.setRowHeight(r.row,u,t.SheetArea.colHeader),i._trigger(t.Events.RowHeightChanged,{sheet:i,sheetName:i._name,row:r.row,header:this._columnHeader}))):i.getRowResizable(r.row,t.SheetArea.viewport)&&(u=this._getRowAutoFitValue(r.row,!1),u!==i.getRowHeight(r.row,t.SheetArea.viewport)&&(i.setRowHeight(r.row,u,t.SheetArea.viewport),i._trigger(t.Events.RowHeightChanged,{sheet:i,sheetName:i._name,row:r.row,header:this._columnHeader}))));i.isPaintSuspended(h),this._resumeInvalidate(n),i.invalidateLayout(),i.repaint()}},p.prototype.saveState=function(){var u=null,f=null,r=this._sheet,e,n,i;if(r&&this._rows&&this._rows.length>0)for(u=[this._rows.length],f=[this._rows.length],e=this._columnHeader?r.getRowCount(t.SheetArea.colHeader):r.getRowCount(t.SheetArea.viewport),n=0;n<this._rows.length;n++)i=this._rows[n],0<=i.row&&i.row<e?this._columnHeader?(u[n]=r.getRowHeight(i.row,t.SheetArea.colHeader),f[n]=r.getRowVisible(i.row,t.SheetArea.colHeader)):(u[n]=r.getRowHeight(i.row,t.SheetArea.viewport),f[n]=r.getRowVisible(i.row,t.SheetArea.viewport)):(u[n]=-1,f[n]=!1);this._oldSizes=u,this._oldVisibles=f},p.prototype.undo=function(n){var o=!1,i=this._sheet,s,e,f,h,c,l,r,u;if(i&&this._rows&&this._rows.length>0){this._suspendInvalidate(n),s=this._getRowsResized(this._rows),e={sheet:i,sheetName:i._name,rowList:s,header:this._columnHeader,cancel:!1},i._trigger(t.Events.RowHeightChanging,e);if(e&&e.cancel===!0)return this._resumeInvalidate(n),!1;for(c=this._columnHeader?i.getRowCount(t.SheetArea.colHeader):i.getRowCount(t.SheetArea.viewport),l=i.isPaintSuspended(),i.isPaintSuspended(!0),r=0;r<this._rows.length;r++)u=this._rows[r],f=this._oldSizes[r],h=this._oldVisibles[r],0<=r&&r<c&&f!==-1&&(this._columnHeader&&i.getRowResizable(u.row,t.SheetArea.colHeader)?(i.setRowHeight(u.row,f,t.SheetArea.colHeader),i.setRowVisible(u.row,h,t.SheetArea.colHeader),o=!0):i.getRowResizable(u.row,t.SheetArea.viewport)&&(i.setRowHeight(u.row,f,t.SheetArea.viewport),i.setRowVisible(u.row,h,t.SheetArea.viewport),o=!0));i.isPaintSuspended(l),this._resumeInvalidate(n),i.invalidateLayout(),i.repaint(),i._trigger(t.Events.RowHeightChanged,{sheet:i,sheetName:i._name,rowList:s,header:this._columnHeader})}return o},p.prototype._getRowsResized=function(n){for(var r=[],i,t=0;t<n.length;t++)i=n[t],r.push(i.row);return r},p.prototype._getRowAutoFitValue=function(n,i){var r=this._sheet,u=0,f=0,c=i?t.SheetArea.colHeader:t.SheetArea.viewport,s,e,o,h,a,l;while(f>=0){s=r.getText(n,f,c);if(s!==""&&s){e=r._getSpanModel(c).find(n,f);if(e&&(e.row<n||e.rowCount>1)){f=e.col+e.colCount;continue}o=r.getActualStyle(n,f),h=!o||!o.font?r._render._getZoomFont(r._render._getDefaultFont(c)):r._render._getZoomFont(o.font),o.wordWrap?(a=s.split(/\r\n|\r|\n/),l=r._getFontHeight(h)/r._zoomFactor,u=Math.max(u,a.length*l)):u=Math.max(u,r._getFontHeight(h)/r._zoomFactor)}f=r._nextNonNullColumn(n,f,i)}return u===0?u=r.defaults.rowHeight:u+=Math.ceil(4/r._zoomFactor),u},p.prototype.canUndo=function(){return this._canUndo},st.prototype.canExecute=function(n){return!0},st.prototype.execute=function(n){var t=this._sheet,r,i;t&&this._columnGroupExtent&&t.colRangeGroup&&(this._suspendInvalidate(n),r=this._columnGroupExtent.index,i=this._columnGroupExtent.count,t.colRangeGroup.group(r,i),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint())},st.prototype.saveState=function(){},st.prototype.undo=function(n){var u=!1,t=this._sheet,r,i;return t&&this._columnGroupExtent&&t.colRangeGroup&&(this._suspendInvalidate(n),r=this._columnGroupExtent.index,i=this._columnGroupExtent.count,t.colRangeGroup.ungroupRange(r,i),u=!0,this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()),u},rt.prototype.canExecute=function(n){return!0},rt.prototype.execute=function(n){var t=this._sheet,i,r;t&&this._columnUngroupExtent&&t.colRangeGroup&&(i=this._columnUngroupExtent.index,r=this._columnUngroupExtent.count,t.colRangeGroup.getLevel(i)<0&&t.colRangeGroup.getLevel(i+r-1)<0?this._canUndo=!1:(this._suspendInvalidate(n),this._canUndo=!0,t.colRangeGroup.ungroupRange(i,r),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()))},rt.prototype.canUndo=function(){return this._canUndo},rt.prototype.saveState=function(){},rt.prototype.undo=function(n){var u=!1,t=this._sheet,r,i;return this._canUndo===!0&&t&&this._columnUngroupExtent&&t.colRangeGroup&&(this._suspendInvalidate(n),r=this._columnUngroupExtent.index,i=this._columnUngroupExtent.count,t.colRangeGroup.group(r,i),u=!0,this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()),u},ot.prototype.canExecute=function(n){return!0},ot.prototype.execute=function(n){var t=this._sheet,r,i;t&&this._rowGroupExtent&&t.rowRangeGroup&&(this._suspendInvalidate(n),r=this._rowGroupExtent.index,i=this._rowGroupExtent.count,t.rowRangeGroup.group(r,i),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint())},ot.prototype.saveState=function(){},ot.prototype.undo=function(n){var u=!1,t=this._sheet,r,i;return t&&this._rowGroupExtent&&t.rowRangeGroup&&(this._suspendInvalidate(n),r=this._rowGroupExtent.index,i=this._rowGroupExtent.count,t.rowRangeGroup.ungroupRange(r,i),u=!0,this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()),u},g.prototype.canExecute=function(n){return!0},g.prototype.execute=function(n){var t=this._sheet,i,r;t&&this._rowUngroupExtent&&t.rowRangeGroup&&(i=this._rowUngroupExtent.index,r=this._rowUngroupExtent.count,t.rowRangeGroup.getLevel(i)<0&&t.rowRangeGroup.getLevel(i+r-1)<0?this._canUndo=!1:(this._suspendInvalidate(n),this._canUndo=!0,t.rowRangeGroup.ungroupRange(i,r),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()))},g.prototype.canUndo=function(){return this._canUndo},g.prototype.saveState=function(){},g.prototype.undo=function(n){var u=!1,t=this._sheet,r,i;return this._canUndo===!0&&t&&this._rowUngroupExtent&&t.rowRangeGroup&&(this._suspendInvalidate(n),r=this._rowUngroupExtent.index,i=this._rowUngroupExtent.count,t.rowRangeGroup.group(r,i),u=!0,this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()),u},c.prototype.canExecute=function(){return!0},c.prototype.execute=function(n){var t=this._sheet,r,i;t&&this._columnExpandExtent&&t.colRangeGroup&&(this._suspendInvalidate(n),r=this._columnExpandExtent.index,i=this._columnExpandExtent.collapsed,t.colRangeGroup.setCollapsed(r,i),t._allowCellOverflow===!0&&t._clearCellOverflowModelCache(),this._resumeInvalidate(n),this._showColumnRangeGroup(i),t.invalidateLayout(),t.repaint())},c.prototype.saveState=function(){},c.prototype.undo=function(n){var r=!1,t=this._sheet,u,i;return t&&this._columnExpandExtent&&t.colRangeGroup&&(this._suspendInvalidate(n),u=this._columnExpandExtent.index,i=this._columnExpandExtent.collapsed,t.colRangeGroup.setCollapsed(u,!i),t._allowCellOverflow===!0&&t._clearCellOverflowModelCache(),r=!0,this._resumeInvalidate(n),this._showColumnRangeGroup(!i),t.invalidateLayout(),t.repaint()),r},c.prototype._showColumnRangeGroup=function(n){var i=this._sheet,f=this._columnExpandExtent.index,c,u,e,h,r,o,s,l;if(f<0||f>=i.getColumnCount())return;if(i.colRangeGroup.direction===t.RangeGroupDirection.Forward){c=i.colRangeGroup.find(f-1,this._columnExpandExtent.level);if(!c)return;u=c.start,e=f,h=1,n?u=f:u<i.frozenColCount&&(u=i.frozenColCount),r=i.getViewportLeftColumn(h),u<r&&(r=u),o=i.getViewportWidth(h),s=this._getColsTotalWidth(i,r,e),s>o&&(r=this._getNewLeftColumn(i,r,s-o)),i._scrollLeftCol=this._tryGetNextScrollableCol(i,r)}else{c=i.colRangeGroup.find(f+1,this._columnExpandExtent.level);if(!c)return;u=f,e=c.end,h=1,n?e=f:(l=i.getColumnCount(),e<l||(e=l-1)),r=i.getViewportLeftColumn(h),u<r?i._scrollLeftCol=this._tryGetNextScrollableCol(i,u):(o=i.getViewportWidth(h),s=this._getColsTotalWidth(i,r,e),s>o&&(r=this._getNewLeftColumn(i,r,s-o),i._scrollLeftCol=this._tryGetNextScrollableCol(i,Math.min(u,r))))}i._syncHScollbarPosition()},c.prototype._getColsTotalWidth=function(n,t,i){for(var u=0,f=n.getColumnCount(),r=t;r<=i&&r<f;r++)u+=n.getColumnWidth(r)*n._zoomFactor;return u},c.prototype._getNewLeftColumn=function(n,t,i){for(var f=0,u=n.getColumnCount(),r=t;r<u&&f<i;r++)t++,f+=n.getColumnWidth(r)*n._zoomFactor;return t>=u?u-1:t},c.prototype._tryGetNextScrollableCol=function(n,t){var f=n.frozenColCount,r=n.getColumnCount()-1,i,u;if(t<f)return f;if(t>r)return r;for(i=t;i<=r;i++){u=n.getColumnWidth(i);if(u>0)return i}return-1},a.prototype.canExecute=function(){return!0},a.prototype.execute=function(n){var t=this._sheet,r,i;t&&this._rowExpandExtent&&t.rowRangeGroup&&(this._suspendInvalidate(n),r=this._rowExpandExtent.index,i=this._rowExpandExtent.collapsed,t.rowRangeGroup.setCollapsed(r,i),this._resumeInvalidate(n),this._showRowRangeGroup(i),t.invalidateLayout(),t.repaint())},a.prototype.saveState=function(){},a.prototype.undo=function(n){var r=!1,t=this._sheet,u,i;return t&&this._rowExpandExtent&&t.rowRangeGroup&&(this._suspendInvalidate(n),u=this._rowExpandExtent.index,i=this._rowExpandExtent.collapsed,t.rowRangeGroup.setCollapsed(u,!i),r=!0,this._resumeInvalidate(n),this._showRowRangeGroup(!i),t.invalidateLayout(),t.repaint()),r},a.prototype._showRowRangeGroup=function(n){var i=this._sheet,f=this._rowExpandExtent.index,c,u,e,h,r,o,s,l;if(f<0||f>=i.getRowCount())return;if(i.rowRangeGroup.direction===t.RangeGroupDirection.Forward){c=i.rowRangeGroup.find(f-1,this._rowExpandExtent.level);if(!c)return;u=c.start,e=f,h=1,n?u=f:u<i.frozenRowCount&&(u=i.frozenRowCount),r=i.getViewportTopRow(h),u<r&&(r=u),o=i.getViewportHeight(h),s=this._getRowsTotalHeight(i,r,e),s>o&&(r=this._getNewTopRow(i,r,s-o)),i._scrollTopRow=this._tryGetNextScrollableRow(i,r)}else{c=i.rowRangeGroup.find(f+1,this._rowExpandExtent.level);if(!c)return;u=f,e=c.end,h=1,n?e=f:(l=i.getRowCount(),e<l||(e=l-1)),r=i.getViewportTopRow(h),u<r?i._scrollTopRow=this._tryGetNextScrollableRow(i,u):(o=i.getViewportHeight(h),s=this._getRowsTotalHeight(i,r,e),s>o&&(r=this._getNewTopRow(i,r,s-o),i._scrollTopRow=this._tryGetNextScrollableRow(i,Math.min(u,r))))}i._syncVScrollbarPosition()},a.prototype._getRowsTotalHeight=function(n,t,i){for(var u=0,f=n.getRowCount(),r=t;r<=i&&r<f;r++)u+=n.getRowHeight(r)*n._zoomFactor;return u},a.prototype._getNewTopRow=function(n,t,i){for(var f=0,u=n.getRowCount(),r=t;r<=u&&f<i;r++)t++,f+=n.getRowHeight(r)*n._zoomFactor;return t>=u?u-1:t},a.prototype._tryGetNextScrollableRow=function(n,t){var f=n.frozenRowCount,r=n.getRowCount()-1,i,u;if(t<f)return f;if(t>r)return r;for(i=t;i<=r;i++){u=n.getRowHeight(i);if(u>0)return i}return-1},ut.prototype.canExecute=function(){return!0},ut.prototype.execute=function(n){var t=this._sheet,r,i;if(t&&this._columnGroupHeaderExpandExtent&&t.colRangeGroup){for(this._suspendInvalidate(n),this.saveState(),r=this._columnGroupHeaderExpandExtent.level,i=0;i<r;i++)t.colRangeGroup.expand(i,!0);t.colRangeGroup.expand(r,!1),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()}},ut.prototype.saveState=function(){var f=null,i=this._sheet,o,e,n,r,s;if(i&&this._columnGroupHeaderExpandExtent&&i.colRangeGroup)for(o=this._columnGroupHeaderExpandExtent.level,f={},e=0;e<=o;e++){var u=0,c=i.getColumnCount(),h=i.colRangeGroup.direction;while(u<c){n=i.colRangeGroup.find(u,e);if(n){r=-1;switch(h){case t.RangeGroupDirection.Backward:r=n.start-1;break;case t.RangeGroupDirection.Forward:r=n.end+1;break;default:break}s=n.getState()===t.GroupState.Collapsed,f[r]||(f[r]=s),u+=n.end-n.start+1}u++}}this._oldStatus=f},ut.prototype.undo=function(n){var r=!1,t=this._sheet,i;if(t&&this._oldStatus&&t.colRangeGroup){this._suspendInvalidate(n);for(i in this._oldStatus)i&&(t.colRangeGroup.setCollapsed(i,this._oldStatus[i]),r=!0);this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()}return r},ft.prototype.canExecute=function(){return!0},ft.prototype.execute=function(n){var t=this._sheet,r,i;if(t&&this._rowGroupHeaderExpandExtent&&t.rowRangeGroup){for(this._suspendInvalidate(n),this.saveState(),r=this._rowGroupHeaderExpandExtent.level,i=0;i<r;i++)t.rowRangeGroup.expand(i,!0);t.rowRangeGroup.expand(r,!1),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()}},ft.prototype.saveState=function(){var f=null,i=this._sheet,o,e,n,r,s;if(i&&this._rowGroupHeaderExpandExtent&&i.rowRangeGroup)for(o=this._rowGroupHeaderExpandExtent.level,f={},e=0;e<=o;e++){var u=0,c=i.getRowCount(),h=i.rowRangeGroup.direction;while(u<c){n=i.rowRangeGroup.find(u,e);if(n){r=-1;switch(h){case t.RangeGroupDirection.Backward:r=n.start-1;break;case t.RangeGroupDirection.Forward:r=n.end+1;break;default:break}s=n.getState()===t.GroupState.Collapsed,f[r]||(f[r]=s),u+=n.end-n.start+1}u++}}this._oldStatus=f},ft.prototype.undo=function(n){var r=!1,t=this._sheet,i;if(t&&this._oldStatus&&t.rowRangeGroup){this._suspendInvalidate(n);for(i in this._oldStatus)i&&(t.rowRangeGroup.setCollapsed(i,this._oldStatus[i]),r=!0);this._resumeInvalidate(n),t.invalidateLayout(),t.repaint()}return r},nt.prototype.canExecute=function(n){return!0},nt.prototype.execute=function(n){var r=this._sheet,u,e,f,s,o,k,b,v,y;if(!r._isValidRange(this._dragDropExtent.fromRow,this._dragDropExtent.fromColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount()))return;if(!this._insert)if(!r._isValidRange(this._dragDropExtent.toRow,this._dragDropExtent.toColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount()))return;this.saveState();if(this._insert){k=this._dragDropExtent.fromRow,b=this._dragDropExtent.fromColumn;if(b>=0&&k<0){u=this._dragDropExtent.fromColumn,e=this._dragDropExtent.toColumn,f=this._dragDropExtent.columnCount,v=this._dragDropExtent.toColumn,this._suspendInvalidate(n);try{this._sheet.addColumns(e,f),this._copy?this._sheet.copyTo(-1,e<=u?u+f:u,-1,e,-1,f,this._option):(this._sheet.moveTo(-1,e<=u?u+f:u,-1,e,-1,f,this._option),this._sheet.deleteColumns(e<=u?u+f:u,f),u<e&&(v=e-f))}finally{this._resumeInvalidate(n)}r&&(s=r.getSelections().toArray(),r._clearSelectionImp(),r.addSelection(-1,v,r.getRowCount(),f),o=r.getSelections(),r._trigger(t.Events.SelectionChanging,{sheet:r,sheetName:r._name,oldSelections:s,newSelections:o}),r._trigger(t.Events.SelectionChanged,{sheet:r,sheetName:r._name}),r._setActiveCellImp(r._getFirstVisualRow(),v,r.activeRowViewportIndex,r.activeColViewportIndex),r.invalidateLayout(),r._dragRect={},r.repaint())}else if(this._dragDropExtent.fromRow>=0&&this._dragDropExtent.fromColumn<0){u=this._dragDropExtent.fromRow,e=this._dragDropExtent.toRow,f=this._dragDropExtent.rowCount,y=this._dragDropExtent.toRow,this._suspendInvalidate(n);try{this._sheet.addRows(e,f),this._copy?this._sheet.copyTo(e<=u?u+f:u,-1,e,-1,f,-1,this._option):(this._sheet.moveTo(e<=u?u+f:u,-1,e,-1,f,-1,this._option),this._sheet.deleteRows(e<=u?u+f:u,f),u<e&&(y=e-f))}finally{this._resumeInvalidate(n)}r&&(s=r.getSelections().toArray(),r._clearSelectionImp(),r.addSelection(y,-1,f,r.getColumnCount()),o=r.getSelections(),r._trigger(t.Events.SelectionChanging,{sheet:r,sheetName:r._name,oldSelections:s,newSelections:o}),r._trigger(t.Events.SelectionChanged,{sheet:r,sheetName:r._name}),r._setActiveCellImp(y,r._getFirstVisualColumn(),r.activeRowViewportIndex,r.activeColViewportIndex),r.invalidateLayout(),r._dragRect={},r.repaint())}}else{var w=this._dragDropExtent.fromRow,p=this._dragDropExtent.fromColumn,h=this._dragDropExtent.toRow,c=this._dragDropExtent.toColumn,l=this._dragDropExtent.rowCount,a=this._dragDropExtent.columnCount;this._suspendInvalidate(n);try{this._copy?this._sheet.copyTo(w,p,h,c,l,a,this._option):this._sheet.moveTo(w,p,h,c,l,a,this._option),r&&(s=r.getSelections().toArray(),r._clearSelectionImp(),r.addSelection(h,c,l,a),o=r.getSelections().toArray(),r._trigger(t.Events.SelectionChanging,{sheet:r,sheetName:r._name,oldSelections:s,newSelections:o}),r._trigger(t.Events.SelectionChanged,{sheet:r,sheetName:r._name}),r._setActiveCellImp(Math.max(r._getFirstVisualRow(),h),Math.max(r._getFirstVisualColumn(),c),r.activeRowViewportIndex,r.activeColViewportIndex),!this._copy&&this._savedFromViewportCells&&this._savedFromViewportCells.isValueSaved()&&i.raiseRangeDataChanged(r,w,p,l,a,this._savedFromViewportCells.getValues()),this._savedToViewportCells&&this._savedToViewportCells.isValueSaved()&&i.raiseRangeDataChanged(r,h,c,l,a,this._savedToViewportCells.getValues()))}finally{this._resumeInvalidate(n)}r&&(r.invalidateLayout(),r._dragRect={},r.repaint())}},nt.prototype.saveState=function(){var v,a,l,u,f,h,c,o,s,y;this.initSaveState();var p=this._dragDropExtent.fromRow<0?0:this._dragDropExtent.fromRow,w=this._dragDropExtent.fromColumn<0?0:this._dragDropExtent.fromColumn,k=this._dragDropExtent.toRow<0?0:this._dragDropExtent.toRow,b=this._dragDropExtent.toColumn<0?0:this._dragDropExtent.toColumn,r=this._dragDropExtent.fromRow<0?this._sheet.getRowCount():this._dragDropExtent.rowCount,n=this._dragDropExtent.fromColumn<0?this._sheet.getColumnCount():this._dragDropExtent.columnCount;this._insert||(this._dragDropExtent.fromRow<0&&(v=new e(this._sheet.getRowCount(t.SheetArea.colHeader),n),a=new at(n),i.saveColumnHeaderInfo(this._sheet,v,a,b,this._option),this._savedToColumnHeaderCells=v,this._savedToColumns=a,this._copy||(l=new e(this._sheet.getRowCount(t.SheetArea.colHeader),n),u=new at(n),i.saveColumnHeaderInfo(this._sheet,l,u,w,this._option),this._savedFromColumnHeaderCells=l,this._savedFromColumns=u)),this._dragDropExtent.fromColumn<0&&(f=new e(r,this._sheet.getColumnCount(t.SheetArea.rowHeader)),h=new lt(r),i.saveRowHeaderInfo(this._sheet,f,h,k,this._option),this._savedToRowHeaderCells=f,this._savedToRows=h,this._copy||(c=new e(r,this._sheet.getColumnCount(t.SheetArea.rowHeader)),o=new lt(r),i.saveRowHeaderInfo(this._sheet,c,o,p,this._option),this._savedFromRowHeaderCells=c,this._savedFromRows=o)),s=new e(r,n),i.saveViewportInfo(this._sheet,s,k,b,this._option),this._savedToViewportCells=s,this._copy||(y=new e(r,n),i.saveViewportInfo(this._sheet,y,p,w,this._option),this._savedFromViewportCells=y)),this._savedAcitveRowViewportIndex=this._sheet.activeRowViewportIndex,this._savedAcitveColumnViewportIndex=this._sheet.activeColViewportIndex,this._savedActiveRow=this._sheet._activeRowIndex,this._savedActiveColumn=this._sheet._activeColIndex},nt.prototype.initSaveState=function(){this._savedFromColumnHeaderCells=null,this._savedFromColumns=null,this._savedFromViewportCells=null,this._savedFromRowHeaderCells=null,this._savedFromRows=null,this._savedToColumnHeaderCells=null,this._savedToColumns=null,this._savedToViewportCells=null,this._savedToRowHeaderCells=null,this._savedToRows=null,this._savedAcitveRowViewportIndex=-2,this._savedAcitveColumnViewportIndex=-2,this._savedActiveRow=-1,this._savedActiveColumn=-1},nt.prototype.undo=function(n){var r=this._sheet,f,s,h,u,o,e,d,k,w;if(!r._isValidRange(this._dragDropExtent.fromRow,this._dragDropExtent.fromColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount()))return!1;if(!this._insert)if(!r._isValidRange(this._dragDropExtent.toRow,this._dragDropExtent.toColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount,this._sheet.getRowCount(),this._sheet.getColumnCount()))return!1;f=!1;if(this._insert){if(!(this._dragDropExtent.fromColumn>=0&&this._dragDropExtent.fromRow>=0))if(this._dragDropExtent.fromColumn<0){if(this._dragDropExtent.fromRow>=0){u=this._dragDropExtent.rowCount,k=this._dragDropExtent.fromRow,this._suspendInvalidate(n);try{this._copy?this._sheet.deleteRows(this._dragDropExtent.toRow,u):(o=this._dragDropExtent.toRow,e=this._dragDropExtent.fromRow,this._dragDropExtent.fromRow<this._dragDropExtent.toRow?o=this._dragDropExtent.toRow-u:e=this._dragDropExtent.fromRow+u,this._sheet.addRows(e,u),this._savedFromViewportCells&&(i.undoCellsInfo(this._sheet,this._savedFromViewportCells,e,0,t.SheetArea.viewport),f=!0),this._savedFromRowHeaderCells&&(i.undoCellsInfo(this._sheet,this._savedFromRowHeaderCells,e,0,t.SheetArea.rowHeader),f=!0),this._savedFromRows&&(i.undoRowsInfo(this._sheet,this._savedFromRows,e),f=!0),f||this._sheet.copyTo(e<=o?o+u:o,-1,e,-1,u,-1,this._option),this._sheet.deleteRows(e<=o?o+u:o,u),o<e&&(k=e-u))}finally{this._resumeInvalidate(n)}r&&(s=r.getSelections().toArray(),r._clearSelectionImp(),r.addSelection(k,-1,u,r.getColumnCount()),h=r.getSelections(),r._trigger(t.Events.SelectionChanging,{sheet:r,sheetName:r._name,oldSelections:s,newSelections:h}),r._trigger(t.Events.SelectionChanged,{sheet:r,sheetName:r._name}),r.invalidateLayout(),r.repaint()),f=!0}}else{d=this._dragDropExtent.fromColumn,u=this._dragDropExtent.columnCount,this._suspendInvalidate(n);try{this._copy?this._sheet.deleteColumns(this._dragDropExtent.toColumn,u):(o=this._dragDropExtent.toColumn,e=this._dragDropExtent.fromColumn,this._dragDropExtent.fromColumn<this._dragDropExtent.toColumn?o=this._dragDropExtent.toColumn-u:e=this._dragDropExtent.fromColumn+u,this._sheet.addColumns(e,u),this._sheet.copyTo(-1,e<=o?o+u:o,-1,e,-1,u,this._option),this._sheet.deleteColumns(e<=o?o+u:o,u),o<e&&(d=e-u))}finally{this._resumeInvalidate(n)}r&&(s=r.getSelections().toArray(),r._clearSelectionImp(),r.addSelection(-1,d,r.getRowCount(),u),h=r.getSelections(),r._trigger(t.Events.SelectionChanging,{sheet:r,sheetName:r._name,oldSelections:s,newSelections:h}),r._trigger(t.Events.SelectionChanged,{sheet:r,sheetName:r._name}),r.invalidateLayout(),r.repaint()),f=!0}}else{var a=this._dragDropExtent.fromRow<0?0:this._dragDropExtent.fromRow,c=this._dragDropExtent.fromColumn<0?0:this._dragDropExtent.fromColumn,l=this._dragDropExtent.toRow<0?0:this._dragDropExtent.toRow,v=this._dragDropExtent.toColumn<0?0:this._dragDropExtent.toColumn,y=this._dragDropExtent.fromRow<0?this._sheet.getRowCount():this._dragDropExtent.rowCount,p=this._dragDropExtent.fromColumn<0?this._sheet.getColumnCount():this._dragDropExtent.columnCount,g=null,b=null;!this._copy&&this._savedFromViewportCells&&this._savedFromViewportCells.isValueSaved()&&(b=i.getValues(this._sheet,a,c,y,p)),this._savedToViewportCells&&this._savedToViewportCells.isValueSaved()&&(g=i.getValues(this._sheet,l,v,y,p)),this._suspendInvalidate(n);try{this._savedToColumnHeaderCells&&(i.undoCellsInfo(this._sheet,this._savedToColumnHeaderCells,0,v,t.SheetArea.colHeader),f=!0),this._savedToColumns&&(i.undoColumnsInfo(this._sheet,this._savedToColumns,v),f=!0),this._savedToViewportCells&&(i.undoCellsInfo(this._sheet,this._savedToViewportCells,l,v,t.SheetArea.viewport),f=!0),this._savedToRowHeaderCells&&(i.undoCellsInfo(this._sheet,this._savedToRowHeaderCells,l,0,t.SheetArea.rowHeader),f=!0),this._savedToRows&&(i.undoRowsInfo(this._sheet,this._savedToRows,l),f=!0),this._savedFromColumnHeaderCells&&(i.undoCellsInfo(this._sheet,this._savedFromColumnHeaderCells,0,c,t.SheetArea.colHeader),f=!0),this._savedFromColumns&&(i.undoColumnsInfo(this._sheet,this._savedFromColumns,c),f=!0),this._savedFromViewportCells&&(i.undoCellsInfo(this._sheet,this._savedFromViewportCells,a,c,t.SheetArea.viewport),f=!0),this._savedFromRowHeaderCells&&(i.undoCellsInfo(this._sheet,this._savedFromRowHeaderCells,a,0,t.SheetArea.rowHeader),f=!0),this._savedFromRows&&(i.undoRowsInfo(this._sheet,this._savedFromRows,a),f=!0)}finally{this._resumeInvalidate(n)}f&&r&&(s=r.getSelections().toArray(),r._clearSelectionImp(),r.addSelection(this._dragDropExtent.fromRow,this._dragDropExtent.fromColumn,this._dragDropExtent.rowCount,this._dragDropExtent.columnCount),h=r.getSelections(),r._trigger(t.Events.SelectionChanging,{sheet:r,sheetName:r._name,oldSelections:s,newSelections:h}),r._trigger(t.Events.SelectionChanged,{sheet:r,sheetName:r._name}),g&&i.raiseRangeDataChanged(r,l,v,y,p,g),b&&i.raiseRangeDataChanged(r,a,c,y,p,b))}return f&&r&&(this._savedActiveRow!==-1&&this._savedActiveColumn!==-1&&(w=r.getSelections()[0],w.contains(this._savedActiveRow,this._savedActiveColumn)?r._setActiveCellImp(this._savedActiveRow,this._savedActiveColumn,!1):r._setActiveCellImp(Math.max(r._getFirstVisualRow(),w.row),Math.max(r._getFirstVisualColumn(),w.col),!1)),this._savedAcitveRowViewportIndex!==-2&&this._savedAcitveColumnViewportIndex!==-2&&this._savedActiveRow!==-1&&this._savedActiveColumn!==-1&&r.showCell(this._savedActiveRow,this._savedActiveColumn,t.VerticalPosition.nearest,t.HorizontalPosition.nearest),r.invalidateLayout(),r.repaint()),f},y.prototype.canExecute=function(n){return!0},y.prototype.saveState=function(){var n=this._sheet.getFormula(this._cellEditInfo.row,this._cellEditInfo.col);n===null||n===""?(this._oldValue=this._sheet.getValue(this._cellEditInfo.row,this._cellEditInfo.col),this._oldValueIsFormula=!1):(this._oldValue=n,this._oldValueIsFormula=!0)},y.prototype.undo=function(n){var i=this._sheet,u=this._cellEditInfo.row,r=this._cellEditInfo.col,f;try{return this._suspendInvalidate(n),i._bind(t.Events.CellChanged,function(n,r){r.propertyName==="value"&&i._trigger(t.Events.ValueChanged,{sheet:r.sheet,sheetName:r.sheetName,row:r.row,col:r.col,oldValue:r._oldValue,newValue:r.sheet.getValue(r.row,r.col),sheetArea:r.sheetArea})}),this._oldValueIsFormula?i.setFormula(u,r,this._oldValue):(f=i.getFormula(u,r),f===null||f===""||i.setFormula(u,r,null),i.setValue(u,r,this._oldValue)),this._resumeInvalidate(n),this._sheet.repaint(),!0}catch(e){return!1}finally{i._unbind(t.Events.CellChanged)}},y.prototype.execute=function(n){this._suspendInvalidate(n),this.saveState();var i=this._sheet,r=i.isPaintSuspended();try{i.isPaintSuspended(!0),i._bind(t.Events.CellChanged,function(n,r){r.propertyName==="value"&&i._trigger(t.Events.ValueChanged,{sheet:r.sheet,sheetName:r.sheetName,row:r.row,col:r.col,oldValue:r._oldValue,newValue:r.sheet.getValue(r.row,r.col),sheetArea:r.sheetArea})}),this.applyResult=this._applyEditing(n)}finally{this._sheet._unbind(t.Events.CellChanged),this._resumeInvalidate(n),i.isPaintSuspended(r)}this._canUndo=this.applyResult===t.DataValidationResult.ForceApply},y.prototype._applyEditing=function(n){var i=this._sheet,u=this._cellEditInfo.row,r=this._cellEditInfo.col,f=this._cellEditInfo.newValue,o=t.DataValidationResult.ForceApply,e,h,s,l,c,a;f&&f.length>0&&f[0]==="="?i.getDataValidator(u,r)&&(h=f.substring(1),h!==""&&h!==i.getFormula(u,r)&&(s=i.getCalcService(),s&&(l=s.parse(h,u>=0?u:0,r>=0?r:0),l&&(c=s.evaluateParsedFormula(i._getSheetSource(),l,u,r),i.isValid(u,r,c)||(o=i._validationError(u,r,c)))))):(e=this._getValueFromEditing(u,r,f),a=i.isValid(u,r,e),a||(o=i._validationError(u,r,f),i._eventHandler._forceCancelSelectiong=!0));if(!(o===t.DataValidationResult.Discard||o===t.DataValidationResult.Retry))if(o===t.DataValidationResult.ForceApply)if(f&&f.length>0&&f[0]==="="){try{i.setFormula(u,r,f.substring(1))}catch(y){i._trigger(t.Events.InvalidOperation,{sheet:i,sheetName:i._name,innerException:y});throw y;}i._trigger(t.Events.UserFormulaEntered,{sheet:i,sheetName:i._name,row:u,col:r,formula:f.substring(1).toUpperCase()})}else{i.hasFormula(u,r)&&i.setFormula(u,r,null);try{/^('=)/ig.test(f)&&(f=f.substring(1)),(e===undefined||e===null)&&(e=this._getValueFromEditing(u,r,f)),i.setValue(u,r,e)}catch(v){i.setValue(u,r,f)}}return o},y.prototype.canUndo=function(n){return this._canUndo},y.prototype._getValueFromEditing=function(n,i,r){var u=null,c=this._sheet.getActualStyle(n,i),s,h,f,e,o;c&&(c.formatter?(u=c.formatter,typeof u=="string"&&(u=new t.GeneralFormatter(u),this._sheet._editingTimeValue&&(u=new t.GeneralFormatter("yyyy/mm/dd hh:mm:ss")))):u=c._autoFormatter);if(!u||u instanceof t.AutoFormatter){h={},f=null;try{f=(new t.GeneralFormatter).GetPreferredDisplayFormatter(r,h)}catch(l){}return e=null,u&&u instanceof t.AutoFormatter&&h.value!==null&&f.FormatString()!=="General"?e=new t.AutoFormatter(f):u||(e=new t.AutoFormatter(f)),e&&(o=this._sheet.getStyle(n,i),o||(o=new t.Style),o._autoFormatter=e,this._sheet.setStyle(n,i,o)),h.value!==null?h.value:r}else{s=null;try{s=u.Parse(r)}catch(l){}return s===undefined||s===null?r:s}},d.prototype.canUndo=function(){return!!this._oldName},d.prototype.canExecute=function(n){return this._sheet&&this._newName&&this._newName!==this._oldName},d.prototype.execute=function(n){var t=this._sheet;t&&this._newName&&this._newName!==this._oldName&&(this.saveState(),this._suspendInvalidate(n),t._name=this._newName,this._resumeInvalidate(n),t._refreshTabStrip())},d.prototype.canUndo=function(){return!!this._oldName},d.prototype.saveState=function(){this._sheet&&(this._oldName=this._sheet._name)},d.prototype.undo=function(n){var t=this._sheet;return t?(this._suspendInvalidate(n),t._name=this._oldName,this._resumeInvalidate(n),t._refreshTabStrip(),!0):!1},tt.prototype.canExecute=function(n){return this._sheet&&this._sheet.parent._allowUserZoom&&this._sheet._zoomFactor!==this._zoomFactor},tt.prototype.execute=function(n){var t=this._sheet;this.saveState(),t&&(!t.parent||t.parent._allowUserZoom===!0)&&t._zoomFactor!==this._zoomFactor&&(t._isEditing===!0&&t.endEdit(),this._suspendInvalidate(n),t.zoom(this._zoomFactor),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint())},tt.prototype.canUndo=function(){return this._sheet&&this._prevZoomFactor>0},tt.prototype.saveState=function(){this._sheet&&(this._prevZoomFactor=this._sheet._zoomFactor)},tt.prototype.undo=function(n){var t=this._sheet;return t?(this._suspendInvalidate(n),t.zoom(this._prevZoomFactor),this._resumeInvalidate(n),t.invalidateLayout(),t.repaint(),!0):!1},v.prototype.canExecute=function(n){var t,i;if(this._cachedActions){for(t=0;t<this._cachedActions.length;t++){i=this._cachedActions[t];if(!i.canExecute(n))return!1}return!0}return!1},v.prototype.execute=function(n){var t,i;this.saveState();if(this._cachedActions){for(this._suspendInvalidate(n),t=0;t<this._cachedActions.length;t++)i=this._cachedActions[t],i.execute(n);this._resumeInvalidate(n),this._sheet.repaint()}},v.prototype.canUndo=function(){var n,t;if(this._cachedActions){for(n=0;n<this._cachedActions.length;n++){t=this._cachedActions[n];if(!t.canUndo())return!1}return!0}return!1},v.prototype.saveState=function(){var n,t;if(this._cachedActions)for(n=0;n<this._cachedActions.length;n++)t=this._cachedActions[n],t.saveState()},v.prototype.undo=function(n){var t,r,i;if(this._cachedActions){for(t=this._cachedActions.length-1;t>=0;t--){r=this._cachedActions[t],this._suspendInvalidate(n),i=r.undo(n),this._resumeInvalidate(n);if(i)this._sheet.repaint();else return!1}return!0}return!1},it.prototype.execute=function(n){var r,u,f;this.saveState(),r=this._sheet;if(r){u=r._getActualRange(this._clearRange);if(u.colCount>0&&u.rowCount>0)try{r._bind(t.Events.CellChanged,function(n,i){i.propertyName==="value"&&r._trigger(t.Events.ValueChanged,{sheet:i.sheet,sheetName:i.sheetName,row:i.row,col:i.col,sheetArea:i.sheetArea})}),f=r.isPaintSuspended(),r.isPaintSuspended(!0),r.suspendEvent(),r.clear(u.row,u.col,u.rowCount,u.colCount,t.SheetArea.viewport,pt.Data),r.resumeEvent(),r.isPaintSuspended(f),r.repaint(),i.raiseRangeDataChanged(r,u.row,u.col,u.rowCount,u.colCount)}finally{this._sheet._unbind(t.Events.CellChanged)}}},it.prototype.canExecute=function(n){var t=this._sheet;return t.isProtected===!0&&t._isAnyCellInRangeLocked(this._clearRange)?!1:!0},it.prototype.canUndo=function(){return!!this._cachedValues},it.prototype.saveState=function(){var u=this._sheet,n,i,r,h,l,f,t,e,s,o,c;if(u){this._cachedFilteredColumns=[],n=u.rowFilter();if(n&&n.range&&n.isFiltered()){i=n.range.row,h=n.range.rowCount,n.showFilterButton&&(i=n.range.row-1,h=n.range.rowCount+1,i<0&&(i=-1,h=-1));if((this._clearRange.row===-1||this._clearRange.row<=i&&i+h<=this._clearRange.row+this._clearRange.rowCount)&&(this._clearRange.col===-1||this._clearRange.col<=n.range.col&&n.range.col+n.range.colCount<=this._clearRange.col+this._clearRange.colCount))for(r=n.range.col<0?0:n.range.col,l=n.range.colCount<0?u.getColumnCount():n.range.colCount,f=0;f<l;f++)n.isColumnFiltered(r+f)&&this._cachedFilteredColumns.push(r+f)}t=u._getActualRange(this._clearRange);if(t.colCount>0&&t.rowCount>0)for(this._cachedValues=[t.row+t.rowCount],e=0;e<t.rowCount;e++)for(this._cachedValues[t.row+e]=[t.col+t.colCount],s=0;s<t.colCount;s++)i=t.row+e,r=t.col+s,o=u.getFormula(i,r),o&&o!==""?this._cachedValues[i][r]=new bt(o,!0):(c=u.getValue(i,r),c!==undefined&&c!==null&&(this._cachedValues[i][r]=new bt(c,!1)))}},it.prototype.undo=function(n){var r=this._sheet,l,o,u,s,f,e,h,c,a;if(r){l=!1,u=r._getActualRange(this._clearRange);if(this._cachedValues&&u.colCount>0&&u.rowCount>0)try{r._bind(t.Events.CellChanged,function(n,i){i.propertyName==="value"&&r._trigger(t.Events.ValueChanged,{sheet:i.sheet,sheetName:i.sheetName,row:i.row,col:i.col,sheetArea:i.sheetArea})});var y=u.rowCount,v=u.colCount,p=r.isPaintSuspended();for(r.isPaintSuspended(!0),r.suspendEvent(),o=0;o<y;o++)for(s=0;s<v;s++)f=u.row+o,e=u.col+s,this._cachedValues[f][e]?(h=this._cachedValues[f][e],h.isFormula?r.setFormula(f,e,h.value):(r.setFormula(f,e,null),r.setValue(f,e,h.value))):(r.setFormula(f,e,null),r.setValue(f,e,null));r.resumeEvent(),r.isPaintSuspended(p),i.raiseRangeDataChanged(r,u.row,u.col,u.rowCount,u.colCount),l=!0}finally{r._unbind(t.Events.CellChanged)}c=r.rowFilter();if(c&&this._cachedFilteredColumns&&this._cachedFilteredColumns.length>0)for(o=0;o<this._cachedFilteredColumns.length;o++)a=this._cachedFilteredColumns[o],c.filter(a);if(l)return r.repaint(),!0}return!1},u.prototype.canExecute=function(n){return this._dragFillExtent.autoFillType===l.ClearValues?this.canExecuteDragClear():this.canExecuteDragFill()},u.prototype.canExecuteDragClear=function(){return!0},u.prototype.canExecuteDragFill=function(){var n=this._dragFillExtent.startRange,t=this._dragFillExtent.fillRange;return!t.intersect(n.row,n.col,n.rowCount,n.colCount)},u.prototype.execute=function(n){if(this.canExecute(n)){var t=this._workSheet;try{this._suspendInvalidate(t),t.suspendCalcService(),this.saveState(),this._execute(t)}finally{t.resumeCalcService(),this._resumeInvalidate(t)}t.invalidateLayout(),t.repaint()}},u.prototype._execute=function(n){var t=this._workSheet,f=t.getSelections()?t.getSelections().toArray():null,r,u;this._dragFillExtent.autoFillType===l.ClearValues?this.executeDragFillClear(n):this.executeDragFill(n),this._savedFilledViewportCells&&this._savedFilledViewportCells.isValueSaved()&&n===this._workSheet&&(r=this._dragFillExtent.fillRange,i.raiseRangeDataChanged(n,r.row,r.col,r.rowCount,r.colCount,this._savedFilledViewportCells.getValues())),u=t.getSelections()?t.getSelections().toArray():null,t._raiseSelectionChanging(f,u)&&t._raiseSelectionChanged()},u.prototype.executeDragFillClear=function(n){var r,u,i;this._clearValueUndoAction.execute(n),r=this._dragFillExtent.startRange,u=this._dragFillExtent.fillRange,r.equals(u)||(this._fillSeries===ct.Column?(i=new t.Range(r.row,r.col,Math.max(1,r.rowCount-u.rowCount),r.colCount),n._setActiveCellImp(Math.max(n._getFirstVisualRow(),i.row),Math.max(n._getFirstVisualColumn(),i.col),n.activeRowViewportIndex,n.activeColViewportIndex),n._clearSelectionImp(),n.addSelection(i.row,i.col,i.rowCount,i.colCount)):(i=new t.Range(r.row,r.col,r.rowCount,Math.max(1,r.colCount-u.colCount)),n._setActiveCellImp(Math.max(n._getFirstVisualRow(),i.row),Math.max(n._getFirstVisualColumn(),i.col),n.activeRowViewportIndex,n.activeColViewportIndex),n._clearSelectionImp(),n.addSelection(i.row,i.col,i.rowCount,i.colCount)))},u.prototype.executeDragFill=function(n){var s=this._workSheet,r=this._dragFillExtent.startRange,h=this._dragFillExtent.fillRange,o,e,c,v,y,u,a;if(this._dragFillExtent.autoFillType===l.FillSeries)this.clearData(h),c=this._dragFillExtent.fillDirection===f.Down||this._dragFillExtent.fillDirection===f.Right,c?s.fillAuto(r,this._wholeFillRange,this._fillSeries):s.fillLinear(r,this._wholeFillRange,this._fillSeries);else if(this._dragFillExtent.autoFillType===l.CopyCells)this.copyCells(r,h,t.CopyToOption.All);else if(this._dragFillExtent.autoFillType===l.FillFormattingOnly)this.copyCells(r,h,t.CopyToOption.Style);else if(this._dragFillExtent.autoFillType===l.FillWithoutFormatting){this.clearData(h),v=r.rowCount===1&&r.colCount===1&&!(r.row===-1&&r.col!==-1)&&!(r.col===-1&&r.row!==-1);if(v)y=t.CopyToOption.Formula|t.CopyToOption.RangeGroup|t.CopyToOption.Span|t.CopyToOption.Sparkline|t.CopyToOption.Tag|t.CopyToOption.Value,this.copyCells(r,h,y);else{for(u=this.adjustRange(this._wholeFillRange),a=new t._GcSheetModel(u.rowCount,u.colCount,null),o=0;o<u.rowCount;o++)for(e=0;e<u.colCount;e++)a.setStyle(o,e,i.getStyleObject(this._workSheet,u.row+o,u.col+e,t.SheetArea.viewport));for(c=this._dragFillExtent.fillDirection===f.Down||this._dragFillExtent.fillDirection===f.Right,c?s.fillAuto(r,this._wholeFillRange,this._fillSeries):s.fillLinear(r,this._wholeFillRange,this._fillSeries),o=0;o<u.rowCount;o++)for(e=0;e<u.colCount;e++)i.setStyleObject(this._workSheet,u.row+o,u.col+e,t.SheetArea.viewport,a.getStyle(o,e))}}s._setActiveCellImp(Math.max(n._getFirstVisualRow(),this._wholeFillRange.row),Math.max(n._getFirstVisualColumn(),this._wholeFillRange.col),n.activeRowViewportIndex,n.activeColViewportIndex),n._selectionModel&&n._clearSelectionImp(),s.addSelection(this._wholeFillRange.row,this._wholeFillRange.col,this._wholeFillRange.rowCount,this._wholeFillRange.colCount)},u.prototype.clearData=function(n){var i=pt.Data;this._workSheet.clear(n.row,n.col,n.rowCount,n.colCount,t.SheetArea.viewport,i)},u.prototype.adjustRange=function(n){var u=n.row!==-1?n.row:0,f=n.col!==-1?n.col:0,i=n.rowCount!==-1?n.rowCount:this._workSheet.getRowCount(),r=n.colCount!==-1?n.colCount:this._workSheet.getColumnCount();return new t.Range(u,f,i,r)},u.prototype.copyCells=function(n,t,i){var p=this._workSheet,r=this.adjustRange(n),u=this.adjustRange(t),s,c,h,e,o,b,l,a,y,k,nt,v,tt,w,g,d;if(this._fillSeries===ct.Column){for(y=Math.floor(u.rowCount/r.rowCount),s=0;s<y;s++)c=r.row,h=r.col,this._dragFillExtent.fillDirection===f.Down?e=u.row+s*r.rowCount:(b=u.row+u.rowCount,e=b-(s+1)*r.rowCount),o=u.col,l=r.rowCount,a=r.colCount,p.copyTo(c,h,e,o,l,a,i);k=u.rowCount%r.rowCount,k!==0&&(this._dragFillExtent.fillDirection===f.Down?c=r.row:(nt=r.rowCount-(u.rowCount-r.rowCount*y),c=r.row+nt),h=r.col,this._dragFillExtent.fillDirection===f.Down?e=u.row+r.rowCount*y:(b=u.row+u.rowCount,e=b-y*r.rowCount-k),o=u.col,l=k,a=r.colCount,p.copyTo(c,h,e,o,l,a,i))}else{for(v=Math.floor(u.colCount/r.colCount),s=0;s<v;s++)c=r.row,h=r.col,e=u.row,this._dragFillExtent.fillDirection===f.Right?o=u.col+s*r.colCount:(tt=u.col+u.colCount,o=tt-(s+1)*r.colCount),l=r.rowCount,a=r.colCount,p.copyTo(c,h,e,o,l,a,i);w=u.colCount%r.colCount,w!==0&&(c=r.row,this._dragFillExtent.fillDirection===f.Right?h=r.col:(g=r.colCount-(u.colCount-r.colCount*v),h=r.col+g),e=u.row,this._dragFillExtent.fillDirection===f.Right?o=u.col+r.colCount*v:(d=u.col+u.colCount,o=d-v*r.colCount-w),l=r.rowCount,a=w,p.copyTo(c,h,e,o,l,a,i))}},u.prototype.saveState=function(){this._dragFillExtent.AutoFillType===l.ClearValues?this.saveDragClearState():this.saveDragFillState()},u.prototype.saveDragClearState=function(){this._clearValueUndoAction.saveState()},u.prototype.saveDragFillState=function(){this._savedFilledViewportCells=this.saveRangeStates(this._dragFillExtent.fillRange),this._savedStartViewportCells=this.saveRangeStates(this._dragFillExtent.startRange)},u.prototype.saveRangeStates=function(n){var r=this.adjustRange(n),u=new e(r.rowCount,r.colCount);return i.saveViewportInfo(this._workSheet,u,r.row,r.col,t.CopyToOption.All),u},u.prototype.undo=function(n){var i=this._workSheet,t=!1;try{t=this._undo(i)}finally{this._workSheet.resumeCalcService(),this._resumeInvalidate(i)}return t},u.prototype._undo=function(n){var u,e=n.getSelections()?n.getSelections().toArray():null,r=null,t=this._dragFillExtent.fillRange,f;return this._savedFilledViewportCells&&this._savedFilledViewportCells.isValueSaved()&&(r=i.getValues(this._workSheet,t.row,t.col,t.rowCount,t.colCount)),u=this._dragFillExtent.autoFillType===l.ClearValues?this.undoDragClear(n):this.undoDragFill(n),n._skipCloseDragFillSmartTag!==!0&&n._closeDragFillPopup(),r&&i.raiseRangeDataChanged(n,t.row,t.col,t.rowCount,t.colCount,r),f=n.getSelections()?n.getSelections().toArray():null,n._raiseSelectionChanging(e,f)&&n._raiseSelectionChanged(),n.repaint(),u},u.prototype.undoDragClear=function(n){var t=this._clearValueUndoAction.undo(n);return n._setActiveCellImp(Math.max(n._getFirstVisualRow(),this._dragFillExtent.startRange.row),Math.max(n._getFirstVisualColumn(),this._dragFillExtent.startRange.col),n.activeRowViewportIndex,n.activeColViewportIndex),n._clearSelectionImp(),n.addSelection(this._dragFillExtent.startRange.row,this._dragFillExtent.startRange.col,this._dragFillExtent.startRange.rowCount,this._dragFillExtent.startRange.colCount),t},u.prototype.undoDragFill=function(n){this._suspendInvalidate(n),n.suspendCalcService();try{this.undoRangeStates(this._savedFilledViewportCells,this._dragFillExtent.fillRange),this.undoRangeStates(this._savedStartViewportCells,this._dragFillExtent.startRange),n._setActiveCellImp(Math.max(n._getFirstVisualRow(),this._dragFillExtent.startRange.row),Math.max(n._getFirstVisualColumn(),this._dragFillExtent.startRange.col),n.activeRowViewportIndex,n.activeColViewportIndex),n._clearSelectionImp(),n.addSelection(this._dragFillExtent.startRange.row,this._dragFillExtent.startRange.col,this._dragFillExtent.startRange.rowCount,this._dragFillExtent.startRange.colCount)}finally{n.resumeCalcService(),this._resumeInvalidate(n)}return n.invalidateLayout(),!0},u.prototype.undoRangeStates=function(n,r){var u=this.adjustRange(r);i.undoCellsInfo(this._workSheet,n,u.row,u.col,t.SheetArea.viewport)},u.prototype.initWholeFilledRange=function(){var u=0,e=0,o=0,s=0,i=this._dragFillExtent.fillDirection,n=this._dragFillExtent.startRange,r=this._dragFillExtent.fillRange;i===f.Left||i===f.Right?(u=n.row,e=n.rowCount,o=i===f.Left?r.col:n.col,s=n.colCount+r.colCount):(u=i===f.Up?r.row:n.row,e=n.rowCount+r.rowCount,o=n.col,s=n.colCount),this._wholeFillRange=new t.Range(u,o,e,s)},h.prototype.execute=function(n){var r,i,t,u;if(this._cachedActions){for(r=this._sheet,i=0;i<this._cachedActions.length;i++)t=this._cachedActions[i],r?(u=r._raiseClipboardPasting(t.pasteRange(),t.pasteOption()),u||(t.execute(n),r._raiseClipboardPasted(t.pasteRange(),t.pasteOption()))):t.execute(n);this.refreshSelection(n),this.refreshUI(n)}},h.prototype.refreshSelection=function(n){var t=this._sheet,f,u,e,r,i;if(t)if(this._cachedActions){f=t.getSelections().toArray(),t._clearSelectionImp();if(this._cachedActions.length>1)for(u=0;u<this._cachedActions.length;u++)e=this._cachedActions[u],r=e.pasteRange(),t.addSelection(r.row,r.col,r.rowCount,r.colCount);else this._cachedActions.length>0&&(i=this._cachedActions[0].pasteRange(),t.addSelection(i.row,i.col,i.rowCount,i.colCount),i.contains(t._activeRowIndex,t._activeColIndex)||t._setActiveCellImp(Math.max(t._getFirstVisualRow(),i.row),Math.max(t._getFirstVisualColumn(),i.col),t.activeRowViewportIndex,t.activeColViewportIndex));t._raiseSelectionChanging(f,t.getSelections().toArray())&&t._raiseSelectionChanged()}},h.prototype.refreshUI=function(n){var t=this._sheet;t&&(t.invalidateLayout(),t.repaint())},h.prototype.canExecute=function(n){var t,i;if(this._cachedActions){for(t=0;t<this._cachedActions.length;t++){i=this._cachedActions[t];if(!i.canExecute(n))return!1}return!0}return!1},h.prototype.canUndo=function(){var n,t;if(this._cachedActions){for(n=0;n<this._cachedActions.length;n++){t=this._cachedActions[n];if(!t.canUndo())return!1}return!0}return!1},h.prototype.saveState=function(){var n,t;if(this._cachedActions)for(n=0;n<this._cachedActions.length;n++)t=this._cachedActions[n],t.saveState()},h.prototype.undo=function(n){var i,t,r;if(this._cachedActions){for(i=!0,t=0;t<this._cachedActions.length;t++)r=this._cachedActions[t],i&=r.undo(n);return this.refreshUI(n),i}return!1},o.prototype.canUndo=function(){return!0},o.prototype.canExecute=function(n){return!0},o.prototype.saveState=function(){var b,g,nt,k,h,c,l,y,p,a,v,tt;this.initSaveState();var et=this._pasteExtent.isCutting,u=o.convertPasteOption(this._pasteOption),n=this._pasteExtent.sourceRange,r=this._pasteExtent.targetRange;if(this._fromSheet&&n&&et){var it=n.row<0?0:n.row,rt=n.col<0?0:n.col,d=n.row<0?this._fromSheet.getRowCount():n.rowCount,w=n.col<0?this._fromSheet.getColumnCount():n.colCount;n.row<0&&n.col<0&&r.row<0&&r.col<0&&this._fromSheet._name!==this._toSheet._name&&(b=new wt,i.saveSheetInfo(this._fromSheet,b,u),this._savedFromSheetInfo=b),n.row<0&&(g=new e(this._fromSheet.getRowCount(t.SheetArea.colHeader),w),nt=new at(w),i.saveColumnHeaderInfo(this._fromSheet,g,nt,rt,u),this._savedFromColumnHeaderCells=g,this._savedFromColumns=nt),n.col<0&&(k=new e(d,this._fromSheet.getColumnCount(t.SheetArea.rowHeader)),h=new lt(d),i.saveRowHeaderInfo(this._fromSheet,k,h,it,u),this._savedFromRowHeaderCells=k,this._savedFromRows=h),c=new e(d,w),i.saveViewportInfo(this._fromSheet,c,it,rt,u),this._savedFromViewportCells=c}var ft=r.row<0?0:r.row,ut=r.col<0?0:r.col,f=r.row<0?this._toSheet.getRowCount():r.rowCount,s=r.col<0?this._toSheet.getColumnCount():r.colCount;this._fromSheet&&n&&(n.row<0&&n.col<0&&r.row<0&&r.col<0&&this._fromSheet._name!==this._toSheet._name&&(l=new wt,i.saveSheetInfo(this._toSheet,l,u),this._savedToSheetInfo=l),n.row<0&&(y=new e(this._toSheet.getRowCount(t.SheetArea.colHeader),s),p=new at(s),i.saveColumnHeaderInfo(this._toSheet,y,p,ut,u),this._savedToColumnHeaderCells=y,this._savedToColumns=p),n.col<0&&(a=new e(f,this._toSheet.getColumnCount(t.SheetArea.rowHeader)),v=new lt(f),i.saveRowHeaderInfo(this._toSheet,a,v,ft,u),this._savedToRowHeaderCells=a,this._savedToRows=v)),tt=new e(f,s),i.saveViewportInfo(this._toSheet,tt,ft,ut,u),this._savedToViewportCells=tt},o.prototype.initSaveState=function(){this._savedFromSheetInfo=null,this._savedFromColumnHeaderCells=null,this._savedFromColumns=null,this._savedFromViewportCells=null,this._savedFromRowHeaderCells=null,this._savedFromRows=null,this._savedToSheetInfo=null,this._savedToColumnHeaderCells=null,this._savedToColumns=null,this._savedToViewportCells=null,this._savedToRowHeaderCells=null,this._savedToRows=null},o.prototype.pasteOption=function(){return this._pasteOption},o.prototype.pasteRange=function(){return this._pasteExtent.targetRange},o.prototype.execute=function(n){var r=this._pasteExtent.sourceRange,t=this._pasteExtent.targetRange,u;if(this._fromSheet&&r&&!this._fromSheet._isValidRange(r.row,r.col,r.rowCount,r.colCount,this._fromSheet.getRowCount(),this._fromSheet.getColumnCount()))return;if(!this._toSheet||!t)return;if(!this._toSheet._isValidRange(t.row,t.col,t.rowCount,t.colCount,this._toSheet.getRowCount(),this._toSheet.getColumnCount()))return;this.saveState(),this._suspendInvalidate(n);try{this._toSheet._clipboardPaste(this._fromSheet,r,this._toSheet,t,this._pasteExtent.isCutting,this._pasteExtent.clipboardText,this._pasteOption),u=this._sheet,u&&(this._pasteExtent.isCutting&&this._savedFromViewportCells&&this._savedFromViewportCells.isValueSaved()&&this._fromSheet&&i.raiseRangeDataChanged(this._fromSheet,r.row,r.col,r.rowCount,r.colCount,this._savedFromViewportCells.getValues()),this._savedToViewportCells&&this._savedToViewportCells.isValueSaved()&&this._toSheet&&i.raiseRangeDataChanged(this._toSheet,t.row,t.col,t.rowCount,t.colCount,this._savedToViewportCells.getValues()))}finally{this._resumeInvalidate(n)}},o.prototype.undo=function(n){var u=this._pasteExtent.sourceRange,f=this._pasteExtent.targetRange,r,y;if(!this._toSheet||!f)return!1;if(!this._toSheet._isValidRange(f.row,f.col,f.rowCount,f.colCount,this._toSheet.getRowCount(),this._toSheet.getColumnCount()))return!1;if(this._fromSheet&&u){if(!this._fromSheet._isValidRange(u.row,u.col,u.rowCount,u.colCount,this._fromSheet.getRowCount(),this._fromSheet.getColumnCount()))return!1;if(this._fromSheet&&this._fromSheet._name===this._toSheet._name&&this._toSheet.parent&&!this._toSheet.parent.sheets.contains(this._fromSheet))return!1}this._suspendInvalidate(n),r=!1;try{var c=null,v=null,h=f.row<0?0:f.row,s=f.col<0?0:f.col,p=f.row<0?this._toSheet.getRowCount():f.rowCount,w=f.col<0?this._toSheet.getColumnCount():f.colCount;this._savedToSheetInfo&&(i.undoSheetInfo(this._toSheet,this._savedToSheetInfo),r=!0),this._savedToViewportCells&&this._savedToViewportCells.isValueSaved()&&(c=i.getValues(this._toSheet,h,s,p,w)),this._savedToColumnHeaderCells&&(i.undoCellsInfo(this._toSheet,this._savedToColumnHeaderCells,0,s,t.SheetArea.colHeader),r=!0),this._savedToColumns&&(i.undoColumnsInfo(this._toSheet,this._savedToColumns,s),r=!0),this._savedToViewportCells&&(i.undoCellsInfo(this._toSheet,this._savedToViewportCells,h,s,t.SheetArea.viewport),r=!0),this._savedToRowHeaderCells&&(i.undoCellsInfo(this._toSheet,this._savedToRowHeaderCells,h,0,t.SheetArea.rowHeader),r=!0),this._savedToRows&&(i.undoRowsInfo(this._toSheet,this._savedToRows,h),r=!0);var e=0,o=0,l=0,a=0;this._fromSheet&&u&&(e=u.row<0?0:u.row,o=u.col<0?0:u.col,l=u.row<0?this._fromSheet.getRowCount():u.rowCount,a=u.col<0?this._fromSheet.getColumnCount():u.colCount,this._savedFromViewportCells&&this._savedFromViewportCells.isValueSaved()&&(v=i.getValues(this._fromSheet,e,o,l,a)),this._savedFromColumnHeaderCells&&(i.undoCellsInfo(this._fromSheet,this._savedFromColumnHeaderCells,0,o,t.SheetArea.colHeader),r=!0),this._savedFromColumns&&(i.undoColumnsInfo(this._fromSheet,this._savedFromColumns,o),r=!0),this._savedFromViewportCells&&(i.undoCellsInfo(this._fromSheet,this._savedFromViewportCells,e,o,t.SheetArea.viewport),r=!0),this._savedFromRowHeaderCells&&(i.undoCellsInfo(this._fromSheet,this._savedFromRowHeaderCells,e,0,t.SheetArea.rowHeader),r=!0),this._savedFromRows&&(i.undoRowsInfo(this._fromSheet,this._savedFromRows,e),r=!0)),y=n,r&&y&&(c&&this._toSheet&&i.raiseRangeDataChanged(this._toSheet,h,s,p,w,c),v&&this._fromSheet&&i.raiseRangeDataChanged(this._fromSheet,e,o,l,a,v))}finally{this._resumeInvalidate(n)}return r},o.convertPasteOption=function(n){var i=0;return(n===t.ClipboardPasteOptions.All||n===t.ClipboardPasteOptions.Values)&&(i|=t.CopyToOption.Value),(n===t.ClipboardPasteOptions.All||n===t.ClipboardPasteOptions.Formatting)&&(i|=t.CopyToOption.Style),(n===t.ClipboardPasteOptions.All||n===t.ClipboardPasteOptions.Formulas)&&(i|=t.CopyToOption.Formula),n===t.ClipboardPasteOptions.All&&(i|=t.CopyToOption.Span,i|=t.CopyToOption.Sparkline),i},wt.prototype={saveDefaultStyle:function(n){this._defaultStyle=n,this._defaultStyleSaved=!0},getDefaultStyle:function(){return this._defaultStyle},saveDefaultColumnWidth:function(n){this._defaultColumnWidth=n,this._defaultColumnWidthSaved=!0},getDefaultColumnWidth:function(){return this._defaultColumnWidth},saveDefaultRowHeight:function(n){this._defaultRowHeight=n,this._defaultRowHeightSaved=!0},getDefaultRowHeight:function(){return this._defaultRowHeight},saveColumnHeaderDefaultStyle:function(n){this._columnHeaderDefaultStyle=n,this._columnHeaderDefaultStyleSaved=!0},getColumnHeaderDefaultStyle:function(){return this._columnHeaderDefaultStyle},saveColumnHeaderDefaultRowHeight:function(n){this._columnHeaderDefaultRowHeight=n,this._columnHeaderDefaultRowHeightSaved=!0},getColumnHeaderDefaultRowHeight:function(){return this._columnHeaderDefaultRowHeight},saveRowHeaderDefaultStyle:function(n){this._rowHeaderDefaultStyle=n,this._rowHeaderDefaultStyleSaved=!0},getRowHeaderDefaultStyle:function(){return this._rowHeaderDefaultStyle},saveRowHeaderDefaultColumnWidth:function(n){this._rowHeaderDefaultColumnWidth=n,this._rowHeaderDefaultColumnWidthSaved=!0},getRowHeaderDefaultColumnWidth:function(){return this._rowHeaderDefaultColumnWidth},isDefaultStyleSaved:function(){return this._defaultStyleSaved},isDefaultColumnWidthSaved:function(){return this._defaultColumnWidthSaved},isDefaultRowHeightSaved:function(){return this._defaultRowHeightSaved},isColumnHeaderDefaultStyleSaved:function(){return this._columnHeaderDefaultStyleSaved},isColumnHeaderDefaultRowHeightSaved:function(){return this._columnHeaderDefaultRowHeightSaved},isRowHeaderDefaultStyleSaved:function(){return this._rowHeaderDefaultStyleSaved},isRowHeaderDefaultColumnWidthSaved:function(){return this._rowHeaderDefaultColumnWidthSaved}},t.CopyMoveCellsInfo=e,t.CopyMoveHelper=i,t.UndoRedo={DragDropExtent:kt,GroupExtent:gt,ActionBase:r,ColumnResizeUndoAction:k,RowResizeUndoAction:b,ColumnAutoFitUndoAction:w,RowAutoFitUndoAction:p,ColumnGroupUndoAction:st,ColumnUngroupUndoAction:rt,RowGroupUndoAction:ot,RowUngroupUndoAction:g,ColumnGroupExpandUndoAction:c,RowGroupExpandUndoAction:a,ColumnGroupHeaderExpandUndoAction:ut,RowGroupHeaderExpandUndoAction:ft,DragDropUndoAction:nt,CellEditUndoAction:y,SheetRenameUndoAction:d,ZoomUndoAction:tt,ClearValueUndoAction:v,DragFillUndoAction:u,ClipboardPasteUndoAction:h,ClipboardPasteRangeUndoAction:o}})(window);(function(n){"use strict";var u=n.GrapeCity,o,r,c,s;typeof u=="undefined"&&(u=n.GrapeCity={}),typeof u.UI=="undefined"&&(u.UI={});var t=u.UI.LineStyle,e={first:1,second:2},f=function(){};u.UI.Line=f,f.prototype={adjust:function(n){n.orientation===0?(n.offsetEnd&&(this._x2+=n.offsetEnd),n.offsetStart&&(this._x1+=n.offsetStart)):n.orientation===1&&(n.offsetEnd&&(this._y2+=n.offsetEnd),n.offsetStart&&(this._y1+=n.offsetStart))},paint:function(n){var i=!1,t;n.lineWidth!==this._lineWidth&&(i=!0),t=this._color?this._color:"#9EB6CE",n.strokeStyle!==t&&(i=!0),i&&(n.closePath(),n.stroke(),n.beginPath(),n.lineWidth=this._lineWidth,n.strokeStyle=t),this.paintLine(n)},paintLine:function(n){n.moveTo(this._x1,this._y1),n.lineTo(this._x2,this._y2)}},o=function(n,t,i,r,u,f){var e=f%2;e||(n!==i?(t-=.5,r-=.5):(n-=.5,i-=.5)),this._x1=n,this._y1=t,this._x2=i,this._y2=r,this._color=u,this._lineWidth=f},o.prototype=new f,r=function(n,t,i,r,u,f,e){var o=f%2;o||(n!==i?(t-=.5,r-=.5):(n-=.5,i-=.5)),this._x1=n,this._y1=t,this._x2=i,this._y2=r,this._color=u,this._lineWidth=f,this._pattern=e},r.prototype=new f,r.prototype.paintLine=function(n){r.render(n,this._x1,this._y1,this._x2,this._y2,this._pattern)},r.render=function(n,t,i,r,u,f){var o=Math.sqrt(Math.pow(r-t,2)+Math.pow(u-i,2)),c={x:(r-t)/o,y:(u-i)/o},h=0,l=0,e,s;f=f&&f.length?f:[4,4];while(h<o)e=Math.min(f[l++%f.length],o-h),s=l%2,h+=e,s&&n.moveTo(t,i),t+=e*c.x,i+=e*c.y,s&&n.lineTo(t,i)},c=function(n,t,i,r,u,f,e,o){f?(n-=1,i-=1):(t-=1,r-=1),this._x1=n,this._y1=t,this._x2=i,this._y2=r,this._color=u,this._horizental=f,this._lineWidth=1,this._pattern1=e,this._pattern2=o},c.prototype=new f,c.prototype.paintLine=function(n){var i=this._horizental?0:1,t=this._horizental?1:0;r.render(n,this._x1-i,this._y1-t,this._x2-i,this._y2-t,this._pattern1),r.render(n,this._x1,this._y1,this._x2,this._y2,this._pattern2)},s=function(n,t,i,r,u,f){var s=f?0:1,e=f?1:0;this._line1=new o(n-s,t-e,i-s,r-e,u,1),this._line2=new o(n+s,t+e,i+s,r+e,u,1),this._color=u,this._horizental=f,this._lineWidth=1},s.prototype=new f,s.prototype.paintLine=function(n){this._line1.paintLine(n),this._line2.paintLine(n)},s.prototype.adjust=function(n){n.lineSide?n.lineSide===e.first?this._line1.adjust(n):n.lineSide===e.second&&this._line2.adjust(n):(this._line1.adjust(n),this._line2.adjust(n))},f.Create=function(n,i,u,f,e,h){(h===undefined||h===null)&&(h=t.thin);switch(h){case t.thin:return new o(n,i,u,f,e,1);case t.medium:return new o(n,i,u,f,e,2);case t.thick:return new o(n,i,u,f,e,3);case t.dashed:return new r(n,i,u,f,e,1,[3,1]);case t.dashDot:return new r(n,i,u,f,e,1,[8,2,2,2]);case t.dotted:return new r(n,i,u,f,e,1,[2,2]);case t.dashDotDot:return new r(n,i,u,f,e,1,[9,3,3,3,3,3]);case t.slantedDashDot:return new c(n,i,u,f,e,n!==u,[11,1,5,1],[10,2,4,2]);case t.mediumDashDot:return new r(n,i,u,f,e,2,[9,3,3,3]);case t.mediumDashDotDot:return new r(n,i,u,f,e,2,[9,3,3,3,3,3]);case t.mediumDashed:return new r(n,i,u,f,e,2,[9,3]);case t.hair:return new r(n,i,u,f,e,1,[1]);case t.double:return new s(n,i,u,f,e,n!==u)}return null};var b=function(n,t){return 0},a=function(n,t){if(n){if(!t)return 1}else return t?-1:0;var r=u.UI.LineBorder.prototype._weight(n),i=u.UI.LineBorder.prototype._weight(t);return r===i?b(n.color,t.color):r-i},i=function(n){if(n){if(n.isGridLine)return 1;if(n.style)return u.UI.LineBorder.prototype.width(n.style)}return 0},l=function(n){return n&&n.style===t.double},p=function(n){return n&&n.style===t.slantedDashDot},h=function(){var n={previous:-1,next:1},f=function(n,t){if(n){if(!t)return n}else return t?t:null;return a(n.style,t.style)>0?n:t},r=function(n,t){n&&n.line&&n.line.adjust(t)},u=function(n,t){if(n===null||n===undefined)return t===null||t===undefined?0:-1;else if(t===null||t===undefined)return 1;else{if(n.isGridLine)return t.isGridLine?0:-1;else if(t.isGridLine)return 1;return a(n.style,t.style)}},t=function(n){return n&&l(n.style)},s=function(n,i,r,u){if(!t(n)){var f=0;return f+=t(i)?1:0,f+=t(r)?1:0,f+=t(u)?1:0,f<2}return!0},v=function(t,i,f,o,s,h){var c={orientation:h?1:0,offsetStart:0,offsetEnd:0},a=u(t,f),l=u(t,o);a<0||l<0?l<0?a<0||(c.lineSide=e.first,c.offsetStart+=s):(c.lineSide=e.second,c.offsetStart+=s):a===0&&l===0?s!==n.previous&&s===n.next&&(c.offsetEnd-=s):s===n.previous?c.offsetStart-=s:s===s.next&&(c.offsetEnd-=2*s),r(t,c)},o=function(f,o,s,h,c,l,a,v,y){var w={orientation:v?1:0,lineSide:y?e.second:e.first,offsetStart:0,offsetEnd:0},p={orientation:v?1:0,lineSide:y?e.first:e.second,offsetStart:0,offsetEnd:0},tt=l===1?h:c,k=a===n.next?s:o,ot=t(k),ut,rt,ft,it,g;ot?(ut=u(f,tt),ut===0?(rt=u(f,k),rt===0?a===n.next&&(p.offsetEnd-=a):rt>0&&(a===n.previous?p.offsetStart-=2*a:a===n.next&&(p.offsetEnd-=2*a))):ut>0?(ft=u(f,k),ft===0?a===n.next&&(p.offsetEnd-=a):ft>0&&(a===n.previous?p.offsetStart-=2*a:a===n.next&&(p.offsetEnd-=2*a))):(it=u(f,k),it===0?a===n.previous?w.offsetStart+=2*a:a===n.next&&(w.offsetEnd+=2*a):it>0&&(a===n.previous?w.offsetStart-=3*a:a===n.next&&(w.offsetEnd-=3*a)))):u(f,tt)<0?a===n.previous?w.offsetStart+=2*a:a===n.next&&(w.offsetEnd+=2*a):a===n.previous?p.offsetStart-=2*a:a===n.next&&(p.offsetEnd-=2*a);var et=l===1?2:1,d=et===1?h:c,nt=!1,b=0;!nt&&t(d)&&u(d,f)>0&&(nt=!0,g=i(d),u(d,tt)>0?g>0&&(b=a===n.next&&t(s)?g>=2?2:1:a===n.previous&&t(o)?g>=3?2:1:g===3?3:2):b=g===3?3:2),nt||t(k)||(!k||k.isGridLine)&&(!d||d.isGridLine)||(nt=!0,b=a===n.previous?2:1),nt&&(a===n.previous?(w.offsetStart+=a*b,p.offsetStart+=a*b):a===n.next&&(w.offsetEnd+=a*b,p.offsetEnd+=a*b)),(w.offsetStart||w.offsetEnd)&&r(f,w),(p.offsetStart||p.offsetEnd)&&r(f,p)},c=function(i,f,e,o,s,h){if(u(i,e)>=0&&u(i,o)>=0){var c={orientation:h?1:0,offsetStart:0,offsetEnd:0};s===n.previous?(c.offsetStart-=2*s,t(i)&&u(f,i)>0&&(c.offsetStart-=1)):s===n.next&&(c.offsetEnd-=2*s,t(i)&&u(f,i)>0&&(c.offsetEnd+=1)),r(i,c)}},h=function(u,e,o,s,h,c){var a,v,l;t(u)&&(a=f(o,s),a&&!a.isGridLine&&(v=i(a),v>0&&(l={orientation:c?1:0,offsetStart:0,offsetEnd:0},h===n.previous?l.offsetStart+=v*h:l.offsetEnd+=v*h,(l.offsetStart||l.offsetEnd)&&r(u,l))))};return{calcLayoutHorizontal:function(n,e,o,h,c,l,a){var v,y,p,w;(e||o||h)&&(p=f(o,h),s(n,e,o,h)?(y=u(p,n))>0?(v=i(p),t(n)&&(t(o)||t(h)||t(e))||v===3&&r(n,{orientation:0,offsetStart:1})):p&&y<0?(y=u(n,e))>0?(v=i(p),v===3||v===2?r(n,{orientation:0,offsetStart:-2}):v===1&&r(n,{orientation:0,offsetStart:-1})):y!==0&&u(e,p)>0&&(v=i(p),v===3&&r(n,{orientation:0,offsetStart:1})):y===0&&(!e||u(n,e)>0)&&(v=i(p),v===3||v===2?r(n,{orientation:0,offsetStart:-2}):v===1&&r(n,{orientation:0,offsetStart:-1})):r(n,{orientation:0,offsetStart:1})),(c||l||a)&&(w=f(l,a),s(n,c,l,a)?(y=u(w,n))>0?(v=i(w),t(n)&&(t(l)||t(a)||t(c))||(v===3?r(n,{orientation:0,offsetEnd:-2}):(v===2||v===1)&&r(n,{orientation:0,offsetEnd:-1}))):y<0?(y=u(n,c))>0?(v=i(w),v===3&&r(n,{orientation:0,offsetEnd:1})):y!==0&&r(n,{orientation:0,offsetEnd:-1}):y===0&&((y=u(n,c))>0?(v=i(w),v===3&&r(n,{orientation:0,offsetEnd:1})):y!==0&&r(n,{orientation:0,offsetEnd:-1})):r(n,{orientation:0,offsetEnd:-2}))},calcLayoutVertical:function(n,e,o,h,c,l,a){var v,y,p,w;(e||o||h)&&(p=f(o,h),s(n,e,o,h)?(y=u(p,n))>0?(v=i(p),t(n)&&(t(o)||t(h)||t(e))||v===3&&r(n,{orientation:1,offsetStart:1})):y<0?(y=u(n,e))>0?(v=i(p),v===3||v===2?r(n,{orientation:1,offsetStart:-2}):v===1&&r(n,{orientation:1,offsetStart:-1})):y!==0&&u(e,p)>0&&(v=i(p),v===3&&r(n,{orientation:1,offsetStart:1})):y===0&&u(n,e)>0&&(v=i(p),v===3||v===2?r(n,{orientation:1,offsetStart:-2}):v===1&&r(n,{orientation:1,offsetStart:-1})):r(n,{orientation:1,offsetStart:1})),(c||l||a)&&(w=f(l,a),s(n,c,l,a)?(y=u(n,w))<0?(v=i(w),t(n)&&(t(l)||t(a)||t(c))||(v===3||v===2?r(n,{orientation:1,offsetEnd:-2}):v===1&&r(n,{orientation:1,offsetEnd:-1}))):w!==null&&y>0?(y=u(n,c))>0?(v=i(w),v===3&&r(n,{orientation:1,offsetEnd:1})):y!==0&&r(n,{orientation:1,offsetEnd:-1}):y===0&&((y=u(n,c))>0?(v=i(w),v===3&&r(n,{orientation:1,offsetEnd:1})):y!==0&&r(n,{orientation:1,offsetEnd:-1})):r(n,{orientation:1,offsetEnd:-2}))},calcDoubleLayout:function(i,r,u,f,e,s,l,a){var w;a?this.calcLayoutVertical(i,r,u,f,e,s,l):this.calcLayoutHorizontal(i,r,u,f,e,s,l);var p=t(u),y=t(f),b=t(r);p&&y&&b?v(i,r,u,f,n.previous,a):p&&!y?o(i,r,e,u,f,1,n.previous,a,!0):!p&&y?o(i,r,e,u,f,2,n.previous,a,!1):p&&y&&!b?c(i,r,u,f,n.previous,a):b&&h(i,r,u,f,n.previous,a),p=t(s),y=t(l),w=t(e),p&&y&&w?v(i,e,s,l,n.next,a):p&&!y?o(i,r,e,s,l,1,n.next,a,!0):!p&&y?o(i,r,e,s,l,2,n.next,a,!1):p&&y&&!w?c(i,e,s,l,n.next,a):w&&h(i,e,s,l,n.next,a)}}}(),y={layoutHorizontal:function(n,t,i,r,u,f,e){h.calcLayoutHorizontal(n,t,i,r,u,f,e)},layoutVertical:function(n,t,i,r,u,f,e){h.calcLayoutVertical(n,t,i,r,u,f,e)}},v={layoutHorizontal:function(n,t,i,r,u,f,e){h.calcDoubleLayout(n,t,i,r,u,f,e,!1)},layoutVertical:function(n,t,i,r,u,f,e){h.calcDoubleLayout(n,t,i,r,u,f,e,!0)}},w={layoutHorizontal:function(n,t,i,r,u,f,e){},layoutVertical:function(n,t,i,r,u,f,e){}};u.UI._GcBorders=function(n,t,i,r){this._sheet=n,this._sheetArea=r,this._rowViewportIndex=t,this._colViewportIndex=i},u.UI._GcBorders.prototype={_isInitialized:!1,_isMerged:!1,_initialize:function(){var n,t;this._spanCells=[],this._rowIndecies=[],this._colIndecies=[],this._overflowedCells=[],this._adjustingRanges=[],this._hGridLine=[],this._vGridLine=[],this._hBorders=[],this._vBorders=[];var f=0,r=0,e=0,i=0;for(this._sheetArea===u.UI.SheetArea.viewport?(f=this._sheet.getViewportLeftColumn(this._colViewportIndex),r=this._sheet.getViewportRightColumn(this._colViewportIndex),e=this._sheet.getViewportTopRow(this._rowViewportIndex),i=this._sheet.getViewportBottomRow(this._rowViewportIndex)):this._sheetArea===u.UI.SheetArea.colHeader?(f=this._sheet.getViewportLeftColumn(this._colViewportIndex),r=this._sheet.getViewportRightColumn(this._colViewportIndex),i=this._sheet.getRowCount(this._sheetArea)):this._sheetArea===u.UI.SheetArea.rowHeader&&(r=this._sheet.getColumnCount(this._sheetArea),e=this._sheet.getViewportTopRow(this._rowViewportIndex),i=this._sheet.getViewportBottomRow(this._rowViewportIndex)),n=e;n<=i;n++)this._sheet.getRowVisible(n,this._sheetArea)&&this._rowIndecies.push(n);for(t=f;t<=r;t++)this._sheet.getColumnVisible(t,this._sheetArea)&&this._colIndecies.push(t);this._isInitialized=!0},addCellLines:function(n,t,i,r,u,f,e,o,s){var y,v,l,a,c,h;this._isInitialized||this._initialize(),s&&(y={row:n,startCol:s.startCol,endCol:s.endCol},this._overflowedCells.contains(y)||this._overflowedCells.push(y)),o?this._spanCells.push(o):(e&&(v=e.borderLeft,l=e.borderTop,a=e.borderRight,c=e.borderBottom,h=e.backColor,(h===undefined||h===null)&&(e._backColor!==undefined||e._backColor!==null)&&(h=e._backColor)),!h||v||a||l||c||this._adjustingRanges.push({r:n,c:t,rc:1,cc:1}),this._addCellLineImp(n,t,i,r,u,f,v,l,a,c,h))},_addCellLineImp:function(n,t,i,r,u,f,e,o,s,h,c,l,a){var p=this._addCellLineSide(n,t,i,r-.5,i+u,r-.5,o,this._hBorders),w=this._addCellLineSide(n,t,i-.5,r,i-.5,r+f,e,this._vBorders),b=this._addCellLineSide(n+1,t,i,r+f-.5,i+u,r+f-.5,h,this._hBorders),k=this._addCellLineSide(n,t+1,i+u-.5,r,i+u-.5,r+f,s,this._vBorders),v,y;c&&this._sheet.getRowHeight(n)!==0&&this._sheet.getColumnWidth(t)!==0||(v=!b&&!l,y=!k&&!a,(v||y)&&this._addGridLine(n,t,i,r,u,f,v,y)),(p||c!==undefined)&&this._removeLineItem(n-1,t,this._hGridLine),(w||c!==undefined)&&this._removeLineItem(n,t-1,this._vGridLine),!c||e||s||o||h||(this._adjustLineItem(n-1,t-1,this._vGridLine,!1),this._adjustLineItem(n-1,t-1,this._hGridLine,!0))},_addCellLineSide:function(n,i,r,u,e,o,s,h){if(s){var c,l=this._queryLineItem(n,i,h,!0);return l.success?(c=l.lineItem,c.style.style!==t.double&&(s.style===t.double||a(s,c.style)>0)&&(c.line=f.Create(r,u,e,o,s.color,s.style),c.style=s)):(c=this._queryLineItem(n,i,h).lineItem,c.line=f.Create(r,u,e,o,s.color,s.style),c.style=s),c.line!==null}return!1},_addGridLine:function(n,t,i,r,e,o,s,h){var l=this._sheetArea===u.UI.SheetArea.viewport,c=this._sheet.gridline,y,v,a;(!l||c)&&(y=l?c.color:"#9EB6CE",s&&(c.showHorizontalGridline||!l)&&(v=this._queryLineItem(n,t,this._hGridLine).lineItem,v.isGridLine=!0,v.line=f.Create(i,r+o-.5,i+e,r+o-.5,y)),h&&(c.showVerticalGridline||!l)&&(a=this._queryLineItem(n,t,this._vGridLine).lineItem,a.isGridLine=!0,a.line=f.Create(i+e-.5,r,i+e-.5,r+o,y)))},_adjustLineItem:function(n,t,i,r){var f=this._queryLineItem(n,t,i,!0),u;f.success&&(u=f.lineItem,u&&u.line&&u.line.adjust({orientation:r?0:1,offsetEnd:-1}))},_removeLineItem:function(n,t,i){var r,u;n<0||t<0||(r=i[n],r&&(u=r[t],u&&(r[t]=null)))},_queryLineItem:function(n,t,i,r){var u,f;if(n===-1||t===-1)return{success:!1};u=i[n];if(!u){if(r)return{success:!1};i[n]=u=[]}f=u[t];if(!f){if(r)return{success:!1};u[t]=f={}}return{success:!0,lineItem:f}},_processOverflowCells:function(){for(var n,t=0;t<this._overflowedCells.length;t++){var u=this._overflowedCells[t],r=u.row,f=u.startCol,e=u.endCol,i;for(n=f;n<e;n++)i=this._queryLineItem(r,n+1,this._vBorders,!0),i.success?this._removeLineItem(r,n+1,this._vBorders):(i=this._queryLineItem(r,n,this._vGridLine,!0),i.success&&this._removeLineItem(r,n,this._vGridLine))}},_processSpans:function(){var n,t;if(this._spanCells.length>0)for(n=0;n<this._spanCells.length;n++)t=this._spanCells[n],this._processSpanCell(t)},_processSpanCell:function(n){var k=n.row,b=n.col,tt=n.x,it=n.y,c,l,a,v,nt=this._sheet.getActualStyle(k,b,this._sheetArea),h=nt?nt.backColor:null,f,i,t,r,u,y,d,p,g,e,o=tt,s=it,w;if(n.rowCount===1)for(i=k,r=this._sheet._getZoomRowHeight(i,this._sheetArea),f=0;f<n.colCount;f++)y=f===0,p=f===n.colCount-1,t=b+f,u=this._sheet._getZoomColumnWidth(t,this._sheetArea),e=this._sheet.getActualStyle(i,t,this._sheetArea),e?(c=e.borderLeft,l=e.borderTop,a=e.borderRight,v=e.borderBottom):c=l=a=v=null,y?this._addCellLineImp(i,t,o,s,u,r,c,l,null,v,h,!1,!0):p?this._addCellLineImp(i,t,o,s,u,r,null,l,a,v,h):this._addCellLineImp(i,t,o,s,u,r,null,l,null,v,h,!1,!0),o+=u;else if(n.colCount===1)for(t=b,u=this._sheet._getZoomColumnWidth(t,this._sheetArea),f=0;f<n.rowCount;f++)d=f===0,g=f===n.rowCount-1,i=k+f,r=this._sheet._getZoomRowHeight(i,this._sheetArea),e=this._sheet.getActualStyle(i,t,this._sheetArea),e?(c=e.borderLeft,l=e.borderTop,a=e.borderRight,v=e.borderBottom):c=l=a=v=null,d?this._addCellLineImp(i,t,o,s,u,r,c,l,a,null,h,!0,!1):g?this._addCellLineImp(i,t,o,s,u,r,c,null,a,v,h):this._addCellLineImp(i,t,o,s,u,r,c,null,a,null,h,!0,!1),s+=r;else for(f=0;f<n.rowCount;f++){for(i=k+f,d=f===0,g=f===n.rowCount-1,r=this._sheet._getZoomRowHeight(i,this._sheetArea),w=0;w<n.colCount;w++)t=b+w,y=w===0,p=w===n.colCount-1,u=this._sheet._getZoomColumnWidth(t,this._sheetArea),e=this._sheet.getActualStyle(i,t,this._sheetArea),e?(c=e.borderLeft,l=e.borderTop,a=e.borderRight,v=e.borderBottom):c=l=a=v=null,d?y?this._addCellLineImp(i,t,o,s,u,r,c,l,null,null,h,!0,!0):p?this._addCellLineImp(i,t,o,s,u,r,null,l,a,null,h,!0,!1):this._addCellLineImp(i,t,o,s,u,r,null,l,null,null,h,!0,!0):g?y?this._addCellLineImp(i,t,o,s,u,r,c,null,null,v,h,!1,!0):p?this._addCellLineImp(i,t,o,s,u,r,null,null,a,v,h):this._addCellLineImp(i,t,o,s,u,r,null,null,null,v,h,!1,!0):y?this._addCellLineImp(i,t,o,s,u,r,c,null,null,null,h,!0,!0):p&&this._addCellLineImp(i,t,o,s,u,r,null,null,a,null,h,!0,!1),o+=u;o=tt,s+=r}!h||c||a||l||v||this._adjustingRanges.push({r:k,c:b,rc:n.rowCount,cc:n.colCount})},_adjust:function(){(this._vBorders.length>0||this._hBorders.length>0)&&this._adjustBorders(),this._adjustingRanges.length>0&&this._adjustGridlines()},_adjustGridlines:function(){for(var i,r,u,n,f=0;f<this._adjustingRanges.length;f++){var t=this._adjustingRanges[f],o=t.r,e=t.c,s=o,c=o-1,l=e-1,h=e;for(t.rc>1&&(s+=t.rc-1),t.cc>1&&(h+=t.cc-1),i=!1,r=!1,u=0;u<this._adjustingRanges.length;u++){n=this._adjustingRanges[u],n.c===h+1&&n.r===o&&(r=!0),n.r===s+1&&n.c===e&&(i=!0);if(i&&r)break;if(n.r>o+1&&n.c>e+1)break}i||this._adjustLineItem(s,l,this._hGridLine,!0),r||this._adjustLineItem(c,h,this._vGridLine,!1)}},_adjustBorders:function(){for(var n,r,i,t=0;t<=this._rowIndecies.length;t++)for(r=this._rowIndecies[t],r===undefined&&t===this._rowIndecies.length&&(r=this._rowIndecies[t-1]+1),n=0;n<=this._colIndecies.length;n++)i=this._colIndecies[n],i===undefined&&n===this._colIndecies.length&&(i=this._colIndecies[n-1]+1),this._adjustHorizontalBorderLine(t,n,r,i);for(n=0;n<=this._colIndecies.length;n++)for(i=this._colIndecies[n],i===undefined&&n===this._colIndecies.length&&(i=this._colIndecies[n-1]+1),t=0;t<=this._rowIndecies.length;t++)r=this._rowIndecies[t],r===undefined&&t===this._rowIndecies.length&&(r=this._rowIndecies[t-1]+1),this._adjustVerticalBorderLine(t,n,r,i)},_adjustHorizontalBorderLine:function(n,t,i,r){var f,h,s,c,a,e,o,b=this._queryLineItem(i,r,this._hBorders,!0),u=0;if(b.success)u++;else{b=this._queryLineItem(i-1,r,this._hGridLine,!0);if(!b.success)return}f=b.lineItem,h=this._getLineItemImp(i,this._prevCol(t),!1),this._isBorderLineInLayout(h)&&u++,s=this._getLineItemImp(this._prevRow(n),r,!0),this._isBorderLineInLayout(s)&&u++,c=this._getLineItemImp(i,r,!0),this._isBorderLineInLayout(c)&&u++,a=this._getLineItemImp(i,this._nextCol(t),!1),this._isBorderLineInLayout(a)&&u++,e=this._getLineItemImp(this._prevRow(n),this._nextCol(t),!0),this._isBorderLineInLayout(e)&&u++,o=this._getLineItemImp(i,this._nextCol(t),!0),this._isBorderLineInLayout(o)&&u++,u>0&&(l(f.style)?v.layoutHorizontal(f,h,s,c,a,e,o):p(f.style)?w.layoutHorizontal(f,h,s,c,a,e,o):y.layoutHorizontal(f,h,s,c,a,e,o))},_adjustVerticalBorderLine:function(n,t,i,r){var f,h,s,c,a,e,o,b=this._queryLineItem(i,r,this._vBorders,!0),u=0;if(b.success)u++;else{b=this._queryLineItem(i,r-1,this._vGridLine,!0);if(!b.success)return}f=b.lineItem,h=this._getLineItemImp(this._prevRow(n),r,!0),this._isBorderLineInLayout(h)&&u++,s=this._getLineItemImp(i,this._prevCol(t),!1),this._isBorderLineInLayout(s)&&u++,c=this._getLineItemImp(i,r,!1),this._isBorderLineInLayout(c)&&u++,a=this._getLineItemImp(this._nextRow(n),r,!0),this._isBorderLineInLayout(a)&&u++,e=this._getLineItemImp(this._nextRow(n),this._prevCol(t),!1),this._isBorderLineInLayout(e)&&u++,o=this._getLineItemImp(this._nextRow(n),r,!1),this._isBorderLineInLayout(o)&&u++,u>0&&(l(f.style)?v.layoutVertical(f,h,s,c,a,e,o):p(f.style)?w.layoutVertical(f,h,s,c,a,e,o):y.layoutVertical(f,h,s,c,a,e,o))},_isBorderLineInLayout:function(n){return n&&!n.isGridLine&&n.line},_prevCol:function(n){return n<0?-1:this._colIndecies[n-1]},_nextCol:function(n){var t=this._colIndecies[n+1];return t===undefined&&n+1>=this._colIndecies.length?this._colIndecies[this._colIndecies.length-1]+1:t},_prevRow:function(n){return n<0?-1:this._rowIndecies[n-1]},_nextRow:function(n){var t=this._rowIndecies[n+1];return t===undefined&&n+1>=this._rowIndecies.length?this._rowIndecies[this._rowIndecies.length-1]+1:t},_getLineItemImp:function(n,t,i){if(n===undefined||n<0||t===undefined||t<0)return null;var u=i?this._vBorders:this._hBorders,r=this._queryLineItem(n,t,u,!0);if(r.success)return r.lineItem;u=i?this._vGridLine:this._hGridLine;if(i){t--;if(t<0)return null}else{n--;if(n<0)return null}return r=this._queryLineItem(n,t,u,!0),r.success?r.lineItem:null},paint:function(n,t){if(!this._isInitialized)return;this._isMerged||(this._processSpans(),this._processOverflowCells(),this._adjust(),this._isMerged=!0),n.save(),n.beginPath(),this._paint(n,t),n.closePath(),n.stroke(),n.restore()},_paint:function(n,t){this._paintGridLine(n),this._paintBorderLines(n)},_paintGridLine:function(n){this._paintLines(n,this._hGridLine),this._paintLines(n,this._vGridLine)},_paintBorderLines:function(n){this._paintLines(n,this._hBorders),this._paintLines(n,this._vBorders)},_paintLines:function(n,t){var u,i,f,r;if(t&&t.length>0)for(u in t)if(u){i=t[u];if(i&&i.length>0)for(f in i)f&&(r=i[f],r&&r.line&&r.line.paint(n))}}}})(window);(function(n,t){var i=n.GrapeCity,u="undefined",f,r;typeof i===u&&(i=n.GrapeCity={}),typeof i.UI===u&&(i.UI={}),f=i.UI,r=n.document,i.UI._SheetEventHandler=function(n){this._init(n)},i.UI._SheetEventHandler.prototype={_init:function(n){this._sheet=n,this._elem=null,this._eventSuspended=0},_getElem:function(){return this._elem||(this._elem=r.createElement("input")),this._elem},_dispose:function(){this._hScrollTimer&&this._hScrollTimer._dispose(),this._vScrollTimer&&this._vScrollTimer._dispose()},_getHScrollTimer:function(){return this._hScrollTimer||(this._hScrollTimer=new i.UI.Timer(this._sheet)),this._hScrollTimer},_getVScrollTimer:function(){return this._vScrollTimer||(this._vScrollTimer=new i.UI.Timer(this._sheet)),this._vScrollTimer},doResize:function(){var t=this._sheet,n=t._getCanvas(),r,i;if(!n||!n.parentNode)return;if(n.parentNode.clientWidth===0||n.parentNode.clientHeight===0)return;r=0,i=0,n.style.display="none",n.width=Math.max(n.parentNode.clientWidth-r,0),n.height=Math.max(n.parentNode.clientHeight-i,0),n.style.display="",t._bounds.width=n.clientWidth||n.width,t._bounds.height=n.clientHeight||n.height,t.invalidateLayout(),t.repaint()},_getCanvasOffset:function(){var i=this._sheet,n=t(i._getCanvas()).offset();return isNaN(r.body.clientTop)||(n.top+=r.body.clientTop),isNaN(r.body.clientLeft)||(n.left+=r.body.clientLeft),n},doMouseDown:function(n){var t,i;if(n.button!==2)return t=this._sheet,t.inCanvas||this.handleDocumentMouseMove(),i=this._getCanvasOffset(),this.doMouseDownImp(n,n.pageX-i.left,n.pageY-i.top),t._isEditing||this._setFocus(),t._isMouseDownInSheet=!0,!1},handleDocumentMouseMove:function(){var n=this;this._isMouseCapture||(t(r).bind("mousemove.gcSheet",function(t){n.doMouseMove(t)}),t(r).bind("mouseup.gcSheet",function(t){n.doMouseUp(t)}),this._isMouseCapture=!0)},unhandleDocumentMouseMove:function(){this._isMouseCapture&&(this._isMouseCapture=!1,t(r).unbind("mousemove.gcSheet"),t(r).unbind("mouseup.gcSheet"))},doMouseDownImp:function(n,t,r){var f=this._sheet,u=f.hitTest(t,r),s=u.groupHitInfo,e,o;if(s)f.isEditing()||this._doClickRangeGroup(s);else{f._currentTarget=u,this.isMouseDown=!0;if(u.resizeInfo)f.endEdit();else if(u.dragInfo&&u.dragInfo.side&&u.dragInfo.side!=="corner"){if(!f.endEdit())return;this.startDragDropping(n,t,r,u)}else if(u.dragInfo&&u.dragInfo.side==="corner"){if(!f.endEdit())return;this.startDragFill(n,t,r,u)}else if(u.filterButtonHitInfo){if(!f.endEdit())return;this._openFilterDialog(u.filterButtonHitInfo)}else{this.setMetaKeyState(n);if(!f.endEdit())return;if(u.row===undefined||u.row===null||u.col===undefined||u.col===null)return;e=f._selectionModel.toArray(),this.startSelecting(n,t,r,u),o=f._selectionModel.toArray(),this._notEqualSelecions(e,o)&&f._trigger(i.UI.Events.SelectionChanging,{sheet:f,sheetName:f._name,oldSelections:e,newSelections:o})}}},_openFilterDialog:function(n){if(!n)return;this._sheet._filterDialiog=new i.UI._GcFilterDialog(this._sheet,n),this._sheet._filterDialiog.open()},_doClickRangeGroup:function(n){var t=this._sheet,f,r,o,u,e,h,s;if(!t||!n)return;n.what==="rgh"?t&&!t._isEditing&&(f=n.info.index,r={sheet:t,sheetName:t._name,isRowGroup:!0,index:-1,level:f,cancel:!1},t._trigger(i.UI.Events.RangeGroupStateChanging,r),r&&r.cancel===!1&&(o=new i.UI.UndoRedo.RowGroupHeaderExpandUndoAction(t,{level:f}),t._doCommand(o),t._trigger(i.UI.Events.RangeGroupStateChanged,{sheet:t,sheetName:t._name,isRowGroup:!0,index:-1,level:f}))):n.what==="cgh"?t._isEditing||(f=n.info.index,r={sheet:t,sheetName:t._name,isRowGroup:!1,index:-1,level:f,cancel:!1},t._trigger(i.UI.Events.RangeGroupStateChanging,r),r&&r.cancel===!1&&(o=new i.UI.UndoRedo.ColumnGroupHeaderExpandUndoAction(t,{level:f}),t._doCommand(o),t._trigger(i.UI.Events.RangeGroupStateChanged,{sheet:t,sheetName:t._name,isRowGroup:!1,index:-1,level:f}))):n.what==="rg"?t.rowRangeGroup&&(u=n.info.index,e=n.info.isExpanded,n.info.lineDirection===i.UI.RangeGroupDirection.Forward?u--:u++,r={sheet:t,sheetName:t._name,isRowGroup:!0,index:u,level:n.info.level,cancel:!1},t._trigger(i.UI.Events.RangeGroupStateChanging,r),r&&r.cancel===!1&&(h=new i.UI.UndoRedo.RowGroupExpandUndoAction(t,{index:n.info.index,level:n.info.level,collapsed:e}),t._doCommand(h),t._trigger(i.UI.Events.RangeGroupStateChanged,{sheet:t,sheetName:t._name,isRowGroup:!0,index:u,level:n.info.level}))):n.what==="cg"&&t.colRangeGroup&&(u=n.info.index,e=n.info.isExpanded,n.info.lineDirection===i.UI.RangeGroupDirection.Forward?u--:u++,r={sheet:t,sheetName:t._name,isRowGroup:!1,index:u,level:n.info.level,cancel:!1},t._trigger(i.UI.Events.RangeGroupStateChanging,r),r&&r.cancel===!1&&(s=new i.UI.UndoRedo.ColumnGroupExpandUndoAction(t,{index:n.info.index,level:n.info.level,collapsed:e}),t._doCommand(s),t._trigger(i.UI.Events.RangeGroupStateChanged,{sheet:t,sheetName:t._name,isRowGroup:!1,index:u,level:n.info.level})))},startSelecting:function(n,t,r,u){var b=0,y=0,v=0,w=0,f=this._sheet,c,e,o,l,a,p,s,h;this._getHScrollTimer().start(),this._getVScrollTimer().start(),this.ctrl||this.shift||f._clearSelectionImp(),this.beginHitTest=u;if(u.hitTestType===i.UI.SheetArea.corner){if(!this.shift){c=f.frozenRowCount?f._getFirstVisualRow():f._scrollTopRow,a=f.frozenColCount?f._getFirstVisualColumn():f._scrollLeftCol,e={sheet:f,sheetName:f._name,row:f._activeRowIndex,col:f._activeColIndex,cancel:!1},f._trigger(i.UI.Events.LeaveCell,e);if(e&&e.cancel===!0)return;f._setActiveCellImp(c,a,1,1),f._trigger(i.UI.Events.EnterCell,{sheet:f,sheetName:f._name,row:c,col:a})}this.ctrl||f._clearSelectionImp(),f._setSelectedRange(-1,-1,f.getRowCount(),f.getColumnCount(),!0)}else if(u.hitTestType===i.UI.SheetArea.colHeader||u.hitTestType===i.UI.SheetArea.colFooter){if(!this.shift){c=f.frozenRowCount?f._getFirstVisualRow():f._scrollTopRow,o=f._getAvailableActiveCell(c,u.col,!1),e={sheet:f,sheetName:f._name,row:f._activeRowIndex,col:f._activeColIndex,cancel:!1},f._trigger(i.UI.Events.LeaveCell,e);if(e&&e.cancel===!0)return;f._setActiveCellImp(o.row,o.col,1,u.colViewportIndex),f._trigger(i.UI.Events.EnterCell,{sheet:f,sheetName:f._name,row:o.row,col:o.col})}this.shift?(b=Math.min(f._activeColIndex,u.col),w=Math.abs(f._activeColIndex-u.col)+1,f._replaceActiveSelectedRange(-1,b,f.getRowCount(),w,!0)):f._setSelectedRange(-1,f._activeColIndex,f.getRowCount(),1,!0)}else if(u.hitTestType===i.UI.SheetArea.rowHeader){if(!this.shift){p=f.frozenColCount?f._getFirstVisualColumn():f._scrollLeftCol,o=f._getAvailableActiveCell(u.row,p,!0),e={sheet:f,sheetName:f._name,row:f._activeRowIndex,col:f._activeColIndex,cancel:!1},f._trigger(i.UI.Events.LeaveCell,e);if(e&&e.cancel===!0)return;l=f._activeRowIndex!==o.row,f._setActiveCellImp(o.row,o.col,u.rowViewportIndex,1),l&&f.doDataItemChanged(),f._trigger(i.UI.Events.EnterCell,{sheet:f,sheetName:f._name,row:o.row,col:o.col})}this.shift?(y=Math.min(f._activeRowIndex,u.row),v=Math.abs(f._activeRowIndex-u.row)+1,f._replaceActiveSelectedRange(y,-1,v,f.getColumnCount(),!0)):f._setSelectedRange(f._activeRowIndex,-1,1,f.getColumnCount(),!0)}else if(u.hitTestType===i.UI.SheetArea.viewport)if(isNaN(u.row)||isNaN(u.col))f._isEditing&&(h=f.getCellRect(f._activeRowIndex,f._activeColIndex,f.activeRowViewportIndex,f.activeColViewportIndex),f._render.update(h.x,h.y,h.width,h.height)),this.beginHitTest=null;else{if(!this.shift)if(f._activeRowIndex!==u.row||f._activeColIndex!==u.col){e={sheet:f,sheetName:f._name,row:f._activeRowIndex,col:f._activeColIndex,cancel:!1},f._trigger(i.UI.Events.LeaveCell,e);if(e&&e.cancel===!0)return;l=f._activeRowIndex!==u.row,f._setActiveCellImp(u.row,u.col,u.rowViewportIndex,u.colViewportIndex),l&&f.doDataItemChanged(),f._trigger(i.UI.Events.EnterCell,{sheet:f,sheetName:f._name,row:u.row,col:u.col})}this.shift?f._extendSelectedRange(u.row,u.col,!0):(s=f._spanModel.find(u.row,u.col),s?f._setSelectedRange(s.row,s.col,s.rowCount,s.colCount,!0):f._setSelectedRange(u.row,u.col,1,1,!0))}},continueSelecting:function(n,t,r,u){var o,e,f;if(!this.beginHitTest)return;if(this._forceCancelSelectiong===!0)return;this.isWorking=!0,o=this._sheet,this.beginHitTest.freezeInfo||(e={freezeTop:!1,freezeLeft:!1},this.beginHitTest.col<o._getFirstPageLeftColumn()&&(e.freezeLeft=!0),this.beginHitTest.row<o._getFirstPageTopRow()&&(e.freezeTop=!0),this.beginHitTest.freezeInfo=e),f=this.beginHitTest.hitTestType,f===i.UI.SheetArea.viewport?this.continueCellSelecting(n,t,r,u):f===i.UI.SheetArea.rowHeader?this.continueRowSelecting(n,t,r,u):(f===i.UI.SheetArea.colHeader||f===i.UI.SheetArea.colFooter)&&this.continueColumnSelecting(n,t,r,u)},continueCellSelecting:function(n,t,r,u){var f=this._sheet,o=this,c=this.beginHitTest.freezeInfo.freezeLeft,l=this.beginHitTest.freezeInfo.freezeTop,e=this.getMousePosition(n,t,r,i.UI.SheetArea.viewport),s,h;e.left?c||this._getHScrollTimer().setAction(function(){var e=f._getFirstPageLeftColumn(),i=f._getPrevVisualColumn(isNaN(f.frozenColCount)?f._scrollLeftCol:Math.max(f._scrollLeftCol,f.frozenColCount));i<e||(f._setLeftColumn(i),o.continueCellSelecting(n,t,r,u))}):e.right&&(c?(f._setLeftColumn(f._getFirstPageLeftColumn()),this.beginHitTest.freezeInfo.freezeLeft=!1):this._getHScrollTimer().setAction(function(){var e=f._getLastPageLeftColumn(),i=f._getNextVisualColumn(isNaN(f.frozenColCount)?f._scrollLeftCol:Math.max(f._scrollLeftCol,f.frozenColCount));i>e||(f._setLeftColumn(i),o.continueCellSelecting(n,t,r,u))})),e.top?l||this._getVScrollTimer().setAction(function(){var s=f._getFirstPageTopRow(),i=f._getPrevVisualRow(isNaN(f.frozenRowCount)?f._scrollTopRow:Math.max(f._scrollTopRow,f.frozenRowCount));o.getIntervalFromDistance(e.distanceX)>50||(i=f._getPrevVisualRow(i)),i<s||(f._setTopRow(i),o.continueCellSelecting(n,t,r,u))}):e.bottom&&(l?(f._setTopRow(f._getFirstPageTopRow()),this.beginHitTest.freezeInfo.freezeTop=!1):this._getVScrollTimer().setAction(function(){var s=f._getLastPageTopRow(),i=f._getNextVisualRow(isNaN(f.frozenRowCount)?f._scrollTopRow:Math.max(f._scrollTopRow,f.frozenRowCount));o.getIntervalFromDistance(e.distanceX)>50||(i=f._getNextVisualRow(i)),i>s||(f._setTopRow(i),o.continueCellSelecting(n,t,r,u))})),this._getHScrollTimer().setInterval(this.getIntervalFromDistance(e.distanceX)),this._getVScrollTimer().setInterval(this.getIntervalFromDistance(e.distanceY)),u=f.hitTest(e.nearMouseX,e.nearMouseY),s=f._selectionModel.toArray(),f._extendSelectedRange(u.row,u.col,!0),h=f._selectionModel.toArray(),this._notEqualSelecions(s,h)&&f._trigger(i.UI.Events.SelectionChanging,{sheet:f,sheetName:f._name,oldSelections:s,newSelections:h})},continueRowSelecting:function(n,t,r,u){var f=this._sheet,c=this,s=this.beginHitTest.freezeInfo.freezeTop,e=this.getMousePosition(n,t,r,i.UI.SheetArea.rowHeader),o;e.top?s||this._getVScrollTimer().setAction(function(){var e=f._getFirstPageTopRow(),i=f._getPrevVisualRow(f._scrollTopRow);i<e||(f._setTopRow(i),c.continueRowSelecting(n,t,r,u))}):e.bottom&&(s?(f._setTopRow(f._getFirstPageTopRow()),this.beginHitTest.freezeInfo.freezeTop=!1):this._getVScrollTimer().setAction(function(){var e=f._getLastPageTopRow(),i=f._getNextVisualRow(f._scrollTopRow);i>e||(f._setTopRow(i),c.continueRowSelecting(n,t,r,u))})),this._getVScrollTimer().setInterval(this.getIntervalFromDistance(e.distanceY)),u=f.hitTest(e.nearMouseX,e.nearMouseY);var l=Math.min(f._activeRowIndex,u.row),v=Math.max(f._activeRowIndex,u.row)-l+1,a=-1,y=f.getColumnCount(),h=f._selectionModel.toArray();f._replaceActiveSelectedRange(l,a,v,y,!0),o=f._selectionModel.toArray(),this._notEqualSelecions(h,o)&&f._trigger(i.UI.Events.SelectionChanging,{sheet:f,sheetName:f._name,oldSelections:h,newSelections:o})},continueColumnSelecting:function(n,t,r,u){var f=this._sheet,c=this,s=this.beginHitTest.freezeInfo.freezeLeft,e=this.getMousePosition(n,t,r,i.UI.SheetArea.colHeader),o;e.left?s||this._getHScrollTimer().setAction(function(){var e=f._getFirstPageLeftColumn(),i=f._getPrevVisualColumn(f._scrollLeftCol);i<e||(f._setLeftColumn(i),c.continueColumnSelecting(n,t,r,u))}):e.right&&(s?(f._setLeftColumn(f._getFirstPageLeftColumn()),this.beginHitTest.freezeInfo.freezeLeft=!1):this._getHScrollTimer().setAction(function(){var e=f._getLastPageLeftColumn(),i=f._getNextVisualColumn(f._scrollLeftCol);i>e||(f._setLeftColumn(i),c.continueColumnSelecting(n,t,r,u))})),this._getHScrollTimer().setInterval(this.getIntervalFromDistance(e.distanceX)),u=f.hitTest(e.nearMouseX,e.nearMouseY);var l=Math.min(f._activeColIndex,u.col),v=Math.max(f._activeColIndex,u.col)-l+1,a=-1,y=f.getRowCount(),h=f._selectionModel.toArray();f._replaceActiveSelectedRange(a,l,y,v,!0),o=f._selectionModel.toArray(),this._notEqualSelecions(h,o)&&f._trigger(i.UI.Events.SelectionChanging,{sheet:f,sheetName:f._name,oldSelections:h,newSelections:o})},stopSelecting:function(){var t,n,r;this.beginHitTest=null,this._getHScrollTimer().stop(),this._getVScrollTimer().stop(),this._forceCancelSelectiong=null;if(this.isWorking===!1)return;else this.isWorking=!1;t=this._sheet,n=!this._lastSelections,n?this._lastSelections=t._selectionModel.toArray():(r=t._selectionModel.toArray(),n=this._notEqualSelecions(this._lastSelections,r),n&&(this._lastSelections=r)),n&&t._trigger(i.UI.Events.SelectionChanged,{sheet:this._sheet,sheetName:this._sheet._name})},startDragDropping:function(n,t,r,u){var e=this._sheet,h,v,s,o,a;if(this.isDragDropping)return;h=null,e._selectionModel.length===1?h=e._selectionModel[0]:e._selectionModel.length<1&&(v=e._spanModel.find(e._activeRowIndex,e._activeColIndex),h=v?v:new i.UI.Range(e._activeRowIndex,e._activeColIndex,1,1));if(h){this.isDragDropping=!0,this._dragDropFromRange=h,s=null,o=e._getActiveSelectedRange(),s=o&&(o.rowCount>0||o.colCount>0)?{r:o.row,c:o.col,rc:o.rowCount,cc:o.colCount}:{r:e._activeRowIndex,c:e._activeColIndex,rc:1,cc:1},this.beginHitTest=u;var c=e._currentTarget,l=e._getActiveSelectionRect(c.rowViewportIndex,c.colViewportIndex),f=e._dragRect;f.x=l.x,f.y=l.y,f.width=l.width-1,f.height=l.height-1,f.row=s.r,f.col=s.c,f.rowCount=s.rc,f.colCount=s.cc,f.beginHitRow=c.row,f.beginHitCol=c.col,f.hitRow=c.row,f.hitCol=c.col;if(this.beginHitTest){a=this.beginHitTest.dragInfo;if(a.outside===!0)switch(a.side){case"left":f.col--;break;case"right":f.col++;break;case"top":f.row--;break;case"bottom":f.row++;break}f.beginRow=f.row,f.beginCol=f.col}this._getHScrollTimer().start(),this._getVScrollTimer().start()}},continueDragDropping:function(n,t,i){var u=this._sheet,f,e,r;if(!this.beginHitTest)return;f=u.hitTest(t,i,!0);if(!this.isDragDropping||!this._dragDropFromRange)return;this.isWorking=!0,e=u._dragRect,e.hitTarget=f,this.beginHitTest.freezeInfo||(r={freezeTop:!1,freezeLeft:!1},this.beginHitTest.col<u._getFirstPageLeftColumn()&&(r.freezeLeft=!0),this.beginHitTest.row<u._getFirstPageTopRow()&&(r.freezeTop=!0),this.beginHitTest.freezeInfo=r),this.continueCellDragDropping(n,t,i)},continueCellDragDropping:function(n,t,r){var u=this._sheet,e=this,f=this.getMousePosition(n,t,r,i.UI.SheetArea.viewport),s,o;if(!f)return;s=this.beginHitTest.freezeInfo.freezeLeft,o=this.beginHitTest.freezeInfo.freezeTop,f.left?s||this._getHScrollTimer().setAction(function(){var f=u._getFirstPageLeftColumn(),i=u._getPrevVisualColumn(isNaN(u.frozenColCount)?u._scrollLeftCol:Math.max(u._scrollLeftCol,u.frozenColCount));i<f||(u._setLeftColumn(i),e.continueCellDragDropping(n,t,r))}):f.right&&(s?(u._setLeftColumn(u._getFirstPageLeftColumn()),this.beginHitTest.freezeInfo.freezeLeft=!1):this._getHScrollTimer().setAction(function(){var f=u._getLastPageLeftColumn(),i=u._getNextVisualColumn(isNaN(u.frozenColCount)?u._scrollLeftCol:Math.max(u._scrollLeftCol,u.frozenColCount));i>f||(u._setLeftColumn(i),e.continueCellDragDropping(n,t,r))})),f.top?o||this._getVScrollTimer().setAction(function(){var f=u._getFirstPageTopRow(),i=u._getPrevVisualRow(isNaN(u.frozenRowCount)?u._scrollTopRow:Math.max(u._scrollTopRow,u.frozenRowCount));i<f||(u._setTopRow(i),e.continueCellDragDropping(n,t,r))}):f.bottom&&(o?(u._setTopRow(u._getFirstPageTopRow()),this.beginHitTest.freezeInfo.freezeTop=!1):this._getVScrollTimer().setAction(function(){var f=u._getLastPageTopRow(),i=u._getNextVisualRow(isNaN(u.frozenRowCount)?u._scrollTopRow:Math.max(u._scrollTopRow,u.frozenRowCount));i>f||(u._setTopRow(i),e.continueCellDragDropping(n,t,r))})),this._getHScrollTimer().setInterval(this.getIntervalFromDistance(f.distanceX)),this._getVScrollTimer().setInterval(this.getIntervalFromDistance(f.distanceY)),this.updateDragDropRect(f.nearMouseX,f.nearMouseY)},updateDragDropRect:function(n,t){var u=this._sheet,e,r,s,h,c;if(!this.beginHitTest)return;e=u.hitTest(n,t,!0);if(e.row===undefined||e.row===null||e.col===undefined||e.col===null)return;if(!this.isDragDropping||!this._dragDropFromRange)return;r=u._dragRect,s=u._getActiveSelectedRange(),s.row===-1&&s.col!==-1?(r.row=-1,r.col=e.col):s.row!==-1&&s.col===-1?(r.row=e.row,r.col=-1):(r.row=r.beginRow+(e.row-r.beginHitRow),r.col=r.beginCol+(e.col-r.beginHitCol),r.row<0&&(r.row=0),r.col<0&&(r.col=0)),r.hitRow=e.row,r.hitCol=e.col,h=u.getRowCount(),c=u.getColumnCount(),r.row+r.rowCount>h&&(r.row=h-r.rowCount),r.col+r.colCount>c&&(r.col=c-r.colCount);var a=r.row<0?0:r.row,l=r.col<0?0:r.col,f=new i.UI.Range(a,l,r.rowCount,r.colCount),o=u._oldDragRange;if(o)if(f.row===o.row&&f.col===o.col&&f.rowCount===o.rowCount&&f.colCount===o.colCount&&f.row>u._getFirstVisualRow()&&f.col>u._getFirstVisualColumn()&&f.row+f.rowCount-1<u._getLastVisualRow()&&f.col+f.colCount-1<u._getLastVisualColumn())return;u._actualDragRange=f,u._render.refreshDragDropIndicator()},stopDragDrop:function(n){var u=!1,l="",w=!1,r=this._sheet,y=null,a;this.beginHitTest=null,this._getHScrollTimer().stop(),this._getVScrollTimer().stop(),a=r._getActiveSelectedRange(),y=a&&(a.rowCount>0||a.colCount>0)?{r:a.row,c:a.col,rc:a.rowCount,cc:a.colCount}:{r:r._activeRowIndex,c:r._activeColIndex,rc:1,cc:1};if(this.isDragDropping===!0&&this.isWorking===!0){var f=y.r,e=y.c,o=y.rc,h=y.cc,s=r._dragRect.row,c=r._dragRect.col,p,v,t;this._isDragInsert&&(f===-1||e===-1)?e>=0&&f<0?(this._isDragCopy&&(c<=e||c>=e+h)||!this._isDragCopy&&(c<e||c>e+h))&&((r._hasPartSpans(-1,e,-1,h)||r._hasPartSpans(-1,c,-1,0))&&(u=!0,l="Cannot change part of a merged cell."),u||(r._hasPartArrayFormulas(-1,e,-1,h)||r._hasPartArrayFormulas(-1,c,-1,0))&&(u=!0,l="Cannot change part of an array."),!u&&r.isProtected&&(u=!0,l="The column you are trying to change is protected and therefore read-only."),u||(t=new i.UI.UndoRedo.DragDropExtent(-1,e,-1,c,-1,h),v=r._raiseDragDropBlock(t.fromRow,t.fromColumn,t.toRow,t.toColumn,t.rowCount,t.columnCount,this._isDragCopy,!0,i.UI.CopyToOption.All),v||(p=new i.UI.UndoRedo.DragDropUndoAction(r,t,this._isDragCopy,!0,i.UI.CopyToOption.All),r.doCommand(p),r._raiseDragDropBlockCompleted(t.fromRow,t.fromColumn,t.toRow,t.toColumn,t.rowCount,t.columnCount,this._isDragCopy,!0,i.UI.CopyToOption.All),w=!0))):f>=0&&e<0&&(this._isDragCopy&&(s<=f||s>=f+o)||!this._isDragCopy&&(s<f||s>f+o))&&((r._hasPartSpans(f,-1,o,-1)||r._hasPartSpans(s,-1,0,-1))&&(u=!0,l="Cannot change part of a merged cell."),u||(r._hasPartArrayFormulas(f,-1,o,-1)||r._hasPartArrayFormulas(s,-1,0,-1))&&(u=!0,l="Cannot change part of an array."),!u&&r.isProtected&&(u=!0,l="The row you are trying to change is protected and therefore read-only."),u||(t=new i.UI.UndoRedo.DragDropExtent(f,-1,s,-1,o,-1),v=r._raiseDragDropBlock(t.fromRow,t.fromColumn,t.toRow,t.toColumn,t.rowCount,t.columnCount,this._isDragCopy,!0,i.UI.CopyToOption.All),v||(p=new i.UI.UndoRedo.DragDropUndoAction(r,t,this._isDragCopy,!0,i.UI.CopyToOption.All),r.doCommand(p),r._raiseDragDropBlockCompleted(t.fromRow,t.fromColumn,t.toRow,t.toColumn,t.rowCount,t.columnCount,this._isDragCopy,!0,i.UI.CopyToOption.All),w=!0))):(s!==f||c!==e)&&((r._hasPartSpans(f,e,o,h)||r._hasPartSpans(s,c,o,h))&&(u=!0,l="Cannot change part of a merged cell."),u||(r._hasPartArrayFormulas(f,e,o,h)||r._hasPartArrayFormulas(s,c,o,h))&&(u=!0,l="Cannot change part of an array."),!u&&r.isProtected&&(!this._isDragCopy&&r._isAnyCellInRangeLocked(new i.UI.Range(f,e,o,h))||r._isAnyCellInRangeLocked(new i.UI.Range(s,c,o,h)))&&(u=!0,l="The cells you are trying to change is protected and therefore read-only."),u||(t=new i.UI.UndoRedo.DragDropExtent(f,e,s,c,o,h),v=r._raiseDragDropBlock(t.fromRow,t.fromColumn,t.toRow,t.toColumn,t.rowCount,t.columnCount,this._isDragCopy,!1,i.UI.CopyToOption.All),v||(p=new i.UI.UndoRedo.DragDropUndoAction(r,t,this._isDragCopy,!1,i.UI.CopyToOption.All),r.doCommand(p),r._raiseDragDropBlockCompleted(t.fromRow,t.fromColumn,t.toRow,t.toColumn,t.rowCount,t.columnCount,this._isDragCopy,!1,i.UI.CopyToOption.All),w=!0)))}this.isWorking=!1,this.isDragDropping=!1,this._dragDropFromRange=null,this._isDragInsert=!1,this._isDragCopy=!1,w===!1&&(r._dragRect={},r.repaint()),u&&r._raiseInvalidOperation(l)},startDragFill:function(n,t,i,r){if(this.isDraggingFill===!0)return;this.beginHitTest=r,this.updateDragFillStartRange();if(!this._dragFillStartRange)return;this.isDraggingFill=!0,this._dragStartRowViewport=r.rowViewportIndex,this._dragStartColumnViewport=r.colViewportIndex,this._dragToRowViewport=r.rowViewportIndex,this._dragToColumnViewport=r.colViewportIndex,this.updateDragStartRangeViewports(),this._getHScrollTimer().start(),this._getVScrollTimer().start()},updateDragStartRangeViewports:function(){var t=this.dragFillStartTopRow(),n;t>=0&&t<this._sheet.frozenRowCount?this._dragFillStartTopRowViewport=0:t<this._sheet.frozenRowCount||t>this._sheet.getRowCount()||(this._dragFillStartTopRowViewport=1),this._dragFillStartBottomRowViewport=this.isDragFillWholeColumns()?1:this._dragStartRowViewport,n=this.dragFillStartLeftColumn(),n>=0&&n<this._sheet.frozenColCount?this._dragFillStartLeftColumnViewport=0:n<this._sheet.frozenColCount||n>this._sheet.getColumnCount()||(this._dragFillStartLeftColumnViewport=1),this._dragFillStartRightColumnViewport=this.isDragFillWholeRows()?1:this._dragStartColumnViewport},updateDragToViewports:function(n,t,i){this.updateDragToRowViewport(n,t,i),this.updateDragToColumnViewport(n,t,i)},updateDragToRowViewport:function(n,t,i){var r,u;this._dragToRowViewport=this._dragStartRowViewport,r=this._sheet._getRowIndex(i,this._dragToRowViewport),(r===undefined||r===null||this._sheet._getRowLayout(this._dragToRowViewport).findRow(r)===null)&&(u=this._sheet._currentTarget.y,i<u?this._dragToRow>this._sheet.frozenRowCount?this._dragToRow>this._sheet.getRowCount()||(this._dragToRowViewport=1):this._dragToRowViewport=0:this._dragStartRowViewport!==0||this._dragToRow<this._sheet.frozenRowCount||(this._dragToRowViewport=1))},updateDragToColumnViewport:function(n,t,i){var r,u;this._dragToColumnViewport=this._dragStartColumnViewport,r=this._sheet._getColumnIndex(t,this._dragToColumnViewport),(r===undefined||r===null||this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(r)===null)&&(u=this._sheet._currentTarget.x,t<u?this._dragToColumn>this._sheet.frozenColCount?this._dragToColumn>this._sheet.getColumnCount()||(this._dragToColumnViewport=1):this._dragToColumnViewport=0:this._dragStartColumnViewport!==0||this._dragToColumn<this._sheet.frozenColCount||(this._dragToColumnViewport=1))},continueDragFill:function(n,t,i){var u=this._sheet,r;if(!this.beginHitTest)return;if(!this.isDraggingFill||!this._dragFillStartRange)return;this.isWorking=!0,this.beginHitTest.freezeInfo||(r={freezeTop:!1,freezeLeft:!1},this.beginHitTest.col<u._getFirstPageLeftColumn()&&(r.freezeLeft=!0),this.beginHitTest.row<u._getFirstPageTopRow()&&(r.freezeTop=!0),this.beginHitTest.freezeInfo=r),this.continueCellDragFill(n,t,i)},continueCellDragFill:function(n,t,r){var u=this._sheet,e=this,f=this.getMousePosition(n,t,r,i.UI.SheetArea.viewport),s,o;if(!f)return;s=this.beginHitTest.freezeInfo.freezeLeft,o=this.beginHitTest.freezeInfo.freezeTop,f.left?s||this._getHScrollTimer().setAction(function(){var f=u._getFirstPageLeftColumn(),i=u._getPrevVisualColumn(isNaN(u.frozenColCount)?u._scrollLeftCol:Math.max(u._scrollLeftCol,u.frozenColCount));i<f||(u._setLeftColumn(i),e.continueCellDragFill(n,t,r))}):f.right&&(s?(u._setLeftColumn(u._getFirstPageLeftColumn()),this.beginHitTest.freezeInfo.freezeLeft=!1):this._getHScrollTimer().setAction(function(){var f=u._getLastPageLeftColumn(),i=u._getNextVisualColumn(isNaN(u.frozenColCount)?u._scrollLeftCol:Math.max(u._scrollLeftCol,u.frozenColCount));i>f||(u._setLeftColumn(i),e.continueCellDragFill(n,t,r))})),f.top?o||this._getVScrollTimer().setAction(function(){var f=u._getFirstPageTopRow(),i=u._getPrevVisualRow(isNaN(u.frozenRowCount)?u._scrollTopRow:Math.max(u._scrollTopRow,u.frozenRowCount));i<f||(u._setTopRow(i),e.continueCellDragFill(n,t,r))}):f.bottom&&(o?(u._setTopRow(u._getFirstPageTopRow()),this.beginHitTest.freezeInfo.freezeTop=!1):this._getVScrollTimer().setAction(function(){var f=u._getLastPageTopRow(),i=u._getNextVisualRow(isNaN(u.frozenRowCount)?u._scrollTopRow:Math.max(u._scrollTopRow,u.frozenRowCount));i>f||(u._setTopRow(i),e.continueCellDragFill(n,t,r))})),this._getHScrollTimer().setInterval(this.getIntervalFromDistance(f.distanceX)),this._getVScrollTimer().setInterval(this.getIntervalFromDistance(f.distanceY)),this.updateDragFillRect(n,f.nearMouseX,f.nearMouseY)},updateDragFillRect:function(n,t,i){this.updateDragToViewports(n,t,i),this.updateDragToCoordinates(n,t,i);if(this._dragToRow<0&&this._dragToColumn<0)return;this.updateCurrentFillSettings(n,t,i),this.updateCurrentFillRange(),this.refreshDragFill()},refreshDragFill:function(){var n;if(t.browser.chrome||t.browser.safari){var i=this._sheet,e=i._render._getCtx(),f=i._render._getBufferCtx(),u=i._render._getBufferCtx2(),r=this.getDragFillFrameRange();this._oldDragFillFrameRange&&(n=null,n=r.containsRange(this._oldDragFillFrameRange)?i._getRangeRect(1,1,r):i._getRangeRect(1,1,this._oldDragFillFrameRange),n.x-=2,n.y-=2,n.width+=4,n.height+=4,i._render._copyDoubleBufferRect(n,null,null,null,f,u)),r&&(n=i._getRangeRect(1,1,r),this.refreshSelectionBorder(u),i._render.paintDragRectangle(u,n),n=!this._oldDragFillFrameRange||r.containsRange(this._oldDragFillFrameRange)?i._getRangeRect(1,1,r):i._getRangeRect(1,1,this._oldDragFillFrameRange),n.x-=2,n.y-=2,n.width+=4,n.height+=4,i._render._copyDoubleBufferRect(n,null,null,null,u,e)),this._oldDragFillFrameRange=r}else this.clearDragFill(),this.refreshSelectionBorder(),this.paintDragFill(),this._oldDragFillFrameRange=this.getDragFillFrameRange()},clearDragFill:function(){var t=this._sheet,n;this._oldDragFillFrameRange&&(n=t._getRangeRect(1,1,this._oldDragFillFrameRange),n.x-=2,n.y-=2,n.width+=4,n.height+=4,t._render._copyDoubleBufferRect(n))},refreshSelectionBorder:function(n){var t=this._sheet;t._render.repaintSelection(this._dragFillStartRange,null,n)},paintDragFill:function(){var u=this._sheet,s=u._render,o=this.getDragFillFrameRange(),n,e,i,r,f,t;if(!o)return;for(n=s._getCtx(),e=u._getSheetLayout(),i=0;i<2;i++)for(r=0;r<2;r++)f=u._getRangeRect(i,r,o),t=e.viewportRect(i,r),n.save(),n.rect(t.x,t.y,t.width,t.height),n.clip(),n.beginPath(),s.paintDragRectangle(n,f),n.beginPath(),n.restore()},updateCurrentFillRange:function(){this._currentFillRange=this.getCurrentFillRange()},isDragFillWholeRows:function(){return this._dragFillStartRange.col===-1&&this._dragFillStartRange.row!==-1},isDragFillWholeColumns:function(){return this._dragFillStartRange.row===-1&&this._dragFillStartRange.col!==-1},isDragClear:function(){return this._currentFillDirection===i.UI.DragFillDirection.LeftClear||this._currentFillDirection===i.UI.DragFillDirection.UpClear},getCurrentFillRange:function(){var t=-1,n=-1,u=-1,r=-1;switch(this._currentFillDirection){case i.UI.DragFillDirection.Left:this.isDragFillWholeColumns()?(t=-1,u=-1):(t=this.dragFillStartTopRow(),u=this._dragFillStartRange.rowCount),n=this._dragToColumn,r=this.dragFillStartLeftColumn()-n;break;case i.UI.DragFillDirection.Right:this.isDragFillWholeColumns()?(t=-1,u=-1):(t=this.dragFillStartTopRow(),u=this._dragFillStartRange.rowCount),n=this.dragFillStartRightColumn()+1,r=this._dragToColumn-n+1;break;case i.UI.DragFillDirection.Up:t=this._dragToRow,u=this.dragFillStartTopRow()-t,this.isDragFillWholeRows()?(n=-1,r=-1):(n=this.dragFillStartLeftColumn(),r=this._dragFillStartRange.colCount);break;case i.UI.DragFillDirection.Down:t=this.dragFillStartBottomRow()+1,u=this._dragToRow-t+1,this.isDragFillWholeRows()?(n=-1,r=-1):(n=this.dragFillStartLeftColumn(),r=this._dragFillStartRange.colCount);break;case i.UI.DragFillDirection.UpClear:t=this._dragToRow,u=this.dragFillStartBottomRow()-t+1,this.isDragFillWholeRows()?(n=-1,r=-1):(n=this.dragFillStartLeftColumn(),r=this._dragFillStartRange.colCount);break;case i.UI.DragFillDirection.LeftClear:this.isDragFillWholeColumns()?(t=-1,u=-1):(t=this._dragFillStartRange.row,u=this._dragFillStartRange.rowCount),n=this._dragToColumn,r=this.dragFillStartRightColumn()-n+1;break;default:break}return new i.UI.Range(t,n,u,r)},updateDragToCoordinates:function(n,t,i){var u=this._sheet,r=u.hitTest(t,i,!0);if(r.row===null||r.col===null)return;var e=u._getLastFullyVisibleRow(),f=u._getLastFullyVisibleColumn(),s=u._getLastVisualRow(),o=u._getLastVisualColumn();this._dragToRow=r.row>e&&e<s?u._getPrevVisualRow(r.row):r.row,this._dragToColumn=r.col>f&&f<o?u._getPrevVisualColumn(r.col):r.col},dragFillStartBottomRowLayout:function(){var n=this.dragFillStartBottomRow();return n!==-1?this._sheet._getRowLayout(this._dragFillStartBottomRowViewport).findRow(n):null},dragFillToViewportBottomRowLayout:function(){return this._sheet._getRowLayout(this._dragToRowViewport).findRow(this.dragFillToViewportBottomRow())},dragFillToViewportBottomRow:function(){return this._sheet.getViewportBottomRow(this._dragToRowViewport)},dragFillStartRightColumnLayout:function(){var n=this.dragFillStartRightColumn();return n!==-1?this._sheet._getColumnLayout(this._dragFillStartRightColumnViewport).findCol(n):null},dragFillToViewportRightColumnLayout:function(){return this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(this.dragFillToViewportRightColumn())},dragFillToViewportRightColumn:function(){return this._sheet.getViewportRightColumn(this._dragToColumnViewport)},updateCurrentFillSettings:function(n,r,u){var v=this.isDragFillWholeRows(),y=this.isDragFillWholeColumns(),g=t(this._sheet._getCanvas()).offset(),c=n.pageX-g.left,l=n.pageY-g.top,it=!1,e,f,o,h,nt,p,s;v||y?y?this._dragToColumn<this.dragFillStartLeftColumn()||this._dragToColumn>this.dragFillStartRightColumn()?this._dragToColumn<this.dragFillStartLeftColumn()?this._currentFillDirection=i.UI.DragFillDirection.Left:this._dragToColumn>this.dragFillStartRightColumn()&&(this._currentFillDirection=i.UI.DragFillDirection.Right):this._currentFillDirection=i.UI.DragFillDirection.LeftClear:v&&(this._dragToRow<this.dragFillStartTopRow()||this._dragToRow>this.dragFillStartBottomRow()?this._dragToRow<this.dragFillStartTopRow()?this._currentFillDirection=i.UI.DragFillDirection.Up:this._dragToRow>this.dragFillStartBottomRow()&&(this._currentFillDirection=i.UI.DragFillDirection.Down):this._currentFillDirection=i.UI.DragFillDirection.UpClear):this._dragToRow<this.dragFillStartTopRow()||this._dragToRow>this.dragFillStartBottomRow()?this._dragToRow<this.dragFillStartTopRow()?this._dragToColumn<this.dragFillStartLeftColumn()||this._dragToColumn>this.dragFillStartRightColumn()?this._dragToColumn<this.dragFillStartLeftColumn()?(e=Math.abs(this._dragToColumn-this.dragFillStartLeftColumn()),f=Math.abs(this._dragToRow-this.dragFillStartTopRow()),this._currentFillDirection=f<e?i.UI.DragFillDirection.Left:i.UI.DragFillDirection.Up):this._dragToColumn>this.dragFillStartRightColumn()&&(e=Math.abs(this._dragToColumn-this.dragFillStartRightColumn()),f=Math.abs(this._dragToRow-this.dragFillStartTopRow()),this._currentFillDirection=f<e?i.UI.DragFillDirection.Right:i.UI.DragFillDirection.Up):this._currentFillDirection=i.UI.DragFillDirection.Up:this._dragToRow>this.dragFillStartBottomRow()&&(this._dragToColumn<this.dragFillStartLeftColumn()||this._dragToColumn>this.dragFillStartRightColumn()?this._dragToColumn<this.dragFillStartLeftColumn()?(e=Math.abs(this._dragToColumn-this.dragFillStartLeftColumn()),f=Math.abs(this._dragToRow-this.dragFillStartBottomRow()),this._currentFillDirection=f<e?i.UI.DragFillDirection.Left:i.UI.DragFillDirection.Down):this._dragToColumn>this.dragFillStartRightColumn()&&(e=Math.abs(this._dragToColumn-this.dragFillStartRightColumn()),f=Math.abs(this._dragToRow-this.dragFillStartBottomRow()),this._currentFillDirection=f<e?i.UI.DragFillDirection.Right:i.UI.DragFillDirection.Down):this._currentFillDirection=i.UI.DragFillDirection.Down):this._dragToColumn<this.dragFillStartLeftColumn()||this._dragToColumn>this.dragFillStartRightColumn()?this._dragToColumn<this.dragFillStartLeftColumn()?this._currentFillDirection=i.UI.DragFillDirection.Left:this._dragToColumn>this.dragFillStartRightColumn()&&(this._currentFillDirection=i.UI.DragFillDirection.Right):(e=Math.abs(this._dragToColumn-this.dragFillStartRightColumn()),f=Math.abs(this._dragToRow-this.dragFillStartBottomRow()),f>e?this._currentFillDirection=i.UI.DragFillDirection.UpClear:f<e?this._currentFillDirection=i.UI.DragFillDirection.LeftClear:(o=this.dragFillStartBottomRowLayout(),o||(o=this.dragFillToViewportBottomRowLayout()),u>o.y+o.height?this._currentFillDirection=i.UI.DragFillDirection.Down:(h=this.dragFillStartRightColumnLayout(),h||(h=this.dragFillToViewportRightColumnLayout()),nt=h.x+h.width-r,p=o.y+o.height-u,c<h.x||c>h.x+h.width||l<o.y||l>o.y+o.height?it=!0:this._currentFillDirection=nt<p?i.UI.DragFillDirection.UpClear:i.UI.DragFillDirection.LeftClear))),s=this._sheet._dragFillIndicatorRect;if(s){var tt=this.dragFillStartBottomRow(),rt=this.dragFillStartRightColumn(),et=tt+1,ut=rt+1,ft=this._sheet.getRowHeight(tt,i.UI.SheetArea.viewport),ot=this._sheet.getColumnWidth(rt,i.UI.SheetArea.viewport),ht=this._sheet.getRowHeight(et,i.UI.SheetArea.viewport),st=this._sheet.getColumnWidth(ut,i.UI.SheetArea.viewport),w=s.x+s.width/2-Math.min(10,ot/2),k=s.x+s.width/2+Math.min(10,st/2),b=s.y+s.height/2-Math.min(10,ft/2),d=s.y+s.height/2+Math.min(10,ht/2),a=!1;v||y?y?a=w<=c&&c<=k:v&&(a=b<=l&&l<=d):a=w<=c&&c<=k&&b<=l&&l<=d,a||it?(this._isDragAroundIndicator=!0,this._currentFillDirection=i.UI.DragFillDirection.LeftClear):this._isDragAroundIndicator=!1}},dragFillStartTopRow:function(){return this._dragFillStartRange?this._dragFillStartRange.row===-1?0:this._dragFillStartRange.row:-1},dragFillStartBottomRow:function(){return this._dragFillStartRange?this._dragFillStartRange.row===-1?this._sheet.getRowCount()-1:this._dragFillStartRange.row+this._dragFillStartRange.rowCount-1:-1},dragFillStartLeftColumn:function(){return this._dragFillStartRange?this._dragFillStartRange.col===-1?0:this._dragFillStartRange.col:-1},dragFillStartRightColumn:function(){return this._dragFillStartRange?this._dragFillStartRange.col===-1?this._sheet.getColumnCount()-1:this._dragFillStartRange.col+this._dragFillStartRange.colCount-1:-1},endDragFill:function(n){var t,u,i,r;this.beginHitTest=null,this._getHScrollTimer().stop(),this._getVScrollTimer().stop();if(!this.isDraggingFill||!this.isWorking){this.resetDragFill();return}this.isDraggingFill=!1,this.isWorking=!1,t=this.getDragFillFrameRange();if(!t)return;u=this.validateFillRange(t),!u||this._isDragAroundIndicator?(this.resetDragFill(),this.refreshSelection(t)):(i=this.getDragAutoFillType(),r=this.executeDragFillAction(this._currentFillRange,i),!r&&this.isDragFill()?this.showDragFillSmartTag(i):this.refreshSelection(t),this.resetDragFill())},showDragFillSmartTag:function(n){var r=this._sheet,t=r._dragFillIndicatorRect,u={x:t.x+t.width,y:t.y+t.height,fillType:n};r._smartTag=new i.UI._GcFillDialog(r,u),r._smartTag.open()},updateDragFillStartRange:function(){var n=this._sheet;n._selectionModel.length===1?this._dragFillStartRange=n._selectionModel[0]:n._activeRowIndex<0||n._activeColIndex<0||(this._dragFillStartRange=new i.UI.Range(n._activeRowIndex,n._activeColIndex,1,1))},resetDragFill:function(){this.isWorking=!1,this.isDraggingFill=!1},refreshSelection:function(n){this._sheet._render.repaintSelection(n)},getDragAutoFillType:function(){if(this.isDragClear())return i.UI.AutoFillType.ClearValues;var n=this._dragFillStartRange.rowCount===1&&this._dragFillStartRange.colCount===1&&!this.isDragFillWholeColumns()&&!this.isDragFillWholeRows();return n?this.isControlPressed?i.UI.AutoFillType.FillSeries:i.UI.AutoFillType.CopyCells:this.isControlPressed?i.UI.AutoFillType.CopyCells:i.UI.AutoFillType.FillSeries},getDragFillFrameRange:function(){if(!this._dragFillStartRange)return null;if(this.isDragClear())return this._dragFillStartRange;var r=0,u=0,n=0,t=0;return this.isVerticalDragFill()?(r=this._currentFillDirection===i.UI.DragFillDirection.Up?this._currentFillRange.row:this._dragFillStartRange.row,u=this._dragFillStartRange.rowCount+this._currentFillRange.rowCount,n=this._dragFillStartRange.col,t=this._dragFillStartRange.colCount):(r=this._dragFillStartRange.row,u=this._dragFillStartRange.rowCount,n=this._currentFillDirection===i.UI.DragFillDirection.Left?this._currentFillRange.col:this._dragFillStartRange.col,t=this._dragFillStartRange.colCount+this._currentFillRange.colCount),new i.UI.Range(r,n,u,t)},validateFillRange:function(n){var i=this._sheet,t=!0,r="";return i._hasSpans(n.row,n.col,n.rowCount,n.colCount)&&(t=!1,r="Can not fill range that contains merged cell."),t&&i.isProtected&&i._isAnyCellInRangeLocked(n)&&(t=!1,r="The cells you are trying to fill is protected and therefore read-only."),t||i._raiseInvalidOperation(r),t},executeDragFillAction:function(n,t){var u=this._sheet,f=u._getActualRange(n),r,o,e;return this._preFillCellsInfo=new i.UI.CopyMoveCellsInfo(f.rowCount,f.colCount),i.UI.CopyMoveHelper.saveViewportInfo(u,this._preFillCellsInfo,f.row,f.col,i.UI.CopyToOption.All),r={startRange:this._dragFillStartRange,fillRange:n,autoFillType:t,fillDirection:this.getCurrentFillDirection()},o=u._raiseDragFillBlock(r.fillRange,r.fillDirection,r.autoFillType),o?!0:(e=new i.UI.UndoRedo.DragFillUndoAction(u,r),u.doCommand(e),u._raiseDragFillBlockCompleted(r.fillRange,r.fillDirection,r.autoFillType),!1)},isDragFill:function(){return this.isIncreaseFill()||this.isDecreaseFill()},isIncreaseFill:function(){return this._currentFillDirection===i.UI.DragFillDirection.Down||this._currentFillDirection===i.UI.DragFillDirection.Right},isDecreaseFill:function(){return this._currentFillDirection===i.UI.DragFillDirection.Left||this._currentFillDirection===i.UI.DragFillDirection.Up},isVerticalDragFill:function(){return this._currentFillDirection===i.UI.DragFillDirection.Up||this._currentFillDirection===i.UI.DragFillDirection.Down||this._currentFillDirection===i.UI.DragFillDirection.UpClear},isDragToRowInView:function(){return this.isRowInViewport(this._dragToRowViewport,this._dragToRow)},isRowInViewport:function(n,t){var r=this._sheet.getViewportTopRow(n),i=this._sheet.getViewportBottomRow(n);return t<r||t>i?!1:!0},getCurrentDragToRowLayout:function(){return this._sheet._getRowLayout(this._dragToRowViewport).findRow(this._dragToRow)},isDragFillStartBottomRowInView:function(){return this.isRowInViewport(this._dragFillStartBottomRowViewport,this.dragFillStartBottomRow())},dragFillStartViewportBottomRowLayout:function(){return this._sheet._getRowLayout(this._dragStartRowViewport).findRow(this.dragFillStartViewportBottomRow())},dragFillStartViewportBottomRow:function(){return this._sheet.getViewportBottomRow(this._dragStartRowViewport)},getValidVerDragToRowLayout:function(){var n;return n=this.isIncreaseFill()?this.isDragToRowInView()?this.getCurrentDragToRowLayout():this.dragFillToViewportBottomRowLayout():this.isDragFillStartBottomRowInView?this.dragFillStartBottomRowLayout():this.dragFillStartViewportBottomRowLayout()},isDragToColumnInView:function(){return this.isColumnInViewport(this._dragToColumnViewport,this._dragToColumn)},isColumnInViewport:function(n,t){var r=this._sheet.getViewportLeftColumn(n),i=this._sheet.getViewportRightColumn(n);return t<r||t>i?!1:!0},getCurrentDragToColumnLayout:function(){return this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(this._dragToColumn)},isDragFillStartRightColumnInView:function(){return this.isColumnInViewport(this._dragFillStartRightColumnViewport,this.dragFillStartRightColumn())},dragFillStartViewportRightColumnLayout:function(){return this._sheet._getColumnLayout(this._dragStartColumnViewport).findCol(this.dragFillStartViewportRightColumn())},dragFillStartViewportRightColumn:function(){return this._sheet.getViewportRightColumn(this._dragStartColumnViewport)},getValidHorDragToColumnLayout:function(){var n;return n=this.isIncreaseFill()?this.isDragToColumnInView()?this.getCurrentDragToColumnLayout():this.dragFillToViewportRightColumnLayout():this.isDragFillStartRightColumnInView()?this.dragFillStartRightColumnLayout():this.dragFillStartViewportRightColumnLayout()},dragFillToViewportTopRowLayout:function(){return this._sheet._getRowLayout(this._dragToRowViewport).findRow(this.dragFillToViewportTopRow())},dragFillToViewportTopRow:function(){return this._sheet.getViewportTopRow(this._dragToRowViewport)},dragFillToViewportLeftColumnLayout:function(){return this._sheet._getColumnLayout(this._dragToColumnViewport).findCol(this.dragFillToViewportLeftColumn())},dragFillToViewportLeftColumn:function(){return this._sheet.getViewportLeftColumn(this._dragToColumnViewport)},getCurrentFillDirection:function(){switch(this._currentFillDirection){case i.UI.DragFillDirection.Left:return i.UI.FillDirection.Left;case i.UI.DragFillDirection.Right:return i.UI.FillDirection.Right;case i.UI.DragFillDirection.Up:return i.UI.FillDirection.Up;case i.UI.DragFillDirection.Down:return i.UI.FillDirection.Down;case i.UI.DragFillDirection.LeftClear:return i.UI.FillDirection.Left;case i.UI.DragFillDirection.UpClear:return i.UI.FillDirection.Up;default:break}return i.UI.FillDirection.Down},getMousePosition:function(n,t,r,u){var f=null,s,o,e;return u===i.UI.SheetArea.viewport?(s=this.getViewPortRect(),f=this.createMousePosition(n,t,r,s)):u===i.UI.SheetArea.rowHeader?(o=this.getRowHeaderRect(),f=this.createMousePosition(n,t,r,o)):u===i.UI.SheetArea.colHeader&&(e=this.getColHeaderRect(),f=this.createMousePosition(n,t,r,e)),f},getViewPortRect:function(){var r=this._sheet,n=r._getSheetLayout(),e=r._getColumnLayout(1,i.UI.SheetArea.viewport),o=r._getRowLayout(1,i.UI.SheetArea.viewport),t=null,f=this.beginHitTest.freezeInfo.freezeLeft,u=this.beginHitTest.freezeInfo.freezeTop;return f&&u?t=new i.UI.Rect(n.x+n.rowHeaderWidth,n.y+n.colHeaderHeight,n.frozenWidth,n.frozenHeight):!f&&u?t=new i.UI.Rect(n.viewportX,n.y+n.colHeaderHeight,n.viewportWidth,n.frozenHeight):f&&!u?t=new i.UI.Rect(n.x+n.rowHeaderWidth,n.viewportY,n.frozenWidth,n.viewportHeight):f||u||(t=new i.UI.Rect(n.viewportX,n.viewportY,n.viewportWidth,n.viewportHeight)),r._scrollLeftCol>r._getFirstPageLeftColumn()||(t.x=n.x+n.rowHeaderWidth,t.width=n.width-t.x),r._scrollTopRow>r._getFirstPageTopRow()||(t.y=n.y+n.colHeaderHeight,t.height=n.height-t.y),r._scrollLeftCol<r._getLastPageLeftColumn()||f||e.length<=0||(t.width=e[e.length-1].x+e[e.length-1].width-t.x),r._scrollTopRow<r._getLastPageTopRow()||u||o.length<=0||(t.height=o[o.length-1].y+o[o.length-1].height-t.y),t},getRowHeaderRect:function(){var r=this._sheet,n=r._getSheetLayout(),u=r._getRowLayout(1,i.UI.SheetArea.viewport),t=null,f=this.beginHitTest.freezeInfo.freezeTop;return t=f?new i.UI.Rect(n.headerX,n.headerY,n.rowHeaderWidth,n.frozenHeight):new i.UI.Rect(n.headerX,n.viewportY,n.rowHeaderWidth,n.viewportHeight),r._scrollTopRow===r._getFirstPageTopRow()&&(t.y=n.headerY+n.colHeaderHeight,t.height=n.height-t.y),r._scrollTopRow<r._getLastPageTopRow()||f||u.length<=0||(t.height=u[u.length-1].y+u[u.length-1].height-t.y),t},getColHeaderRect:function(){var r=this._sheet,n=r._getSheetLayout(),u=r._getColumnLayout(1,i.UI.SheetArea.viewport),t=null,f=this.beginHitTest.freezeInfo.freezeLeft;return t=f?new i.UI.Rect(n.headerX,n.headerY,n.frozenWidth,n.colHeaderHeight):new i.UI.Rect(n.viewportX,n.headerY,n.viewportWidth,n.colHeaderHeight),r._scrollLeftCol===r._getFirstPageLeftColumn()&&(t.x=n.headerX+n.rowHeaderWidth,t.width=n.width-t.x),r._scrollLeftCol<r._getLastPageLeftColumn()||f||u.length<=0||(t.width=u[u.length-1].x+u[u.length-1].width-t.x),t},createMousePosition:function(n,t,i,r){var u={top:!1,bottom:!1,left:!1,right:!1,distanceX:null,distanceY:null,nearMouseX:t,nearMouseY:i};return t>r.x?t<r.x+r.width||(u.right=!0):u.left=!0,i>r.y?i<r.y+r.height||(u.bottom=!0):u.top=!0,u.left?(u.distanceX=r.x-t,u.nearMouseX=r.x+.5):u.right&&(u.distanceX=t-r.x-r.width,u.nearMouseX=r.x+r.width-.5),u.top?(u.distanceY=r.y-i,u.nearMouseY=r.y+.5):u.bottom&&(u.distanceY=i-r.y-r.height,u.nearMouseY=r.y+r.height-.5),u},getIntervalFromDistance:function(n){var t=-1;return!isNaN(n)&&n>0&&(t=Math.ceil(500/n),t=Math.max(20,t*10),t>200&&(t=200)),t},updateRange:function(n,t,r,u){if(r===0||u===0)return;var e=this._sheet,y=i.UI.SheetArea.viewport,l=e._getRowLayout(0,y),a=e._getColumnLayout(0,y),s=e._getRowLayout(1,y),c=e._getColumnLayout(1,y),p=0;a&&a.length>0&&(p=a[a.length-1].col),c&&c.length>0&&(p=c[c.length-1].col);var h=this.getYForRow(n,t,r,u,!0,p,l,s),w=this.getYForRow(n,t,r,u,!1,p,l,s),b=0;l&&l.length>0&&(b=l[l.length-1].row),s&&s.length>0&&(b=s[s.length-1].row);var o=this.getXForCol(n,t,r,u,!0,b,a,c),v=this.getXForCol(n,t,r,u,!1,b,a,c),f=e._getSheetLayout();v>o&&w>h&&e._render.update(o-f.headerX-2,h-f.headerY-2,v-o+2*f.headerX+2,w-h+2*f.headerY+2),w>h&&e._render.update(f.headerX,h,f.rowHeaderWidth,w-h),v>o&&(e._render.update(o,f.headerY,v-o,f.colHeaderHeight),e._render.update(o,f.footerY,v-o,f.colHeaderHeight))},getYForRow:function(n,t,i,r,u,f,e,o){var a=this._sheet,h=n,c,l,s;u||(h=n+i-1);if(h<a.frozenRowCount){if(e.length<1)return-1}else{if(o.length<1)return-1;u?h<o[0].row&&(h=o[0].row):h>o[o.length-1].row&&(h=o[o.length-1].row)}for(c=0,u&&(c=9e4),l=Math.max(a._scrollLeftCol,t);l<t+r&&l<=f;l++)s=a.getCellRect(h,l),s&&(u?s.y<c&&(c=s.y):c<s.y+s.height&&(c=s.y+s.height));return c},getXForCol:function(n,t,i,r,u,f,e,o){var a=this._sheet,h=t,c,l,s;u||(h=t+r-1);if(h<a.frozenColCount){if(e.length<1)return}else{if(o.length<1)return;u?h<o[0].col&&(h=o[0].col):h>o[o.length-1].col&&(h=o[o.length-1].col)}for(c=0,u&&(c=9e4),l=Math.max(a._scrollTopRow,n);l<n+i&&l<=f;l++)s=a.getCellRect(l,h),s&&(u?s.x<c&&(c=s.x):c<s.x+s.width&&(c=s.x+s.width));return c},getResizingArea:function(){return 4},_getPrevVisualRowBeforeFindRow:function(n,t){var r=this._sheet,i=n;return r._render._isCellHiddenByGroup(i,0,t)?(i=r._getPrevVisualRow(i,t),i!==null?i:n):n},_getPrevVisualColBeforeFindCol:function(n,t){var r=this._sheet,i=n;return r._render._isCellHiddenByGroup(0,i,t)?(i=r._getPrevVisualColumn(i,t),i!==null?i:n):n},_getResizeRowInfo:function(n,t,i,r,u){var e=null,h=n._getRowLayout(t.rowViewportIndex,r),f,o,s;return isNaN(t.row)||isNaN(t.col)||(t.row=this._getPrevVisualRowBeforeFindRow(t.row,r),f=h.findRow(t.row),f&&(f.y+f.height-i<u&&u<f.y+f.height+i?(e={action:"sizeRow",index:t.row,sheetArea:r},o=n.getRowCount(r)-1,o<0||(s=n._getLastVisualRow(r),e.index===s&&e.index!==o&&f.y+f.height-i/2<u&&(e={action:"sizeRow",index:o,sheetArea:r}))):f.y-i<u&&u<f.y+i&&h.indexOf(f)>0&&(e={action:"sizeRow",index:t.row-1,sheetArea:r}))),e&&!n.getRowResizable(e.index,r)&&(e=null),e},_getResizeColInfo:function(n,t,i,r,u){var e=null,h=n._getColumnLayout(t.colViewportIndex,r),f,o,s;return isNaN(t.col)||isNaN(t.row)||(t.col=this._getPrevVisualColBeforeFindCol(t.col,r),f=h.findCol(t.col),f&&(f.x+f.width-i<u&&u<f.x+f.width+i?(e={action:"sizeCol",index:t.col,sheetArea:r},o=n.getColumnCount(r)-1,o<0||(s=n._getLastVisualColumn(r),e.index===s&&e.index!==o&&f.x+f.width-i/2<u&&(e={action:"sizeCol",index:o,sheetArea:r}))):f.x-i<u&&u<f.x+i&&h.indexOf(f)>0&&(e={action:"sizeCol",index:t.col-1,sheetArea:r}))),e&&!n.getColumnResizable(e.index,r)&&(e=null),e},getResizingRowCol:function(n,t,r){var u=this._sheet,f=null,s,o,e,h;return(!u.parent||u.parent._allowUserResize)&&(e=this.getResizingArea(),h=u._getSheetLayout(),n.rowViewportIndex<0&&n.colViewportIndex>=0?(f=this._getResizeColInfo(u,n,e,i.UI.SheetArea.colHeader,t),f||(f=this._getResizeRowInfo(u,n,e,i.UI.SheetArea.colHeader,r))):n.rowViewportIndex>=0&&n.colViewportIndex<0?(f=this._getResizeRowInfo(u,n,e,i.UI.SheetArea.rowHeader,r),f||(f=this._getResizeColInfo(u,n,e,i.UI.SheetArea.rowHeader,t))):n.rowViewportIndex<0&&n.colViewportIndex<0?u._getLastVisualRow(i.UI.SheetArea.rowHeader)!==null||Math.abs(r-h.colHeaderHeight)>e?u._getLastVisualColumn(i.UI.SheetArea.colHeader)!==null||Math.abs(t-h.rowHeaderWidth)>e||(o=u.getColumnCount()-1,o<0||(f={action:"sizeCol",index:o,sheetArea:i.UI.SheetArea.colHeader})):(s=u.getRowCount()-1,s<0||(f={action:"sizeRow",index:s,sheetArea:i.UI.SheetArea.rowHeader})):n.rowViewportIndex<0||n.colViewportIndex<0||(h.colHeaderHeight!==0||r>e?h.rowHeaderWidth!==0||t>e||(o=u.getColumnCount(i.UI.SheetArea.rowHeader)-1,o<0||(f={action:"sizeCol",index:o,sheetArea:i.UI.SheetArea.rowHeader})):(s=u.getRowCount(i.UI.SheetArea.colHeader)-1,s<0||(f={action:"sizeRow",index:s,sheetArea:i.UI.SheetArea.colHeader})))),f},getDragInfo:function(n,t,i){var u=null,e=this._sheet,o=e._getActiveSelectedRange(),r,f;return o.row===-1&&o.col===-1?u:(n.rowViewportIndex<0||n.colViewportIndex<0||e._selectionModel.length!==1||(r=e._getActiveSelectionRect(n.rowViewportIndex,n.colViewportIndex),r.x-4<t&&t<r.x+4&&r.y<=i&&i<r.y+r.height&&(u={action:"drag",side:"left"}),u||(f=this._sheet._dragFillIndicatorRect,!f||f.x>t||t>f.x+f.width||f.y>i||i>f.y+f.height||(u={action:"drag",side:"corner"})),u||r.x+r.width-4<t&&t<r.x+r.width+4&&r.y<=i&&i<r.y+r.height&&(u={action:"drag",side:"right"}),u||r.y-4<i&&i<r.y+4&&r.x<=t&&t<r.x+r.width&&(u={action:"drag",side:"top"}),u||r.y+r.height-4<i&&i<r.y+r.height+4&&r.x<=t&&t<r.x+r.width&&(u={action:"drag",side:"bottom"}),u&&(t<r.x||t>r.x+r.width||i<r.y||i>r.y+r.height)&&(u.outside=!0)),this._sheet.canUserDragDrop()||u&&u.side!=="corner"&&(u.side=null),this._sheet.canUserDragFill()||u&&u.side==="corner"&&(u.side=null),u)},doMouseMove:function(n){var t=this._getCanvasOffset();this.doMouseMoveImp(n,n.pageX-t.left,n.pageY-t.top)},doMouseOut:function(n){var i=this._sheet,t;if(this.isMouseDown)return;t={x:-1e4,y:-1e4,rowViewportIndex:null,colViewportIndex:null,row:-1,col:-1,resizeInfo:null,hitTestType:null},i._setHoverCell(t)},doMouseMoveImp:function(t,i,r){var o=this._sheet,f,u,e,c,y,v,p,a,l,h,s;if(this.isMouseDown){n.gcGlobal.activeElement||(n.gcGlobal.activeElement=o),f=o._currentTarget,u=f.resizeInfo;if(u){if(f.x===i&&f.y===r)return;e=o._getSheetLayout(),f.rowViewportIndex===-1&&f.colViewportIndex===-1&&(f.rowViewportIndex=1,f.colViewportIndex=1),u.action==="sizeRow"?(y=o._getRowLayout(f.rowViewportIndex,u.sheetArea),u.index=this._getPrevVisualRowBeforeFindRow(u.index,u.sheetArea),v=y.findRow(u.index),v||(v=y.findRow(f.row)),u.startY=v.y,u.movingY=r,u.movingY<v.y&&(u.movingY=v.y),c=e.y+e.height,u.movingY>c&&(u.movingY=c),o._render.update(e.x,u.startY,e.width,e.height-u.startY,!0)):(p=o._getColumnLayout(f.colViewportIndex,u.sheetArea),u.index=this._getPrevVisualColBeforeFindCol(u.index,u.sheetArea),a=p.findCol(u.index),a||(a=p.findCol(f.col)),u.startX=a.x,u.movingX=i,u.movingX<a.x&&(u.movingX=a.x),c=e.x+e.width,u.movingX>c&&(u.movingX=c),o._render.update(u.startX,e.y,e.width-u.startX,e.height,!0))}else f.dragInfo&&f.dragInfo.side!=="corner"?this.continueDragDropping(t,i,r):f.dragInfo&&f.dragInfo.side==="corner"?this.continueDragFill(t,i,r):this.continueSelecting(t,i,r)}else{l=o.hitTest(i,r);if(!l)return;h=o._getCanvas();if(!h)return;s=l.resizeInfo,s?h.style.cursor=s.action==="sizeCol"?"w-resize":s.action==="sizeRow"?"n-resize":"default":(s=l.dragInfo,s&&s.action==="drag"?s.side==="corner"?h.style.cursor="crosshair":s.side&&(h.style.cursor="move"):h.style.cursor="default"),l&&o._setHoverCell(l)}},doMouseUp:function(n){var i=this._sheet,t;return i.inCanvas||this.unhandleDocumentMouseMove(),t=this._getCanvasOffset(),this.doMouseUpImp(n,n.pageX-t.left,n.pageY-t.top),t=i._isMouseDownInSheet,!t},doMouseUpImp:function(t,r,u){var f=this._sheet,h,p,e,v,s,o,a,l,w,c,y;if(f._isMouseDownInSheet!==!0)return;else f._isMouseDownInSheet=!1;h=n.gcGlobal.activeElement,this.isMouseDown=!1,h&&h!==f&&h.endEdit&&(h.endEdit(),h.repaint()),p=f._currentTarget;if(f._currentTarget){e=p.resizeInfo;if(e){if(e.action==="sizeRow"){if(e.movingY!==undefined&&e.movingY!==null){v=Math.max(0,(e.movingY-e.startY)/f._zoomFactor),l=[];if(f._isRowSelected(e.index))for(s=0;s<f._selectionModel.length;s++)o=f._selectionModel[s],o.col===-1&&(o=f._getActualRange(o),l.push({firstRow:o.row,lastRow:o.row+o.rowCount-1}));else l.push({firstRow:e.index,lastRow:e.index});w=e.sheetArea===i.UI.SheetArea.colHeader,a=new i.UI.UndoRedo.RowResizeUndoAction(f,l,v,w),f._doCommand(a)}}else if(e.movingX!==undefined&&e.movingX!==null){v=Math.max(0,(e.movingX-e.startX)/f._zoomFactor),c=[];if(f._isColumnSelected(e.index))for(s=0;s<f._selectionModel.length;s++)o=f._selectionModel[s],o.row===-1&&(o=f._getActualRange(o),c.push({firstCol:o.col,lastCol:o.col+o.colCount-1}));else c.push({firstCol:e.index,lastCol:e.index});y=e.sheetArea===i.UI.SheetArea.rowHeader,a=new i.UI.UndoRedo.ColumnResizeUndoAction(f,c,v,y),f._doCommand(a)}}else f._currentTarget.dragInfo&&!this.isDraggingFill?(this.stopDragDrop(t),f._currentTarget=null):f._currentTarget.dragInfo&&this.isDraggingFill===!0?(this.endDragFill(t),f._currentTarget=null):f._trigger(i.UI.Events.CellClick,{sheet:f,sheetName:f._name,sheetArea:f._currentTarget.hitTestType,row:f._currentTarget.row,col:f._currentTarget.col})}n.gcGlobal.activeElement=f,this.stopSelecting(),this.setMetaKeyState(t)},startEdit:function(n){var i=this._sheet,r=i._getCanvas(),t=this._getCanvasOffset();n.shiftKey||n.ctrlKey||i._doStartEdit(r,n.pageX-t.left,n.pageY-t.top)},doKeyDown:function(n){var r=this._sheet,t=!r._isEditing&&!n.ctrlKey&&(n.keyCode===i.UI.Key.pdn||n.keyCode===i.UI.Key.pup||n.keyCode===i.UI.Key.left||n.keyCode===i.UI.Key.right||n.keyCode===i.UI.Key.tab||n.keyCode===i.UI.Key.up||n.keyCode===i.UI.Key.down);if(t){if(this._keyPressed){this._keyPressedCount<5&&this._keyPressedCount++,i.UI.cancelDefault(n);return}this._keyPressed=!0,this._keyPressedCount=1,this._repeatKeyDown(n)}else this._keyDownImp(n)},_repeatKeyDown:function(t){if(!this._keyPressed)return;var i=this;i._keyDownImp(t),this._keyPressed&&n.setTimeout(function(){i._repeatKeyDown(t)},100/this._keyPressedCount)},_keyDownImp:function(n){var t=this._sheet,r;this.setMetaKeyState(n),n.keyCode===i.UI.Key.tab&&i.UI.cancelDefault(n),t._isEditing||n.keyCode!==i.UI.Key.pdn&&n.keyCode!==i.UI.Key.pup&&n.keyCode!==i.UI.Key.end&&n.keyCode!==i.UI.Key.home&&n.keyCode!==i.UI.Key.up&&n.keyCode!==i.UI.Key.down||i.UI.cancelDefault(n),t._isEditing||n.keyCode!==i.UI.Key.left&&n.keyCode!==i.UI.Key.right||i.UI.cancelDefault(n);if(!t._processKeyMap(n))return;r=t._getCanvas(),r&&this.allowEnterEditing(n)&&t._startEditImp(r,t._activeRowIndex,t._activeColIndex,null,null,!0)},doKeyUp:function(n){this._keyPressed=!1,this.setMetaKeyState(n)},allowEnterEditing:function(n){if(n.ctrlKey||n.altKey||n.shiftKey)return!1;if(n.keyCode<65||n.keyCode>90)if((n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105))if(n.keyCode<186||n.keyCode>192)if((n.keyCode<220||n.keyCode>222)&&n.keyCode!==219)if(n.keyCode<106||n.keyCode>111){if(n.keyCode===32)return!0;else if(n.keyCode===61)return!0;else if(n.keyCode===173)return!0;else if(n.keyCode===229||n.keyCode===0)return!0}else return!0;else return!0;else return!0;else return!0;else return!0;return!1},setMetaKeyState:function(n){var t=this._sheet,r;this.shift=n.shiftKey&&!n.ctrlKey,this.ctrl=n.ctrlKey&&!n.shiftKey,t._isNavigateInSelection=!1,n.keyCode===i.UI.Key.tab&&(t._selectionModel.length>1?t._isNavigateInSelection=!0:(r=t._getActiveSelectedRange(),r&&t._selectionModel.length>0&&(t._isNavigateInSelection=!(t._activeRowIndex===r.row&&t._activeColIndex===r.col&&t._activeRowCount===r.rowCount&&t._activeColCount===r.colCount))));if(this.isDragDropping===!0){var u=t._getActiveSelectedRange(),e=this._isDragInsert,f=this._isDragCopy;this._isDragInsert=u.row===-1||u.col===-1?n.shiftKey:!1,this._isDragCopy=n.ctrlKey,(e!==this._isDragInsert||f!==this._isDragCopy)&&t._render.refreshDragDropIndicator()}this.isShiftPressed=n.shiftKey,this.isControlPressed=n.ctrlKey},doMouseWheel:function(t,r){var u=this._sheet,e,o;if(!u.endEdit())return;if(t.ctrlKey){if(!u.parent||u.parent._allowUserZoom){var s=u._zoomFactor,f=u._zoomFactor-.05*r,h=new i.UI.UndoRedo.ZoomUndoAction(u,f);u._doCommand(h),f=u._zoomFactor,s!==f&&u._trigger(i.UI.Events.UserZooming,{sheet:u,sheetName:u._name,oldZoomFactor:s,newZoomFactor:f});return}}else e=u._scrollTopRow,u.frozenRowCount>0&&(u._scrollTopRow===0&&r>0?u._scrollTopRow=u.frozenRowCount:r<0&&u._scrollTopRow===u.frozenRowCount-r&&(u._scrollTopRow=0)),u._scrollTopRow=u._scrollTopRow+r,u._scrollTopRow<u._getFirstPageTopRow()?u._scrollTopRow=u._getFirstPageTopRow():u._scrollTopRow>u._getLastVisualRow()&&(u._scrollTopRow=u._getLastVisualRow()),e!==u._scrollTopRow&&u._trigger(i.UI.Events.TopRowChanged,{sheet:u,sheetName:u._name,oldTopRow:e,newTopRow:u._scrollTopRow}),o=this,this.scrollTimer||(this.scrollTimer=n.setInterval(function(){o._scrollView()},this.waittime)),this.scrolling=!0;u.invalidateLayout(),u.repaint(),u._syncVScrollbarPosition()},waittime:100,scrollTop:0,scrollLeft:0,oldLeft:0,oldTop:0,doVScroll:function(t){var r=this._sheet,i;if(!r.endEdit())return;this.scrolling=!0,r._scrollTopRow=t,i=this,this.scrollTimer||(this.scrollTimer=n.setInterval(function(){i._scrollView()},this.waittime))},doHScroll:function(t){var r=this._sheet,i;if(!r.endEdit())return;this.scrolling=!0,r._scrollLeftCol=t,i=this,this.scrollTimer||(this.scrollTimer=n.setInterval(function(){i._scrollView()},this.waittime))},_scrollView:function(){var r;if(!this.scrolling){if(this.scrollTimer){n.clearInterval(this.scrollTimer),this.scrollTimer=null,this._sheet.repaint(),r=this.oldTop!==this._sheet._scrollTopRow,this.oldTop=this._sheet._scrollTopRow,this.oldLeft=this._sheet._scrollLeftCol;if(r){var i=this._sheet.getViewportTopRow(1),u=this._sheet.getViewportBottomRow(1),t=Math.max(0,i-60);t<this._sheet.getRowCount()&&this._loadData(t,2*u-i)}}return}this.scrolling=!1,this._updateView()},_getLoadingProgress:function(n){var o=n+"_loading",i=t("#"+o),e,u,f;return i&&i.length!==0||(e=r.createElement("div"),i=t(e),i.attr("id",o),i.css("textAlign","center"),i.css("background-color","#DCDCDC"),r.body.insertBefore(e,null)),i.css("position","absolute"),u=t("#"+n),f=u.position(),i.css("left",f.left),i.css("top",f.top),i.css("width",u.width()),i.css("height",u.height()),{show:function(){i.fadeIn("fast"),i.append("postback and loading ...")},hide:function(){i.fadeOut("fast"),i.html("")}}},_loadData:function(t,i){var u,r;if(!this._sheet.parent||!this._sheet.parent._host)return;this._sheet.dataContext&&this._sheet.dataContext.read?(u=this,this._dataContextLoadDelegate=function(n,t){return u._dataContextLoaded(n,t)},this.lastLoadedRowIndex=t,jQuery.ajax({url:this._sheet.dataContext.read,type:"POST",data:JSON.stringify({index:t,count:i-t+1}),dataType:"json",contentType:"application/json;charset=UTF-8",success:this._dataContextLoadDelegate})):(r=this._sheet.parent._host.id,r&&r.length>0&&typeof n.WebForm_DoCallback!="undefined"&&(this.lastLoadedRowIndex=t,this._doLoadData(r,t,i)))},_dataContextLoaded:function(n,t){var r=n.data,u,f,i;if(r&&r.length>0){u=this._sheet,f=u.getDataSource();if(f&&this.lastLoadedRowIndex===n.start)for(i=0;i<r.length;i++)f[n.start+i]=r[i];u.recalcAll(),u.repaint()}},_doCallBack:function(i,u){var o=this._sheet.parent._host.id,f,h,e,s;if(o&&o.length>0&&typeof n.WebForm_DoCallback!="undefined"){f=t(r.forms);if(!f||f.length===0)return;f=f[0],f.__EVENTTARGET.value=o,f.__EVENTARGUMENT.value=i,this._sheet.parent.saveData(),n.__theFormPostCollection.length=0,n.__theFormPostData="",n.WebForm_InitCallback(),n.__theFormPostData="gcallback=true&"+n.__theFormPostData,f.__EVENTVALIDATION&&(n.__theFormPostData+="&__EVENTVALIDATION="+WebForm_EncodeCallback(f.__EVENTVALIDATION.value)),h=f.action,e=this._getLoadingProgress(o),e&&e.show(),s=this,this._updateDelegate=function(n,t){return e.hide(),s._onUpdateCallback(n,t)},this._errorDelegate=function(n,t){e.hide()},t.ajax({url:h,type:"POST",data:n.__theFormPostData,dataType:"html",contentType:"application/x-www-form-urlencoded, charset=UTF-8",success:this._updateDelegate,error:this._errorDelegate})}},_doLoadData:function(i,u,f){var a={start:u,end:f},l=this._sheet.hasPendingChanges(),c=this,e,s,h,o;if(l){e=t(r.forms);if(!e||e.length===0)return;e=e[0],s="loadData,"+u+","+f,e.__EVENTTARGET.value=i,e.__EVENTARGUMENT.value=s,this._sheet.parent.saveData(),n.__theFormPostCollection.length=0,n.__theFormPostData="",n.WebForm_InitCallback(),n.__theFormPostData="gcallback=true&"+n.__theFormPostData,e.__EVENTVALIDATION&&(n.__theFormPostData+="&__EVENTVALIDATION="+WebForm_EncodeCallback(e.__EVENTVALIDATION.value)),h=e.action,o=this._getLoadingProgress(i),o&&o.show(),this._updateDelegate=function(n,t){return o.hide(),c._onUpdateCallback(n,t)},this._errorDelegate=function(n,t){o.hide()},t.ajax({url:h,type:"POST",data:n.__theFormPostData,dataType:"html",contentType:"application/x-www-form-urlencoded, charset=UTF-8",success:this._updateDelegate,error:this._errorDelegate})}else this._loadDataDelegate=function(n,t){return c._onLoadDataCallback(n,t)},this._sheet.parent.saveData(),n.__theFormPostCollection.length=0,n.__theFormPostData="",n.WebForm_InitCallback(),n.WebForm_DoCallback(i,"loadData,"+u+","+f,this._loadDataDelegate,a,null,!0)},_onUpdateCallback:function(n,i){var s,o,e,u,f,h;this._sheet.clearPendingChanges(),s=r;try{s.selection.empty()}catch(c){}o=s.createElement("div");if(!o)return;o.innerHTML=n,e=t(r.forms);if(!e||e.length===0)return;e=e[0],e.__EVENTTARGET.value="",e.__EVENTARGUMENT.value="",u=s.getElementById("__VIEWSTATE"),f=this.getElementById(o,"__VIEWSTATE"),u&&f&&(u.value=f.value),u=s.getElementById("__EVENTVALIDATION"),f=this.getElementById(o,"__EVENTVALIDATION"),u&&f&&(u.value=f.value),h=this._sheet.parent._host.id,u=r.getElementById(h+"_data"),f=this.getElementById(o,h+"_data"),u&&f&&(u.value=f.value),o.innerHTML="",this._sheet.parent._loadData(!0),this._sheet.parent.invalidateLayout(),this._sheet.parent.repaint()},getElementById:function(n,t){var i,r;if(!n)return null;i=n.firstChild;while(i){if(i.id===t||i.name===t)return i;r=this.getElementById(i,t);if(r)return r;i=i.nextSibling}return null},_onLoadDataCallback:function(n,t){var i,f,s,r,c,l,e,a,o,u,h;if(!n)return;i=this._sheet,f=JSON.parse(n);if(!f)return;s=f.dataSource;if(s&&s.length>0){c=i.getDataSource();if(c&&this.lastLoadedRowIndex===t.start)for(l=JSON.parse(s),r=0;r<l.length;r++)c[t.start+r]=l[r]}e=f.data;if(e)if(this.lastLoadedRowIndex===t.start){for(r in e)typeof r!="function"&&(i._dataModel.dataTable[r]=e[r]);if(f.rows)for(r in f.rows)typeof r!="function"&&(i._rowInfos[r]=f.rows[r]);i.suspendCalcService(),i.suspendEvent(),i.isPaintSuspended(!0),a=i.getColumnCount();for(r in e)if(typeof r!="function"){o=e[r];if(o)for(u=0;u<a;u++)h=null,o[u]&&(h=o[u].formula),h&&(o[u].formula=null,i.setFormula(parseInt(r,10),u,h))}i.resumeCalcService(),i.resumeEvent(),i.isPaintSuspended(!1)}i.suspendEvent(),i.isPaintSuspended(!0),i.recalcAll(),i.resumeEvent(),i.isPaintSuspended(!1),i.clearPendingChanges(),i.repaint()},_updateView:function(){var n=this._sheet,t;if(this.painting)return;this.painting=!0,t=!1,this.oldTop!==n._scrollTopRow&&this.oldLeft===n._scrollLeftCol?t=this._vScrollView(n):this.oldTop===n._scrollTopRow&&this.oldLeft!==n._scrollLeftCol&&(t=this._hScrollView(n)),t||(n.invalidateLayout(),n.repaint()),this.painting=!1},_vScrollView:function(n){var e=!1,o=this.oldTop,t,s,u,r,f;if(n._scrollTopRow>o)s=n._getRowLayout(1,i.UI.SheetArea.viewport),u=s.findRow(n._scrollTopRow),u&&(e=!0,t=n._getSheetLayout(),n._render.translateScreen(t.x,u.y,t.rowHeaderWidth+t.frozenWidth+t.viewportWidth,t.viewportHeight-u.y,t.x,t.viewportY),n.invalidateLayout(),n._render.update(t.x,t.viewportY+t.viewportHeight-u.y,t.rowHeaderWidth+t.frozenWidth+t.viewportWidth,u.y,!1));else{for(t=n._getSheetLayout(),r=0,f=n._scrollTopRow;f<o&&r<t.viewportHeight;f++)r+=n._getZoomRowHeight(f);r<t.viewportHeight&&(e=!0,n._render.translateScreen(t.x,t.viewportY,t.rowHeaderWidth+t.frozenWidth+t.viewportWidth,t.viewportHeight-r,t.x,t.viewportY+r),n.invalidateLayout(),n._render.update(t.x,t.viewportY,t.rowHeaderWidth+t.frozenWidth+t.viewportWidth,r,!1))}return e},_hScrollView:function(n){var e=!1,o=this.oldLeft,t,s,u,r,f;if(n._scrollLeftCol>o)s=n._getColumnLayout(1,i.UI.SheetArea.viewport),u=s.findCol(n._scrollLeftCol),u&&(e=!0,t=n._getSheetLayout(),n._render.translateScreen(u.x,t.y,t.viewportWidth-u.x,t.colHeaderHeight+t.frozenHeight+t.viewportHeight,t.viewportX,t.y),n.invalidateLayout(),n._render.update(t.viewportX+t.viewportWidth-u.x,t.y,u.x,t.colHeaderHeight+t.frozenHeight+t.viewportHeight,!1));else{for(t=n._getSheetLayout(),r=0,f=n._scrollLeftCol;f<o&&r<t.viewportWidth;f++)r+=n._getZoomColumnWidth(f);r<t.viewportWidth&&(e=!0,n._render.translateScreen(t.viewportX,t.y,t.viewportWidth-r,t.colHeaderHeight+t.frozenHeight+t.viewportHeight,t.viewportX+r,t.y),n.invalidateLayout(),n._render.update(t.viewportX,t.y,r,t.colHeaderHeight+t.frozenHeight+t.viewportHeight,!1))}return e},_notEqualSelecions:function(n,t){var f=!0,r,i,u;if(n.length===t.length)for(r=0;r<n.length;r++){i=n[r],u=t[r];if(i.row!==u.row||i.col!==u.col||i.rowCount!==u.rowCount||i.colCount!==u.colCount){f=!0;break}else f=!1}return f},_setFocus:function(){var n,t,i,u;this._focusElem||(n=r.createElement("div"),n.style.top="10px",n.style.left="-1000px",n.style.position="absolute",n.style.overflow="hidden",n.style.width="2px",t=r.createElement("input"),t.type="text",t.style.top="10px",t.style.left="10px",t.style.position="absolute",t.className="gcSheetFocusInputStyle",t.setAttribute("gcUIElement","gcSheetFocusInput"),n.style.top=""+(Math.max(r.documentElement.scrollTop,r.body.scrollTop)+10)+"px",n.style.left=""+(Math.max(r.documentElement.scrollLeft,r.body.scrollLeft)+10)+"px",n.insertBefore(t,null),i=null,u=this._sheet._getCanvas(),u&&(i=u.parentNode),i&&i.insertBefore(n,null),this._focusElem=t),r.body.focus(),this._focusElem.focus()},bind:function(n,i,r){t(this._getElem()).bind(n,i,r)},unbind:function(n,i){t(this._getElem()).unbind(n,i)},trigger:function(n,i){this._eventSuspended===0&&t(this._getElem()).trigger(n,i)}},f.Events={ValidationError:"ValidationError",CellClick:"CellClick",CellDoubleClick:"CellDoubleClick",EnterCell:"EnterCell",LeaveCell:"LeaveCell",ValueChanged:"ValueChanged",TopRowChanged:"TopRowChanged",LeftColumnChanged:"LeftColumnChanged",InvalidOperation:"InvalidOperation",RangeFiltering:"RangeFiltering",RangeFiltered:"RangeFiltered",RangeSorting:"RangeSorting",RangeSorted:"RangeSorted",ClipboardChanging:"ClipboardChanging",ClipboardChanged:"ClipboardChanged",ClipboardPasting:"ClipboardPasting",ClipboardPasted:"ClipboardPasted",ColumnWidthChanging:"ColumnWidthChanging",ColumnWidthChanged:"ColumnWidthChanged",RowHeightChanging:"RowHeightChanging",RowHeightChanged:"RowHeightChanged",DragDropBlock:"DragDropBlock",DragDropBlockCompleted:"DragDropBlockCompleted",DragFillBlock:"DragFillBlock",DragFillBlockCompleted:"DragFillBlockCompleted",EditStarting:"EditStarting",EditChange:"EditChange",EditEnd:"EditEnd",RangeGroupStateChanging:"RangeGroupStateChanging",RangeGroupStateChanged:"RangeGroupStateChanged",SelectionChanging:"SelectionChanging",SelectionChanged:"SelectionChanged",SheetTabClick:"SheetTabClick",SheetTabDoubleClick:"SheetTabDoubleClick",UserZooming:"UserZooming",UserFormulaEntered:"UserFormulaEntered",CellChanged:"CellChanged",ColumnChanged:"ColumnChanged",RowChanged:"RowChanged",ActiveSheetChanging:"ActiveSheetChanging",ActiveSheetChanged:"ActiveSheetChanged",SparklineChanged:"SparklineChanged",RangeChanged:"RangeChanged"}})(window,jQuery);(function(n){"use strict";function u(n,t){for(var r,i=0;i<n.length;i++){r=n[i];if(t(r))return r}return null}var f=n.GrapeCity,c="undefined",h,t,r,e,i,l,o,s;typeof f===c&&(f={}),typeof f.UI===c&&(f.UI={}),h=f,t=h.UI,t.Range=function(n,t,i,r){this.row=n,this.rowCount=i,this.col=t,this.colCount=r},t.Range.prototype={intersect:function(n,t,i,r){return(n===-1||this.row===-1||this.row<n+i&&n<this.row+this.rowCount)&&(t===-1||this.col===-1||this.col<t+r&&t<this.col+this.colCount)},contains:function(n,i,r,u){if(arguments.length===2)return(this.row===-1||this.row<=n&&n<this.row+this.rowCount)&&(this.col===-1||this.col<=i&&i<this.col+this.colCount);else if(arguments.length===4)return this.containsRange(new t.Range(n,i,r,u))},containsRange:function(n){return(this.row===-1||this.row<=n.row&&n.row+n.rowCount<=this.row+this.rowCount)&&(this.col===-1||this.col<=n.col&&n.col+n.colCount<=this.col+this.colCount)},offset:function(n,i){var u=this.col,r=this.row;return this.col!==-1&&(u+=n),this.row!==-1&&(r+=i),new t.Range(r,u,this.rowCount,this.colCount)},union:function(n){var r=Math.min(this.row,n.row),i=Math.min(this.col,n.col),f=Math.max(this.row+this.rowCount-1,n.row+n.rowCount-1),u=Math.max(this.col+this.colCount-1,n.col+n.colCount-1);return new t.Range(r,i,f-r+1,u-i+1)},equals:function(n){return n instanceof t.Range?this.row===n.row&&this.col===n.col&&this.rowCount===n.rowCount&&this.colCount===n.colCount:!1}},t.SheetArea={corner:0,colHeader:1,rowHeader:2,viewport:3},t.CopyToOption={Value:1,Formula:2,RangeGroup:8,Sparkline:16,Span:32,Style:64,Tag:128},r=t.CopyToOption,r.All=r.Value|r.Formula|r.RangeGroup|r.Sparkline|r.Span|r.Style|r.Tag,e="This operation will cause overlapping spans.",t._SpanModel=function(){},t._SpanModel.prototype=[],i=t._SpanModel.prototype,i.find=function(n,t){return u(this,function(i){return i.contains(n,t)})},i.remove=function(n){for(var t=0;t<this.length;t++)if(this[t]===n){this.splice(t,1);return}},i.copy=function(n,i,r,u,f,o){var a=!1,v=this.length,s,l,h,c;if(n===-1){for(c=[],h=0;h<v;h++)s=this[h],i<=s.col&&s.col<i+o?(c.push(new t.Range(s.row,u+s.col-i,s.rowCount,s.colCount)),a=!0):u<=s.col&&s.col<u+o&&(this.splice(h,1),h--,v--,a=!0);for(h=0;h<c.length;h++){l=c[h];if(!this.isValid(this,0,this.length,l))throw new Error(e);this.push(l)}}else if(i===-1){for(c=[],h=0;h<v;h++)s=this[h],n<=s.row&&s.row<n+f?(c.push(new t.Range(r+s.row-n,s.col,s.rowCount,s.colCount)),a=!0):r<=s.row&&s.row<r+f&&(this.splice(h,1),h--,v--,a=!0);for(h=0;h<c.length;h++){l=c[h];if(!this.isValid(this,0,this.length,l))throw new Error(e);this.push(l)}}else{for(c=[],h=0;h<v;h++)s=this[h],n<=s.row&&s.row<n+f&&i<=s.col&&s.col<i+o?(c.push(new t.Range(r+s.row-n,u+s.col-i,s.rowCount,s.colCount)),a=!0):r<=s.row&&s.row<r+f&&u<=s.col&&s.col<u+o&&(this.splice(h,1),h--,v--,a=!0);for(h=0;h<c.length;h++){l=c[h];if(!this.isValid(this,0,this.length,l))throw new Error(e);this.push(l)}}},i.isValid=function(n,t,i,r){for(var f,u=t;u<i&&u<n.length;u++){f=n[u];if(f.intersect(r.row,r.col,r.rowCount,r.colCount))return!1}return!0},i.getEnumerator=function(n,i,r,u){return new t._SpanEnumerator(this,n,i,r,u)},i.clear=function(n,t,i,r){for(var u,f=0;f<this.length;f++)u=this[f],(n===-1||n<=u.row&&u.row<n+i)&&(t===-1||t<=u.col&&u.col<t+r)&&this.splice(f--,1)},i.move=function(n,i,r,u,f,o){var a=!1,l=new t._SpanModel,v=[],p=this.length,s,y=t.Range,h,c;if(n===-1)for(h=0;h<p;h++)s=this[h],i<=s.col&&s.col<i+o?(c=new y(s.row,u+s.col-i,s.rowCount,s.colCount),v.push(c),a=!0):u<s.col&&s.col<u+o?a=!0:l.push(s);else if(i===-1)for(h=0;h<p;h++)s=this[h],n<=s.row&&s.row<n+f?(c=new y(r+s.row-n,s.col,s.rowCount,s.colCount),v.push(c),a=!0):r<=s.row&&s.row<r+f?a=!0:l.push(s);else for(h=0;h<p;h++)s=this[h],n<=s.row&&s.row<n+f&&i<=s.col&&s.col<i+o?(c=new y(r+s.row-n,u+s.col-i,s.rowCount,s.colCount),v.push(c),a=!0):r<=s.row&&s.row<r+f&&u<=s.col&&s.col<u+o?a=!0:l.push(s);if(a){if(v.length>0)for(h=0;h<v.length;h++){c=v[h];if(!this.isValid(l,0,l.length,c))throw new Error(e);l.push(c)}for(this.length=0,h=0;h<l.length;h++)this.push(l[h])}},i.isEmpty=function(){return this.length<=0?!0:!1},i.addRows=function(n,i){for(var e=!1,o=this.length,f=t.Range,r,u=0;u<o;u++)r=this[u],r.row<n?r.row<n&&n<r.row+r.rowCount&&(this[u]=new f(r.row,r.col,r.rowCount+i,r.colCount),e=!0):(this[u]=new f(r.row+i,r.col,r.rowCount,r.colCount),e=!0)},i.addColumns=function(n,i){for(var e=!1,o=this.length,f=t.Range,r,u=0;u<o;u++)r=this[u],r.col<n?r.col<n&&n<r.col+r.colCount&&(this[u]=new f(r.row,r.col,r.rowCount,r.colCount+i),e=!0):(this[u]=new f(r.row,r.col+i,r.rowCount,r.colCount),e=!0)},i.removeRows=function(n,i){for(var e=!1,f=[],h=this.length,s=t.Range,r,o,u=0;u<h;u++)r=this[u],r.row<n?r.row<n&&n<r.row+r.rowCount&&(this[u]=new s(r.row,r.col,r.rowCount-Math.min(r.row+r.rowCount-n,i),r.colCount),this[u].rowCount===1&&this[u].colCount===1&&f.push(u),e=!0):r.row<n+i?(f.push(u),e=!0):(this[u]=new s(r.row-i,r.col,r.rowCount,r.colCount),e=!0);for(u=0;u<f.length;u++)o=f[u],this.splice(o,1)},i.removeColumns=function(n,i){for(var e=!1,f=[],h=this.length,s=t.Range,r,o,u=0;u<h;u++)r=this[u],r.col<n?r.col<n&&n<r.col+r.colCount&&(this[u]=new s(r.row,r.col,r.rowCount,r.colCount-Math.min(r.col+r.colCount-n,i)),this[u].rowCount===1&&this[u].colCount===1&&f.push(u),e=!0):r.col<n+i?(f.push(u),e=!0):(this[u]=new s(r.row,r.col-i,r.rowCount,r.colCount),e=!0);for(u=0;u<f.length;u++)o=f[u],this.splice(o,1)},t._SpanEnumerator=function(n,t,i,r,u){this.model=n,this.row=t,this.column=i,this.rowCount=r,this.columnCount=u,this.currentIndex=-1,t===-1&&i===-1&&(this.all=!0)},t._SpanEnumerator.prototype={current:function(){return 0<=this.currentIndex&&this.currentIndex<this.model.length?this.model[this.currentIndex]:null},moveNext:function(){this.currentIndex++;if(!this.all)while(this.currentIndex<this.model.length&&!this.model[this.currentIndex].intersect(this.row,this.column,this.rowCount,this.columnCount))this.currentIndex++;return this.currentIndex<this.model.length},reset:function(){this.currentIndex=-1}},t._CellOverflowLayoutModel=function(){},t._CellOverflowLayoutModel.prototype=[],l=t._CellOverflowLayoutModel.prototype,l.find=function(n){return u(this,function(t){return t.contains(n)})},t._CellOverflowLayout=function(n,t,i,r,u,f,e){this.column=n,this.startCol=t,this.endCol=i,this.columnWidth=u,this.hAlign=f,this.columnPrevWidth=e},t._CellOverflowLayout.prototype.contains=function(n){return n>=this.startCol&&n<=this.endCol},t._CellOverflowValueLayoutModel=function(){},t._CellOverflowValueLayoutModel.prototype=[],t._CellOverflowValueLayoutModel.prototype.find=function(n){return u(this,function(t){return t.contains(n)})},t._CellOverflowValueLayout=function(n,t,i,r,u,f,e,o,s){this.data=n,this.row=t,this.col=i,this.x=r,this.y=u,this.width=f,this.height=e,this.sheetArea=o,this.cellOverflowLayout=s},t._CellOverflowValueLayout.prototype.contains=function(n){return n===this.cellOverflowLayout.column},t._SelectionModel=function(){},t._SelectionModel.prototype=[],o=t._SelectionModel.prototype,o.find=function(n,t){return u(this,function(i){return i.contains(n,t)})},o.clear=function(){this.splice(0,this.length),this.activeSelectedRangeIndex=-1},o.add=function(n,i,r,u){var f=new t.Range(n,i,r,u);this.push(f),this.activeSelectedRangeIndex=this.length-1},o.toArray=function(){for(var t=[],n=0;n<this.length;n++)t.push(this[n]);return t},t._LayoutModel=function(){},t._LayoutModel.prototype=[],s=t._LayoutModel.prototype,s.findCell=function(n,t){return u(this,function(i){return i.contains(n,t)})},s.findRow=function(n){return u(this,function(t){return t.row===n})},s.findCol=function(n){return u(this,function(t){return t.col===n})},t._Layout=function(n,t,i,r,u,f,e,o){this.rowCount=e,this.colCount=o,this.row=n,this.col=t,this.x=i,this.y=r,this.width=u,this.height=f},t._Layout.prototype.contains=function(n,t){return n<this.row+this.rowCount&&this.row<=n&&t<this.col+this.colCount&&this.col<=t},t._Layout.prototype.intersect=function(n){return(this.x<0||n.x<this.x+this.width&&this.x<n.x+n.width)&&(this.y<0||n.y<this.y+this.height&&this.y<n.y+n.height)},t._GcSheetModel=function(n,t,i){this.rowCount=n!==null&&n!==undefined?n:200,this.colCount=t!==null&&t!==undefined?t:20,this.name=i,this.dataTable={},this._rowDataArray=[],this._columnDataArray=[],this._defaultDataNode=null,this.dirtyNodes={}},t._GcSheetModel.prototype={getRowCount:function(){return this.rowCount},getColumnCount:function(){return this.colCount},_updateDirty:function(n,t){if(n>=0&&t>=0){var i=this.dataTable[n];i.rs!=="n"&&(i.rs="e"),this.dirtyNodes[n]=i}},getValue:function(n,t){var i=this.getNode(n,t);return i&&i.value!==undefined&&i.value!==null?i.value:null},setValue:function(n,t,i){var r=this.getNode(n,t,!0);r.value!==i&&(r.value=i,this._updateDirty(n,t))},getSparkline:function(n,t){var i=this.getNode(n,t);return i&&i.sparkline?i.sparkline:null},setSparkline:function(n,t,i){var r=this.getNode(n,t,!0);r.sparkline!==i&&(r.sparkline=i,this._updateDirty(n,t))},setFormula:function(n,t,i){var r=this.getNode(n,t,!0);r.formula!==i&&(r.formula=i,this._updateDirty(n,t))},getFormula:function(n,t){var i=this.getNode(n,t);if(i)return i.formula},getStyle:function(n,t){var i=this.getNode(n,t);if(i)return i.style},setStyle:function(n,t,i){var r=this.getNode(n,t,!0);r&&r.style!==i&&(r.style=i,this._updateDirty(n,t))},getVisualState:function(n,t){var i=this.getNode(n,t);if(i)return i.visualState},setVisualState:function(n,t,i){var r=this.getNode(n,t,!0);r.visualState!==i&&(r.visualState=i,this._updateDirty(n,t))},addRows:function(n,t){if(n<0||n>this.rowCount||t<0)return;this.addElements(this.dataTable,this.rowCount,n,t),this.addElements(this._rowDataArray,this.rowCount,n,t),this.addElements(this.dirtyNodes,this.rowCount,n,t),this.rowCount+=t;for(var i=0;i<t;i++)this.dataTable[n+i]={rs:"n"},this.dirtyNodes[n+i]=this.dataTable[n+i]},deleteRows:function(n,t){var i=this.rowCount;if(n<0||n>=i||t<=0)return;n+t>i&&(t=i-n),this.deleteElements(this.dataTable,i,n,t),this.deleteElements(this._rowDataArray,i,n,t),this.deleteElements(this.dirtyNodes,i,n,t),this.rowCount-=t},addElements:function(n,t,i,r){var u,f,o,e,s;if(0<=i&&i<t){u=[];for(f in n)!n.hasOwnProperty(f)||isNaN(f)||f<i||u.push(f);for(u.sort(function(n,t){return n-t}),o=0;o<u.length;o++)e=u[u.length-o-1],s=n[e],n[e]=null,n[parseInt(e,10)+r]=s}},deleteElements:function(n,t,i,r){var f,u,o,e,s;if(0<=i&&i<t){f=[];for(u in n)n.hasOwnProperty(u)&&!isNaN(u)&&(i<=u&&u<i+r?n[u]=null:u<i+r||f.push(u));for(f.sort(function(n,t){return n-t}),o=0;o<f.length;o++)e=f[o],s=n[e],n[e]=null,n[parseInt(e,10)-r]=s}},addColumns:function(n,t){var i,r;if(n<0||n>this.colCount||t<0)return;for(i=0;i<this.rowCount;i++)r=this.dataTable[i],r&&n<this.colCount&&this.addElements(r,this.colCount,n,t);this.addElements(this._columnDataArray,this.colCount,n,t),this.colCount+=t},deleteColumns:function(n,t){var u=this.colCount,i,r;if(n<0||n>=u||t<0)return;for(i=0;i<this.rowCount;i++)r=this.dataTable[i],r&&n<this.colCount&&this.deleteElements(r,this.colCount,n,t);this.deleteElements(this._columnDataArray,this.colCount,n,t),n+t>u&&(t=u-n),this.colCount-=t},getNode:function(n,t,i){var r,u;return n>=this.rowCount||t>=this.colCount?null:(r=null,n<0||t<0?n!==-1||t<0?n<0||t!==-1?n===-1&&t===-1&&(r=this._defaultDataNode,!r&&i&&(r=this._defaultDataNode={})):(r=this._rowDataArray[n],!r&&i&&(r=this._rowDataArray[n]={})):(r=this._columnDataArray[t],!r&&i&&(r=this._columnDataArray[t]={})):(u=this.dataTable[n],!u&&i&&(u=this.dataTable[n]={}),u&&(r=u[t],!r&&i&&(r=u[t]={}))),r)},_setNode4Swap:function(n,t,i,r,u){if(i<0||r<0)i<0||r!==-1||n<0||t!==-1?r<0||i!==-1||t<0||n!==-1||(this._columnDataArray[r]=u):this._rowDataArray[i]=u;else{var f=this.dataTable[i];f||(f=this.dataTable[i]={}),f[r]=u,u&&u.cellCalc&&delete u.cellCalc}},swapNode:function(n,t,i,r){var f=this.getNode(n,t),u=this.getNode(i,r);f?this._setNode4Swap(n,t,i,r,f):u&&this._setNode4Swap(n,t,i,r,null),u?this._setNode4Swap(i,r,n,t,u):f&&this._setNode4Swap(i,r,n,t,null)},getDataRowIndex:function(n){return n},nextNonNullRow:function(n){n++;while(n>=0&&n<this.rowCount){if(this.dataTable.hasOwnProperty(n)&&this.dataTable[n])break;n++}return n<this.rowCount?n:-1},nextNonNullColumn:function(n,t){var i=null;n>=0&&n<this.rowCount&&this.dataTable.hasOwnProperty(n)&&(i=this.dataTable[n]);if(!i)return-1;t++;while(t>=0&&t<this.colCount){if(i.hasOwnProperty(t)&&i[t])break;t++}return t<this.colCount?t:-1},clear:function(n,i,r,u,f){var o=[],e,c,h,s;if(n<0||i<0)if(n<0||i!==-1)if(n!==-1||i<0)n===-1&&i===-1&&(e=this._defaultDataNode,e&&o.push(e));else{i+u>this.columnCount&&(u=this.columnCount-i);if(u<=0)return;for(c=i;c<i+u;c++)e=this.getNode(-1,c),e&&o.push(e)}else{n+r>this.rowCount&&(r=this.rowCount-n);if(r<=0)return;for(h=n;h<n+r;h++)e=this.getNode(h,-1),e&&o.push(e)}else{n+r>this.rowCount&&(r=this.rowCount-n);if(r<=0)return;i+u>this.columnCount&&(u=this.columnCount-i);if(u<=0)return;for(h=n;h<n+r;h++)for(c=i;c<i+u;c++)e=this.getNode(h,c),e&&o.push(e)}for(s=0;s<o.length;s++)o[s]&&((f&t.StorageType.Style)>0&&(o[s].style=null),(f&t.StorageType.Data)>0&&(o[s].value=null,o[s].formula=null),(f&t.StorageType.Sparkline)>0&&(o[s].sparkline=null))}},t._UndoManager=function(n,t,i){this._context=n,parseInt(t,10)<0&&(t=2147483647),this._maxLength=t,this._allowUndo=i,this._undoStack=[],this._redoStack=[]},t._UndoManager.prototype={changed:null,context:function(){return this._context},canUndo:function(){return this._undoStack.length>0},canRedo:function(){return this._redoStack.length>0},_shrinkUndoStack:function(n){for(var t=0;t<n;t++)this._undoStack.shift()},_raiseChanged:function(){this.changed&&typeof this.changed=="function"&&this.changed(this)},doAction:function(n){if(!n||!n.execute)return!1;var t=!0;try{n.execute(this._context)}catch(i){t=!1}return this._allowUndo&&t&&n.canUndo()&&n.undo&&(this._maxLength>0&&this._undoStack.length>=this._maxLength&&this._shrinkUndoStack(this._undoStack.length-this._maxLength+1),this._undoStack.push(n),this._redoStack=[],this._raiseChanged()),t},undo:function(){var t=!0,n;if(this._allowUndo&&this.canUndo()){n=this._undoStack[this._undoStack.length-1];try{n&&n.canUndo&&n.canUndo()&&n.undo&&(t=n.undo(this._context))}catch(i){t=!1}t&&(this._redoStack.push(this._undoStack.pop()),this._raiseChanged())}return t},redo:function(){var t=!0,n;if(this._allowUndo&&this.canRedo()){n=this._redoStack[this._redoStack.length-1];try{n&&n.execute&&n.execute(this._context)}catch(i){t=!1}t&&(this._undoStack.push(this._redoStack.pop()),this._raiseChanged())}return t},getUndoList:function(){return this._undoStack.slice(0)},getRedoList:function(){return this._redoStack.slice(0)}}})(window);(function(n){"use strict";var t=n.GrapeCity,i;typeof t=="undefined"&&(t={}),typeof t.UI=="undefined"&&(t.UI={}),i=n.document,t.UI._SheetRender=function(n){this._init(n)},t.UI._SheetRender.prototype={_init:function(n){this._sheet=n},_getCtx:function(){this.ctx=null;var r=this._sheet,i=r._getCanvas();if(i){if(!i.getContext&&t.UI._isSilverlightCanvas())if(!i.getContext)return;i.getContext||typeof n.FlashCanvas=="undefined"||n.FlashCanvas.initElement(i),i.getContext&&(this.ctx=i.getContext("2d"))}return this.ctx&&(this.ctx.name="userContext"),this.ctx},_getBufferCtx:function(){var f=this._sheet,u=f._bounds,r=this.buffer;r&&r.width===u.width&&r.height===u.height||(this.buffer=r=i.createElement("canvas"),r.width=u.width,r.height=u.height);if(r.getContext)this.bufferCtx=r.getContext("2d");else if(t.UI._isSilverlightCanvas())if(r.getContext)this.bufferCtx=r.getContext("2d");else return;else if(typeof n.FlashCanvas!="undefined"){n.FlashCanvas.initElement(c);if(!r.getContext)return;this.bufferCtx=r.getContext("2d")}return this.bufferCtx&&(this.bufferCtx.beginPath(),this.bufferCtx.font=this._getZoomFont(this._getDefaultFont()),this.bufferCtx.name="bufferContext"),this.bufferCtx},_getBufferCtx2:function(){var f=this._sheet,u=f._bounds,r=this.buffer2;r&&r.width===u.width&&r.height===u.height||(this.buffer2=r=i.createElement("canvas"),r.width=u.width,r.height=u.height);if(r.getContext)this.bufferCtx2=r.getContext("2d");else if(t.UI._isSilverlightCanvas())if(r.getContext)this.bufferCtx2=r.getContext("2d");else return;else if(typeof n.FlashCanvas!="undefined"){n.FlashCanvas.initElement(c);if(!r.getContext)return;this.bufferCtx2=r.getContext("2d")}return this.bufferCtx2&&(this.bufferCtx2.beginPath(),this.bufferCtx2.font=this._getZoomFont(this._getDefaultFont()),this.bufferCtx2.name="bufferContext"),this.bufferCtx2},_getDefaultFont:function(n){return n&&n!==t.UI.SheetArea.viewport?"11pt "+this._sheet.currentTheme().bodyFont():"10pt Arial"},_getDefaultBackground:function(){return"white"},_scaleFont:function(n,t,r){var h,o,e,u,f,s;return t===1?n:(h=this._sheet,o=h._getEditingSpan(),o.style.font=n,e=o.currentStyle,i.defaultView&&i.defaultView.getComputedStyle&&(e=i.defaultView.getComputedStyle(o,"")),u=e.fontSize,f="px",u.indexOf(f)!==-1&&(s=Math.max(1,Math.floor(parseFloat(u.replace(f,""))*t)),r&&s===1&&(r.value=!0),u=""+s+f),u+" "+e.fontFamily)},_getZoomFont:function(n){var t=this._sheet;return this._scaleFont(n,t._zoomFactor)},_copyDoubleBuffer:function(n,i,r,u,f,e,o,s,h){var v,c;if(!t.UI._useDoubleBuffer())return;if(n!==undefined&&n!==null&&i!==undefined&&i!==null&&r>0&&u>0){var a=s?s:this._getBufferCtx(),y=h?h:this._getCtx(),l=null;if(this._sheet._canvas)if(o){v=new t.UI.Rect(n,i,r,u),c=v.getIntersectRect(o);if(c)n=c.x,i=c.y,l=a.getImageData(c.x,c.y,c.width,c.height);else return}else l=a.getImageData(n,i,r,u);else l=a.getImageData(0,0,r,u);(f===undefined||f===null)&&(f=n),(e===undefined||e===null)&&(e=i),y.putImageData(l,f,e)}},_copyDoubleBufferRect:function(n,t,i,r,u,f){n&&this._copyDoubleBuffer(n.x,n.y,n.width,n.height,t,i,r,u,f)},translateScreen:function(n,t,i,r,u,f,e,o){try{var s=this._getCtx(),h=s.getImageData(n,t,i,r);s.putImageData(h,u,f)}catch(c){}},repaintSelection:function(n,i,r){var c,h,o,y,f,v,b,s;r||(r=this._getCtx());var k=!1,e=this._sheet,u=new t.UI.Range(-1,-1,-1,-1);if(n){u=e._allowCellOverflow?new t.UI.Range(n.row,0,n.rowCount,e.getColumnCount()):new t.UI.Range(n.row,n.col,n.rowCount,n.colCount);if(!e._isNavigateInSelection){if(u.col>=0){var a=u.col,w=u.col+u.colCount-1,d=e.getRowCount(t.UI.SheetArea.colHeader);for(c=0;c<d;c++)o=e._colHeaderSpanModel.find(c,u.col),o&&(a=Math.min(o.col,a)),o=e._colHeaderSpanModel.find(c,u.col+u.colCount-1),o&&(w=Math.max(o.col+o.colCount-1,w));u.col=a,u.colCount=w-a+1}if(u.row>=0){var l=u.row,p=u.row+u.rowCount-1,g=e.getColumnCount(t.UI.SheetArea.rowHeader);for(h=0;h<g;h++)o=e._rowHeaderSpanModel.find(u.row,h),o&&(l=Math.min(o.row,l)),o=e._rowHeaderSpanModel.find(u.row+u.rowCount-1,h),o&&(p=Math.max(o.row+o.rowCount-1,p));u.row=l,u.rowCount=p-l+1}}}y=this._getInViewportIndex(u),f=e._getRangeRect(y.rowViewportIndex,y.colViewportIndex,u);if(f.width>0&&f.height>0){f.x-=2,f.y-=2,f.width+=4,f.height+=4;if(i){v=f.getIntersectRect(i);if(v)f=v;else return}b=t.UI._useDoubleBuffer(),b||(e._dirty=!0),this.paint(r,f),s=e._getSheetLayout(),f.height>0&&!e._isNavigateInSelection&&(e._dirty=!0,this.paint(r,new t.UI.Rect(s.x,f.y,s.rowHeaderWidth,f.height))),f.width>0&&!e._isNavigateInSelection&&(e._dirty=!0,this.paint(r,new t.UI.Rect(f.x,s.y,f.width,s.colHeaderHeight))),k=!0}return k},_getInViewportIndex:function(n){var t=this._sheet,i={rowViewportIndex:1,colViewportIndex:1},u=isNaN(t.frozenColCount)?0:Math.min(t.frozenColCount,t.getColumnCount()),r=isNaN(t.frozenRowCount)?0:Math.min(t.frozenRowCount,t.getRowCount());return n.row<r&&(i.rowViewportIndex=0),n.col<u&&(i.colViewportIndex=0),i},update:function(n,i,r,u,f){var o=this._sheet,e;if(o._layoutSuspended>0)return;e=this._getCtx(),e&&(f||(o._dirty=!0),this.paint(e,new t.UI.Rect(n,i,r,u)))},repaint:function(n){var i=this._sheet,t;if(i._layoutSuspended>0)return;t=this._getCtx(),t&&(i._dirty=!0,this.paint(t,n))},paint:function(n,i){var e,u,o,f,r,c,s,h;if(!n)return;e=this._sheet,u=e._bounds,i||(i=u),o=t.UI._useDoubleBuffer(),f=o?this._getBufferCtx():n,f||(o=!1,f=n),e._dirty&&(e._dirty=!1,o&&(f.clearRect(i.x,i.y,i.width,i.height),f.translate(-u.x,-u.y)),this.paintSheet(f,i),o&&f.translate(u.x,u.y));if(o){r=n,($.browser.chrome||$.browser.safari)&&(r=this._getBufferCtx2()),this._copyDoubleBufferRect(i,null,null,null,f,r);if(!e._hoverCell&&e._canvas){for(c=e._getSheetLayout(),s=0;s<2;s++)for(h=0;h<2;h++)u=c.viewportRect(s,h),(!i||u.intersectRect(i))&&(r.save(),r.rect(u.x,u.y,u.width,u.height),r.clip(),r.beginPath(),this.paintSelection(r,s,h,i),r.beginPath(),r.restore());this.paintResizeLine(r,i)}r!==n&&this._copyDoubleBufferRect(i,null,null,null,r,n)}},paintSheet:function(n,t){var f=this._sheet,e,i,r,u;if(!n||f._layoutSuspended>0)return;for(r=f._bounds,n.save(),t?n.rect(t.x,t.y,t.width,t.height):n.rect(r.x,r.y,r.width,r.height),n.clip(),n.beginPath(),n.fillStyle=this._getThemeContentBackgroundColor("gray"),n.fillRect(r.x,r.y,r.width,r.height),u=f._getSheetLayout(),this.paintGroup(n,t),i=0;i<2;i++)(!t||u.colHeaderRect(i).intersectRect(t))&&this.paintColHeader(n,i,t);for(e=0;e<2;e++)for((!t||u.rowHeaderRect(e).intersectRect(t))&&this.paintRowHeader(n,e,t),i=0;i<2;i++)(!t||u.viewportRect(e,i).intersectRect(t))&&this.paintViewport(n,e,i,t);(!t||u.headerCornerRect().intersectRect(t))&&this.paintColHeaderCorner(n,t);if(f._colFooterVisible)for((!t||u.footerCornerRect().intersectRect(t))&&this.paintColFooterCorner(n,t),i=0;i<2;i++)(!t||u.footerRect(i).intersectRect(t))&&this.paintColFooter(n,i,t);this.paintFrozenLine(n,t),f.borderWidth>0&&(n.strokeStyle=f.borderColor,n.lineWidth=f.borderWidth,n.strokeRect(r.x+n.lineWidth/2,r.y+n.lineWidth/2,Math.max(0,r.width-n.lineWidth),Math.max(0,r.height-n.lineWidth))),n.beginPath(),n.restore()},_getThemeContentBackgroundColor:function(n){var f=this._sheet,e=f.parent?f.parent.useWijmoTheme:f.useWijmoTheme,u,r;return e===!0&&(u=t.UI.Global.prototype._dummyContent,r=u.currentStyle,i.defaultView&&i.defaultView.getComputedStyle&&(r=i.defaultView.getComputedStyle(u,"")),r&&r.backgroundColor&&r.backgroundColor!==""&&(n=r.backgroundColor)),n},refreshDragDropIndicator:function(){var n=this._sheet,h=n._currentTarget,e,u,o,i,s;if(!h||!h.dragInfo)return;var a=this._getCtx(),l=n._getSheetLayout(),f=n._dragOldRect,c=n._actualDragRange,r=n._dragRect;for(e=0;e<2;e++)for(u=0;u<2;u++)o=l.viewportRect(e,u),i=n._getRangeRect(e,u,c),(i&&o.intersectRect(new t.UI.Rect(i.x-2,i.y-2,i.width+4,i.height+4))||f&&o.intersectRect(new t.UI.Rect(f.x-2,f.y-2,f.width+4,f.height+4)))&&(r.x=i.x,r.y=i.y,r.width=i.width-1,r.height=i.height-1,this.paintDragDropIndicator(a,o));n._oldDragRange=c,s=n._eventHandler._isDragInsert,n._dragOldRect=s===!0?n._insertDragRect:new t.UI.Rect(r.x,r.y,r.width,r.height)},paintDragDropIndicator:function(n,i){var u=this._sheet,r=u._dragRect,w=u._eventHandler._isDragInsert,v=r.hitTarget,f,h,o,l,y,s,c,p,e;if(!u||!r||!v)return;n.save();if(w===!0&&(r.row===-1||r.col===-1))r.row===-1&&r.col!==-1?(o=u._getColumnLayout(0).findCol(r.hitCol),o||(o=u._getColumnLayout(1).findCol(r.hitCol)),o&&(l=o.x,y=o.width,r.col=r.hitCol,v.x>l+y/2&&(r.col<u._getLastFullyVisibleColumn()||r.col===u._getLastVisualColumn())&&(l=o.x+o.width,r.col++),f=u._dragOldRect,f&&f.width===0||(f=u._dragRect),f&&(h=new t.UI.Rect(f.x-2,f.y-2,f.width+4,f.height+4),this._copyDoubleBufferRect(h,null,null,i),this.repaintSelection(u._getActiveSelectedRange(),i)),u._insertDragRect=new t.UI.Rect(l,r.y,0,r.height),n.rect(i.x,i.y,i.width,i.height),n.clip(),n.beginPath(),this.paintDragLine(n,l,r.y,l,r.y+r.height))):r.row!==-1&&r.col===-1&&(s=u._getRowLayout(0).findRow(r.hitRow),s||(s=u._getRowLayout(1).findRow(r.hitRow)),s&&(c=s.y,p=s.height,r.row=r.hitRow,v.y>c+p/2&&(r.row<u._getLastFullyVisibleRow()||r.row===u._getLastVisualRow())&&(c=s.y+s.height,r.row++),f=u._dragOldRect,f&&f.height===0||(f=u._dragRect),f&&(h=new t.UI.Rect(f.x-2,f.y-2,f.width+4,f.height+4),this._copyDoubleBufferRect(h,null,null,i),this.repaintSelection(u._getActiveSelectedRange(),i)),u._insertDragRect=new t.UI.Rect(r.x,c,r.width,0),n.rect(i.x,i.y,i.width,i.height),n.clip(),n.beginPath(),this.paintDragLine(n,r.x,c,r.x+r.width,c)));else if($.browser.chrome||$.browser.safari){var u=this._sheet,n=this._getCtx(),b=this._getBufferCtx(),a=this._getBufferCtx2();u._dragOldRect&&(e=u._dragOldRect,e.x-=2,e.y-=2,e.width+=4,e.height+=4,this._copyDoubleBufferRect(e,null,null,null,b,a),this.repaintSelection(u._getActiveSelectedRange(),i,a)),r&&(e=r,this.paintDragRectangle(a,e),e.x-=2,e.y-=2,e.width+=4,e.height+=4,u._dragOldRect&&(e=this._union(u._dragOldRect,e)),this._copyDoubleBufferRect(e,null,null,null,a,n))}else f=u._dragOldRect,f&&(h=new t.UI.Rect(f.x-2,f.y-2,f.width+4,f.height+4),this._copyDoubleBufferRect(h,null,null,i),this.repaintSelection(u._getActiveSelectedRange(),i)),n.rect(i.x,i.y,i.width,i.height),n.clip(),n.beginPath(),this.paintDragRectangle(n,r);n.beginPath(),n.restore()},_union:function(n,i){var f=Math.min(n.x,i.x),e=Math.min(n.y,i.y),r=Math.max(n.x+n.width-1,i.x+i.width-1),u=Math.max(n.y+n.height-1,i.y+i.height-1);return new t.UI.Rect(f,e,r,u)},paintDragRectangle:function(n,t){this.paintDragLine(n,t.x,t.y,t.x+t.width,t.y),this.paintDragLine(n,t.x,t.y+t.height,t.x+t.width,t.y+t.height),this.paintDragLine(n,t.x,t.y,t.x,t.y+t.height),this.paintDragLine(n,t.x+t.width,t.y,t.x+t.width,t.y+t.height)},paintDragLine:function(n,i,r,u,f){n.save();var s,o,e;i===u?(n.rect(i-2,r,7,Math.abs(f-r)),n.clip(),n.beginPath(),r<f?(r-=3,f+=3):(r+=3,f-=3),s=new t.UI.Line.Create(i-1,r-1,u-1,f+1,"black",t.UI.LineStyle.hair),o=new t.UI.Line.Create(i,r,u,f,"black",t.UI.LineStyle.hair),e=new t.UI.Line.Create(i+1,r-1,u+1,f+1,"black",t.UI.LineStyle.hair)):r===f&&(n.rect(i,r-2,Math.abs(u-i),7),n.clip(),n.beginPath(),i<u?(i-=3,u+=3):(i+=3,u-=3),s=new t.UI.Line.Create(i-1,r-1,u+1,f-1,"black",t.UI.LineStyle.hair),o=new t.UI.Line.Create(i,r,u,f,"black",t.UI.LineStyle.hair),e=new t.UI.Line.Create(i-1,r+1,u+1,f+1,"black",t.UI.LineStyle.hair)),s.paintLine(n),o.paintLine(n),e.paintLine(n),n.stroke(),n.beginPath(),n.restore()},paintResizeLine:function(n,t){var r,i,o=this._sheet,e,u,f;if(!o._eventHandler.isMouseDown)return;e=o._currentTarget;if(!e)return;u=e.resizeInfo;if(u){f=o._getSheetLayout(),n.save(),n.strokeStyle="black",n.lineWidth=1,n.beginPath();if(u.action==="sizeRow")for(r=f.x;r<f.x+f.width;r+=2)i=Math.max(0,u.startY-.5),n.moveTo(r,i),n.lineTo(r+1,i),n.moveTo(r,u.movingY-.5),n.lineTo(r+1,u.movingY-.5);else for(i=f.y;i<f.y+f.height;i+=2)r=Math.max(0,u.startX-.5),n.moveTo(r,i),n.lineTo(r,i+1),n.moveTo(u.movingX-.5,i),n.lineTo(u.movingX-.5,i+1);n.stroke(),n.restore()}},paintColHeaderCorner:function(n,i){var f=this._sheet,r,e,u;n.beginPath(),r=f._getSheetLayout().headerCornerRect(),e=f.getActualStyle(-1,-1,t.UI.SheetArea.corner),this.paintCell(n,null,-1,-1,r.x,r.y,r.width,r.height,e,t.UI.SheetArea.corner),u=new t.UI._GcBorders(f,0,0,t.UI.SheetArea.corner),u.addCellLines(0,0,r.x,r.y,r.width,r.height),u.paint(n,i)},paintFrozenLine:function(n,t){var r=this._sheet,i;(r.frozenRowCount||r.frozenColCount)&&(i=r._getSheetLayout(),n.save(),n.strokeStyle="black",n.lineWidth=1,n.beginPath(),r.frozenColCount&&(n.moveTo(i.viewportX-.5,i.y),n.lineTo(i.viewportX-.5,i.y+i.height)),r.frozenRowCount&&(n.moveTo(i.x,i.viewportY-.5),n.lineTo(i.x+i.width,i.viewportY-.5)),n.stroke(),n.restore())},paintColHeader:function(n,i,r){this.paintViewportImp(n,-1,i,t.UI.SheetArea.colHeader,r)},paintRowHeader:function(n,i,r){this.paintViewportImp(n,i,-1,t.UI.SheetArea.rowHeader,r)},paintColFooterCorner:function(n,i){var h=this._sheet,r=h._getSheetLayout(),s=r.footerX,u=r.footerY,l=r.footerWidth,a=r.footerHeight,e=0,o=h._getColumnLayout(1,t.UI.SheetArea.viewport),f=o.findCol(o[o.length-1].col,t.UI.SheetArea.viewport),c;e=f?f.x+f.width:r.width,n.save(),n.strokeStyle="#9EB6CE",n.beginPath(),n.moveTo(s,u-.5),n.lineTo(e,u-.5),n.stroke(),n.restore(),n.fillStyle="white",n.fillRect(s,u,l,a),c=h.getActualStyle(-1,-1,t.UI.SheetArea.footerCorner),this.paintCell(n,null,-1,-1,s,u,l,a,c,t.UI.SheetArea.footerCorner)},paintColFooter:function(n,i,r){var f=this._sheet,u=f._getSheetLayout();n.fillStyle="white",i===0?n.fillRect(u.frozenX,u.footerY,u.frozenWidth,u.footerHeight):n.fillRect(u.viewportX,u.footerY,u.viewportWidth,u.footerHeight),this.paintViewportImp(n,-1,i,t.UI.SheetArea.colFooter,r)},paintViewport:function(n,i,r,u){this.paintViewportImp(n,i,r,t.UI.SheetArea.viewport,u)},paintSelection:function(n,t,i,r){var f=this._sheet,e=null,s,l,c,o;for(n.save(),r&&(n.rect(r.x,r.y,r.width,r.height),n.clip(),n.beginPath()),s=0;s<f._selectionModel.length;s++)l=f._selectionModel[s],e=f._getRangeRect(t,i,l),e&&e.width>0&&e.height>0&&(n.fillStyle="rgba(180,180,200, 0.2)",n.fillRect(e.x,e.y,e.width,e.height));var u=f.getCellRect(f._activeRowIndex,f._activeColIndex,t,i),a=f._getSheetLayout(),h=a.viewportRect(t,i);h.intersectRect(u)&&(u.x=Math.max(u.x,h.x),u.y=Math.max(u.y,h.y)),u&&u.x!==null&&u.x!==undefined&&u.y!==null&&u.y!==undefined&&u.width!==null&&u.width!==undefined&&u.height!==null&&u.height!==undefined||(u=null),r&&u&&u.intersectRect(r)&&(this._copyDoubleBuffer(u.x+1,u.y+1,u.width-2,u.height-2,u.x+1,u.y+1,null,null,n),f._selectionModel.length>1&&(n.strokeStyle="black",n.lineWidth=1,n.strokeRect(u.x+1.5,u.y+1.5,u.width-4,u.height-4))),f._selectionModel.length===1&&(f._eventHandler.isDraggingFill&&f._eventHandler.isDragClear()&&!f._eventHandler._isDragAroundIndicator&&(c=f._eventHandler.getCurrentFillRange(),o=f._getRangeRect(t,i,c),o&&o.width>0&&o.height>0&&(n.fillStyle="rgba(110,110,110, 0.5)",n.fillRect(o.x,o.y,o.width,o.height))),this.paintSelectionBorder(n,t,i,e,r)),n.beginPath(),n.restore()},paintSelectionBorder:function(n,i,r,u,f){var e=this._sheet;if(u.width>=0&&u.height>=0&&(!f||u.intersect(f.x-1,f.y-1,f.width+2,f.height+2))){n.save(),n.beginPath(),n.strokeStyle="black",n.lineWidth=2;if(u.width>0&&u.height>0){if(e._eventHandler.isDraggingFill)switch(e._eventHandler._currentFillDirection){case t.UI.DragFillDirection.Up:n.moveTo(u.x+.5,u.y-.5),n.lineTo(u.x+u.width-1,u.y-.5);break;case t.UI.DragFillDirection.Down:n.moveTo(u.x+.5,u.y+u.height-.5),n.lineTo(u.x+u.width-1,u.y+u.height-.5);break;case t.UI.DragFillDirection.Left:n.moveTo(u.x-.5,u.y+.5),n.lineTo(u.x-.5,u.y+u.height-1);break;case t.UI.DragFillDirection.Right:n.moveTo(u.x+u.width-.5,u.y+.5),n.lineTo(u.x+u.width-.5,u.y+u.height-1);break;case t.UI.DragFillDirection.UpClear:case t.UI.DragFillDirection.LeftClear:break;default:break}else n.rect(u.x-.5,u.y-.5,u.width,u.height);n.stroke(),e.canUserDragFill()&&this.paintDragFillIndicator(n,i,r,u,f)}else(u.width===0||u.height===0)&&n.strokeRect(u.x-1,u.y-1,u.width+1,u.height+1);n.beginPath(),n.restore()}},getDragFillIndicatorRect:function(n){var r=this._sheet,u=r._getActiveSelectedRange(),f=r._getSheetLayout(),i=new t.UI.Rect(-4,-4,4,4);return u.col===-1?(i.x=f.frozenX,i.y=n.y+n.height-.5-2):u.row===-1?(i.x=n.x+n.width-.5-2,i.y=f.frozenY):(i.x=n.x+n.width-.5-2,i.y=n.y+n.height-.5-2),r._dragFillIndicatorRect=i,i},paintDragFillIndicator:function(n,i,r,u,f){var h=this._sheet,c=h._getSheetLayout(),e=this.getDragFillIndicatorRect(u),s=c.viewportRect(i,r),o;(!f||e.intersectRect(f))&&e.intersectRect(s)&&(o=new t.UI.Rect(e.x-1.5,e.y-1.5,e.width+2,e.height+2),o.x=Math.max(o.x,s.x),o.y=Math.max(o.y,s.y),this._copyDoubleBufferRect(o,null,null,null,null,n),n.fillStyle="black",n.fillRect(e.x,e.y,e.width,e.height))},paintViewportImp:function(n,i,r,u,f){var nt,et,ft,tt,g,ut,st;n.beginPath();var s=this._sheet,pt=s._getSheetLayout(),v=s._getRowLayout(i,u),c=s._getColumnLayout(r,u),yt=s._getCellLayout(i,r,u),ht=t.UI._useDoubleBuffer(),o=new t.UI.Rect,ct=!1;ht&&v&&v.length>0&&c&&c.length>0&&(o.x=c[0].x,o.y=v[0].y,o.width=c[c.length-1].x+c[c.length-1].width-o.x,o.height=v[v.length-1].y+v[v.length-1].height-o.y,n.save(),n.rect(o.x,o.y,o.width,o.height),n.clip(),n.beginPath(),ct=!0,n.fillStyle=this._getDefaultBackground(),n.fillRect(o.x,o.y,o.width,o.height));var p=null,a=null,e=null,l,h,d=0,k=0,b=0,y=0,ot,it,at=v.length,lt=c.length,vt=new t.UI._GcBorders(s,i,r,u),rt=[],w=[];w.painted=!1;if(at>0&&lt>0)for(nt=0;nt<at;nt++){for(p=v[nt],et=this._buildCellOverflowLayoutModel(p.row,u),ft=new t.UI._CellOverflowValueLayoutModel,tt=0;tt<lt;tt++){a=c[tt];if(f&&!a.intersect(f))continue;e=yt.findCell(p.row,a.col),e?(l=e.row,h=e.col,d=e.x,k=e.y,b=e.width,y=e.height):(l=p.row,h=a.col,d=a.x,k=p.y,b=a.width,y=p.height),ht||(n.fillStyle=this._getDefaultBackground(),n.fillRect(d,k,b,y)),l<0||h<0||(ot=s.getValue(l,h,u),it=s.getActualStyle(l,h,u)),g=null,s._allowCellOverflow&&et&&(g=et.find(h)),s.rowFilter()&&!w.painted&&s.rowFilter().isFilterHeader(p.row,a.col,u)&&a.width>0&&p.height>0&&(ut={row:l,col:h,x:d,y:k,width:b,height:y,sheetArea:u},w.contains(ut)||w.push(ut)),u===t.UI.SheetArea.viewport&&e&&rt.contains(e)&&(e.row!==p.row||e.col!==a.col)||(e&&rt.contains(e)||(st=it,this._isCellHidden(l,h,u)&&(st={_backColor:it.backColor}),vt.addCellLines(l,h,d,k,b,y,st,e,g)),b>0&&y>0&&this.paintCell(n,ot,l,h,d,k,b,y,it,u,g),e&&rt.push(e),s._allowCellOverflow&&y>0&&this._buildCellOverflowValueLayoutModel(n,ot,l,h,d,k,b,y,u,g,ft,c))}s._allowCellOverflow&&this._paintCellOverflowValue(n,ft),s.rowFilter()&&s.rowFilter().showFilterButton&&!w.painted&&(this._paintFilterButton(n,w,i,r),w.length>0&&(w.painted=!0))}vt.paint(n,f),ct&&(n.restore(),n.beginPath())},_isHiddenByGroup:function(n,t){return!n||n._getCount()===0?!1:n.isCollapsed(t)},_isCellHiddenByGroup:function(n,i,r){var u=this._sheet;if(r===undefined||r===null||r===t.UI.SheetArea.viewport)return this._isHiddenByGroup(u.rowRangeGroup,n)||this._isHiddenByGroup(u.colRangeGroup,i);else if(r===t.UI.SheetArea.colHeader)return this._isHiddenByGroup(u.colRangeGroup,i);else if(r===t.UI.SheetArea.rowHeader)return this._isHiddenByGroup(u.rowRangeGroup,n)},_isRowHiddenByFilter:function(n){var t=this._sheet;if(t.rowFilter())return!t.rowFilter().isRowFilteredOut(n)},_isCellHidden:function(n,t,i){var r=this._sheet;return!r.getRowVisible(n,i)||!r.getColumnVisible(t,i)?!1:this._isCellHiddenByGroup(n,t,i)},_paintFilterButton:function(i,r,u,f){var h=this._sheet,k=[],d=h._zoomFactor>1?1:h._zoomFactor,p,o,s,b,v,w;for(i.save(),i.lineWidth=1,i.fillStyle="#FFFFFF",i.strokeStyle="#CCCCCC",p=[],o=this._getCtx(),s=0;s<r.length;s++){var e=r[s],c=parseInt(h.defaults.rowHeight*d,10),l=c,a=e.x+e.width-c,y=e.y+e.height-l;k.push({row:e.row,col:e.col,x:a,y:y,width:c,height:l,sheetArea:e.sheetArea}),i.save(),i.rect(e.x,e.y,e.width,e.height),i.clip(),i.beginPath(),i.fillRect(a+1,y+1,c-3,l-3),i.strokeRect(a+1-.5,y+2-.5,c-3,l-4),b=this._getFilterButtonState(e.col),v=new n.Image,v.src=t.UI._GcFilterDialog.getImageSrc(b),v.complete?i.drawImage(v,a,y+1,c-3,l-3):p.push({img:v,x:a,y:y,width:c-3,height:l-3,cell:e}),i.beginPath(),i.restore()}i.restore();if(p.length>0)for(s=0;s<p.length;s++)w=p[s],function(n){n.img.onload=function(){var t=n.cell;i.save(),o.save(),i.rect(t.x,t.y,t.width,t.height),o.rect(t.x,t.y,t.width,t.height),i.clip(),o.clip(),i.beginPath(),o.beginPath(),i.drawImage(n.img,n.x,n.y,n.width,n.height),o.drawImage(n.img,n.x,n.y,n.width,n.height),i.beginPath(),o.beginPath(),i.restore(),o.restore()}}(w);h._filterButtonsModel||(h._filterButtonsModel={}),h._filterButtonsModel[u]||(h._filterButtonsModel[u]={}),h._filterButtonsModel[u][f]=k},paintCell:function(n,i,r,u,f,e,o,s,h,c,l){var v=this._sheet,tt=this.getVisualState(r,u,c),a="",w,d,g,k,y,nt,p,b;h.font?(h.font=this._getZoomFont(h.font),a=h.font):(h.font=this._getZoomFont(this._getDefaultFont(c)),a=h.font);if(!h.wordWrap&&h.shrinkToFit){w=v.getText(r,u,c);if(w&&w!=="")for(d={value:!1},g=0;g<3&&d.value===!1;g++){k=v._getStringWidth(w,a),y=Math.max(0,o-4),h.hAlign!==t.UI.HorizontalAlign.center&&h.textIndent&&(y=Math.max(0,y-h.textIndent*8));if(y<k)a=this._scaleFont(a,y/k,d),h.font=a;else{h.font=a;break}}}o>0&&s>0&&(nt=v._getCellType(r,u,c),f--,e--,o++,s++,p={visualState:tt,cellOverflowLayout:l,useWijmoTheme:v.parent?v.parent.useWijmoTheme:v.useWijmoTheme},c===t.UI.SheetArea.viewport&&(b=v.getSparkline(r,u),b&&(p.sparkline=b)),h.wordWrap&&(p.lineHeight=v._getFontHeight(a)),nt.paint(n,i,f,e,o,s,h,p))},getVisualState:function(n,i,r){var f=this._sheet,e=f._getModel(r),u=null;return e&&(u=e.getVisualState(n,i)),(u===undefined||u===null)&&(u=t.UI.VisualState.Normal),r===undefined||r===null||r===t.UI.SheetArea.viewport?!f._isEditing&&f._isActiveCell(n,i)?u=t.UI.VisualState.Active:f._isSelected(n,i,r)&&(u=t.UI.VisualState.Selected):(f._isSelected(n,i,r)&&(u=t.UI.VisualState.Highlight,f._isAllSelected(n,i,r)&&(u=t.UI.VisualState.Selected)),f._isHover(n,i,r)&&(u=t.UI.VisualState.Hover)),u},paintLine:function(n,t,i,r,u,f){n.lineWidth=t.width(),n.strokeStyle=t.color,n.moveTo(i,r),n.lineTo(u,f)},paintGroup:function(n,i){var u=this._sheet,f=u._getGroupLayout(),r;if(f.width>0||f.height>0){for(n.save(),this.paintGroupHeader(n),this._rowGroups=[new t.UI._RangeGroupPresenter(u,!0,0),new t.UI._RangeGroupPresenter(u,!0,1)],r=0;r<2;r++)this._rowGroups[r].createGroupInfo(),this._rowGroups[r].paintGroups(n);for(this._columnGroups=[new t.UI._RangeGroupPresenter(u,!1,0),new t.UI._RangeGroupPresenter(u,!1,1)],r=0;r<2;r++)this._columnGroups[r].createGroupInfo(),this._columnGroups[r].paintGroups(n);n.beginPath(),n.restore()}},paintGroupHeader:function(n){var r=this._sheet,u=new t.UI._RangeGroupHeaderPresenter(r,!1),i;u.paintGroupHeader(n),i=new t.UI._RangeGroupHeaderPresenter(r,!0),i.paintGroupHeader(n)},groupHitTest:function(n,i){var f=this._sheet,o=f._getGroupLayout(),s,l,u,c,h;if(!o)return null;s=new t.UI.Rect(o.x,o.y,o.width,f._bounds.height);if(!s.contains(n,i)){s=new t.UI.Rect(o.x,o.y,f._bounds.width,o.height);if(!s.contains(n,i))return null}var e={what:"empty",info:null},a=new t.UI._RangeGroupHeaderPresenter(f,!0),r=a.getGroupButton(n,i);r&&(e={what:"rgh",info:r}),e.what==="empty"&&(l=new t.UI._RangeGroupHeaderPresenter(f,!1),r=l.getGroupButton(n,i),r&&(e={what:"cgh",info:r}));if(e.what==="empty")for(c=[new t.UI._RangeGroupPresenter(f,!0,0),new t.UI._RangeGroupPresenter(f,!0,1)],u=0;u<2;u++){c[u].createGroupInfo(),r=c[u].getRowGroupButton(n,i);if(r){e={what:"rg",info:r};break}}if(e.what==="empty")for(h=[new t.UI._RangeGroupPresenter(f,!1,0),new t.UI._RangeGroupPresenter(f,!1,1)],u=0;u<2;u++){h[u].createGroupInfo(),r=h[u].getColGroupButton(n,i);if(r){e={what:"cg",info:r};break}}return e},_paintCellOverflowValue:function(n,t){for(var i,r=0;r<t.length;r++)i=t[r],this.paintCellOverflowValue(n,i.data,i.row,i.col,i.x,i.y,i.width,i.height,i.sheetArea,i.cellOverflowLayout)},_buildCellOverflowValueLayoutModel:function(n,i,r,u,f,e,o,s,h,c,l,a){var p=this._sheet,v,b,d,w,y,g=isNaN(p.frozenColCount)?0:p.frozenColCount,k;if(c&&!l.find(c.column)){k=!1,u<g&&(k=!0);if(c.column===u)v=f,b=v,c.hAlign===t.UI.HorizontalAlign.right?b=f+o-c.columnWidth:c.hAlign===t.UI.HorizontalAlign.center&&(b=f+o/2-c.columnPrevWidth),c.layout={x:b,y:e,width:c.columnWidth,height:s},d=new t.UI._CellOverflowValueLayout(i,r,c.column,v,e,o,s,h,c),l.push(d);else if(!k&&c.column<p._scrollLeftCol){for(v=a[0].x,y=0,w=p._scrollLeftCol-1;w>=c.column;w--)y=p._getZoomColumnWidth(w,h),v-=y;b=v,c.hAlign===t.UI.HorizontalAlign.right?b=v+y-c.columnWidth:c.hAlign===t.UI.HorizontalAlign.center&&(b=v+y/2-c.columnPrevWidth),c.layout={x:b,y:e,width:c.columnWidth,height:s},i=p.getValue(r,c.column,h),d=new t.UI._CellOverflowValueLayout(i,r,c.column,v,e,y,s,h,c),l.push(d)}else if(!k&&c.column>p._getPageRightColumn()||k&&c.column>=g){v=a[a.length-1].x+a[a.length-1].width,y=0;if(k){for(w=g;w<c.column;w++)y=p._getZoomColumnWidth(w,h),v+=y;y=p._getZoomColumnWidth(c.column,h)}else{for(w=p._getPageRightColumn()+1;w<c.column;w++)y=p._getZoomColumnWidth(w,h),v+=y;y=p._getZoomColumnWidth(c.column,h)}b=v,c.hAlign===t.UI.HorizontalAlign.right?b=v+y-c.columnWidth:c.hAlign===t.UI.HorizontalAlign.center&&(b=v+y/2-c.columnPrevWidth),c.layout={x:b,y:e,width:c.columnWidth,height:s},i=p.getValue(r,c.column,h),d=new t.UI._CellOverflowValueLayout(i,r,c.column,v,e,y,s,h,c),l.push(d)}}},_buildCellOverflowLayoutModel:function(n,i){var u,e,r,c,h,o,s,f;if(i!==undefined&&i!==null&&i!==t.UI.SheetArea.viewport)return null;u=this._sheet;if(!u._allowCellOverflow)return null;if(u.maxCellOverflowDistance===1)return null;e=null;if(u._cellOverflowModelCache){e=u._cellOverflowModelCache[n];if(e)return e}else u._cellOverflowModelCache={};for(e=new t.UI._CellOverflowLayoutModel,r=0;r<u.getColumnCount(i);r++){c=u.getColumnVisible(r,i),h=u.getColumnWidth(r,i);if(c===!1||h<=0)continue;o=u.getActualStyle(n,r,t.UI.SheetArea.viewport);if(o&&(o.shrinkToFit||o.wordWrap))continue;s=t.UI._SheetRender.getHAlignByValueType(o.hAlign,u.getValue(n,r)),s===undefined||s===null||s===t.UI.HorizontalAlign.left?(f=this._buildCellOverflowLayoutModelForLeft(n,r,i,o),f&&(e.push(f),r=f.endCol)):s===t.UI.HorizontalAlign.right?(f=this._buildCellOverflowLayoutModelForRight(n,r,i,o),f&&(e.push(f),r=f.endCol)):s===t.UI.HorizontalAlign.center&&(f=this._buildCellOverflowLayoutModelForCenter(n,r,i,o),f&&(e.push(f),r=f.endCol))}return u._cellOverflowModelCache[n]=e,e},_buildCellOverflowLayoutModelForLeft:function(n,i,r,u){var f=this._sheet,l=f.getText(n,i,r),h,s,c,e,a,y;if(!l||l===""||f._spanModel.find(n,i)!==null)return null;if(f.getValue(n,i+1,r)!==null||f._spanModel.find(n,i+1)!==null)return null;var o=f._getZoomColumnWidth(i,r),p=!u||!u.font?this._getZoomFont(this._getDefaultFont(r)):this._getZoomFont(u.font),v=f._getStringWidth(l,p)+(u.textIndent?u.textIndent*8:0);if(v<=o)return null;for(h=i,s=f.getColumnCount(r),f.maxCellOverflowDistance&&(c=parseInt(f.maxCellOverflowDistance,10)+i,c<s&&(s=c)),e=i+1;e<s;e++){a=f.getValue(n,e,r),y=f._spanModel.find(n,e);if(a!==undefined&&a!==null||y||v<o)break;o+=f._getZoomColumnWidth(e,r),h=e}return h===i?null:new t.UI._CellOverflowLayout(i,i,h,v,o-1,t.UI.HorizontalAlign.left,null)},_buildCellOverflowLayoutModelForRight:function(n,i,r,u){var f=this._sheet,l=f.getText(n,i,r),h,s,c,e,a,y;if(!l||l===""||f._spanModel.find(n,i)!==null)return null;if(f.getValue(n,i-1,r)!==null||f._spanModel.find(n,i-1)!==null)return null;var o=f._getZoomColumnWidth(i,r),p=!u||!u.font?this._getZoomFont(this._getDefaultFont(r)):this._getZoomFont(u.font),v=f._getStringWidth(l,p);if(v<=o)return null;for(h=i,s=-1,f.maxCellOverflowDistance&&(c=i-parseInt(f.maxCellOverflowDistance,10),c>s&&(s=c)),e=i-1;e>s;e--){a=f.getValue(n,e,r),y=f._spanModel.find(n,e);if(a!==undefined&&a!==null||y||v<o)break;o+=f._getZoomColumnWidth(e,r),h=e}return h===i?null:new t.UI._CellOverflowLayout(i,h,i,v,o-1,t.UI.HorizontalAlign.right,null)},_buildCellOverflowLayoutModelForCenter:function(n,i,r,u){var f=this._sheet,w=f.getText(n,i,r),b,e,s,c,l,h,p;if(!w||w===""||f._spanModel.find(n,i)!==null)return null;var y=f._getZoomColumnWidth(i,r),g=!u||!u.font?this._getZoomFont(this._getDefaultFont(r)):this._getZoomFont(u.font),v=f._getStringWidth(w,g);if(v<=y)return null;var a=y/2,k=i,d=0,o=-1;for(f.maxCellOverflowDistance&&(d=parseInt(parseInt(f.maxCellOverflowDistance,10)/2+.5,10),b=i-d,b>o&&(o=b)),e=i-1;e>o;e--){s=f.getValue(n,e,r),c=f._spanModel.find(n,e);if(s!==undefined&&s!==null||c||v/2<a)break;a+=f._getZoomColumnWidth(e,r),k=e}for(l=y/2,h=i,o=f.getColumnCount(r),f.maxCellOverflowDistance&&(p=parseInt(f.maxCellOverflowDistance,10)-d+1+i,p<o&&(o=p)),e=i+1;e<o;e++){s=f.getValue(n,e,r),c=f._spanModel.find(n,e);if(s!==undefined&&s!==null||c||v/2<l)break;l+=f._getZoomColumnWidth(e,r),h=e}return k===h?null:new t.UI._CellOverflowLayout(i,k,h,v,a+l-1,t.UI.HorizontalAlign.center,a)},_getFilterButtonState:function(n){var i=t.UI._FilterButtonState.noSortFilter,u=this._sheet.rowFilter(),r;return u?(r=u.getSortState(n),u.isColumnFiltered(n)?r===t.UI.SortState.None?i=t.UI._FilterButtonState.filter:r===t.UI.SortState.Ascending?i=t.UI._FilterButtonState.filterAscend:r===t.UI.SortState.Descending&&(i=t.UI._FilterButtonState.filterDescend):r===t.UI.SortState.None?i=t.UI._FilterButtonState.noSortFilter:r===t.UI.SortState.Ascending?i=t.UI._FilterButtonState.ascend:r===t.UI.SortState.Descending&&(i=t.UI._FilterButtonState.descend),i):i},paintCellOverflowValue:function(n,t,i,r,u,f,e,o,s,h){var c=this._sheet,l=c.getActualStyle(i,r,s),y,v,a;l.font=l.font?this._getZoomFont(l.font):this._getZoomFont(this._getDefaultFont(s)),y=this.getVisualState(i,r,s),v={visualState:y,cellOverflowLayout:h,useWijmoTheme:c.parent?c.parent.useWijmoTheme:c.useWijmoTheme},e>0&&o>0&&(a=c._getCellType(i,r,s),c._isEditing&&i===c._activeRowIndex&&r===c._activeColIndex||(u--,f--,e++,o++,a.paintValue(n,t,u,f,e,o,l,v)))}},t.UI._SheetRender.getHAlignByValueType=function(n,i){if(n===t.UI.HorizontalAlign.general){var r=(typeof i=="object"?Object.prototype.toString.call(i).slice(8,-1):typeof i).toLowerCase();n=r==="boolean"?t.UI.HorizontalAlign.center:r==="number"||r==="date"?t.UI.HorizontalAlign.right:t.UI.HorizontalAlign.left}return n}})(window);(function(n,t,i){"use strict";function f(n){this._init(n)}function o(n){return n.split("\u00a0").join(" ").toUpperCase()}function e(n){for(var r=[],t=0,i=n.length;t<i;t++)r[t]=o(n[t]);return r}function c(n,t,i){var f=o(n),u=new r.UI._ArrayHelper(t).indexOf(f);return u===-1&&(u=new r.UI._ArrayHelper(i).indexOf(f)),u}function u(n,t,i){this.name=n,this.numberFormat=t,this.dateTimeFormat=i}function s(n){var t=n.dateTimeFormat;return t&&!t.eras&&(t.eras=n.eras),new u(n.name,n.numberFormat,t)}var r=n.GrapeCity,h;typeof r=="undefined"&&(r=n.GrapeCity={}),typeof r.UI=="undefined"&&(r.UI={}),r.UI._ArrayHelper=function(){function t(n,t,i){n.splice(t,0,i)}function r(n,t){n[n.length]=t}function i(n,t,i){var u,r;if(typeof t=="undefined")return-1;u=n.length;if(u!==0)for(i=+i,isNaN(i)?i=0:(isFinite(i)&&(i=i-i%1),i<0&&(i=Math.max(0,u+i))),r=i;r<u;r++)if(typeof n[r]!="undefined"&&n[r]===t)return r;return-1}function n(n){this._array=n}return n.prototype={add:function(n){r(this._array,n)},insert:function(n,i){t(this._array,n,i)},indexOf:function(n,t){return i(this._array,n,t)},array:function(n){return arguments.length===0?this._array:(this._array=n,this)}},n}(),f.prototype={_init:function(n){this._parts=typeof n!="undefined"&&n!==null&&n!==""?[n.toString()]:[],this._value={},this._len=0},_insert:function(n){this._parts.splice(0,0,n)},insert:function(n,t){var r,f,u;(t===i||t===null)&&(t=0);if(t===0){this._insert(n);return}r=this.toString();if(t>=r.length){this.append(n);return}f=r.substring(0,t),u=r.substr(t),this._init(f+n+u)},append:function(n){this._parts[this._parts.length]=n},appendLine:function(n){this._parts[this._parts.length]=typeof n=="undefined"||n===null||n===""?"\r\n":n+"\r\n"},clear:function(){this._init()},isEmpty:function(){return this._parts.length===0?!0:this.toString()===""},toString:function(n){var t,r,i;n=n||"",t=this._parts,this._len!==t.length&&(this._value={},this._len=t.length),r=this._value;if(typeof r[n]=="undefined"){if(n!=="")for(i=0;i<t.length;)typeof t[i]=="undefined"||t[i]===""||t[i]===null?t.splice(i,1):i++;r[n]=this._parts.join(n)}return r[n]}},r.UI._StringBuilder=f,u.prototype={_getDateTimeFormats:function(){return this._dateTimeFormats||(this._dateTimeFormats=["yy/MM/dd","yy/MM/d","yy/M/dd","yy/M/d","yyyy/MM/dd","yyyy/MM/d","yyyy/M/dd","yyyy/M/d","MM/dd/yyyy","MM/d/yyyy","M/dd/yyyy","M/d/yyyy","hh:mm:ss","hh:mm:s","hh:m:ss","hh:m:s","h:mm:ss","h:mm:s","h:m:ss","h:m:s","hh:mm:ss tt","hh:mm:s tt","hh:m:ss tt","hh:m:s tt","h:mm:ss tt","h:mm:s tt","h:m:ss tt","h:m:s tt","hh:mm","hh:m","h:mm","h:m","yy/MM/dd hh:mm:ss","yy/MM/dd hh:mm:s","yy/MM/dd hh:m:ss","yy/MM/dd hh:m:s","yy/MM/dd h:mm:ss","yy/MM/dd h:mm:s","yy/MM/dd h:m:ss","yy/MM/dd h:m:s","yy/MM/dd hh:mm:ss tt","yy/MM/dd hh:mm:s tt","yy/MM/dd hh:m:ss tt","yy/MM/dd hh:m:s tt","yy/MM/dd h:mm:ss tt","yy/MM/dd h:mm:s tt","yy/MM/dd h:m:ss tt","yy/MM/dd h:m:s tt","yy/MM/d hh:mm:ss","yy/MM/d hh:mm:s","yy/MM/d hh:m:ss","yy/MM/d hh:m:s","yy/MM/d hh:mm:ss","yy/MM/d h:mm:s","yy/MM/d h:m:ss","yy/MM/d h:m:s","yy/MM/d hh:mm:ss tt","yy/MM/d hh:mm:s tt","yy/MM/d hh:m:ss tt","yy/MM/d hh:m:s tt","yy/MM/d h:mm:ss tt","yy/MM/d h:mm:s tt","yy/MM/d h:m:ss tt","yy/MM/d h:m:s tt","yy/M/dd hh:mm:ss","yy/M/dd hh:mm:s","yy/M/dd hh:m:ss","yy/M/dd hh:m:s","yy/M/dd hh:mm:ss","yy/M/dd h:mm:s","yy/M/dd h:m:ss","yy/M/dd h:m:s","yy/M/dd hh:mm:ss tt","yy/M/dd hh:mm:s tt","yy/M/dd hh:m:ss tt","yy/M/dd hh:m:s tt","yy/M/dd h:mm:ss tt","yy/M/dd h:mm:s tt","yy/M/dd h:m:ss tt","yy/M/dd h:m:s tt","yy/M/d hh:mm:ss","yy/M/d hh:mm:s","yy/M/d hh:m:ss","yy/M/d hh:m:s","yy/M/d hh:mm:ss","yy/M/d h:mm:s","yy/M/d h:m:ss","yy/M/d h:m:s","yy/M/d hh:mm:ss tt","yy/M/d hh:mm:s tt","yy/M/d hh:m:ss tt","yy/M/d hh:m:s tt","yy/M/d h:mm:ss tt","yy/M/d h:mm:s tt","yy/M/d h:m:ss tt","yy/M/d h:m:s tt","yyyy/MM/dd hh:mm:ss","yyyy/MM/dd hh:mm:s","yyyy/MM/dd hh:m:ss","yyyy/MM/dd hh:m:s","yyyy/MM/dd hh:mm:ss","yyyy/MM/dd h:mm:s","yyyy/MM/dd h:m:ss","yyyy/MM/dd h:m:s","yyyy/MM/dd hh:mm:ss tt","yyyy/MM/dd hh:mm:s tt","yyyy/MM/dd hh:m:ss tt","yyyy/MM/dd hh:m:s tt","yyyy/MM/dd h:mm:ss tt","yyyy/MM/dd h:mm:s tt","yyyy/MM/dd h:m:ss tt","yyyy/MM/dd h:m:s tt","yyyy/MM/d hh:mm:ss","yyyy/MM/d hh:mm:s","yyyy/MM/d hh:m:ss","yyyy/MM/d hh:m:s","yyyy/MM/d hh:mm:ss","yyyy/MM/d h:mm:s","yyyy/MM/d h:m:ss","yyyy/MM/d h:m:s","yyyy/MM/d hh:mm:ss tt","yyyy/MM/d hh:mm:s tt","yyyy/MM/d hh:m:ss tt","yyyy/MM/d hh:m:s tt","yyyy/MM/d h:mm:ss tt","yyyy/MM/d h:mm:s tt","yyyy/MM/d h:m:ss tt","yyyy/MM/d h:m:s tt","yyyy/M/dd hh:mm:ss","yyyy/M/dd hh:mm:s","yyyy/M/dd hh:m:ss","yyyy/M/dd hh:m:s","yyyy/M/dd hh:mm:ss","yyyy/M/dd h:mm:s","yyyy/M/dd h:m:ss","yyyy/M/dd h:m:s","yyyy/M/dd hh:mm:ss tt","yyyy/M/dd hh:mm:s tt","yyyy/M/dd hh:m:ss tt","yyyy/M/dd hh:m:s tt","yyyy/M/dd h:mm:ss tt","yyyy/M/dd h:mm:s tt","yyyy/M/dd h:m:ss tt","yyyy/M/dd h:m:s tt","yyyy/M/d hh:mm:ss","yyyy/M/d hh:mm:s","yyyy/M/d hh:m:ss","yyyy/M/d hh:m:s","yyyy/M/d hh:mm:ss","yyyy/M/d h:mm:s","yyyy/M/d h:m:ss","yyyy/M/d h:m:s","yyyy/M/d hh:mm:ss tt","yyyy/M/d hh:mm:s tt","yyyy/M/d hh:m:ss tt","yyyy/M/d hh:m:s tt","yyyy/M/d h:mm:ss tt","yyyy/M/d h:mm:s tt","yyyy/M/d h:m:ss tt","yyyy/M/d h:m:s tt","MM/dd/yyyy hh:mm:ss","MM/dd/yyyy hh:mm:s","MM/dd/yyyy hh:m:ss","MM/dd/yyyy hh:m:s","MM/dd/yyyy hh:mm:ss","MM/dd/yyyy h:mm:s","MM/dd/yyyy h:m:ss","MM/dd/yyyy h:m:s","MM/dd/yyyy hh:mm:ss tt","MM/dd/yyyy hh:mm:s tt","MM/dd/yyyy hh:m:ss tt","MM/dd/yyyy hh:m:s tt","MM/dd/yyyy h:mm:ss tt","MM/dd/yyyy h:mm:s tt","MM/dd/yyyy h:m:ss tt","MM/dd/yyyy h:m:s tt","MM/d/yyyy hh:mm:ss","MM/d/yyyy hh:mm:s","MM/d/yyyy hh:m:ss","MM/d/yyyy hh:m:s","MM/d/yyyy hh:mm:ss","MM/d/yyyy h:mm:s","MM/d/yyyy h:m:ss","MM/d/yyyy h:m:s","MM/d/yyyy hh:mm:ss tt","MM/d/yyyy hh:mm:s tt","MM/d/yyyy hh:m:ss tt","MM/d/yyyy hh:m:s tt","MM/d/yyyy h:mm:ss tt","MM/d/yyyy h:mm:s tt","MM/d/yyyy h:m:ss tt","MM/d/yyyy h:m:s tt","M/dd/yyyy hh:mm:ss","M/dd/yyyy hh:mm:s","M/dd/yyyy hh:m:ss","M/dd/yyyy hh:m:s","M/dd/yyyy hh:mm:ss","M/dd/yyyy h:mm:s","M/dd/yyyy h:m:ss","M/dd/yyyy h:m:s","M/dd/yyyy hh:mm:ss tt","M/dd/yyyy hh:mm:s tt","M/dd/yyyy hh:m:ss tt","M/dd/yyyy hh:m:s tt","M/dd/yyyy h:mm:ss tt","M/dd/yyyy h:mm:s tt","M/dd/yyyy h:m:ss tt","M/dd/yyyy h:m:s tt","M/d/yyyy hh:mm:ss","M/d/yyyy hh:mm:s","M/d/yyyy hh:m:ss","M/d/yyyy hh:m:s","M/d/yyyy hh:mm:ss","M/d/yyyy h:mm:s","M/d/yyyy h:m:ss","M/d/yyyy h:m:s","M/d/yyyy hh:mm:ss tt","M/d/yyyy hh:mm:s tt","M/d/yyyy hh:m:ss tt","M/d/yyyy hh:m:s tt","M/d/yyyy h:mm:ss tt","M/d/yyyy h:mm:s tt","M/d/yyyy h:m:ss tt","M/d/yyyy h:m:s tt"]),this._dateTimeFormats},_getMonthIndex:function(n){return this._upperMonths||(this._upperMonths=e(this.dateTimeFormat.MonthNames),this._upperMonthsGenitive=e(this.dateTimeFormat.MonthGenitiveNames)),c(n,this._upperMonths,this._upperMonthsGenitive)},_getAbbrMonthIndex:function(n){return this._upperAbbrMonths||(this._upperAbbrMonths=e(this.dateTimeFormat.AbbreviatedMonthNames),this._upperAbbrMonthsGenitive=e(this.dateTimeFormat.AbbreviatedMonthGenitiveNames)),c(n,this._upperAbbrMonths,this._upperAbbrMonthsGenitive)},_getDayIndex:function(n){return this._upperDays||(this._upperDays=e(this.dateTimeFormat.DayNames)),new r.UI._ArrayHelper(this._upperDays).indexOf(o(n))},_getAbbrDayIndex:function(n){return this._upperAbbrDays||(this._upperAbbrDays=e(this.dateTimeFormat.AbbreviatedDayNames)),new r.UI._ArrayHelper(this._upperAbbrDays).indexOf(o(n))}},u._parse=s,u.invariantCulture=s({name:"",numberFormat:{CurrencyDecimalDigits:2,CurrencyDecimalSeparator:".",IsReadOnly:!0,CurrencyGroupSizes:[3],NumberGroupSizes:[3],PercentGroupSizes:[3],CurrencyGroupSeparator:",",CurrencySymbol:"\u00a4",NaNSymbol:"NaN",CurrencyNegativePattern:0,NumberNegativePattern:1,PercentPositivePattern:0,PercentNegativePattern:0,NegativeInfinitySymbol:"-Infinity",NegativeSign:"-",NumberDecimalDigits:2,NumberDecimalSeparator:".",NumberGroupSeparator:",",CurrencyPositivePattern:0,PositiveInfinitySymbol:"Infinity",PositiveSign:"+",PercentDecimalDigits:2,PercentDecimalSeparator:".",PercentGroupSeparator:",",PercentSymbol:"%",PerMilleSymbol:"\u2030",NativeDigits:["0","1","2","3","4","5","6","7","8","9"],DigitSubstitution:1},dateTimeFormat:{AMDesignator:"AM",Calendar:{MinSupportedDateTime:"@-62135568000000@",MaxSupportedDateTime:"@253402300799999@",AlgorithmType:1,CalendarType:1,Eras:[1],TwoDigitYearMax:2029,IsReadOnly:!0},DateSeparator:"/",FirstDayOfWeek:0,CalendarWeekRule:0,FullDateTimePattern:"dddd, dd MMMM yyyy HH:mm:ss",LongDatePattern:"dddd, dd MMMM yyyy",LongTimePattern:"HH:mm:ss",MonthDayPattern:"MMMM dd",PMDesignator:"PM",RFC1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",ShortDatePattern:"MM/dd/yyyy",ShortTimePattern:"HH:mm",SortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",TimeSeparator:":",UniversalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",YearMonthPattern:"yyyy MMMM",AbbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ShortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],DayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],AbbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],MonthNames:["January","February","March","April","May","June","July","August","September","October","November","December",""],IsReadOnly:!0,NativeCalendarName:"Gregorian Calendar",AbbreviatedMonthGenitiveNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],MonthGenitiveNames:["January","February","March","April","May","June","July","August","September","October","November","December",""]},eras:[1,"A.D.",null,0]}),u.currentCulture=s({name:"en-US",numberFormat:{CurrencyDecimalDigits:2,CurrencyDecimalSeparator:".",IsReadOnly:!1,CurrencyGroupSizes:[3],NumberGroupSizes:[3],PercentGroupSizes:[3],CurrencyGroupSeparator:",",CurrencySymbol:"$",NaNSymbol:"NaN",CurrencyNegativePattern:0,NumberNegativePattern:1,PercentPositivePattern:0,PercentNegativePattern:0,NegativeInfinitySymbol:"-Infinity",NegativeSign:"-",NumberDecimalDigits:2,NumberDecimalSeparator:".",NumberGroupSeparator:",",CurrencyPositivePattern:0,PositiveInfinitySymbol:"Infinity",PositiveSign:"+",PercentDecimalDigits:2,PercentDecimalSeparator:".",PercentGroupSeparator:",",PercentSymbol:"%",PerMilleSymbol:"\u2030",NativeDigits:["0","1","2","3","4","5","6","7","8","9"],DigitSubstitution:1},dateTimeFormat:{AMDesignator:"AM",Calendar:{MinSupportedDateTime:"@-62135568000000@",MaxSupportedDateTime:"@253402300799999@",AlgorithmType:1,CalendarType:1,Eras:[1],TwoDigitYearMax:2029,IsReadOnly:!1},DateSeparator:"/",FirstDayOfWeek:0,CalendarWeekRule:0,FullDateTimePattern:"dddd, MMMM dd, yyyy h:mm:ss tt",LongDatePattern:"dddd, MMMM dd, yyyy",LongTimePattern:"h:mm:ss tt",MonthDayPattern:"MMMM dd",PMDesignator:"PM",RFC1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",ShortDatePattern:"M/d/yyyy",ShortTimePattern:"h:mm tt",SortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",TimeSeparator:":",UniversalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",YearMonthPattern:"MMMM, yyyy",AbbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ShortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],DayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],AbbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],MonthNames:["January","February","March","April","May","June","July","August","September","October","November","December",""],IsReadOnly:!1,NativeCalendarName:"Gregorian Calendar",AbbreviatedMonthGenitiveNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],MonthGenitiveNames:["January","February","March","April","May","June","July","August","September","October","November","December",""]},eras:[1,"A.D.",null,0]}),r.UI._CultureInfo=u,h=r.UI._StringHelper=function(){function t(n,t){for(var f="",e=t[0],o,u,s,r,i=0;;){o=e.indexOf("{",i),u=e.indexOf("}",i);if(o<0&&u<0){f+=e.slice(i);break}if(u>0&&(u<o||o<0)){if(e.charAt(u+1)!=="}")throw new Error("format: brace mis-match");f+=e.slice(i,u+1),i=u+2;continue}f+=e.slice(i,o),i=o+1;if(e.charAt(i)==="{"){f+="{",i++;continue}if(u<0)throw new Error("format: brace mis-match");var h=e.substring(i,u),c=h.indexOf(":"),l=parseInt(c<0?h:h.substring(0,c),10)+1;if(isNaN(l))throw new Error("invalid format");s=c<0?"":h.substring(c+1),r=t[l],(typeof r=="undefined"||r===null)&&(r=""),f+=r.toFormattedString?r.toFormattedString(s):n&&r.localeFormat?r.localeFormat(s):r.format?r.format(s):r.toString(),i=u+1}return f}function n(n){this._str=n}return n.prototype={startsWith:function(n){return this._str.substr(0,n.length)===n},endsWith:function(n){return this._str.indexOf(n,this._str.length-n.length)!==-1},trim:function(){return this._str.replace(/^\s+|\s+$/g,"")},trimEnd:function(){return this._str.replace(/\s+$/,"")},trimStart:function(){return this._str.replace(/^\s+/,"")}},n.format=function(n,i){return t(!1,arguments)},n}(),r.UI._DateTimeHelper=function(){function a(n,t){for(var f=0,i=!1,u,r=0,e=n.length;r<e;r++){u=n.charAt(r);switch(u){case"'":case'"':i?t.append("'"):f++,i=!1;break;case"\\":i&&t.append("\\"),i=!i;break;default:t.append(u),i=!1;break}}return f}function b(n,t){t||(t="F");var i=t.length;if(i===1)switch(t){case"d":return n.ShortDatePattern;case"D":return n.LongDatePattern;case"t":return n.ShortTimePattern;case"T":return n.LongTimePattern;case"f":return n.LongDatePattern+" "+n.ShortTimePattern;case"F":return n.FullDateTimePattern;case"M":case"m":return n.MonthDayPattern;case"s":return n.SortableDateTimePattern;case"Y":case"y":return n.YearMonthPattern;case"g":return n.ShortDatePattern+" "+n.ShortTimePattern;case"G":return n.ShortDatePattern+" "+n.LongTimePattern;case"R":case"r":return n.RFC1123Pattern;case"u":return n.UniversalSortableDateTimePattern;case"U":return n.FullDateTimePattern;case"o":case"O":return"yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fffffff";default:throw new Error("InvalidString");}else i===2&&t.charAt(0)==="%"&&(t=t.charAt(1));return t}function o(n,t){var r,f,i,u;if(!t)return 0;for(f=n.getTime(),i=0,u=t.length;i<u;i+=4){r=t[i+2];if(r===null||f>=r)return i}return 0}function s(n,t,i,r){var u=n.getFullYear();return!r&&t.eras&&(u-=t.eras[i+3]),u}function k(n,t){var r=new Date,u=o(r),i;return t<100&&(i=s(r,n,u),t+=i-i%100,t>n.Calendar.TwoDigitYearMax&&(t-=100)),t}function p(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g|\[h\]|\[mm\]|\[ss\]/g}function tt(n,t){var u,l,h,o;if(n._parseRegExp){if(n._parseRegExp[t])return n._parseRegExp[t]}else n._parseRegExp={};u=b(n,t),u=u.replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");var i=new f("^"),c=new r.UI._ArrayHelper([]),s=0,y=0,v=p(),e;while((e=v.exec(u))!==null){l=u.slice(s,e.index),s=v.lastIndex,y+=a(l,i);if(y%2==1){i.append(e[0]);continue}switch(e[0]){case"dddd":case"ddd":case"MMMM":case"MMM":case"gg":case"g":i.append("(\\D+)");break;case"tt":case"t":i.append("(\\D*)");break;case"yyyy":i.append("(\\d{4})");break;case"fff":i.append("(\\d{3})");break;case"ff":i.append("(\\d{2})");break;case"f":i.append("(\\d)");break;case"dd":case"d":case"MM":case"M":case"yy":case"y":case"HH":case"H":case"hh":case"h":case"mm":case"m":case"ss":case"s":i.append("(\\d\\d?)");break;case"zzz":i.append("([+-]?\\d\\d?:\\d{2})");break;case"zz":case"z":i.append("([+-]?\\d\\d?)");break;case"/":i.append("(\\"+n.DateSeparator+")");break;default:throw new Error("Invalid date format pattern");}c.add(e[0])}return a(u.slice(s),i),i.append("$"),h=i.toString().replace(/\s+/g,"\\s+"),o={regExp:h,groups:c.array()},n._parseRegExp[t]=o,o}function c(n,i,r){var it,yt,u,ct,ut,b,d,g,pt,f,nt,p,ot;n=t.trim(n);var c=r.dateTimeFormat,vt=tt(c,i),lt=new RegExp(vt.regExp).exec(n);if(lt===null)return null;var at=vt.groups,st=null,o=null,e=null,y=null,v=null,w=0,a,rt=0,et=0,s=0,ft=null,ht=!1,l=!0;for(it=0,yt=at.length;it<yt;it++){u=lt[it+1];if(u)switch(at[it]){case"dd":case"d":l=!1,y=parseInt(u,10);if(y<1||y>31)return null;break;case"MMMM":l=!1,e=r._getMonthIndex(u);if(e<0||e>11)return null;break;case"MMM":l=!1,e=r._getAbbrMonthIndex(u);if(e<0||e>11)return null;break;case"M":case"MM":l=!1,e=parseInt(u,10)-1;if(e<0||e>11)return null;break;case"y":case"yy":l=!1,o=k(c,parseInt(u,10));if(o<0||o>9999)return null;break;case"yyyy":l=!1,o=parseInt(u,10);if(o<0||o>9999)return null;break;case"h":case"hh":case"H":case"HH":w=parseInt(u,10);if(w<0||w>23)return null;break;case"m":case"mm":rt=parseInt(u,10);if(rt<0||rt>59)return null;break;case"s":case"ss":et=parseInt(u,10);if(et<0||et>59)return null;break;case"tt":case"t":ct=u.toUpperCase(),ht=ct===c.PMDesignator.toUpperCase();if(!ht&&ct!==c.AMDesignator.toUpperCase())return null;break;case"f":s=parseInt(u,10)*100;if(s<0||s>999)return null;break;case"ff":s=parseInt(u,10)*10;if(s<0||s>999)return null;break;case"fff":s=parseInt(u,10);if(s<0||s>999)return null;break;case"dddd":l=!1,v=r._getDayIndex(u);if(v<0||v>6)return null;break;case"ddd":l=!1,v=r._getAbbrDayIndex(u);if(v<0||v>6)return null;break;case"zzz":ut=u.split(/:/);if(ut.length!==2)return null;a=parseInt(ut[0],10);if(a<-12||a>13)return null;b=parseInt(ut[1],10);if(b<0||b>59)return null;ft=a*60+(new h(u).startsWith("-")?-b:b);break;case"z":case"zz":a=parseInt(u,10);if(a<-12||a>13)return null;ft=a*60;break;case"g":case"gg":d=u;if(!d||!c.eras)return null;for(d=d.toLowerCase().trim(),g=0,pt=c.eras.length;g<pt;g+=4)if(d===c.eras[g+1].toLowerCase()){st=g;break}if(st===null)return null;break}}f=new Date,p=c.Calendar.convert,p&&(nt=p.fromGregorian(f)),p||(nt=[f.getFullYear(),f.getMonth(),f.getDate()]),o===null?o=nt[0]:c.eras&&(o+=c.eras[(st||0)+3]),e===null&&(e=nt[1]),y===null&&(y=nt[2]);if(p){f=p.toGregorian(o,e,y);if(f===null)return null}else{f.setFullYear(o,e,y);if(f.getDate()!==y)return null;if(v!==null&&f.getDay()!==v)return null}return ht&&w<12&&(w+=12),f.setHours(w,rt,et,s),ft!==null&&(ot=f.getMinutes()-(ft+f.getTimezoneOffset()),f.setHours(f.getHours()+parseInt(ot/60,10),ot%60)),f._classNames=[l?"TimeSpan":"DateTime"],f}function n(n){return n<10?"0"+n:n.toString()}function l(n){return n<10?"00"+n:n<100?"0"+n:n.toString()}function nt(n){return n<10?"000"+n:n<100?"00"+n:n<1e3?"0"+n:n.toString()}function w(n,t,i){for(var u,o,e,s=!1,r=1,f=i.length;r<f;r++){o=i[r];if(o){s=!0,u=c(n,o,t);if(u)return u}}if(!s)for(e=t._getDateTimeFormats(),r=0,f=e.length;r<f;r++){u=c(n,e[r],t);if(u)return u}return null}function g(n){return n===i||n===null?0:(n-y)/v}function d(n){if(n<0)throw new Error("invalid OADate");var t=new Date(y);return t.setMilliseconds(n*v),t}function e(n){this._date=n}var y=new Date(1899,11,30),v=864e5;return e.prototype={Hour:function(){return this._date.getHours()},Minute:function(){return this._date.getMinutes()},Second:function(){return this._date.getSeconds()},Millisecond:function(){return this._date.getMilliseconds()},TotalDays:function(){return Math.floor(this.toOADate())},toOADate:function(){return g(this._date)},format:function(n){return this._toFormattedString(n,u.invariantCulture)},localeFormat:function(n){return this._toFormattedString(n,u.currentCulture)},_toFormattedString:function(t,i){function ft(){return v||rt?v:(v=et.test(t),rt=!0,v)}function c(n,t){if(h)return h[t];switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate()}}var u=i.dateTimeFormat,tt=u.Calendar.convert,g,ut,w,k,r,e,v,rt,et,it,d,h;if(!t||!t.length||t==="i")return i&&i.name.length?tt?this._toFormattedString(u.FullDateTimePattern,i):(g=new Date(this._date.getTime()),ut=o(this._date,u.eras),g.setFullYear(s(this._date,u,ut)),g.toLocaleString()):this._date.toString();for(w=u.eras,k=t==="s",t=b(u,t),r=new f,et=/([^d]|^)(d|dd)([^d]|$)/g,it=0,d=p(),!k&&tt&&(h=tt.fromGregorian(this._date));;){var st=d.lastIndex,y=d.exec(t),ot=t.slice(st,y?y.index:t.length);it+=a(ot,r);if(!y)break;if(it%2==1){r.append(y[0]);continue}switch(y[0]){case"dddd":r.append(u.DayNames[this._date.getDay()]);break;case"ddd":r.append(u.AbbreviatedDayNames[this._date.getDay()]);break;case"dd":v=!0,r.append(n(c(this._date,2)));break;case"d":v=!0,r.append(c(this._date,2));break;case"MMMM":r.append(u.MonthGenitiveNames&&ft()?u.MonthGenitiveNames[c(this._date,1)]:u.MonthNames[c(this._date,1)]);break;case"MMM":r.append(u.AbbreviatedMonthGenitiveNames&&ft()?u.AbbreviatedMonthGenitiveNames[c(this._date,1)]:u.AbbreviatedMonthNames[c(this._date,1)]);break;case"MM":r.append(n(c(this._date,1)+1));break;case"M":r.append(c(this._date,1)+1);break;case"yyyy":case"yyy":r.append(nt(h?h[0]:s(this._date,u,o(this._date,w),k)));break;case"yy":r.append(n((h?h[0]:s(this._date,u,o(this._date,w),k))%100));break;case"y":r.append((h?h[0]:s(this._date,u,o(this._date,w),k))%100);break;case"hh":e=this._date.getHours()%12,e===0&&(e=12),r.append(n(e));break;case"h":e=this._date.getHours()%12,e===0&&(e=12),r.append(e);break;case"HH":r.append(n(this._date.getHours()));break;case"H":r.append(this._date.getHours());break;case"mm":r.append(n(this._date.getMinutes()));break;case"m":r.append(this._date.getMinutes());break;case"ss":r.append(n(this._date.getSeconds()));break;case"s":r.append(this._date.getSeconds());break;case"tt":r.append(this._date.getHours()<12?u.AMDesignator:u.PMDesignator);break;case"t":r.append((this._date.getHours()<12?u.AMDesignator:u.PMDesignator).charAt(0));break;case"f":r.append(l(this._date.getMilliseconds()).charAt(0));break;case"ff":r.append(l(this._date.getMilliseconds()).substr(0,2));break;case"fff":r.append(l(this._date.getMilliseconds()));break;case"z":e=this._date.getTimezoneOffset()/60,r.append((e<=0?"+":"-")+Math.floor(Math.abs(e)));break;case"zz":e=this._date.getTimezoneOffset()/60,r.append((e<=0?"+":"-")+n(Math.floor(Math.abs(e))));break;case"zzz":e=this._date.getTimezoneOffset()/60,r.append((e<=0?"+":"-")+n(Math.floor(Math.abs(e)))+":"+n(Math.abs(this._date.getTimezoneOffset()%60)));break;case"g":case"gg":u.eras&&r.append(u.eras[o(this._date,w)+1]);break;case"/":r.append(u.DateSeparator);break;case"[h]":r.append("[h]");break;case"[mm]":r.append("[mm]");break;case"[ss]":r.append("[ss]");break;default:throw new Error("Invalid date format pattern");}}return r.toString()}},e.parseLocale=function(n,t){return w(n,u.currentCulture,arguments)},e.parseInvariant=function(n,t){return w(n,u.InvariantCulture,arguments)},e.parseExact=c,e.fromOADate=d,e}(),r.UI._NumberHelper=function(){function k(){return/^(C|c|D|d|E|e|F|f|G|g|N|n|P|p|R|r|X|x)(\d*)$/g}function d(n,t){var e=Math.floor(Math.abs(n)),f={integer:1,decimal:0},h;while(e>=10)e=e/10,f.integer++;var r=n.toString(),o=r.search(/e/ig),u=r.indexOf(t),i;if(o!==-1){var c=r.substr(0,o),l=r.substr(o+1),s=0;u!==-1&&(s=c.substr(u+1).length),h=parseFloat(l),i=s-h,i<0&&(i=0),f.decimal=i}else i=0,u!==-1&&(i=r.substr(u+1).length),f.decimal=i;return f}function s(n){for(var i={symbol:n.charAt(0),sign:0},r="",t=1;t<n.length;t++){r=n.charAt(t);if(r==="+")i.sign=1;else if(r==="-")i.sign=-1;else if(r==="0"){i.exp=n.length-t;break}else throw new Error("invalid exponent format");}return i}function nt(n){for(var h=null,c=null,a=null,f={intPart:null,decPart:null,group:!1,scale:0,percent:0,permile:0,exponent:null},t="",nt=!1,tt=!1,it=!1,l=!1,y=!1,v=!1,d=!1,k=!1,r=null,e=null,u=[],g,b,w,o,p=0;p<n.length;p++){r=n.charAt(p);if(nt){r!=="'"?t+=r:(u.push(t),t="",nt=!1),e=r;continue}else if(tt){r!=='"'?t+=r:(u.push(t),t="",tt=!1),e=r;continue}else if(it){u.push(t+r),t="",e=r;continue}else if(l){if(e==="E"||e==="e")if(r==="+"||r==="-"||r==="0"){t+=r;continue}else l=!1;else if(e==="+"||e==="-")if(r==="0"){t+=r;continue}else l=!1,u.push(t),t="";else if(e==="0")if(r==="0"){t+=r;continue}else l=!1,d||(d=!0,f.exponent=s(t)),u.push(t),t=""}else if(r==="0"||r==="#"){k=!0;if(e==="0"||e==="#"){t+=r,e=r;continue}else t!==""&&(u.push(t),t="")}else(e==="0"||e==="#")&&r!=="0"&&r!=="#"&&(u.push(t),t="");if(r===";"){t!==""&&(l&&!d&&(f.exponent=s(t)),u.push(t),t=""),y?f.decPart=r:f.intPart=u,u=[];if(h===i||h===null)h=f;else if(c===i||c===null)c=f;else if(a===i||a===null)a=f;else throw new Error("invalid format: too much semicolons");y=!1,k=!1,v&&(f.group=!0,v=!1),f={intPart:null,decPart:null,group:!1,scale:0,percent:0,permile:0,exponent:null}}else if(r===".")t!==""&&(u.push(t),t=""),f.intPart=u,u=[],y=!0,k=!1,v&&(f.group=!0,v=!1);else if(r==="'")nt=!0;else if(r==='"')tt=!0;else if(r==="%")f.percent++,u.push(r);else if(r==="\u2030")f.permile++,u.push(r);else if(r==="0"||r==="#")t+=r;else if(r===",")if(y)t!==""&&(u.push(t),t="");else{t!==""&&(u.push(t),t="");if(!k)continue;for(g=!0,b="",w=p+1;w<n.length;w++){o=n.charAt(w);if(b!==""){(o==="'"||o==='"')&&(b="");continue}if(o==="'"||o==='"')b=o;else if(o==="0"||o==="#"){g=!1;break}else if(o==="."||o===";")break}g?f.scale++:v=!0}else r==="E"||r==="e"?(l=!0,t!==""&&u.push(t),t=r):t+=r;e=r}return t!==""&&(l&&!d&&(f.exponent=s(t)),u.push(t)),v&&(f.group=!0),y?f.decPart=u:f.intPart=u,h===i||h===null?h=f:c===i||c===null?c=f:(a===i||a===null)&&(a=f),{normal:h,negative:c,zero:a}}function n(n,t,i){for(var r=n.length;r<t;r++)n=i?"0"+n:n+"0";return n}function v(n,t,i,r){var e=t[0],h=1,u=n.length-1,c=new f(""),o=0,s=!1;while(u>=0){if(e<1||e>9)throw new Error("NumberGroupSize must be between 1 and 9.");/\d/ig.test(n[u])&&(s&&(c.insert(i,0),s=!1),o++),c.insert(n[u],0),o===e&&(s=!0,o=0,h<t.length&&(e=t[h],h++)),u--}return c.toString()}function t(t,i,r,u,f,e,o){var y=Math.pow(10,i),a=Math.round(t*y)/y,h,s,c,l;return isFinite(a)||(a=t),t=a,h=t.toString(),l=h.split(/e/i),h=l[0],c=l.length>1?parseInt(l[1],10):0,l=h.split("."),h=l[0],s=l.length>1?l[1]:"",c>0?(s=n(s,c,!1),h+=s.slice(0,c),s=s.substr(c)):c<0&&(c=-c,h=t<0?e+n(h.replace(e,""),c+1,!0):n(h,c+1,!0),s=h.slice(-c,h.length)+s,h=h.slice(0,-c)),i>0?(s=s.length>i?s.slice(0,i):n(s,i,!1),s=f+s):s="",o===!0?h+s:v(h,r,u,e)+s}function g(i,r,u){var e=new f(""),h,o,s,b,it,p,nt,w,c,tt,l,ut,k,bt,st,lt,rt,ht,y,yt,et,ct,kt,ft,vt,at,pt;i=i*Math.pow(100,r.percent),i=i*Math.pow(1e3,r.permile),i=i/Math.pow(10,r.scale*3),h=r.intPart,o=r.decPart;if(!h&&!o)return"";s=null,b=null;if(h)for(s="",it=0;it<h.length;it++)p=h[it],/^(0|#)+/g.test(p)&&(s+=p);if(o)for(b="",nt=0;nt<o.length;nt++)w=o[nt],/^(0|#)+/g.test(w)&&(b+=w);if(s||b)b||(b="");else return(h?h.join(""):"")+(o?o.join(""):"");tt=0,l=d(i,u.NumberDecimalSeparator);if(r.exponent){ut=Math.abs(i),k=s?s.length:1;if(ut<1){if(ut<1&&ut>0){r.exponent.sign=-1,l.integer=k,l.decimal-=k,bt=Math.pow(10,k);while(ut*10<bt)ut*=10,tt++;i*=Math.pow(10,tt)}}else l.integer>k?(l.integer-=k,l.decimal+=k,i=i/Math.pow(10,l.integer),tt=l.integer):tt=l.integer<k?0:0,r.exponent.sign===-1&&(r.exponent.sign=0)}st=b.lastIndexOf("0"),lt=l.decimal,st<0||(lt=st+1),rt=t(i,lt,u.NumberGroupSizes,u.NumberGroupSeparator,u.NumberDecimalSeparator,u.NegativeSign,!0);if(rt==="")return(h?h.join(""):"")+(o?o.join(""):"");ht=!1;if(h){y=rt.split(u.NumberDecimalSeparator)[0],yt=y.substr(0,1),yt===u.NegativeSign&&(y=y.substr(1));var g=0,wt="",ot=s.indexOf("0"),dt=ot===-1?y.length:s.length-ot;for(it=h.length-1;it>=0;it--){p=h[it];if(/^(0|#)+/g.test(p)){wt=p+wt;if(wt!==s){for(et=p.length,ct=y.length-g-1;ct>=0&&et>0;ct--)kt=y.charAt(ct),e._insert(kt),et--,g++;g>=y.length&&g<dt&&et>0&&(e._insert(new Array(et+1).join("0")),g+=et)}else ft=y.substr(0,y.length-g),ot>=0&&ot<s.length-g-ft.length&&(ft=new Array(s.length-g-ot-ft.length+1).join("0")+ft),e._insert(ft)}else r.exponent&&!ht&&/^((E(\+|-)?|e(\+|-)?)\d+)/g.test(p)?(ht=!0,c="",c+=r.exponent.symbol,c+=a[r.exponent.sign],c+=n(tt.toString(),r.exponent.exp,!0),e._insert(c)):e._insert(p)}yt===u.NegativeSign&&e._insert(yt),r.group===!0&&(e=new f(v(e.toString(),u.NumberGroupSizes,u.NumberGroupSeparator,u.NegativeSign)))}if(o)for(vt="",lt>0?(at=rt.indexOf(u.NumberDecimalSeparator),at!==-1&&(vt=rt.substring(at+1),s===""&&e.append(rt.substr(0,at)),e.append(u.NumberDecimalSeparator))):/^(#+)$/ig.test(b)&&o.join("").length===b.length||(e.append(u.NumberDecimalSeparator),st>0&&(vt=new Array(st+1).join("0"))),pt=0,nt=0;nt<o.length;nt++)w=o[nt],/^(0|#)+/g.test(w)?(e.append(vt.substr(pt,w.length)),pt+=w.length):r.exponent&&!ht&&/^((E(\+|-)?|e(\+|-)?)\d+)/g.test(w)?(ht=!0,c="",c+=r.exponent.symbol,c+=a[r.exponent.sign],c+=n(tt.toString(),r.exponent.exp,!0),e.append(c)):e.append(w);return e.toString()}function o(n,t,i){var f=t.NegativeSign,u=t.PositiveSign,r=new h(n);(i===4||i===2)&&(f=" "+f,u=" "+u);if(i===4||i===3){if(r.endsWith(f))return["-",n.substr(0,n.length-f.length)];else if(r.endsWith(u))return["+",n.substr(0,n.length-u.length)]}else if(i===2||i===1){if(r.startsWith(f))return["-",n.substr(f.length)];else if(r.startsWith(u))return["+",n.substr(u.length)]}else if(i===0){if(r.startsWith("(")&&r.endsWith(")"))return["-",n.substr(1,n.length-2)]}else throw new Error("");return["",n]}function c(n,t){var b,v,a,h,k,d,g,u,nt,l,c,y;n=n!==i&&n!==null?new r.UI._StringHelper(n).trim():"";if(n.match(/^[+-]?infinity$/i))return parseFloat(n);if(n.match(/^0x[a-f0-9]+$/i))return parseInt(n,10);var e=t.numberFormat,w=o(n,e,e.NumberNegativePattern),p=w[0],s=w[1];return p===""&&e.NumberNegativePattern!==1&&(w=o(n,e,1),p=w[0],s=w[1]),p===""&&(p="+"),s[0]===e.CurrencySymbol&&(s=s.substr(1)),a=s.indexOf("e"),a<0&&(a=s.indexOf("E")),a<0?(v=s,b=null):(v=s.substr(0,a),b=s.substr(a+1)),d=v.indexOf(e.NumberDecimalSeparator),d<0?(h=v,k=null):(h=v.substr(0,d),k=v.substr(d+e.NumberDecimalSeparator.length)),h=h.split(e.NumberGroupSeparator).join(""),g=e.NumberGroupSeparator.replace(/\u00A0/g," "),e.NumberGroupSeparator!==g&&(h=h.split(g).join("")),u=p+h,k!==null&&(u+="."+k),nt=u[u.length-1],nt===e.PercentSymbol&&(u=u.substr(0,u.length-1),u=new r.UI._StringHelper(u).trimEnd(),l=u.indexOf(e.NumberDecimalSeparator),l===-1&&(l=u.length),c=new f(""),c.append(u.substr(0,l-2)),c.append(e.NumberDecimalSeparator),c.append(u.substr(l-2,2)),c.append(u.substr(l+1)),u=c.toString()),b!==null&&(y=o(b,e,1),y[0]===""&&(y[0]="+"),u+="e"+y[0]+y[1]),u.match(/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/)?parseFloat(u):NaN}function b(t,r,u){if(Math.abs(Math.floor(t)-t)!==0)throw new Error("Bad Format Specifier");var f=t>=0?t.toString(16):(rt+t+1).toString(16);return f=r?f.toLowerCase():f.toUpperCase(),u!==i&&u!==null&&f.length<u?n(f,u,!0):f}function p(i,r,u,f,e,o,s){var h=0,l=i>=1||i===0,v=l?function(n,t){return n/t<10}:function(n,t){return n*t>=1},a,c;while(h<1e3){a=Math.pow(10,h);if(v(i,a))break;h++}return i=l?Math.abs(i)/Math.pow(10,h):Math.abs(i)*Math.pow(10,h),c=t(i,u,f,e,o,s),c+=r+(l?"+":"-")+n(h.toString(),3,!0)}function e(n){this._num=n}var a={"1":"+","0":"","-1":"-"},rt=4294967295,it=["n %","n%","%n"],tt=["-n %","-n%","-%n"],l=["(n)","-n","- n","n-","n -"],y=["$n","n$","$ n","n $"],w=["($n)","-$n","$-n","$n-","(n$)","-n$","n-$","n$-","-n $","-$ n","n $-","$ n-","$ -n","n- $","($ n)","(n $)"];return e.prototype={format:function(n){return this._toFormattedString(n,u.invariantCulture)},localeFormat:function(n){return this._toFormattedString(n,u.currentCulture)},_toFormattedString:function(n,t){return!n||n.length===0||n==="i"?t&&t.name.length>0?this._num.toLocaleString():this._num.toString():k().test(n)?this._toStandardFormattedString(n,t.numberFormat):this._toCustomFormattedString(n,t.numberFormat)},_toStandardFormattedString:function(i,r){var e=Math.abs(this._num),u,f,o,c,a,s,v,h;i||(i="D"),u=-1,i.length>1&&(u=parseInt(i.slice(1),10));switch(i.charAt(0)){case"d":case"D":f="n",u!==-1&&(e=n(""+e,u,!0)),this._num<0&&(e="-"+e);break;case"c":case"C":f=this._num<0?w[r.CurrencyNegativePattern]:y[r.CurrencyPositivePattern],u===-1&&(u=r.CurrencyDecimalDigits),e=t(Math.abs(this._num),u,r.CurrencyGroupSizes,r.CurrencyGroupSeparator,r.CurrencyDecimalSeparator,r.NegativeSign);break;case"n":case"N":f=this._num<0?l[r.NumberNegativePattern]:"n",u===-1&&(u=r.NumberDecimalDigits),e=t(Math.abs(this._num),u,r.NumberGroupSizes,r.NumberGroupSeparator,r.NumberDecimalSeparator,r.NegativeSign);break;case"p":case"P":f=this._num<0?tt[r.PercentNegativePattern]:it[r.PercentPositivePattern],u===-1&&(u=r.PercentDecimalDigits),e=t(Math.abs(this._num)*100,u,r.PercentGroupSizes,r.PercentGroupSeparator,r.PercentDecimalSeparator,r.NegativeSign);break;case"F":case"f":o=this._toFixedPoint(e,f,i,u,r),e=o[0],f=o[1];break;case"e":case"E":o=this._toScientificNotation(e,f,i,u,r),e=o[0],f=o[1];break;case"x":case"X":f="n",e=b(this._num,i.charAt(0)==="x",u===-1?0:u);break;case"g":case"G":c=this._num.toString(),o=[],o=c.indexOf("e")===-1&&c.indexOf("E")===-1?this._toFixedPoint(e,f,i,u,r):this._toScientificNotation(e,f,i.replace("g","e").replace("G","E"),u,r),e=o[0],f=o[1];break;default:throw new Error("Bad Format Specifier");}for(a=/n|\$|-|%/g,s="";;){v=a.lastIndex,h=a.exec(f),s+=f.slice(v,h?h.index:f.length);if(!h)break;switch(h[0]){case"n":s+=e;break;case"$":s+=r.CurrencySymbol;break;case"-":/[1-9]/.test(e)&&(s+=r.NegativeSign);break;case"%":s+=r.PercentSymbol;break;default:throw new Error("Invalid number format pattern");}}return s},_toScientificNotation:function(n,t,i,r,u){return t="n",n=p(Math.abs(this._num),i.charAt(0),r===-1?6:r,u.NumberGroupSizes,u.NumberGroupSeparator,u.NumberDecimalSeparator,u.NegativeSign),this._num<0&&(n="-"+n),[n,t]},_toFixedPoint:function(n,i,r,u,f){i=this._num<0?l[f.NumberNegativePattern]:"n",u===-1&&(u=2);var e=Math.floor(n),o=n-e;return n=t(o,u,f.NumberGroupSizes,f.NumberGroupSeparator,f.NumberDecimalSeparator,f.NegativeSign),n=""+e+n.substring(1),[n,i]},_toCustomFormattedString:function(n,t){var u=nt(n),r=null,i;return this._num===0?r=u.zero:this._num<0&&(r=u.negative),r||(r=u.normal),i=g(this._num,r,t)+"",i.indexOf(t.NegativeSign)===1&&i.indexOf(t.CurrencySymbol)===0&&(i=i[1]+i[0]+i.substring(2)),i}},e.parseLocale=function(n){return c(n,u.currentCulture)},e.parseInvariant=function(n){return c(n,u.invariantCulture)},e}()})(this,jQuery);(function(n){"use strict";function a(){this.strValue=""}function f(n,t){var r,i,u;if(n===undefined||n===null)return t==="null";if(!t)return!1;r={undefined:"undefined",number:"number",boolean:"boolean",string:"string"};if(r[typeof n]===t)return!0;if(t==="function"&&/^\s*\bfunction\b/.test(""+n))return!0;if(Object.prototype.toString.call(n).slice(8,-1).toLowerCase()===t.toLowerCase())return!0;if(n&&n._classNames){for(i=0;i<n._classNames.length;i++){u=n._classNames[i];if(u===t)return!0}return!1}else{if(n===undefined||n===null)return!1;if(t==="DateTime"||t==="TimeSpan")return n instanceof Date}if(typeof t=="string")if(r[t])return!1;return n instanceof t}function g(n,t){return f(n,t)?n:null}function st(n){this.value=n}function o(n,t){this._classNames=["NumberFormatBase","IFormatter","IFormatProviderSupport"],this._initFileds(),this.partLocaleID=n,this.partDbNumberFormat=t}function vt(n){this._classNames=["StandardDateTimeFormatter","IFormatter"],this._formatString=n}function lt(n){this._classNames=["StandardNumberFormatter","IFormatter"],this._formatString=n}function ft(n,i,r){this._classNames=["NumberFormatText","IFormatter"];var u=o.TrimNotSupportSymbol(n,!1);i&&(u=t.ReplaceKeyword(u,this.PartLocaleID().OriginalToken(),this.PartLocaleID().CurrencySymbol())),u=t.Filter(u,t.LeftSquareBracket,t.RightSquareBracket),u=t.TrimEscape(u),this._formatString=u}function wt(){}function c(n,t){this._classNames=["GeneralFormatter","IFormatter","INotifyPropertyChanged","IColorFormatter"],this._initFileds(),u.IsNullOrEmpty(n)&&(n=o.General),t||(t=b.CustomMode),this.formatCached=n,this.formatModeType=t,this.isDefault=this.formatCached.toLowerCase()===o.General.toLowerCase(),this.isConstructed=!1}function s(n,i,r){this.digitalFormat=null,this.exponentialDigitalFormat=null,this.fullFormatString=null,o.call(this,i,r),this._classNames.push("NumberFormatGeneral");if(arguments.length>0)if(s.EvaluateFormat(n)){if(n.Contains(t.Zero)||n.Contains(t.NumberSign)||n.Contains(t.DecimalSeparator)||n.Contains(t.CommercialAt))throw"format is illegal.";this.fullFormatString=n}else throw"format is illegal.";else this.fullFormatString=o.General}function at(n){this._classNames=["CustomNumberFormat","IFormatter","IFormatProviderSupport"],this._initFileds(),arguments.length===0?(this.formatCached=o.General,this.numberFormat=new s):this.Init(n)}function it(n,t,i,r){var f,o,u;if(i&&i.length>0)for(f in i)if(i.hasOwnProperty(f)){o=i[f],u=e.UI._DateTimeHelper.parseLocale(n,o);if(u&&u-t==0)return r.call()}return null}function p(n){this._classNames=["FormatPartBase"],this._initFileds(),this.originalToken=n}function v(n,t,i,r){o.call(this,i,r),this._classNames.push("NumberFormatDateTime"),this._initFileds(),this.ExactlyMatch=!1,this.formatString=this.FixFormat(o.TrimNotSupportSymbol(n)),this.absTimeParts=t,this._init(n,t,i,r)}function l(n,i,f){var e,l,a,h,s,c;this.numberFormatString=null,this.fullFormatString=null,this.isGeneralNumber=!1,this.fractionIntegerFormat=null,this.fractionNumeratorFormat=null,this.fractionDenominatorFormat=null,this.excelFormatString=u.Empty,o.call(this,i,f),this._classNames.push("NumberFormatDigital"),e=o.TrimNotSupportSymbol(n),this.fullFormatString=t.Filter(n,t.LeftSquareBracket,t.RightSquareBracket),this.excelFormatString=e,i&&(l=e,e=t.ReplaceKeyword(l,this.PartLocaleID().OriginalToken(),this.PartLocaleID().CurrencySymbol())),this.PartDBNumberFormat()&&(this.excelFormatString=t.ReplaceKeyword(this.excelFormatString,this.PartDBNumberFormat().OriginalToken(),this.PartDBNumberFormat().toString())),e=t.Filter(e,t.LeftSquareBracket,t.RightSquareBracket),a=e.indexOf(t.SolidusSign),a>-1&&(e=r.Replace(e,"\\"+t.QuestionMark,t.Zero),h=e.split(t.SolidusSign),h&&h.length===2&&(this.fractionDenominatorFormat=h[1],s=h[0],s&&(c=s.lastIndexOf(t.Space),c>-1?(this.fractionIntegerFormat=s.substr(0,c),this.fractionNumeratorFormat=s.substr(c+1,s.length-c-1)):this.fractionNumeratorFormat=s))),this.numberFormatString=e}function rt(n){var e,s,h,o;p.call(this,n),this._classNames.push("ConditionFormatPart"),this._initFileds(),e=t.TrimSquareBracket(n);if(u.IsNullOrEmpty(e))throw new Error("token is illegal.");for(var i=null,f=0,r=null;f<e.length;f++){r=e[f];if(t.IsOperator(r))i||(i=new a),i.Append(r);else break}if(!i)throw new Error("token is illegal.");s=i.toString(),i=null;switch(s){case"<":this.compareOperator=y.LessThan;break;case"<=":this.compareOperator=y.LessThanOrEqualsTo;break;case"=":this.compareOperator=y.EqualsTo;break;case">=":this.compareOperator=y.GreaterThanOrEqualsTo;break;case">":this.compareOperator=y.GreaterThan;break;case"<>":this.compareOperator=y.NotEqualsTo;break;default:throw new Error("token is illegal.");}for(;f<e.length;f++){r=e[f];if(t.IsOperator(r))throw new Error("token is illegal.");i||(i=new a),i.Append(r)}if(!i)throw new Error("token is illegal.");h=i.toString(),o=parseFloat(h);if(isNaN(o))throw new Error("token is illegal.");else this.value=o}function et(n){var i,f,e;this.foreColor="black",this.index=-1,this.colorName=null,p.call(this,n),this._classNames.push("ColorFormatPart"),i=t.TrimSquareBracket(n);if(!i||i===u.Empty)throw new Error("token is illegal.");try{this.foreColor=i,this.colorName=i;return}catch(o){}if(i.length>"Color".length){i=r.Remove(i,0,"Color".length),f=-1,e=parseInt(i,10);if(!isNaN(e)){f=e;if(f>=1&&f<=56)return}}throw new Error("token is illegal.");}function k(n){var i,t;p.call(this,n),this._classNames.push("ABSTimeFormatPart"),this._initFileds();if(k.EvaluateFormat(n)){this.token=n.toLowerCase();if(this.token[1]===k.HoursABSContent)this.type=ot.Hour;else if(this.token[1]===k.MinuteABSContent)this.type=ot.Minute;else if(this.token[1]===k.SecondABSContent)this.type=ot.Second;else throw new Error("token is illegal.");}else throw new Error("token is illegal.");for(i=new a,t=0;t<this.token.length-2;t++)i.Append("0");this.formatString=i.toString()}function pt(n,t){this._classNames=["DBNumber"],this._initFileds();var r=null,i=null;if(n){this.units=[];for(r in n)r&&(i=n[r],i===0?this.units.push(u.Empty):this.units.push(i.toString()))}if(t){this.numbers=[];for(r in t)r&&(i=t[r],i===0?this.numbers.push(u.Empty):this.numbers.push(i.toString()))}}function w(n){p.call(this,n),this._classNames.push("DBNumberFormatPart"),this._initFileds();if(w.EvaluateFormat(n)){this.token=n;var u=t.TrimSquareBracket(n),i=r.Remove(u,0,"dbnum".length);this.type=parseInt(i,10);if(this.type<0||this.type>3)throw new Error("token is illegal.");}else throw new Error("token is illegal.");}function tt(n){var i,f;p.call(this,n),this._classNames.push("LocaleIDFormatPart"),this._initFileds();if(!n)throw new Error("token");if(n===u.Empty)throw new Error("token is illegal.");this.content=t.TrimSquareBracket(n),i=this.content;if(!i||i===u.Empty)throw new Error("token is illegal.");if(t.IsEquals(i[0],t.Dollar,!1))i=r.Remove(i,0,1);else throw new Error("token is illegal.");f=i.indexOf(t.HyphenMinus);if(f>-1)this.currencySymbol=i.substr(0,f),i=r.Remove(i,0,f);else{this.currencySymbol=i;return}if(t.IsEquals(i[0],t.HyphenMinus,!1))i=r.Remove(i,0,1);else throw new Error("token is illegal.");if(i.length>0)this.locateID=ct.ParseHexString(i);else throw new Error("token is illegal.");}var e=n.GrapeCity,yt,ht,b,ut,h,i,ct;typeof e=="undefined"&&(e=n.GrapeCity={}),typeof e.UI=="undefined"&&(e.UI={});var d={CurrentCulture:0,CurrentCultureIgnoreCase:1,InvariantCulture:2,InvariantCultureIgnoreCase:3,Ordinal:4,OrdinalIgnoreCase:5},u={Empty:"",Format:function(){var t,n,i;if(arguments.length===0)return null;for(t=arguments[0],n=1;n<arguments.length;n++)i=new RegExp("\\{"+(n-1)+"\\}","gm"),t=t.replace(i,arguments[n]);return t},IsNullOrEmpty:function(n){return!n||n===u.Empty}},r={Contains:function(n,t){return t===""||n.indexOf(t)>=0},IndexOf:function(n,t,i){if(i)if(i===d.CurrentCultureIgnoreCase){var u=n.toLowerCase(),r=t.toLowerCase();return u.indexOf(r)}else return n.indexOf(t);else return n.indexOf(t)},TrimStart:function(n,t){if(!t)return n;for(var i=n;;){if(i.substr(0,t.length)!==t)break;i=i.substr(t.length)}return i},TrimEnd:function(n,t){if(!t)return n;for(var i=n;;){if(i.substr(i.length-t.length,t.length)!==t)break;i=i.substr(0,i.length-t.length)}return i},Trim:function(n,t){var i=t;return t||(i=" "),n=this.TrimStart(n,i),n=this.TrimEnd(n,i)},Insert:function(n,t,i){if(t<0||t>n.length||i===null||i===undefined)throw new Error;var u=n.substr(0,t),r=n.substr(t,n.length-t);return u+i+r},Remove:function(n,t,i){(i===undefined||i===null)&&(i=n.length-t);if(t<0||i<0||t+i>n.length)throw new Error;var u=n.substr(0,t),r=n.substr(t+i,n.length-t-i);return u+r},StartsWith:function(n,t,i){if(!t)throw new Error;if(t==="")return!0;if(t.length>n.length)return!1;var u=n,r=t;return i===d.CurrentCultureIgnoreCase&&(u=u.toLowerCase(),r=r.toLowerCase()),u.search(new RegExp("^"+r))>-1},EndsWith:function(n,t,i){if(!t)throw new Error;if(t==="")return!0;if(t.length>n.length)return!1;var u=n,r=t;return i===d.CurrentCultureIgnoreCase&&(u=u.toLowerCase(),r=r.toLowerCase()),u.search(new RegExp(r+"$"))>-1},Replace:function(n,t,i){if(!t||t==="")throw new Error;var r=new RegExp(t,"g");return n.replace(r,i)}};e.UI.StringHelper=r,a.prototype={Append:function(n){n&&(this.strValue+=n.toString())},toString:function(){return this.strValue.toString()},Length:function(){return this.strValue.length},ToString:function(n,t){var r=this.toString(),i;return arguments.length===0?r:i=r.substr(n,t)},Remove:function(n,t){var i=this.toString();this.strValue=r.Remove(i,n,t)}},e.UI.StringBuilder=a,yt={None:0,AllowLeadingWhite:1,AllowTrailingWhite:2,AllowInnerWhite:4,AllowWhiteSpaces:7,NoCurrentDateDefault:8,AdjustToUniversal:16,AssumeLocal:32,AssumeUniversal:64,RoundtripKind:128},ht={IsDigit:function(n){var t=n.charCodeAt(0);return t>=48&&t<=57},IsWhiteSpace:function(n){var t=n.charCodeAt(0);return t>=9&&t<=13||t===32||t===133||t===160}},b={CustomMode:0,StandardDateTimeMode:1,StandardNumericMode:2},e.UI.FormatMode=b,ut={General:0,Number:1,DateTime:2,Text:3},e.UI.NumberFormatType=ut;var ot={Hour:0,Minute:1,Second:2},t={DoubleQuote:'"',SingleQuote:"'",Tab:"\t",LeftSquareBracket:"[",RightSquareBracket:"]",LessThanSign:"<",GreaterThanSign:">",EqualsThanSign:"=",PlusSign:"+",HyphenMinus:"-",UnderLine:"_",LeftParenthesis:"(",RightParenthesis:")",Dollar:"$",Comma:",",Space:" ",SolidusSign:"/",ReverseSolidusSign:"\\",Zero:"0",QuestionMark:"?",Colon:":",Semicolon:";",Sharp:"#",CommercialAt:"@",NumberSign:"#",Asterisk:"*",Exponential1:"E+",Exponential2:"E-",DecimalSeparator:".",NumberGroupSeparator:",",PercentSymbol:"%",NaNSymbol:"NaN",FormatSeparator:";",NegativeSign:"-",ReplacePlaceholder:"@",ExponentialSymbol:"E",DateTimeFormatInfo:e.UI._CultureInfo.currentCulture.dateTimeFormat,NumberFormatInfo:{CurrencySymbol:"$",NegativeSign:"-",NaNSymbol:"NaN",CurrencyDecimalSeparator:".",CurrencyGroupSeparator:",",NegativeInfinitySymbol:"-Infinity",NumberDecimalSeparator:".",NumberGroupSeparator:",",PercentDecimalSeparator:".",PercentGroupSeparator:",",PercentSymbol:"%",PerMilleSymbol:"???",PositiveInfinitySymbol:"Infinity",PositiveSign:"+"},Filter:function(n,t,i){var e,r,u,f;if(n===undefined||n===null||n==="")return n;for(e="",r=0,u=0;u<n.length;u++)f=n[u],f===t?r++:f===i?(r--,r<0&&(r=0)):r===0&&(e+=f);return e.toString()},TrimSquareBracket:function(n){return!n||n===u.Empty?n:(n[0]===t.LeftSquareBracket&&(n=r.TrimStart(n,t.LeftSquareBracket)),n[n.length-1]===t.RightSquareBracket&&(n=r.TrimEnd(n,t.RightSquareBracket)),n)},IsOperator:function(n){return n===t.LessThanSign||n===t.GreaterThanSign||n===t.EqualsThanSign},TrimEscape:function(n){for(var e=n.length,u=!1,f=new a,r,i=0;i<e;i++)r=n.charAt(i),r===t.ReverseSolidusSign?(u=!u,u||f.Append(r)):(u=!1,f.Append(r));return f.toString()},AddSquareBracket:function(n){if(!n)throw new Error("token");return(n.length===0||n[0]!==t.LeftSquareBracket)&&(n=r.Insert(n,0,t.LeftSquareBracket.toString())),(n.length===0||n[n.length-1]!==t.RightSquareBracket)&&(n=r.Insert(n,n.length,t.RightSquareBracket.toString())),n},IsEquals:function(n,t,i){return n||t?n&&t?i?n.toLowerCase()===t.toLowerCase():n===t:!1:!0},ReplaceKeyword:function(n,t,i){var f,o,e;if(!n||n===u.Empty||this.IsEquals(t,i,!0))return n;f=n,o=0;for(;;){e=r.IndexOf(f,t,d.CurrentCultureIgnoreCase);if(e>-1)f=r.Remove(f,e,t.length),f=r.Insert(f,e,i),o=e+i.length;else break}return f},IsDecimal:function(n,i){var r=t.DecimalSeparator;return i&&(r=i.NumberDecimalSeparator),n.indexOf(r)>-1}},y={EqualsTo:0,NotEqualsTo:1,GreaterThan:2,GreaterThanOrEqualsTo:3,LessThan:4,LessThanOrEqualsTo:5},nt={IsNumber:function(n){return f(n,"number")||f(n,"DateTime")||f(n,"TimeSpan")||n&&!f(n,"boolean")&&!isNaN(n)},ToDouble:function(n){return n?f(n,"number")?n:f(n,"string")&&!isNaN(n)?e.UI._NumberHelper.parseLocale(n):f(n,"DateTime")?new e.UI._DateTimeHelper(n).toOADate():f(n,"TimeSpan")?new e.UI._DateTimeHelper(n).TotalDays():parseFloat(n):0}};e.UI.FormatConverter=nt,o.prototype={_initFileds:function(){this.numberStringConverter=null,this.numberFormatInfo=null,this.dateTimeFormatInfo=null,this.partLocaleID=null,this.partDbNumberFormat=null},NumberStringConverter:function(n){if(arguments.length===0)return this.numberStringConverter?this.numberStringConverter:null;else this.numberStringConverter=n},PartLocaleID:function(){return g(this.partLocaleID,"LocaleIDFormatPart")},PartDBNumberFormat:function(){return g(this.partDbNumberFormat,"DBNumberFormatPart")},DateTimeFormatInfo:function(n){if(arguments.length===0)return this.dateTimeFormatInfo;else this.dateTimeFormatInfo=n},NumberFormatInfo:function(n){if(arguments.length===0)return this.numberFormatInfo;else this.numberFormatInfo=n},NumberGroupSeparator:function(){return this.NumberFormatInfo()?this.NumberFormatInfo().NumberGroupSeparator():t.NumberGroupSeparator},PercentSymbol:function(){return this.NumberFormatInfo()?this.NumberFormatInfo().PercentSymbol():t.PercentSymbol},PositiveSign:function(){return this.NumberFormatInfo()?this.NumberFormatInfo().PositiveSign():t.PositiveSign},NegativeSign:function(){return this.NumberFormatInfo()?this.NumberFormatInfo().NegativeSign():t.NegativeSign},DecimalSeparator:function(){return this.NumberFormatInfo()?this.NumberFormatInfo().NumberDecimalSeparator():t.DecimalSeparator},NaNSymbol:function(){return this.NumberFormatInfo()?this.NumberFormatInfo().NaNSymbol:t.NaNSymbol}},o.General="General",o.TrimNotSupportSymbol=function(n,t){var f,e,i,r,u;for(t||(t=!0),f=!1,e=new a,i=0;i<n.length;i++)r=n[i],u=!0,r==='"'?f=!f:f||(t||(r==="?"&&(o.IsTransform(n,i)||(u=!1)),r==="/"&&(o.IsTransform(n,i)||(u=!1))),r==="_"?o.IsTransform(n,i)||(u=!1,i++):r==="*"&&(o.IsTransform(n,i)||(u=!1))),u&&e.Append(r);return e.toString()},o.IsTransform=function(n,t){if(n[t]==="\\")throw new Error("the '\\' can't be evaluated");if(t-1>0&&t-1<n.length)if(n[t-1]==="\\")if(t-2<0)return!0;else if(t-2>0&&t-2<n.length)return n[t-2]!=="\\";return!1},o.ContainsKeywords=function(n,i){var e,f,c,o,h;if(!n||n===u.Empty)return!1;var l=new a,s=!1,v=null;for(e=0;e<n.length;e++)f=n[e],f==='"'?s=!s:s||f!==t.UnderLine&&v!==t.UnderLine&&l.Append(f),v=f;for(c=l.toString().toLowerCase(),o=0;o<i.length;o++){h=i[o];if(r.Contains(c,h))return!0}return!1},vt.prototype={ShortDatePattern:"d",LongDatePattern:"D",FullDatePatternShortTime:"f",FullDatePatternLongTime:"F",GeneralDatePatternLongTimeShortTime:"g",GeneralDatePatternLongTimeLongTime:"G",MonthDayPattern1:"m",MonthDayPattern2:"M",RoundTripDatePattern1:"o",RoundTripDatePattern2:"O",RFC1123Pattern1:"r",RFC1123Pattern2:"R",SortableDatePattern:"s",ShortTimePattern:"t",LongTimePattern:"T",UniversalSortableDatePattern:"u",UniversalFullDatePattern:"U",YearMonthPattern1:"y",YearMonthPattern2:"Y",EvaluateFormat:function(n){return n===this.ShortDatePattern||n===this.LongDatePattern||n===this.FullDatePatternShortTime||n===this.FullDatePatternLongTime||n===this.GeneralDatePatternLongTimeShortTime||n===this.GeneralDatePatternLongTimeLongTime||n===this.MonthDayPattern1||n===this.MonthDayPattern2||n===this.RoundTripDatePattern1||n===this.RoundTripDatePattern2||n===this.RFC1123Pattern1||n===this.RFC1123Pattern2||n===this.SortableDatePattern||n===this.ShortTimePattern||n===this.LongTimePattern||n===this.UniversalSortableDatePattern||n===this.UniversalFullDatePattern||n===this.YearMonthPattern1||n===this.YearMonthPattern2?!0:!1},Format:function(n){try{return n===undefined||n===null||n===""?"":new e.UI._DateTimeHelper(n).localeFormat(this._formatString)}catch(t){return n.toString()}},Parse:function(n){try{return!n||n===""?null:e.UI._DateTimeHelper.parseLocale(n,this._formatString)}catch(t){return new Date(n)}}},e.UI._StandardDateTimeFormatter=vt,lt.prototype={CurrencyPattern1:"c",CurrencyPattern2:"C",DecimalPattern1:"d",DecimalPattern2:"D",ScientificPattern1:"e",ScientificPattern2:"E",FixedPointPattern1:"f",FixedPointPattern2:"F",GeneralPattern1:"g",GeneralPattern2:"G",NumberPattern1:"n",NumberPattern2:"N",PercentPattern1:"p",PercentPattern2:"P",RoundTripPattern1:"r",RoundTripPattern2:"R",HexadecimalPattern1:"x",HexadecimalPattern2:"X",EvaluateFormat:function(n){if(n&&n!==u.Empty&&n.length>0){var t=n.substr(0,1);if(t===this.CurrencyPattern1||t===this.CurrencyPattern2||t===this.DecimalPattern1||t===this.DecimalPattern2||t===this.ScientificPattern1||t===this.ScientificPattern2||t===this.FixedPointPattern1||t===this.FixedPointPattern2||t===this.GeneralPattern1||t===this.GeneralPattern2||t===this.NumberPattern1||t===this.NumberPattern2||t===this.PercentPattern1||t===this.PercentPattern2||t===this.RoundTripPattern1||t===this.RoundTripPattern2||t===this.HexadecimalPattern1||t===this.HexadecimalPattern2)return!0}return!1},Format:function(n){try{return!n||n===""?"":new e.UI._NumberHelper(n).localeFormat(this._formatString)}catch(t){return n.toString()}},Parse:function(n){try{return!n||n===""?null:e.UI._NumberHelper.parseLocale(n)}catch(i){var t=parseFloat(n);return isNaN(t)||!isFinite(t)?null:t}}},e.UI._StandardNumberFormatter=lt,ft.prototype=new o,ft.prototype.Format=function(n){try{var t=e.Calc.Convert.toString(n),i=r.Replace(this._formatString,'"',"");return i&&(t=r.Replace(i,"@",t)),t}catch(u){return""}},ft.prototype.Parse=function(n){return n?n:""},ft.prototype.FormatString=function(){return this._formatString},ft.EvaluateFormat=function(n){return!0},e.UI.AutoFormatter=function(n){this._innerFormatter=n},e.UI.AutoFormatter.prototype={formatString:function(){return this._innerFormatter?this._innerFormatter.formatString():""},innerFormatter:function(n){return arguments.length===0?this._innerFormatter:(this._innerFormatter=n,this)},Parse:function(n){return this._innerFormatter?this._innerFormatter.Parse(n):n},Format:function(n){return this._innerFormatter?this._innerFormatter.Format(n):n===undefined||n===null?"":n.toString()},toJSON:function(){return null}},h={defaultNumberFormatter:null,defaultGeneralFormatter:null,defaultShortDatePatternFormatter:null,defaultLongTimePatternFormatter:null,defaultSXDatetimePatternFormatter:null,defaultDMMMFormatter:null,defaultMMMYYFormatter:null,defaultHMMFormatter:null,defaultHMMSSFormatter:null,defaultHMMSS0Formatter:null,defaultShortDatePatternHMMFormatter:null,defaultShortDatePatternHMMSSFormatter:null,defaultShortDatePatternHMMSS0Formatter:null,defaultComboNumberFormatter1:null,defaultComboNumberFormatter2:null,defaultStandardNumberFormatter:null,defaultStandardPercentFormatter1:null,defaultStandardPercentFormatter2:null,defaultStandardGroupNumberFormatter1:null,defaultStandardGroupNumberFormatter2:null,DefaultNumberFormatter:function(){return this.defaultNumberFormatter||(this.defaultNumberFormatter=new c("###################0.################")),this.defaultNumberFormatter},DefaultGeneralFormatter:function(){return this.defaultGeneralFormatter||(this.defaultGeneralFormatter=new c),this.defaultGeneralFormatter},DefaultShortDatePatternFormatter:function(){return this.defaultShortDatePatternFormatter||(this.defaultShortDatePatternFormatter=new c(t.DateTimeFormatInfo.ShortDatePattern)),this.defaultShortDatePatternFormatter},DefaultSXDatetimePatternFormatter:function(){return this.defaultSXDatetimePatternFormatter||(this.defaultSXDatetimePatternFormatter=new c("m/d/yyyy h:mm:ss tt")),this.defaultSXDatetimePatternFormatter},DefaultLongTimePatternFormatter:function(){return this.defaultLongTimePatternFormatter||(this.defaultLongTimePatternFormatter=new c(t.DateTimeFormatInfo.LongTimePattern)),this.defaultLongTimePatternFormatter},DefaultDMMMFormatter:function(){return this.defaultDMMMFormatter||(this.defaultDMMMFormatter=new c("d-mmm")),this.defaultDMMMFormatter},DefaultMMMYYFormatter:function(){return this.defaultMMMYYFormatter||(this.defaultMMMYYFormatter=new c("mmm-yy")),this.defaultMMMYYFormatter},DefaultHMMFormatter:function(){return this.defaultHMMFormatter||(this.defaultHMMFormatter=new c("h:mm")),this.defaultHMMFormatter},DefaultHMMSSFormatter:function(){return this.defaultHMMSSFormatter||(this.defaultHMMSSFormatter=new c("h:mm:ss")),this.defaultHMMSSFormatter},DefaultHMMSS0Formatter:function(){return this.defaultHMMSS0Formatter||(this.defaultHMMSS0Formatter=new c("h:mm:ss.0")),this.defaultHMMSS0Formatter},DefaultComboNumberFormatter1:function(){return this.defaultComboNumberFormatter1||(this.defaultComboNumberFormatter1=new c(u.Format("{0}#,##0.00;[Red]({0}#,##0.00)",t.NumberFormatInfo.CurrencySymbol))),this.defaultComboNumberFormatter1},DefaultComboNumberFormatter2:function(){return this.defaultComboNumberFormatter2||(this.defaultComboNumberFormatter2=new c(u.Format("{0}#,##0;[Red]({0}#,##0)",t.NumberFormatInfo.CurrencySymbol))),this.defaultComboNumberFormatter2},DefaultStandardNumberFormatter:function(){return this.defaultStandardNumberFormatter||(this.defaultStandardNumberFormatter=new c("0.00E+00")),this.defaultStandardNumberFormatter},DefaultStandardPercentFormatter1:function(){return this.defaultStandardPercentFormatter1||(this.defaultStandardPercentFormatter1=new c("0.00%")),this.defaultStandardPercentFormatter1},DefaultStandardPercentFormatter2:function(){return this.defaultStandardPercentFormatter2||(this.defaultStandardPercentFormatter2=new c("0%")),this.defaultStandardPercentFormatter2},DefaultStandardGroupNumberFormatter1:function(){return this.defaultStandardGroupNumberFormatter1||(this.defaultStandardGroupNumberFormatter1=new c("#,##0.00")),this.defaultStandardGroupNumberFormatter1},DefaultStandardGroupNumberFormatter2:function(){return this.defaultStandardGroupNumberFormatter2||(this.defaultStandardGroupNumberFormatter2=new c("#,##0")),this.defaultStandardGroupNumberFormatter2}},c.prototype={_initFileds:function(){this.formatters=null,this.formatModeType=b.CustomMode,this.dateTimeFormatInfo=null,this.numberFormatInfo=null,this.isSingleFormatterInfo=!0,this.isDefault=!0,this.formatCached=null,this.isConstructed=!1,this.PropertyChanged=[]},toJSON:function(){return{formatters:this.formatters}},HasFormatedColor:function(){return this.isDefault?!1:this.PositiveExpression()&&this.PositiveExpression().ColorFormatPart()?!0:this.NegativeExpression()&&this.NegativeExpression().ColorFormatPart()?!0:this.ZeroExpression()&&this.ZeroExpression().ColorFormatPart()?!0:this.TextExpression()&&this.TextExpression().ColorFormatPart()?!0:!1},IsDefaultFormat:function(){return this.isDefault},FormatString:function(n){var i,r,e,s;if(arguments.length===0){this.Init(),i=null;switch(this.FormatMode()){case b.CustomMode:if(this.formatters)for(r=0;r<this.formatters.length;r++)e=this.formatters[r],f(e,"CustomNumberFormat")&&(i?i.Append(t.FormatSeparator):i=new a,s=e.FormatString(),i.Append(s));break;case b.StandardDateTimeMode:if(f(this.formatters[0],"StandardDateTimeFormatter"))return this.formatters[0].FormatString();break;case b.StandardNumericMode:if(f(this.formatters[0],"StandardNumberFormatter"))return this.formatters[0].FormatString();break}return i?i.toString():u.Empty}else{if(!n)throw new Error("value");this.formatters=null,this.formatCached=n,this.isDefault=this.formatCached.toLowerCase()===o.General.toLowerCase(),this.isConstructed=!1,this.Init(),this.RaisePropertyChanged("FormatString")}},DateTimeFormatInfo:function(n){var i,r;if(arguments.length===0)return this.Init(),this.dateTimeFormatInfo?this.dateTimeFormatInfo:t.DateTimeFormatInfo;else{this.Init(),this.dateTimeFormatInfo=n;if(this.formatters)for(i=0;i<this.formatters.length;i++)r=this.formatters[i],f(r,"IFormatProviderSupport")&&r.DateTimeFormatInfo(n);this.RaisePropertyChanged("DateTimeFormatInfo")}},NumberFormatInfo:function(n){var i,r;if(arguments.length===0)return this.Init(),this.numberFormatInfo?this.numberFormatInfo:t.NumberFormatInfo;else{this.Init(),this.numberFormatInfo=n;if(this.formatters)for(i=0;i<this.formatters.length;i++)r=this.formatters[i],f(r,"IFormatProviderSupport")&&r.NumberFormatInfo(n);this.RaisePropertyChanged("NumberFormatInfo")}},FormatMode:function(n){if(arguments.length===0)return this.formatModeType;else this.formatModeType=n,this.RaisePropertyChanged("FormatMode")},ExcelCompatibleFormatString:function(){var n,i,r,e;this.Init(),n=null;switch(this.FormatMode()){case b.CustomMode:if(this.formatters)for(i=0;i<this.formatters.length;i++)r=this.formatters[i],f(r,"CustomNumberFormat")&&(n?n.Append(t.FormatSeparator):n=new a,e=r.ExcelCompatibleFormatString(),n.Append(e));break;case b.StandardDateTimeMode:if(f(this.formatters[0],"StandardDateTimeFormatter"))return this.formatters[0].ExcelCompatibleFormatString();break;case b.StandardNumericMode:if(f(this.formatters[0],"StandardNumberFormatter"))return this.formatters[0].ExcelCompatibleFormatString();break}return n?n.toString():u.Empty},PositiveExpression:function(){return this.Init(),this.formatters&&this.formatters.length>0?g(this.formatters[0],"CustomNumberFormat"):null},NegativeExpression:function(){return this.Init(),this.formatters&&this.formatters.length>1?g(this.formatters[1],"CustomNumberFormat"):null},ZeroExpression:function(){return this.Init(),this.formatters&&this.formatters.length>2?g(this.formatters[2],"CustomNumberFormat"):null},TextExpression:function(){return this.Init(),this.formatters&&this.formatters.length>3?g(this.formatters[3],"CustomNumberFormat"):null},GetFormatType:function(n){this.Init();var t=this.GetFormatInfo(n);if(f(t,"CustomNumberFormat")){if(f(t.Formatter(),"NumberFormatDigital"))return ut.Number;else if(f(t.Formatter(),"NumberFormatDateTime"))return ut.DateTime;else if(f(t.Formatter(),"NumberFormatText"))return ut.Text}else if(f(t,"NumberFormatDigital")||f(t,"StandardNumberFormatter"))return ut.Number;else if(f(t,"NumberFormatDateTime")||f(t,"StandardDateTimeFormatter"))return ut.DateTime;else if(f(t,"NumberFormatText"))return ut.Text;return ut.General},GetPreferredEditingFormatter:function(n){var t,i;return this.Init(),f(n,"DateTime")?(t=new e.UI._DateTimeHelper(n),t.Hour()===0&&t.Minute()===0&&t.Second()===0&&t.Millisecond()===0?h.DefaultShortDatePatternFormatter():h.DefaultSXDatetimePatternFormatter()):f(n,"TimeSpan")?h.DefaultLongTimePatternFormatter():nt.IsNumber(n)?(i=nt.ToDouble(n),i>1e20?new c("0.##E+00"):h.DefaultNumberFormatter()):f(n,"string")?h.DefaultGeneralFormatter():h.DefaultGeneralFormatter()},GetPreferredDisplayFormatter:function(n,i){var l,o,e,a;i||(i={}),i.value=null,this.Init();if(u.IsNullOrEmpty(n))return new c;l=n,o=i.value=this.Parse(l);if(f(o,"DateTime")||f(o,"TimeSpan")){if(e=it(n,o,s.GeneralMonthDay(),function(){return h.DefaultDMMMFormatter()}))return e;if(e=it(n,o,s.GeneralYearMonth(),function(){return h.DefaultMMMYYFormatter()}))return e;if(e=it(n,o,s.GeneralYearMonthDay(),function(){return h.DefaultShortDatePatternFormatter()}))return e;if(e=it(n,o,s.GeneralHourMinute(),function(){return h.DefaultHMMFormatter()}))return e;if(e=it(n,o,s.GeneralHourMinuteSecond(),function(){return h.DefaultHMMSSFormatter()}))return e;if(e=it(n,o,s.GeneralHourMinuteSecondSubSecond(),function(){return h.DefaultHMMSS0Formatter()}))return e;a=this;if(e=it(n,o,s.GeneralHourMinuteWithDate(),function(){return h.defaultShortDatePatternHMMFormatter||(h.defaultShortDatePatternHMMFormatter=new c(a.DateTimeFormatInfo().ShortDatePattern+" h:mm")),h.defaultShortDatePatternHMMFormatter}))return e;if(e=it(n,o,s.GeneralHourMinuteSecondWithDate(),function(){return h.defaultShortDatePatternHMMSSFormatter||(h.defaultShortDatePatternHMMSSFormatter=new c(a.DateTimeFormatInfo().ShortDatePattern+" h:mm:ss")),h.defaultShortDatePatternHMMSSFormatter}))return e;if(e=it(n,o,s.GeneralHourMinuteSecondSubSecondWithDate(),function(){return h.defaultShortDatePatternHMMSS0Formatter||(h.defaultShortDatePatternHMMSS0Formatter=new c(a.DateTimeFormatInfo().ShortDatePattern+" h:mm:ss.0")),h.defaultShortDatePatternHMMSS0Formatter}))return e}else if(nt.IsNumber(o))if(l[0]===t.NumberFormatInfo.CurrencySymbol[0])return r.Contains(l,t.DecimalSeparator)?h.DefaultComboNumberFormatter1():h.DefaultComboNumberFormatter2();else if(r.IndexOf(l,"e",d.CurrentCultureIgnoreCase)>-1)return h.DefaultStandardNumberFormatter();else if(l[0].toString()===t.PercentSymbol||l[l.length-1].toString()===t.PercentSymbol)return r.Contains(l,t.DecimalSeparator)?h.DefaultStandardPercentFormatter1():h.DefaultStandardPercentFormatter2();else if(r.Contains(l,t.NumberGroupSeparator))return r.Contains(l,t.DecimalSeparator)?h.DefaultStandardGroupNumberFormatter1():h.DefaultStandardGroupNumberFormatter2();return h.DefaultGeneralFormatter()},Format:function(n,i){var r,o,h,e,s;i&&(i.value=null),this.Init(),r=this.GetFormatInfo(n),f(r,"CustomNumberFormat")&&r.ColorFormatPart()&&i&&(i.value=r.ColorFormatPart().ForeColor()),o=0,h=nt.IsNumber(n),h&&(o=nt.ToDouble(n));if(r){e=null;if(h&&r===this.NegativeExpression())e=r.Format(Math.abs(o)),s=g(r,"CustomNumberFormat"),s&&s.ConditionFormatPart()&&s.ConditionFormatPart().value>0&&o<0&&(e=t.NegativeSign+e);else try{e=r.Format(n)}catch(c){f(n,"string")&&(e=n.toString())}return e?e:u.Empty}else return h&&o<0?t.HyphenMinus.toString():f(n,"string")?n.toString():n===undefined||n===null?u.Empty:n.toString()},Parse:function(n){return this.Init(),this.formatters&&this.formatters.length>0?this.formatters[0].Parse(n):null},Init:function(){if(!this.isConstructed){this.isConstructed=!0;switch(this.formatModeType){case b.CustomMode:this.InitExcelCompatibleMode(this.formatCached);break;case b.StandardDateTimeMode:this.InitStandardDateTimeMode(this.formatCached);break;case b.StandardNumericMode:this.InitStandardNumericMode(this.formatCached);break}}},InitStandardDateTimeMode:function(n){var t=new vt(n);if(t.EvaluateFormat(n))this.formatters=[],this.formatters.push(t);else throw new Error("format is illegal.");},InitStandardNumericMode:function(n){var t=new lt(n);if(t.EvaluateFormat(n))this.formatters=[],this.formatters.push(t);else throw new Error("format is illegal.");},InitExcelCompatibleMode:function(n){var i,o,f,e;if(u.IsNullOrEmpty(n))throw new Error("format is illegal.");this.formatters=[];if(this.isDefault)this.formatters.push(new at);else{this.isSingleFormatterInfo=!r.Contains(n,t.FormatSeparator.toString()),i=n.split(t.FormatSeparator);if(!i)throw new Error("format is illegal.");if(i.length<1||i.length>5)throw new Error("format is illegal.");for(o=0,f=0;f<i.length;f++){o++;if(o>4)break;e=new at(i[f]),e&&this.formatters.push(e)}if(!this.PositiveExpression())throw new Error("format is illegal.");}},GetFormatInfo:function(n){if(this.FormatMode()===b.CustomMode){if(typeof n=="string"&&isNaN(n))return this.TextExpression()?this.TextExpression():this.PositiveExpression();else if(nt.IsNumber(n)||f(n,"boolean")){var u=this.PositiveExpression(),r=this.NegativeExpression(),i=nt.ToDouble(n),e=u&&u.ConditionFormatPart(),o=r&&r.ConditionFormatPart(),t=this.isSingleFormatterInfo?this.PositiveExpression():null;return this.PositiveExpression()&&(e?u.ConditionFormatPart().IsMeetCondition(i)&&(t=u):(i>0||i===0&&!this.ZeroExpression())&&(t=u)),!t&&this.NegativeExpression()&&(o?r.ConditionFormatPart().IsMeetCondition(i)&&(t=r):i<0&&(t=r)),!t&&this.ZeroExpression()&&i===0&&(t=this.ZeroExpression()),!t&&this.ZeroExpression()&&(t=this.ZeroExpression()),!t&&this.NegativeExpression()&&(t=this.NegativeExpression()),t}}else if(this.FormatMode()===b.StandardDateTimeMode||this.FormatMode()===b.StandardNumericMode)if(this.formatters&&this.formatters.length===1)return this.formatters[0];return null},RaisePropertyChanged:function(n){var t,i;if(this.PropertyChanged)for(t=0;t<this.PropertyChanged.length;t++)i=this.PropertyChanged[t],typeof i=="function"&&i(this,n)}},e.UI.GeneralFormatter=c,p.prototype={_initFileds:function(){this.originalToken=null},OriginalToken:function(){return this.originalToken}},p.SupportedPartFormat=function(){return p._supportedPartFormat||(p._supportedPartFormat=["ConditionFormatPart","ColorFormatPart","LocaleIDFormatPart"]),p._supportedPartFormat},i={defaultNumberStringConverter:null,YearTwoDigit:"yy",YearSingleDigit:"y",YearFourDigit:"yyyy",MonthSingleDigit:"m",MonthTwoDigit:"mm",MonthAbbreviation:"mmm",MonthUnabbreviated:"mmmm",MonthJD:"mmmmm",DaySingleDigit:"d",DayTwoDigit:"dd",DayWeekDayAbbreviation:"aaa",DayWeekDayUnabbreviated:"aaaa",HoursSingleDigit:"h",HoursTwoDigit:"hh",MinuteSingleDigit:"m",MinuteTwoDigit:"mm",SecondSingleDigit:"s",SecondTwoDigit:"ss",SubSecondSingleDigit:".0",SubSecondTwoDigit:".00",SubSecondThreeDigit:".000",EraYear:"e",AMPMTwoDigit:"AM/PM",AMPMSingleDigit:"A/P",StandardYearSingleDigit:"%y",StandardMonthSingleDigit:"%M",StandardMonthTwoDigit:"MM",StandardMonthAbbreviation:"MMM",StandardMonthUnabbreviated:"MMMM",StandardAMPMSingleDigit:"tt",StandardMinuteSingleDigit:"%m",StandardHourSingleDigit:"H",StandardHourTwoDigit:"HH",StandardSecondSingleDigit:"%s",StandardSubSecondSingleDigit:".f",StandardSubSecondTwoDigit:".ff",StandardSubSecondThreeDigit:".fff",StandardDayWeekDayAbbreviation:"ddd",StandardDayWeekDayUnabbreviated:"dddd",PlaceholderMonthJD:t.ReplacePlaceholder+"mmmmm",defaultAbsoluteTime:new Date(1899,11,30,0,0,0,0),EvaluateFormat:function(n){return o.ContainsKeywords(n,v.keywords)}},at.prototype={_initFileds:function(){this.conditionFormatPart=null,this.colorFormatPart=null,this.localeIDFormatPart=null,this.dbNumberFormatPart=null,this.numberFormat=null,this.dateTimeFormatInfo=null,this.numberFormatInfo=null,this.formatCached=null},Init:function(n){var w,c,d,h,o,k;if(n===null||n===undefined)throw new Error("format is illegal.");this.conditionFormatPart=null,this.colorFormatPart=null,this.localeIDFormatPart=null,this.dbNumberFormatPart=null,this.formatCached=n;var e=null,r=null,y=!1,b=[];for(w=0;w<n.length;w++){c=n[w];if(c===t.LeftSquareBracket){if(y)throw new Error("format is illegal.");else r&&(e||(e=new a),e.Append(r.toString()),r=null),r=new a,r.Append(c);y=!0}else if(c===t.RightSquareBracket){if(y)if(r){r||(r=new a),r.Append(c),d=r.toString(),h=g(p.Create(d),"FormatPartBase");if(h&&!f(h,"ABSTimeFormatPart"))this.AddPart(h);else if(f(h,"ABSTimeFormatPart"))b.push(g(h,"ABSTimeFormatPart")),e||(e=new a),e.Append(r.toString());else throw new Error("format is illegal.");r=null}else throw new Error("format is illegal.");else throw new Error("format is illegal.");y=!1}else r||(r=new a),r.Append(c)}if(r)if(y)throw new Error("format is illegal.");else e||(e=new a),e.Append(r.toString());o=e?e.toString():u.Empty;if(s.EvaluateFormat(o))this.numberFormat=new s(o,this.LocaleIDFormatPart(),this.dbNumberFormatPart);else if(i.EvaluateFormat(o))k=b.length>0?b:null,this.numberFormat=new v(o,k,this.LocaleIDFormatPart(),this.dbNumberFormatPart);else if(l.EvaluateFormat(o))this.numberFormat=new l(n,this.LocaleIDFormatPart(),this.dbNumberFormatPart);else if(ft.EvaluateFormat(o))this.numberFormat=new ft(n,this.LocaleIDFormatPart(),this.dbNumberFormatPart);else throw new Error("format is illegal.");},FormatString:function(){var n=new a;return this.numberFormat&&this.numberFormat.FormatString()&&(this.ColorFormatPart()&&n.Append(this.ColorFormatPart().toString()),this.ConditionFormatPart()&&n.Append(this.ConditionFormatPart().toString()),this.DBNumberFormatPart()&&n.Append(this.DBNumberFormatPart().toString()),this.LocaleIDFormatPart()&&n.Append(this.LocaleIDFormatPart().toString()),n.Append(this.numberFormat.FormatString())),n.toString()},ConditionFormatPart:function(){return this.conditionFormatPart},ColorFormatPart:function(){return this.colorFormatPart},LocaleIDFormatPart:function(){return this.localeIDFormatPart},DBNumberFormatPart:function(){return this.dbNumberFormatPart},NumberStringConverter:function(n){if(arguments.length===0)return this.numberFormat?this.numberFormat.NumberStringConverter():null;else this.numberFormat&&this.numberFormat.NumberStringConverter(n)},ExcelCompatibleFormatString:function(){var n=new a;return this.numberFormat&&this.numberFormat.ExcelCompatibleFormatString()&&(f(this.numberFormat,"NumberFormatDigital")||(this.DBNumberFormatPart()&&n.Append(this.DBNumberFormatPart().toString()),this.LocaleIDFormatPart()&&n.Append(this.LocaleIDFormatPart().toString()),this.ConditionFormatPart()&&n.Append(this.ConditionFormatPart().toString()),this.ColorFormatPart()&&n.Append(this.ColorFormatPart().toString())),n.Append(this.numberFormat.ExcelCompatibleFormatString())),n.toString()},Formatter:function(){return this.numberFormat},DateTimeFormatInfo:function(n){if(arguments.length===0)return this.Formatter().DateTimeFormatInfo();else this.Formatter().DateTimeFormatInfo(n),this.dateTimeFormatInfo=n},NumberFormatInfo:function(n){if(arguments.length===0)return this.Formatter().NumberFormatInfo();else this.Formatter().NumberFormatInfo(n),this.numberFormatInfo=n},AddPart:function(n){if(!n)throw new Error("part");if(f(n,"ConditionFormatPart"))if(this.conditionFormatPart)throw new Error("The type of descriptor was added.");else this.conditionFormatPart=g(n,"ConditionFormatPart");else if(f(n,"ColorFormatPart"))if(this.colorFormatPart)throw new Error("The type of descriptor was added.");else this.colorFormatPart=g(n,"ColorFormatPart");else if(f(n,"LocaleIDFormatPart"))if(this.localeIDFormatPart)throw new Error("The type of descriptor was added.");else this.localeIDFormatPart=g(n,"LocaleIDFormatPart");else if(f(n,"DBNumberFormatPart"))if(this.dbNumberFormatPart)throw new Error("The type of descriptor was added.");else this.dbNumberFormatPart=g(n,"DBNumberFormatPart")},Format:function(n){return this.numberFormat.Format(n)},Parse:function(n){return this.numberFormat.Parse(n)}},rt.prototype=new p,rt.prototype._initFileds=function(){this.value=0,this.compareOperator=null},rt.prototype.CompareOperator=function(){return this.compareOperator},rt.prototype.Value=function(){return this.value},rt.prototype.toString=function(){var n=new a,i;switch(this.compareOperator){case y.EqualsTo:n.Append("=");break;case y.GreaterThan:n.Append(">");break;case y.GreaterThanOrEqualsTo:n.Append(">=");break;case y.LessThan:n.Append("<");break;case y.LessThanOrEqualsTo:n.Append("<=");break;case y.NotEqualsTo:n.Append("<>");break;default:throw new Error;}return n.Append(this.value),i=t.AddSquareBracket(n.toString())},rt.prototype.IsMeetCondition=function(n){switch(this.compareOperator){case y.EqualsTo:return n===this.value;case y.GreaterThan:return n>this.value;case y.GreaterThanOrEqualsTo:return n>=this.value;case y.LessThan:return n<this.value;case y.LessThanOrEqualsTo:return n<=this.value;case y.NotEqualsTo:return n!==this.value}return!1},rt.EvaluateFormat=function(n){if(!n||n===u.Empty)return!1;var i=t.TrimSquareBracket(n);return!i||i===u.Empty?!1:t.IsOperator(i[0])},et.prototype=new p,et.prototype.ForeColor=function(){return this.foreColor},et.prototype.toString=function(){if(this.index>-1)return t.AddSquareBracket("Color"+this.index);else if(this.colorName)return t.AddSquareBracket(this.colorName);throw new Error;},et.EvaluateFormat=function(n){if(!n||n===u.Empty)return!1;var i=t.TrimSquareBracket(n);return!i||i===u.Empty?!1:i.length<3?!1:isNaN(n[n.length-1])?n[0]!==n[1]:r.StartsWith(n,"Color",d.CurrentCultureIgnoreCase)},k.prototype=new p,k.prototype._initFileds=function(){this.token=null,this.type=null,this.formatString=null},k.prototype.FormatString=function(){return this.formatString},k.prototype.TimePartType=function(){return this.type},k.prototype.Token=function(){return this.token},k.HoursABSContent="h",k.MinuteABSContent="m",k.SecondABSContent="s",k.EvaluateFormat=function(n){var i,r,f,e;if(!n||n===u.Empty)return!1;i=t.TrimSquareBracket(n);if(!i||i===u.Empty)return!1;for(i=i.toLowerCase(),r=null,f=0;f<i.length;f++){r||(r=i[f]),e=k;if(r!==e.HoursABSContent&&r!==e.MinuteABSContent&&r!==e.SecondABSContent)return!1;if(r!==i[f])return!1}return!0},pt.prototype={_initFileds:function(){this.units=null,this.numbers=null},Units:function(){return this.units},Numbers:function(){return this.numbers}},w.prototype=new p,w.prototype._initFileds=function(){this.token=null,this.type=0},w.prototype.Token=function(){return this.token?this.token:u.Empty},w.prototype.Type=function(){return this.type},w.prototype.ReplaceNumberString=function(n,i,f){var h,y;if(!n||n===u.Empty)return n;var s=n,p=n,o=-1,e=-1,v=!1,c=null,a=null,l=null;for(h=n.length-1;h>=0;h--)y=p[h],isNaN(y)&&(!t.IsEquals(y,t.DecimalSeparator,!1)||v)?e>-1&&o>-1&&(c=p.substr(e,o-e+1),a=parseFloat(c),isNaN(a)||(l=this.NumberString(c,i,f),s=r.Remove(s,e,o-e+1),s=r.Insert(s,e,l)),o=-1,e=-1,v=!1):(t.IsEquals(y,t.DecimalSeparator,!1)&&(v=!0),o===-1&&(o=h),e=h);return e>-1&&o>-1&&(c=p.substr(e,o-e+1),a=parseFloat(c),isNaN(a)||(l=this.NumberString(c,i,f),s=r.Remove(s,e,o-e+1),s=r.Insert(s,e,l)),o=-1,e=-1,v=!1),s},w.prototype.NumberString=function(n,t,i){var r=n.split("."),f,u;if(r)if(r.length===1)return w.FormatNumberString(r[0],i?t.Units():null,t.Numbers());else if(r.length===2)return f=w.FormatNumberString(r[0],i?t.Units():null,t.Numbers()),u=w.FormatNumberString(r[1],t.Numbers()),f+"."+u;throw new Error("value is illegal.");},w.prototype.toString=function(){if(this.type>-1)return t.AddSquareBracket("DBNum"+this.type);throw new Error;},w.EvaluateFormat=function(n){if(!n||n===u.Empty)return!1;var i=t.TrimSquareBracket(n);return!i||i===u.Empty?!1:r.StartsWith(i,"DBNum",d.CurrentCultureIgnoreCase)?!0:!1},w.FormatNumberString=function(n,t,i){var k=n,y=0,l=null,v=0,g,tt,b,f,s,o,it,d;if(arguments.length===2){for(g=new a,y=0;y<k.length;y++)l=k.substr(y,1),v=parseInt(l,10),g.Append(i[v]);return g.toString()}else if(arguments.length===3){if(!t)return w.FormatNumberString(n,i);var e=0,nt=null,h=k.length,p=!1,c=[];for(y=0;y<h;y++)tt=t.length-1-y,tt>-1?r.Insert(c,0,t[tt].toString()):r.Insert(c,0,u.Empty);for(b=!1,f=0;f<h;f++)l=k.substr(f,1),v=parseInt(l,10),s=u.Empty,o=u.Empty,h-f-16>0?(s=i[v],o="",b=!0):f!==h-1&&f!==h-5&&f!==h-9&&f!==h-13?l==="0"?(s="",o="",e=e+1):l!=="0"&&e!==0?(s=i[0]+i[v],o=c[f],e=0):(s=i[v],o=c[f],e=0):l!=="0"&&e!==0?(s=i[0]+i[v],o=c[f],e=0):l!=="0"&&e===0||b?(s=i[v],o=c[f],e=0,b=!1):l!=="0"||e<3?h<11?(s="",o=c[f],e=e+1):(s="",e=e+1):(s="",o="",e=e+1),it=s+o===u.Empty,it||(p=!1),f!==h-13||p||(o=c[f],p=!0),f!==h-9||p||(o=c[f],p=!0),f===h-1&&(o=c[f],p=!0),nt=nt+s+o;d=parseInt(n,10);if(!isNaN(d))if(d===0)return i[0];return nt}},ct={ParseHexString:function(n){if(!n||n===u.Empty)throw new Error("string is illegal.");return parseInt(n,16)},FixJapaneseChars:function(n){return n},GetFraction:function(n,t,i,r,u){var e,c,f;i.value=Math.ceil(n)-1,r.value=0,u.value=0;var h=n-Math.ceil(n)+1,s=2,o=9;for(s=Math.pow(10,t-1),o=Math.pow(10,t)-1,s<2&&(s=2),o<2&&(o=2),e=!1,c=0,f=s;f<=o;f++){var y=f*h,l=Math.round(y),a=l/f,v=Math.abs(a-h);(e?v<Math.abs(c-h):!0)&&(e=!0,c=a,r.value=l,u.value=f)}return e}},tt.prototype=new p,tt.prototype._initFileds=function(){this.currencySymbol=null,this.locateID=-1,this.cultureInfo=null,this.content=null},tt.prototype.CurrencySymbol=function(){return this.currencySymbol?this.EncodeSymbol(this.currencySymbol):u.Empty},tt.prototype.AllowScience=function(){},tt.prototype.GetDBNumber=function(n){var t=this.locateID&255;return null},tt.prototype.toString=function(){return this.content?t.AddSquareBracket(this.content):u.Empty},tt.prototype.EncodeSymbol=function(n){return r.Replace(n,".","'.'")},tt.EvaluateFormat=function(n){if(!n||n===u.Empty)return!1;var i=t.TrimSquareBracket(n);return!i||i===u.Empty?!1:t.IsEquals(i[0],t.Dollar,!1)},p.Create=function(n){return rt.EvaluateFormat(n)?new rt(n):w.EvaluateFormat(n)?new w(n):tt.EvaluateFormat(n)?new tt(n):k.EvaluateFormat(n)?new k(n):et.EvaluateFormat(n)?new et(n):null},v.prototype=new o,v.prototype._initFileds=function(){this.validDateTimeFormatString=null,this.formatString=null,this.hasJD=!1,this.absoluteTime=null,this.absTimeParts=null,this.hasYearDelay=!1},v.prototype._init=function(n,r,u,f){var e=new st(this.formatString),h,o,s;if(i.EvaluateFormat(e.value)){h=this.ProcessAMPM(e),this.hasJD=this.Replace(e.value,i.MonthJD,'"'+i.PlaceholderMonthJD+'"',!0,!1,e,!1,!1),this.Replace(e.value,i.MonthUnabbreviated,i.StandardMonthUnabbreviated,!0,!1,e,!1,!1),this.Replace(e.value,i.MonthAbbreviation,i.StandardMonthAbbreviation,!0,!1,e,!1,!1),this.Replace(e.value,i.MonthTwoDigit,i.StandardMonthTwoDigit,!0,!1,e,!1,!1),this.Replace(e.value,i.MonthSingleDigit,i.StandardMonthSingleDigit,!0,!1,e,!1,!1),this.Replace(e.value,i.DayWeekDayAbbreviation,i.StandardDayWeekDayAbbreviation,!0,!0,e,!1,!0),this.Replace(e.value,i.DayWeekDayUnabbreviated,i.StandardDayWeekDayUnabbreviated,!0,!0,e,!1,!0),this.Replace(e.value,i.MinuteSingleDigit,i.StandardMinuteSingleDigit,!1,!0,e,!1,!1),this.Replace(e.value,i.HoursSingleDigit,i.StandardHourSingleDigit,!0,!0,e,!1,!1),this.Replace(e.value,i.HoursTwoDigit,i.StandardHourTwoDigit,!0,!0,e,!1,!1),this.Replace(e.value,i.SecondSingleDigit,i.StandardSecondSingleDigit,!0,!0,e,!1,!0),this.PartDBNumberFormat()&&this.PartLocaleID()&&(this.hasYearDelay|=this.Replace(e.value,i.YearFourDigit,'"'+t.ReplacePlaceholder+i.YearFourDigit+'"',!0,!1,e,!1,!0),this.hasYearDelay|=this.Replace(e.value,i.YearTwoDigit,'"'+t.ReplacePlaceholder+i.YearTwoDigit+'"',!0,!1,e,!1,!0)),this.Replace(e.value,i.EraYear,i.YearFourDigit,!0,!1,e,!1,!0),this.Replace(e.value,i.EraYear+i.EraYear,i.YearFourDigit,!0,!1,e,!1,!0),this.Replace(e.value,i.EraYear+i.EraYear+i.EraYear,i.YearFourDigit,!0,!1,e,!1,!0),this.Replace(e.value,i.YearSingleDigit,i.StandardYearSingleDigit,!0,!1,e,!1,!0);if(this.absTimeParts)for(o=0;o<this.absTimeParts.length;o++)s=this.absTimeParts[o],this.Replace(e.value,s.token,t.ReplacePlaceholder+s.token,!0,!0,e,!1,!0);this.validDateTimeFormatString=e.value}else throw new Error("format is illegal.");},v.prototype.baseNumberStringConverter=o.prototype.NumberStringConverter,v.prototype.NumberStringConverter=function(n){if(arguments.length===0)return this.baseNumberStringConverter()?this.baseNumberStringConverter():i.defaultNumberStringConverter;else this.baseNumberStringConverter(n)},v.prototype.AbsoluteTime=function(){return this.absoluteTime?this.absoluteTime:i.defaultAbsoluteTime},v.prototype.FormatString=function(){return this.formatString},v.prototype.baseDateTimeFormatInfo=o.prototype.DateTimeFormatInfo,v.prototype.DateTimeFormatInfo=function(n){if(arguments.length===0)return this.baseDateTimeFormatInfo()?this.baseDateTimeFormatInfo():t.DateTimeFormatInfo;else this.baseDateTimeFormatInfo(n)},v.prototype.ExactlyMatch=function(n){if(arguments.length===0)return this.exactlyMatch;else this.exactlyMatch=n},v.prototype.ExcelCompatibleFormatString=function(){return this.formatTemp=this.FormatString,this.Replace(this.formatTemp,i.StandardAMPMSingleDigit,this.CurrentAMPM(),!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardMonthUnabbreviated,i.MonthUnabbreviated,!0,!1,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardMonthAbbreviation,i.MonthAbbreviation,!0,!1,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardMonthTwoDigit,i.MonthTwoDigit,!0,!1,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardMonthSingleDigit,i.MonthSingleDigit,!0,!1,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardDayWeekDayAbbreviation,i.DayWeekDayAbbreviation,!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardDayWeekDayUnabbreviated,i.DayWeekDayUnabbreviated,!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardMinuteSingleDigit,i.MinuteSingleDigit,!1,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardHourSingleDigit,i.HoursSingleDigit,!0,!0,this.formatTemp,!1,!1),this.Replace(this.formatTemp,i.StandardHourTwoDigit,i.HoursTwoDigit,!0,!0,this.formatTemp,!1,!1),this.Replace(this.formatTemp,i.StandardSecondSingleDigit,i.SecondSingleDigit,!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardSubSecondThreeDigit,i.SubSecondThreeDigit,!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardSubSecondTwoDigit,i.SubSecondTwoDigit,!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardSubSecondSingleDigit,i.SubSecondSingleDigit,!0,!0,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.YearFourDigit,i.EraYear,!0,!1,this.formatTemp,!1,!0),this.Replace(this.formatTemp,i.StandardYearSingleDigit,i.YearSingleDigit,!0,!0,this.formatTemp,!1,!0),this.formatTemp},v.prototype.CurrentAMPM=function(){var n=null,r;return n=this.DateTimeFormatInfo()?this.DateTimeFormatInfo():t.DateTimeFormatInfo,n&&n.AMDesignator&&n.AMDesignator!==u.Empty&&n.PMDesignator&&n.PMDesignator!==u.Empty?r=u.Format("{0}/{1}",n.AMDesignator,n.PMDesignator):i.AMPMTwoDigit},v.prototype.Format=function(n){var o,h,l,s,w,v,a,y,c,p;if(f(n,"boolean"))return n.toString().toUpperCase();o=u.Empty,h=new Date;try{try{h=e.Calc.Convert.toDateTime(n);if(!h||isNaN(h))return n.toString()}catch(k){return n.toString()}l=this.validDateTimeFormatString,s=this.validDateTimeFormatString.replace(/%/g,""),s==="H"||s==="h"||s==="m"||s==="M"||s==="d"||s==="s"||s==="y"?(l="%"+s,this.validDateTimeFormatString=l):l=s,o=new e.UI._DateTimeHelper(h).localeFormat(l),this.hasJD&&(w=this._getMonthName(h.getMonth()),o=r.Replace(o,i.PlaceholderMonthJD,w.substr(0,1)));if(this.absTimeParts)for(v=h-this.AbsoluteTime(),a=0;a<this.absTimeParts.length;a++){y=this.absTimeParts[a],c=null;switch(y.TimePartType()){case ot.Hour:c=Math.floor(v/36e5);break;case ot.Minute:c=Math.floor(v/6e4);break;case ot.Second:c=Math.floor(v/1e3);break}c&&(p=y.token.replace("[","\\[").replace("]","\\]"),o=r.Replace(o,t.ReplacePlaceholder+p,c))}}catch(b){o=nt.toString(n)}return this.NumberStringConverter()&&this.hasYearDelay&&(o=r.Replace(o,t.ReplacePlaceholder+i.YearFourDigit,h.toString(i.YearFourDigit)),o=r.Replace(o,t.ReplacePlaceholder+i.YearTwoDigit,h.toString(i.YearTwoDigit))),o},v.prototype._getMonthName=function(n){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return t[n]},v.prototype.Parse=function(n){var t,f,r,i;if(!n||n===u.Empty)return null;t=ct.FixJapaneseChars(n),f=t.toLowerCase();if(f==="true")return!0;else if(f==="false")return!1;if(this.validDateTimeFormatString){r=e.UI._DateTimeHelper.parseExact(t,this.validDateTimeFormatString,e.UI._CultureInfo.currentCulture);if(r)return r}if(!this.ExactlyMatch)try{return i=e.Calc.Convert.toDateTime(t),i&&!isNaN(i)?i:t}catch(o){return t}return null},v.prototype.FixFormat=function(n){for(var f=n,s=new a,o=!1,h=r.IndexOf(f,i.HoursSingleDigit[0],d.CurrentCultureIgnoreCase)>-1||r.IndexOf(f,i.SecondSingleDigit[0],d.CurrentCultureIgnoreCase)>-1,c=r.IndexOf(f,i.YearTwoDigit[0],d.CurrentCultureIgnoreCase)>-1||r.IndexOf(f,i.DaySingleDigit[0],d.CurrentCultureIgnoreCase)>-1,u,e=0;e<f.length;e++)u=f[e],u==='"'?o=!o:o||(u==="Y"||u==="D"||u==="S"||u==="E"||u==="G"?u=u.toLowerCase():u==="M"&&(e>1?t.IsEquals("A",f[e-1],!0)||t.IsEquals("P",f[e-1],!0)||(u=u.toLowerCase()):u=u.toLowerCase())),s.Append(u);return s.toString()},v.prototype.ProcessAMPM=function(n){var u=!1,t;return r.Contains(n.value,i.AMPMTwoDigit)&&(n.value=r.Replace(n.value,i.AMPMTwoDigit,i.StandardAMPMSingleDigit),u=!0),r.Contains(n.value,i.AMPMSingleDigit)&&(n.value=r.Replace(n.value,i.AMPMSingleDigit,i.StandardAMPMSingleDigit),this.DateTimeFormatInfo()&&(this.DateTimeFormatInfo().AMDesignator=i.AMPMSingleDigit.substr(0,1),this.DateTimeFormatInfo().PMDesignator=i.AMPMSingleDigit.substr(2,1)),u=!0),r.Contains(n.value,i.CurrentAMPM)&&(n.value=r.Replace(n.value,i.CurrentAMPM,i.StandardAMPMSingleDigit),t=i.CurrentAMPM.split("/"),t&&t.length===2&&(this.DateTimeFormatInfo().AMDesignator=t[0],this.DateTimeFormatInfo().PMDesignator=t[1]),u=!0),u},v.prototype.Replace=function(n,u,f,o,s,h,c,l){var v,w,p,k,it,y,tt;h.value=n;if(o||s){var g=[],b=!0,ut=r.IndexOf(h.value,i.HoursSingleDigit[0],d.CurrentCultureIgnoreCase)>-1||r.IndexOf(h.value,i.SecondSingleDigit[0],d.CurrentCultureIgnoreCase)>-1,ft=r.IndexOf(h.value,i.YearTwoDigit[0],d.CurrentCultureIgnoreCase)>-1||r.IndexOf(h.value,i.DaySingleDigit[0],d.CurrentCultureIgnoreCase)>-1;!ft&&ut&&(b=!1);for(var nt=!1,rt=0,a=0;a<h.value.length;a++){v=h.value[a],t.IsEquals(v,i.HoursSingleDigit[0],!0)||t.IsEquals(v,i.SecondSingleDigit[0],!0)?b=!1:(t.IsEquals(v,i.YearTwoDigit[0],!0)||t.IsEquals(v,i.DaySingleDigit[0],!0))&&(b=!0);if(o&&t.IsEquals(v,u[rt],l)&&b||s&&t.IsEquals(v,u[rt],l)&&!b){for(w=!0,p=0;p<u.length;p++)if(p+a>=n.length||!t.IsEquals(u[p],h.value[p+a],l)){w=!1;break}k=a+u.length-1;if(w&&k+1<h.value.length){for(it=h.value[k],y=-1,y=k+1;y<h.value.length;y++)if(!t.IsEquals(it,h.value[y],l))break;y>k+1&&(a=y,w=!1)}w&&!nt&&new e.UI._ArrayHelper(g).insert(0,a)}v==='"'&&(nt=!nt)}if(g.length>0){if(!c)for(a=0;a<g.length;a++)tt=g[a],h.value=r.Remove(h.value,tt,u.length),h.value=r.Insert(h.value,tt,f);return!0}else return!1}return!1},v.keywords=[i.YearTwoDigit,i.YearFourDigit,i.MonthSingleDigit,i.MonthTwoDigit,i.MonthAbbreviation,i.MonthUnabbreviated,i.MonthJD,i.DaySingleDigit,i.DayTwoDigit,i.DayWeekDayAbbreviation,i.DayWeekDayUnabbreviated,i.HoursSingleDigit,i.HoursTwoDigit,i.MinuteSingleDigit,i.MinuteTwoDigit,i.SecondSingleDigit,i.SecondTwoDigit],l.prototype=new o,l.prototype.baseNumberStringConverter=o.prototype.NumberStringConverter,l.prototype.NumberStringConverter=function(n){if(arguments.length===0)return this.baseNumberStringConverter()?this.baseNumberStringConverter():this.defaultNumberStringConverter;else this.baseNumberStringConverter(n)},l.prototype.FormatString=function(){return this.fullFormatString},l.prototype.baseNumberFormatInfo=o.prototype.NumberFormatInfo,l.prototype.NumberFormatInfo=function(n){if(arguments.length===0)return this.baseNumberFormatInfo()?this.baseNumberFormatInfo():this.PartLocaleID()&&this.PartLocaleID().CultureInfo()?this.PartLocaleID().CultureInfo().NumberFormat():t.NumberFormatInfo;else this.baseNumberFormatInfo(n)},l.prototype.IsGeneralNumber=function(n){if(arguments.length===0)return this.isGeneralNumber;else this.isGeneralNumber=n},l.prototype.ExcelCompatibleFormatString=function(){return this.excelFormatString},l.prototype.Format=function(n){var h,c,i,b,l,k,o,d,g;if(f(n,"boolean"))return n.toString().toUpperCase();h=nt.ToDouble(n);if(isNaN(h)||!isFinite(h)||isNaN(n))return typeof n=="string"?n:null;c=this.NaNSymbol(),i=null;if(this.fractionNumeratorFormat&&this.fractionDenominatorFormat){var w=new st(0),r=new st(0),s=new st(0),tt=this.fractionDenominatorFormat.length;if(this.GetFraction(h,tt,w,r,s))if(this.fractionIntegerFormat){i=new a,w.value!==0&&(i.Append(w.value.toString(this.fractionIntegerFormat,this.NumberFormatInfo())),i.Append(t.Space)),b=this.fractionDenominatorFormat,l=parseFloat(b),isNaN(l)||l>0&&(r.value*=l/s.value,b=u.Empty,s.value=l,k=Math.ceil(r.value)-r.value,r.value=k<=.5&&k>0?parseFloat(parseInt(r.value,10)+1):parseFloat(parseInt(r.value,10))),o=this.fractionNumeratorFormat,d=parseFloat(o);if(!isNaN(d))if(d===0){var y=o.length,p=r.value.toString(),v=p.length;y>v?o=o.substr(0,o.length-(y-v)):y<v&&(p=p.substr(0,v-(v-y)),r.value=parseInt(p,10))}return r.value!==0&&(i.Append(r.value.toString(o,this.NumberFormatInfo())),i.Append(t.SolidusSign),i.Append(s.value.toString(b,this.NumberFormatInfo()))),i.toString()}else return i=new a,g=w.value*s.value+r.value,i.Append(g.toString(this.fractionNumeratorFormat,this.NumberFormatInfo())),i.Append(t.SolidusSign),i.Append(s.value.toString(this.fractionDenominatorFormat,this.NumberFormatInfo())),i.toString();else return h.toString(this.NumberFormatInfo())}else c=new e.UI._NumberHelper(h).localeFormat(this.EncodeNumberFormat(this.numberFormatString)),this.NumberStringConverter()&&(c=this.NumberStringConverter().ConvertTo(c,n,this.isGeneralNumber,this.PartLocaleID(),this.PartDBNumberFormat()));return c},l.prototype.Parse=function(n){var g,y,o,f,p,a,tt,k,nt,i,l,w,v;n=this.TrimSpecialSymbol(n),n=this.TrimCurrencySymbol(n);if(!n||n===u.Empty)return null;if(r.EndsWith(n,t.NumberGroupSeparator))return n;g=ct.FixJapaneseChars(n);if(n.toLowerCase()==="true")return!0;else if(n.toLowerCase()==="false")return!1;var h=t.IsDecimal(g,this.NumberFormatInfo()),b=r.IndexOf(g,t.ExponentialSymbol,d.CurrentCultureIgnoreCase),s=b>-1;if(this.numberFormatString){y=new st(0),n=this.TrimPercentSign(n,y),o=n,s&&(o=n.substr(0,b)),o[0]===t.NumberFormatInfo.PositiveSign&&(o=o.substr(1),n=n.substr(1)),f=r.Replace(o,t.NumberGroupSeparator,""),p=f.indexOf(t.DecimalSeparator);if(p===f.lastIndexOf(t.DecimalSeparator)){a=new e.UI._StringBuilder("#,##0");if(p!==-1)for(a.append("."),tt=f.length-p-1,k=0;k<tt;k++)a.append("0");nt=new c(a.toString()).Format(f),nt===o&&(n=s?f+n.substr(b):f)}i=parseFloat(n),l=null,i.toString()!==n&&(w=this.NumberFormatInfo(),v=t.DecimalSeparator,w&&(v=w.NumberDecimalSeparator),h||s?h&&!s?l=new RegExp("^((\\+|-)?\\d+)"+v+"(\\d+)$","ig"):!h&&s?l=new RegExp("^((\\+|-)?\\d+)((E(\\+|-)?|e(\\+|-)?)\\d+)$","ig"):h&&s&&(l=new RegExp("^((\\+|-)?\\d+)"+v+"(\\d+)((E(\\+|-)?|e(\\+|-)?)\\d+)$","ig")):l=new RegExp("^((\\+|-)?\\d+)$","ig"));if(!isNaN(i)&&isFinite(i)&&(!l||l.test(n)))return y.value>0&&(i=i/parseFloat(100*y.value)),i!==0&&Math.abs(i-Math.floor(i))!==0&&(h=!0),s&&(h=!0),this.ToObject(i,h)}return null},l.prototype.EncodeNumberFormat=function(n){var i,r,t;if(n){for(i=n.split(""),r=new e.UI._StringBuilder,t=0;t<i.length-1;)i[t]==="\\"?(r.append(i[t+1]),t+=2):(r.append(i[t]),t++);t===i.length-1&&i[t]!=="\\"&&r.append(i[t]),n=r.toString()}return n},l.prototype.ToObject=function(n,t){return t?n:n>1e22?n:parseInt(n,10)},l.prototype.TrimPercentSign=function(n,i){i.value=0;if(!n||n===u.Empty)return n;var e=n,f=t.PercentSymbol,o=n.indexOf(f);return o===n.length-1&&o===n.lastIndexOf(f)&&(e=r.Replace(e,f,""),i.value+=(n.length-e.length)/f.length),e},l.prototype.TrimSpecialSymbol=function(n){var i,h,s,c,e,f,o;if(!n||n===u.Empty)return n;for(i=n,h=-1,s=0;s<i.length;s++)if(ht.IsDigit(i[s])){h=s;break}for(c=-1,e=i.length-1;e>-1;e--)if(ht.IsDigit(i[e])){c=e;break}for(f=i.length-1;f>-1;f--){o=i[f];if(this.IsSpecialSymbol(o))ht.IsWhiteSpace(o)?(f<h||c<f)&&(i=r.Remove(i,f,1)):i=r.Remove(i,f,1);else if(o==="-"||o==="+")if(f>0)if(i[f-1]!=="e"&&i[f-1]!=="E"&&i[f-1]!=="("&&i[f-1].toString()!==t.NumberFormatInfo.CurrencySymbol)break}return i},l.prototype.IsStandardNumberSymbol=function(n){var r=this.NumberFormatInfo()?this.NumberFormatInfo():t.NumberFormatInfo,i;if(r){i=n.toString();if(i===r.CurrencyDecimalSeparator||i===r.CurrencyGroupSeparator||i===r.CurrencySymbol||i===r.NaNSymbol||i===r.NegativeInfinitySymbol||i===r.NegativeSign||i===r.NumberDecimalSeparator||i===r.NumberGroupSeparator||i===r.PercentDecimalSeparator||i===r.PercentGroupSeparator||i===r.PercentSymbol||i===r.PerMilleSymbol||i===r.PositiveInfinitySymbol||i===r.PositiveSign)return!0}return!1},l.prototype.IsSpecialSymbol=function(n){return this.IsStandardNumberSymbol(n)?!1:ht.IsWhiteSpace(n)?!0:!1},l.prototype.TrimCurrencySymbol=function(n){var u=this.NumberFormatInfo()?this.NumberFormatInfo():t.NumberFormatInfo,i,r;return u&&(i=u.CurrencySymbol,r=n.indexOf(i),r===0&&r===n.lastIndexOf(i)&&(n=n.substr(1))),n},l.keywords=[t.Exponential1,t.Exponential2,t.NumberSign,t.DecimalSeparator,t.NumberGroupSeparator,t.PercentSymbol,t.Zero,t.SolidusSign],l.EvaluateFormat=function(n){return o.ContainsKeywords(n,l.keywords)},l.GetFraction=function(n,t,i,r,u){return ct.GetFraction(n,t,i,r,u)},s.prototype=new o,s.prototype.DigitalFormat=function(){if(!this.digitalFormat){var n=this.fullFormatString;n=t.ReplaceKeyword(n,o.General,s.GeneralNumber),this.digitalFormat=new l(n,this.PartLocaleID(),this.PartDBNumberFormat()),this.digitalFormat.IsGeneralNumber(!0)}return this.digitalFormat},s.prototype.ExponentialDigitalFormat=function(){return this.exponentialDigitalFormat||(this.exponentialDigitalFormat=new l("0.#####E+00",this.PartLocaleID(),this.PartDBNumberFormat()),this.exponentialDigitalFormat.IsGeneralNumber(!0)),this.exponentialDigitalFormat},s.prototype.FormatString=function(){return r.Replace(this.fullFormatString,s.GeneralPlaceholder,o.General)},s.prototype.Format=function(n){var e,i,u;if(nt.IsNumber(n)){e=this.partLocaleID?this.partLocaleID.AllowScience():!0,i=nt.ToDouble(n);if(i!==undefined&&i!==null)return Math.abs(i)>99999999999&&e||Math.abs(i)<1e-11&&i!==0?this.ExponentialDigitalFormat().Format(n):this.DigitalFormat().Format(n)}else if(f(n,"string"))return u=r.Replace(this.FormatString(),'"',""),u=t.TrimEscape(u),u?r.Replace(u,"General",n):n;else if(f(n,"boolean"))return n.toString().toUpperCase();return""},s.prototype.Parse=function(n){var l,a,h,c;if(u.IsNullOrEmpty(n))return null;l=!1,a=r.IndexOf(n,"-"),a>0&&(t.IsEquals(n.charAt(a-1),t.ExponentialSymbol,!0)||(l=!0));if(r.Contains(n,"/")||l||r.Contains(n,":")){h=e.UI._DateTimeHelper.parseLocale(n);if(h&&!isNaN(h))return h}var o=n,i=null,s=null;o.charAt(0)===t.NegativeSign?s=!0:o.charAt(0)===t.PositiveSign&&(s=!1),c=!1,s&&o.length>3&&o.charAt(1)===t.LeftParenthesis&&o.charAt(o.length-1)===t.RightParenthesis&&(c=!0);if(s&&c){i=this.DigitalFormat().Parse(r.Remove(n,0,1));if(i)return f(i,"number")?Math.abs(i)*(s?-1:1):i}else{i=this.DigitalFormat().Parse(n);if(i!==undefined&&i!==null)return i}return n},s.GeneralPlaceholder="@NumberFormat",s.GeneralNumber="##################0.################",s.GeneralMonthDay=function(){return["M/d","MMM/d","MMMM/d","d/M","d/MMM","d/MMMM","M-d","MMM-d","MMMM-d","d-M","d-MMM","d-MMMM"]},s.GeneralYearMonth=function(){return["M/y","MMM/y","M/yyyy","MMM/yyyy","M-y","MMM-y","M-yyyy","MMM-yyyy"]},s.GeneralYearMonthDay=function(){return["M/d/y","MMM/d/y","MMMM/d/y","M/d/yyyy","MMM/d/yyyy","MMMM/d/yyyy","d/M/y","d/MMM/y","d/MMMM/y","d/M/yyyy","d/MMM/yyyy","d/MMMM/yyyy","yyyy/M/d","M-d-y","MMM-d-y","MMMM-d-y","M-d-yyyy","MMM-d-yyyy","MMMM-d-yyyy","d-M-y","d-MMM-y","d-MMMM-y","d-M-yyyy","d-MMM-yyyy","d-MMMM-yyyy","yyyy-M-d"]},s.GeneralHourMinute=function(){return["H:m","h:m tt"]},s.GeneralHourMinuteWithDate=function(){return["M/d H:m","MMM/d H:m","MMMM/d H:m","d/M H:m","d/MMM H:m","d/MMMM H:m","M/y H:m","MMM/y H:m","M/yyyy H:m","MMM/yyyy H:m","M/d/y H:m","MMM/d/y H:m","MMMM/d/y H:m","M/d/yyyy H:m","MMM/d/yyyy H:m","MMMM/d/yyyy H:m","M-d H:m","MMM-d H:m","MMMM-d H:m","d-M H:m","d-MMM H:m","d-MMMM H:m","M-y H:m","MMM-y H:m","M-yyyy H:m","MMM-yyyy H:m","M-d-y H:m","MMM-d-y H:m","MMMM-d-y H:m","M-d-yyyy H:m","MMM-d-yyyy H:m","MMMM-d-yyyy H:m","M/d h:m tt","MMM/d h:m tt","MMMM/d h:m tt","d/M h:m tt","d/MMM h:m tt","d/MMMM h:m tt","M/y h:m tt","MMM/y h:m tt","M/yyyy h:m tt","MMM/yyyy h:m tt","M/d/y h:m tt","MMM/d/y h:m tt","MMMM/d/y h:m tt","M/d/yyyy h:m tt","MMM/d/yyyy h:m tt","MMMM/d/yyyy h:m tt","M-d h:m tt","MMM-d h:m tt","MMMM-d h:m tt","d-M h:m tt","d-MMM h:m tt","d-MMMM h:m tt","M-y h:m tt","MMM-y h:m tt","M-yyyy h:m tt","MMM-yyyy h:m tt","M-d-y h:m tt","MMM-d-y h:m tt","MMMM-d-y h:m tt","M-d-yyyy h:m tt","MMM-d-yyyy h:m tt","MMMM-d-yyyy h:m tt"]},s.GeneralHourMinuteSecond=function(){return["H:m:s","h:m:s tt","H:m:s","h:mm:ss tt"]},s.GeneralHourMinuteSecondSubSecond=function(){return["H:m:s.FFF","h:m:s.FFF tt"]},s.GeneralHourMinuteSecondWithDate=function(){return["M/d H:m:s","MMM/d H:m:s","MMMM/d H:m:s","d/M H:m:s","d/MMM H:m:s","d/MMMM H:m:s","M/y H:m:s","MMM/y H:m:s","M/yyyy H:m:s","MMM/yyyy H:m:s","M/d/y H:m:s","MMM/d/y H:m:s","MMMM/d/y H:m:s","M/d/yyyy H:m:s","MMM/d/yyyy H:m:s","MMMM/d/yyyy H:m:s","d/M/y H:m:s","d/MMM/y H:m:s","d/MMMM/y H:m:s","d/M/yyyy H:m:s","d/MMM/yyyy H:m:s","d/MMMM/yyyy H:m:s","yyyy/M/d H:m:s","M-d H:m:s","MMM-d H:m:s","MMMM-d H:m:s","d-M H:m:s","d-MMM H:m:s","d-MMMM H:m:s","M-y H:m:s","MMM-y H:m:s","M-yyyy H:m:s","MMM-yyyy H:m:s","M-d-y H:m:s","MMM-d-y H:m:s","MMMM-d-y H:m:s","M-d-yyyy H:m:s","MMM-d-yyyy H:m:s","MMMM-d-yyyy H:m:s","d-M-y H:m:s","d-MMM-y H:m:s","d-MMMM-y H:m:s","d-M-yyyy H:m:s","d-MMM-yyyy H:m:s","d-MMMM-yyyy H:m:s","yyyy-M-d H:m:s","M/d h:m:s tt","MMM/d h:m:s tt","MMMM/d h:m:s tt","d/M h:m:s tt","d/MMM h:m:s tt","d/MMMM h:m:s tt","M/y h:m:s tt","MMM/y h:m:s tt","M/yyyy h:m:s tt","MMM/yyyy h:m:s tt","M/d/y h:m:s tt","MMM/d/y h:m:s tt","MMMM/d/y h:m:s tt","M/d/yyyy h:m:s tt","MMM/d/yyyy h:m:s tt","MMMM/d/yyyy h:m:s tt","d/M/y h:m:s tt","d/MMM/y h:m:s tt","d/MMMM/y h:m:s tt","d/M/yyyy h:m:s tt","d/MMM/yyyy h:m:s tt","d/MMMM/yyyy h:m:s tt","yyyy/M/d h:m:s tt","M/d/yyyy h:mm:ss tt","M-d h:m:s tt","MMM-d h:m:s tt","MMMM-d h:m:s tt","d-M h:m:s tt","d-MMM h:m:s tt","d-MMMM h:m:s tt","M-y h:m:s tt","MMM-y h:m:s tt","M-yyyy h:m:s tt","MMM-yyyy h:m:s tt","M-d-y h:m:s tt","MMM-d-y h:m:s tt","MMMM-d-y h:m:s tt","M-d-yyyy h:m:s tt","MMM-d-yyyy h:m:s tt","MMMM-d-yyyy h:m:s tt","d-M-y h:m:s tt","d-MMM-y h:m:s tt","d-MMMM-y h:m:s tt","d-M-yyyy h:m:s tt","d-MMM-yyyy h:m:s tt","d-MMMM-yyyy h:m:s tt","yyyy-M-d h:m:s tt"]},s.GeneralHourMinuteSecondSubSecondWithDate=function(){return["M/d H:m:s.FFF","MMM/d H:m:s.FFF","MMMM/d H:m:s.FFF","d/M H:m:s.FFF","d/MMM H:m:s.FFF","d/MMMM H:m:s.FFF","M/y H:m:s.FFF","MMM/y H:m:s.FFF","M/yyyy H:m:s.FFF","MMM/yyyy H:m:s.FFF","d/M/y H:m","d/MMM/y H:m","d/MMMM/y H:m","d/M/yyyy H:m","d/mmm/yyyy H:m","d/MMMM/yyyy H:m","yyyy/M/d H:m","M/d/y H:m:s.FFF","MMM/d/y H:m:s.FFF","MMMM/d/y H:m:s.FFF","M/d/yyyy H:m:s","MMM/d/yyyy H:m:s.FFF","MMMM/d/yyyy H:m:s.FFF","d/M/y H:m:s.FFF","d/MMM/y H:m:s.FFF","d/MMMM/y H:m:s.FFF","d/M/yyyy H:m:s.FFF","d/MMM/yyyy H:m:s.FFF","d/MMMM/yyyy H:m:s.FFF","yyyy/M/d H:m:s.FFF","M-d H:m:s.FFF","MMM-d H:m:s.FFF","MMMM-d H:m:s.FFF","d-M H:m:s.FFF","d-MMM H:m:s.FFF","d-MMMM H:m:s.FFF","M-y H:m:s.FFF","MMM-y H:m:s.FFF","M-yyyy H:m:s.FFF","MMM-Yyyy H:m:s.FFF","d-M-y H:m","d-MMM-y H:m","d-MMMM-y H:m","d-M-yyyy H:m","d-MMM-yyyy H:m","d-MMMM-yyyy H:m","yyyy-M-d H:m","M-d-y H:m:s.FFF","MMM-d-y H:m:s.FFF","MMMM-d-y H:m:s.FFF","M-d-yyyy H:m:s","MMM-d-yyyy H:m:s.FFF","MMMM-d-yyyy H:m:s.FFF","D-M-y H:m:s.FFF","d-MMM-y H:m:s.FFF","d-MMMM-y H:m:s.FFF","D-M-yyyy H:m:s.FFF","d-MMM-yyyy H:m:s.FFF","d-MMMM-yyyy H:m:s.FFF","yyyy-M-d H:m:s.FFF","M/d h:m:s.FFF tt","MMM/d h:m:s.FFF tt","MMMM/d h:m:s.FFF tt","d/M h:m:s.FFF tt","d/MMM h:m:s.FFF tt","d/MMMM h:m:s.FFF tt","M/y h:m:s.FFF tt","MMM/y h:m:s.FFF tt","M/yyyy h:m:s.FFF tt","MMM/yyyy h:m:s.FFF tt","d/M/y h:m tt","d/MMM/y h:m tt","d/MMMM/y h:m tt","d/M/yyyy h:m tt","d/mmm/yyyy h:m tt","d/MMMM/yyyy h:m tt","yyyy/M/d h:m tt","M/d/y h:m:s.FFF tt","MMM/d/y h:m:s.FFF tt","MMMM/d/y h:m:s.FFF tt","M/d/yyyy h:m:s tt","MMM/d/yyyy h:m:s.FFF tt","MMMM/d/yyyy h:m:s.FFF tt","d/M/y h:m:s.FFF tt","d/MMM/y h:m:s.FFF tt","d/MMMM/y h:m:s.FFF tt","d/M/yyyy h:m:s.FFF tt","d/MMM/yyyy h:m:s.FFF tt","d/MMMM/yyyy h:m:s.FFF tt","yyyy/M/d h:m:s.FFF tt","M-d h:m:s.FFF tt","MMM-d h:m:s.FFF tt","MMMM-d h:m:s.FFF tt","d-M h:m:s.FFF tt","d-MMM h:m:s.FFF tt","d-MMMM h:m:s.FFF tt","M-y h:m:s.FFF tt","MMM-y h:m:s.FFF tt","M-yyyy h:m:s.FFF tt","MMM-Yyyy h:m:s.FFF tt","d-M-y h:m tt","d-MMM-y h:m tt","d-MMMM-y h:m tt","d-M-yyyy h:m tt","d-MMM-yyyy h:m tt","d-MMMM-yyyy h:m tt","yyyy-M-d h:m tt","M-d-y h:m:s.FFF tt","MMM-d-y h:m:s.FFF tt","MMMM-d-y h:m:s.FFF tt","M-d-yyyy H:m:s tt","MMM-d-yyyy H:m:s.FFF tt","MMMM-d-yyyy h:m:s.FFF tt","d-M-y h:m:s.FFF tt","d-MMM-y h:m:s.FFF tt","d-MMMM-y h:m:s.FFF tt","d-M-yyyy h:m:s.FFF tt","d-MMM-yyyy h:m:s.FFF tt","d-MMMM-yyyy h:m:s.FFF tt","yyyy-M-d h:m:s.FFF tt"]},s.EvaluateFormat=function(n){return!n||n===u.Empty?!1:o.ContainsKeywords(n,[o.General.toLowerCase()])}})(window);(function(n,t){"use strict";function u(){}function e(){}function a(){}function l(){}function s(){}var nt="undefined",r=n.GrapeCity;typeof r===nt&&(r=n.GrapeCity={}),typeof r.UI===nt&&(r.UI={});var i=r.UI,tt=n.document,w=n.Image,g="position",d="absolute",ot="margin",ft="font",rt="class",p="left",k="right",b="top",h="bottom",c="middle",o="center",ut="gcUIElement",f="none",v="0",y="#9fa9c5",et="#F6FAFB",it="#D2DBEB";u.prototype={paint:function(n,t,i,r,u,f,e,o){},getEditor:function(){var n=tt.createElement("textarea");return t(n).css(g,d),t(n).css(ot,v),t(n).css(ft,"normal 10pt Arial"),t(n).css("word-wrap","normal"),t(n).css("overflow","hidden"),t(n).css("resize",f),t(n).css("border","2px #5292f7 solid"),t(n).css("outline",f),t(n).css("box-shadow","1px 2px 5px rgba(0,0,0,0.4)"),t(n).attr(rt,"gc-input-box"),n.setAttribute("autocomplete","off"),n.setAttribute(ut,"gcEditingInput"),n},_getLocator:function(){var n=tt.createElement("span");return t(n).css(g,d),t(n).css("visibility","hidden"),t(n).css("background-color","#68E"),t(n).css(ot,v),t(n).css("padding","2px"),t(n).css(ft,"normal 12px Arial"),t(n).css("color","white"),t(n).css("border-width",v),t(n).attr(rt,"gc-input-locator"),n.setAttribute(ut,"gcEditingLocator"),n},getEditorValue:function(n){return n.value!==undefined&&n.value!==null&&n.value.length>0?n.value:null},setEditorValue:function(n,t){t!==undefined&&t!==null&&(n.value=t)},parse:function(n,t){if(t===undefined||t===null||n===undefined||n===null)return n===undefined||n===null?"":n.toString();else try{var r=new i.GeneralFormatter(t);return r.Parse(n)}catch(u){return n.toString()}},format:function(n,t,r){if(t===undefined||t===null||n===undefined||n===null){if(n===undefined||n===null)return"";if(typeof n=="boolean"||n instanceof Boolean)return n.toString().toUpperCase();else if(n instanceof Date)return new i._DateTimeHelper(n).localeFormat("M/d/yyyy h:mm:ss");return n.toString()}else try{var u=null;return u=t instanceof i.AutoFormatter||t instanceof i.GeneralFormatter?t:new i.GeneralFormatter(t),u.Format(n,r)}catch(f){return n.toString()}},focus:function(n){n&&n.focus()},getThemeStyle:function(n){return i.Global.prototype.getWijmoThemeStyle(n)}},i._BaseCellType=u,e.prototype=new u,e.prototype.paint=function(n,t,i,u,e,o,s,h){if(!n)return;n.save(),n.rect(i,u,e,o),n.clip(),n.beginPath(),s&&s.backColor?(n.fillStyle=s.backColor,n.fillRect(i,u,e,o)):r.UI._useDoubleBuffer()||(s&&h.visualState===r.UI.VisualState.Selected?(n.fillStyle="#9fa9c5",n.fillRect(i,u,e,o)):s&&h.visualState===r.UI.VisualState.Active&&(n.fillStyle="#9fafc5",n.fillRect(i,u,e,o)));try{s&&s.backgroundImage&&s.backgroundImage!==f&&n.drawImage(s.backgroundImage,i,u,e,o)}catch(c){}h.sparkline&&h.sparkline.paintSparkline(n,i,u,e,o),h.cellOverflowLayout||this.paintValue(n,t,i,u,e,o,s,h),n.restore()},e.prototype.paintValue=function(n,t,r,u,f,e,s,l){var y,tt,v,it,rt,a,w,nt,d,ut,g;if(!n)return;n.save(),l.cellOverflowLayout&&(y=l.cellOverflowLayout.layout,y&&(n.rect(y.x,y.y,y.width,y.height),n.clip(),n.beginPath())),tt={value:null},v=this.format(t,s.formatter?s.formatter:s._autoFormatter,tt);if(v!==undefined&&v!==null&&v.length>0){s.foreColor&&(n.fillStyle=s.foreColor),tt.value&&(n.fillStyle=tt.value),s.font&&(n.font=s.font),it=0,s.textIndent>0&&(it=s.textIndent*8),rt=i._SheetRender.getHAlignByValueType(s.hAlign,t),a=2,a+=it,n.textAlign=p,rt===i.HorizontalAlign.center?(a=f/2,n.textAlign=o):rt===i.HorizontalAlign.right&&(a=f-3,a-=it,n.textAlign=k),w=v.split(/\r\n|\r|\n/),nt=0,s.wordWrap&&w.length>1&&s.vAlign!==i.VerticalAlign.top&&(nt=(w.length-1)*l.lineHeight),d=2,n.textBaseline=b,s.vAlign===i.VerticalAlign.center?(d=(e-nt)/2,n.textBaseline=c):s.vAlign===i.VerticalAlign.bottom&&(d=e-nt-2,n.textBaseline=h);if(s.wordWrap)for(ut=u+d,g=0;g<w.length;g++)n.fillText(w[g],r+a,ut),ut+=l.lineHeight;else n.fillText(v,r+a,u+d)}n.restore()},i._TextCellType=e,a.prototype=new u,a.prototype.paint=function(n,t,r,u,e,s,l,a){var v,ot,g,rt,d,tt,ft,ut;if(!n)return;n.save(),n.rect(r,u,e,s),n.clip(),n.beginPath(),v=null;if(a&&a.visualState!==undefined)if(a.useWijmoTheme)try{v=this.getThemeStyle(a.visualState),v&&v.backgroundColor&&v.backgroundColor!==""?(n.fillStyle=v.backgroundColor,n.fillRect(r,u,e,s)):v&&v.backgroundImage&&v.backgroundImage!==f&&v.backgroundImage!==""&&(ot=new w,g=v.backgroundImage,g=g.replace('url("',""),g=g.replace('")',""),ot.src=g,n.drawImage(ot,r,u,e,s))}catch(ct){}else rt=i.VisualState,d=n.createLinearGradient(r+e/2,u,r+e/2,u+s),a.visualState===rt.Normal&&(l.backColor?n.fillStyle=l.backColor:(d.addColorStop(.125,et),d.addColorStop(1,it),n.fillStyle=d)),a.visualState===rt.Highlight&&(d.addColorStop(.125,"#ffd45a"),d.addColorStop(1,"#ffef72"),n.fillStyle=d),a.visualState===rt.Selected&&(n.fillStyle=y),a.visualState===rt.Hover&&(d.addColorStop(.125,"#ffe165"),d.addColorStop(1,"#fff9a3"),n.fillStyle=d),n.fillRect(r,u,e,s);tt=this.format(t,l.formatter);if(tt!==undefined&&tt!==null&&tt.length>0){a&&a.useWijmoTheme&&v?n.fillStyle=v.color:l.foreColor&&(n.fillStyle=l.foreColor),l.font&&(n.font=l.font),ft=0,l.textIndent>0&&(ft=l.textIndent*8);var st=i.HorizontalAlign,ht=i.VerticalAlign,nt=2;nt+=ft,n.textAlign=p,l.hAlign===st.center?(nt=e/2,n.textAlign=o):l.hAlign===st.right&&(nt=e-1,nt-=ft,n.textAlign=k),ut=3,n.textBaseline=b,l.vAlign===ht.center?(ut=s/2+1,n.textBaseline=c):l.vAlign===ht.bottom&&(ut=s-1,n.textBaseline=h),n.fillText(tt,r+nt,u+ut)}n.restore()},i._ColumnHeaderCellType=a,l.prototype=new u,l.prototype.paint=function(n,t,r,u,e,s,l,a){var v,ut,d,tt,g,rt,it;if(!n)return;n.save(),n.rect(r,u,e,s),n.clip(),n.beginPath(),v=null;if(a&&a.visualState!==undefined)if(a.useWijmoTheme)try{v=this.getThemeStyle(a.visualState),v&&v.backgroundColor&&v.backgroundColor!==""?(n.fillStyle=v.backgroundColor,n.fillRect(r,u,e,s)):v&&v.backgroundImage&&v.backgroundImage!==f&&v.backgroundImage!==""&&(ut=new w,d=v.backgroundImage,d=d.replace('url("',""),d=d.replace('")',""),ut.src=d,n.drawImage(ut,r,u,e,s))}catch(ot){}else tt=i.VisualState,a.visualState===tt.Normal&&(n.fillStyle=l.backColor?l.backColor:"#E4ECF7"),a.visualState===tt.Highlight&&(n.fillStyle="#ffdc61"),a.visualState===tt.Selected&&(n.fillStyle=y),a.visualState===tt.Hover&&(n.fillStyle="#fde47b"),n.fillRect(r,u,e,s);g=this.format(t,l.formatter);if(g!==undefined&&g!==null&&g.length>0){a&&a.useWijmoTheme&&v?n.fillStyle=v.color:l.foreColor&&(n.fillStyle=l.foreColor),l.font&&(n.font=l.font),rt=0,l.textIndent>0&&(rt=l.textIndent*8);var ft=i.HorizontalAlign,et=i.VerticalAlign,nt=2;nt+=rt,n.textAlign=p,l.hAlign===ft.center?(nt=e/2,n.textAlign=o):l.hAlign===ft.right&&(nt=e-1,nt-=rt,n.textAlign=k),it=3,n.textBaseline=b,l.vAlign===et.center?(it=s/2+1,n.textBaseline=c):l.vAlign===et.bottom&&(it=s-1,n.textBaseline=h),n.fillText(g,r+nt,u+it)}n.restore()},i._RowHeaderCellType=l,s.prototype=new u,s.prototype.paint=function(n,t,r,u,e,o,s,h){var p,c,k,a,v,d,l,b;if(!n)return;n.save(),n.rect(r,u,e,o),n.clip(),n.beginPath();if(h&&h.visualState!==undefined){p=i.VisualState;if(h.useWijmoTheme)try{c=this.getThemeStyle(h.visualState),c&&c.backgroundColor&&c.backgroundColor!==""?(n.fillStyle=c.backgroundColor,n.fillRect(r,u,e,o)):c&&c.backgroundImage&&c.backgroundImage!==f&&(k=new w,a=c.backgroundImage,a=a.replace('url("',""),a=a.replace('")',""),k.src=a,n.drawImage(k,r,u,e,o))}catch(g){}else h.visualState===p.Normal&&(n.fillStyle="#A9C4E9"),h.visualState===p.Selected&&(n.fillStyle=y),h.visualState===p.Hover&&(n.fillStyle="#a1b0c8"),n.fillRect(r,u,e,o);v=n.createLinearGradient(r+e/2,u,r+e/2,u+o),v.addColorStop(.125,et),h&&h.useWijmoTheme?(d=this.getThemeStyle(p.Hover),v.addColorStop(1,d.backgroundColor)):v.addColorStop(1,it),n.fillStyle=v,n.beginPath(),l=3,b=o,e<o&&(b=e),n.moveTo(r+e-b+l,u+o-l),n.lineTo(r+e-l,u+o-l),n.lineTo(r+e-l,u+o-b+l),n.fill()}n.restore()},i._CornerCellType=s})(window,jQuery);(function(n,t,i){"use strict";function w(n,t){this._error=n,this._code=t}function g(){}function pt(n,t){this._value=n,this._rowCount=n.length;if(arguments.length<2){t=0;for(var i=0;i<n.length;i++)t=Math.max(n[i].length,t)}this._columnCount=t}function pr(n,t,i,r,u){this._array=n,this._row=t,this._column=i,this._rowCount=r,this._columnCount=u}function ki(n){this._value=n}function ir(n){this._value=n}function tu(n){this.values=n}function ct(){}function vt(n){var r,u,i,t;if(!n||n.length===0)throw au;for(r=null,u=0;u<n.length;u++){i=n[u];if(r){if(i.getRangeCount()!==r.getRangeCount())throw au;for(t=0;t<i.getRangeCount();t++)if(i.getColumn(t)!==r.getColumn(t)||i.getColumnCount(t)!==r.getColumnCount(t)||i.getRow(t)!==r.getRow(t)||i.getRowCount(t)!==r.getRowCount(t))throw au;}else r=i}this._references=n.slice(0)}function ot(n,t){this._source=n,this._ranges=t}function wt(n){this._sheet=n}function lr(n){this._values=n}function of(n,t,i,r,u,f,o,s){e._ConcreteReference.call(n,new bt.Range(t,i,r,u)),this.Action=f,this.Operand1=o,this.Operand2=s}function ef(n,t,i,r,u,f){e._ConcreteReference.call(n,t,i,r,u),this.Action=f}function hf(n,t,i,r,u,f,o,s){e._ConcreteReference.call(n,new bt.Range(t,i,r,u)),this.Action=f,this.Operand1=o,this.SwithOrder=s}function pi(n,t,r,u,f){(r===i||r===null)&&(r=0);if(!f&&t instanceof g)return n.call(t);else if(t instanceof ct)return n.call(t,r);return u}function br(n){return n<=255}function re(n){return n<=127}function gf(n){var t=n.charCodeAt(0);return br(t)?t>=48&&t<=57:!1}function vu(n){var t=n.charCodeAt(0);return br(t)?re(t)?(t|=32,t>=96&&t<=122):ni[t]===kt.UppercaseLetter||ni[t]===kt.LowercaseLetter:!1}function wf(n){var t=n.charCodeAt(0);return br(t)?re(t)?t<=57?t>=48:(t|=32,t>=96&&t<=122):ni[t]===kt.UppercaseLetter||ni[t]===kt.LowercaseLetter:!1}function oo(n){var t=n.charCodeAt(0);return br(t)?ni[t]===kt.MathSymbol||ni[t]===kt.CurrencySymbol||ni[t]===kt.ModifierSymbol||ni[t]===kt.OtherSymbol:!1}function kr(n){var t=n.charCodeAt(0);return br(t)?re(t)?t>=48&&t<=57:ni[t]===kt.DecimalDigitNumber||ni[t]===kt.OtherNumber:!1}function is(n,t,i){for(var e=n.length,r=k.None,u,f=t;f<e;f++){u=n.charAt(f);if(gf(u))r===k.None?r=k.Int:r===k.Dot?r=k.Decimal:r===k.Sign?r=k.Int:(r===k.Exponent||r===k.SignExponent)&&(r=k.ScientificNotation);else if(u===i)if(r===k.Int)r=k.Decimal;else if(r===k.None||r===k.Sign)r=k.Dot;else return{result:!1};else if(u==="+"||u==="-")if(r===k.None)r=k.Sign;else if(r===k.Exponent)r=k.SignExponent;else return{result:!0,endIndex:f-1};else if(u==="E"||u==="e")if(r===k.Int||r===k.Decimal)r=k.Exponent;else return{result:!1};else if(r===k.Int||r===k.Decimal||r===k.ScientificNotation)return{result:!0,endIndex:f-1}}return r===k.Int||r===k.Decimal||r===k.ScientificNotation?{result:!0,endIndex:e-1}:{result:!1}}function v(n){this._init(n)}function so(n,t){var i={row:this.row,column:this.column,rowCount:1,columnCount:1};return this.rowRelative&&(i.row+=n),this.columnRelative&&(i.column+=t),i}function uo(n,t){var i={},f,e,r,u;return this.isFullRow&&this.isFullColumn?(i.row=-1,i.column=-1,i.rowCount=-1,i.columnCount=-1):this.isFullRow?(i.column=-1,i.columnCount=-1,f=this.startRowRelative?this.startRow+n:this.startRow,e=this.endRowRelative?this.endRow+n:this.endRow,i.row=Math.min(f,e),i.rowCount=Math.abs(f-e)+1):this.isFullColumn?(i.row=-1,i.rowCount=-1,r=this.startColumnRelative?this.startColumn+t:this.startColumn,u=this.endColumnRelative?this.endColumn+t:this.endColumn,i.column=Math.min(r,u),i.columnCount=Math.abs(r-u)+1):(f=this.startRowRelative?this.startRow+n:this.startRow,e=this.endRowRelative?this.endRow+n:this.endRow,r=this.startColumnRelative?this.startColumn+t:this.startColumn,u=this.endColumnRelative?this.endColumn+t:this.endColumn,i.row=Math.min(f,e),i.rowCount=Math.abs(f-e)+1,i.column=Math.min(r,u),i.columnCount=Math.abs(r-u)+1),i}function fi(){}function ft(n){this.argument=n}function it(n,t){this.fn=n,this.args=t}function dt(n){this.name=n}function gu(n){this.name=n}function ei(n,t){this.source=n,this.name=t}function gt(n){this.value=n}function sr(n){this.value=n}function nf(n,t){this.value=n,this.originalValue=t}function du(n){this.value=n}function a(n){this.value=n}function rr(n,t){this.source=n,this.value=t}function hr(n,t,i){this.startSource=n,this.endSource=t,this.value=i}function bu(n){this.value=n}function ku(n){this.value=new pt(n)}function or(){this.value=e.missingArgument}function er(){}function rt(n,t){this.operator=n,this.operand=t}function nt(n,t,i){this.operator=n,this.left=t,this.right=i}function ii(){}function yt(n){this.source=n}function p(n,t,i,r){this.row=n,this.column=t,this.rowRelative=i,this.columnRelative=r}function su(n,t,i,r){this.row=n,this.column=t,this.rowRelative=i,this.columnRelative=r}function d(n,t,i,r,u){this.source=n,this.row=t,this.column=i,this.rowRelative=r,this.columnRelative=u}function o(n,t,i,r,u,f,e,o){arguments.length===0?this._initDefault():this.init(n,t,i,r,u,f,e,o)}function eu(n,t,i,r,u,f,e,o){arguments.length===0?this._initDefault():this.init(n,t,i,r,u,f,e,o)}function h(n,t,i,r,u,f,e,o,s){arguments.length===1?this._initDefault(n):this.init(n,t,i,r,u,f,e,o,s)}function wi(n,t,i,r,u,f,e,o,s,h){this.init(n,t,i,r,u,f,e,o,s,h)}function dr(n){this.structReference=n}function ou(n,t){return(n===i||n===null)&&(t===i||t===null)?!0:(n===i||n===null)&&t!==i&&t!==null||n!==i&&n!==null&&(t===i||t===null)?!1:n.toLowerCase()===t.toLowerCase()}function iu(n){this.name=n}function si(n){this.name=n}function bi(n,t){return n===t?!0:Math.abs(n-t)<Math.abs(n)/281474976710656}function et(n,t){this.name=n,this.acceptsReference=t}function af(n,t,i){this._init(n,t,i)}function y(n,t,r,f){(f===i||f===null)&&(f=u.Nothing),this.value=n,this.type=t,this.index=r,this.subType=f,this.children=[]}function sf(){this._index=-1,this._tokens=[]}function ts(){this._stack=[]}function uu(n,t,i,r){for(var s=n.length,o=i===r?0:1,e="",f,u=t+1;u<s;u++){f=n.charAt(u),f===i&&o++;if(f===r){o--;if(i===r&&u+2<s&&n.charAt(u+1)===i)e+=i,u++;else if(o!==0)e+=f;else return{result:e,endIndex:u}}else e+=f}throw"no syntax '"+r+"'to match the syntax '"+i+"'.";}function bo(n,t){for(var f=n.length,e=f-t,i,u,r=0;r<wu.length;r++){i=wu[r];if(t+i.length>f)continue;u=n.slice(t,t+i.length);if(i.length<=e&&(i===u||i===u.toUpperCase()))return{result:i,endIndex:t+i.length-1}}throw"'"+n.slice(t)+"' is invalid.";}function wr(n){return n==="^"||n===":"?1:n==="*"||n==="/"||n===" "?2:n==="+"||n==="-"||n===","?3:n==="&"?4:5}function yo(n){if(n.subType===u.RangeOp)return s.range;else if(n.subType===u.Union)return s.union;else if(n.subType===u.Intersection)return s.intersection;var t=n.value;if(t==="^")return s.exponent;else if(t==="*")return s.multiply;else if(t==="/")return s.divide;else if(t==="+")return s.add;else if(t==="-")return s.subtract;else if(t==="&")return s.concatenate;else if(t==="<")return s.lessThan;else if(t==="=")return s.equal;else if(t===">")return s.greaterThan;else if(t===">=")return s.greaterThanOrEqual;else if(t==="<=")return s.lessThanOrEqual;else if(t==="<>")return s.notEqual;else if(t===":"||t==="!")return s.range;else if(t===" "||t===",")return s.intersection;return s.add}function ff(n,t,i){return n&&n.hasOwnProperty(t)?n[t]:i}function vo(n,t){var i=t+1;return n<0?n%i+i:n>t?n%i:n}function te(n,t,i,r){this.useR1C1=n,this.row=t,this.column=i,this.option=r}function nu(n,t,i,r,u,f){this.source=n,this.arrayFormulaMode=arguments.length>=2?t:!1,this.row=arguments.length>=3?i:0,this.column=arguments.length>=4?r:0,this.rowCount=arguments.length>=5?u:1,this.columnCount=arguments.length>=6?f:1}function ie(){}function ai(n,t,i){n.hasOwnProperty(t)&&n[t]||(n[t]=[]),n[t].push(i)}function vi(n,t,i){var u=n[t],r;if(u)for(r=0;r<u.length;r++)if(u[r]===i){u.splice(r,1);return}}function yr(n,i,r){t(i).each(function(i,u){n[u]&&t(n[u]).each(function(n,t){t[r]()})})}function us(n,t,i,r,u){return(n.row===-1||t===-1||n.row<t+r&&t<n.row+n.rowCount)&&(n.column===-1||i===-1||n.column<i+u&&i<n.column+n.columnCount)}function fs(n,t,i){return(n.row===-1||n.row<=t&&t<n.row+n.rowCount)&&(n.column===-1||n.column<=i&&i<n.column+n.columnCount)}function es(n,t){if(t.action===hu)return us(n,t.row,t.column,t.rowCount,t.columnCount);else if(t.action===cu)return fs(n,t.row,t.column);return!1}function fu(n,i,r,u){t(i).each(function(i,f){n[f]&&t(n[f]).each(function(n,t){es(t,r)&&t.listener[u]()})})}function os(n,t){for(var i=0;i<t.length;i++)if(n.hasOwnProperty(t[i])&&n[t[i]].length>0)return!0;return!1}function ar(){}function ci(n,t,i){this.sheetSource=n,this.row=t,this.column=i,this.delay=0,this._listeners=[ui,oi,ri]}function lt(n,t){this.sheetSource=n,this.row=t,this._listeners=[ui,oi,uf,ri]}function at(n,t){this.sheetSource=n,this.column=t,this._listeners=[ui,oi,ri,lf]}function yi(n){this.name=n,this._listeners=[ui,oi,ri]}function he(n){this.sheetSource=n,this._listeners=[ui,oi,ri]}function le(n,t){var r=Math.max(n.row,t.row),i=Math.max(n.column,t.column),f=Math.min(n.row+n.rowCount,t.row+t.rowCount),u=Math.min(n.column+n.columnCount,t.column+t.columnCount);return r>=f||i>=u?null:{row:r,column:i,rowCount:f-r,columnCount:u-i,intersectWith:le}}function df(n,t,i,r,u,f,e,o){this._fromModel=n,this._fromRow=t,this._fromColumn=i,this._toModel=r,this._toRow=u,this._toColumn=f,this._rowCount=e,this._columnCount=o}function ru(){this._dataModels=[],this._customFunctions=[],this._customNames=[],this.clearDirties()}function rs(n,t,i,r){return n===-1&&r>127||t===-1&&i>127||i*r>127}function ae(n,t){this._sheet=n,this._sheetArea=t,this._controller=new ru,this._controller.attachDataModel(this)}function ve(n){this.context=n,this.parser=new v,this.evaluator=new ie,this.useR1C1=!1,this._suspended=0}var di="undefined",kf="number",ht="string",bf="boolean",ur="TRUE",fr="FALSE",li=n.GrapeCity,bt,e,f,st,c,vf,yf,pf,eo,ho,ao,lo,co,to,no,ge,io,fo,po,ro,go,ko,ns,r,u,wo,hu,cu;typeof li===di&&(li={}),typeof li.UI===di&&(li.UI={}),bt=li.UI,typeof li.Calc===di&&(li.Calc={}),e=li.Calc,typeof e.Expressions===di&&(e.Expressions={}),typeof e.Operators===di&&(e.Operators={}),typeof e.Functions===di&&(e.Functions={});var b=e.Expressions,s=e.Operators,tt=e.Functions,au="InvalidArgument",hi="InvalidCastException",cr="Not supported",gr="The formula you typed contains an invalid char: ",ti="invalid token at ",nr="Invalid array at ",lu="Invalid cell reference or name at ",vr="ARRAY",tr="ARRAYROW",ue="#NULL!",de="#DIV/0!",se="#VALUE!",tf="#REF!",ee="#NAME?",oe="#N/A",fe="#NUM!",wu=[ue,de,se,tf,ee,oe,fe],ss=[0,7,15,23,29,42,36],yu=[1,26,676];e.missingArgument={},w.prototype={toString:function(){return this._error}},w.parse=function(n){var t,r;if(n!==i&&n!==null&&n!=="")for(t=0;t<wu.length;t++){r=wu[t];if(r===n||r===n.toUpperCase())return new w(r,ss[t])}},e.Error=w;var hs=new w(ue,0),pu=new w(de,7),ut=new w(se,15),l=new w(tf,23),gi=new w(ee,29),cf=new w(oe,42),ne=new w(fe,36);e.Errors={Null:hs,DivideByZero:pu,Value:ut,Reference:l,Name:gi,NotAvailable:cf,Number:ne},g.prototype={getRowCount:function(){return 1},getColumnCount:function(){return 1},length:function(){return this.getRowCount()*this.getColumnCount()},getValueByIndex:function(n){return this.getValue(parseInt(n/this.getColumnCount(),10),n%this.getColumnCount())},getValue:function(n,t){}},e.Array=g,pt.prototype=new g,pt.prototype.getRowCount=function(){return this._rowCount},pt.prototype.getColumnCount=function(){return this._columnCount},pt.prototype.getValue=function(n,t){return this._value[n][t]},e._ConcreteArray=pt,pr.prototype=new g,pr.prototype.getRowCount=function(){return this._rowCount},pr.prototype.getColumnCount=function(){return this._columnCount},pr.prototype.getValue=function(n,t){return e._ArrayHelper.getValue(this._array,this._row+n,this._column+t)},e._SliceArray=pr,ki.prototype=new g,ki.prototype.getRowCount=function(){return this._value.getRowCount(0)},ki.prototype.getColumnCount=function(){return this._value.getColumnCount(0)},ki.prototype.getValue=function(n,t){return this._value.getValue(0,n,t)},e._ArrayWrappingRange=ki,ir.prototype=new g,ir.prototype.getRowCount=function(){return 1},ir.prototype.getColumnCount=function(){return 1},ir.prototype.getValue=function(n,t){return this._value},e._ArrayWrappingScalar=ir,tu.prototype=new g,tu.prototype.getRowCount=function(){return this.values.length},tu.prototype.getColumnCount=function(){return 1},tu.prototype.getValue=function(n,t){return this.values[n]},e._OneDimensionalArray=tu,ct.prototype={getRangeCount:function(){return 1},getRow:function(n){},getColumn:function(n){},getRowCount:function(n){},getColumnCount:function(n){},getValue:function(n,t,i){},isSubtotal:function(n,t,i){},getSource:function(){}},e.Reference=ct,vt.prototype=new ct,vt.prototype.getSheetCount=function(){return this._references.length},vt.prototype.getRangeCount=function(){return this._references[0].getRangeCount()},vt.prototype.getRow=function(n){return this._references[0].getRow(n)},vt.prototype.getColumn=function(n){return this._references[0].getColumn(n)},vt.prototype.getRowCount=function(n){return this._references[0].getRowCount(n)},vt.prototype.getColumnCount=function(n){return this._references[0].getColumnCount(n)},vt.prototype.getSource=function(n){return this._references[n].getSource()},vt.prototype.getValue=function(n,t,r,u){return(n===i||n===null)&&(n=0),this._references[n].getValue(t,r,u)},vt.prototype.isSubtotal=function(n,t,r,u){return(n===i||n===null)&&(n=0),this._references[n].isSubtotal(t,r,u)},e._SheetRangeReference=vt,ot.prototype=new ct,ot.prototype.getRangeCount=function(){return this._ranges.length},ot.prototype.getRow=function(n){return this._ranges[n].row},ot.prototype.getColumn=function(n){return this._ranges[n].col},ot.prototype.getRowCount=function(n){return this._ranges[n].rowCount},ot.prototype.getColumnCount=function(n){return this._ranges[n].colCount},ot.prototype.getSource=function(){return this._source},ot.prototype.getValue=function(n,t,i){return this.getActualValue(n,t,i)},ot.prototype.getActualValue=function(n,t,i){var r=this._source;return r.getValue(n,this.getRow(n)-r.getRow(n)+t,this.getColumn(n)-r.getColumn(n)+i)},ot.prototype.isSubtotal=function(n,t,i){var r=this._source;return r.isSubtotal(n,this.getRow(n)-r.getRow(n)+t,this.getColumn(n)-r.getColumn(n)+i)},e._ConcreteReference=ot,wt.prototype=new ct,wt.prototype.getRangeCount=function(){return 1},wt.prototype.getRow=function(n){return 0},wt.prototype.getColumn=function(n){return 0},wt.prototype.getRowCount=function(n){return this._sheet.getRowCount()},wt.prototype.getColumnCount=function(n){return this._sheet.getColumnCount()},wt.prototype.getValue=function(n,t,i){return t>=0&&t<this._sheet.getRowCount()||i>=0&&i<this._sheet.getColumnCount()?this._sheet.getValue(t,i):l},wt.prototype.getSource=function(){return new wt(this._sheet)},e._SheetReference=wt,lr.prototype=new g,lr.prototype.getRowCount=function(){return this._values.length*this._values[0].getRowCount(0)},lr.prototype.getColumnCount=function(){return this._values[0].getColumnCount(0)},lr.prototype.getValue=function(n,t){var r=t/this._values[0].getRowCount(0),i=n/this._values[0].getRowCount(0);return this._values[r].getValue(0,i,t)},e._CalcSheetRangeWrappingCalcRange=lr,of.prototype=new e._ConcreteReference(null,null),of.prototype.getValue=function(n,t,i){return this.Action(this.getActualValue(n,t,i),this.Operand1,this.Operand2)},e._TernaryCompositeConcreteReference=of,ef.prototype=new e._ConcreteReference(null,null),ef.prototype.getValue=function(n,t,i){return this.Action(this.getActualValue(n,t,i))},e._UnaryCompositeConcreteReference=ef,hf.prototype=new e._ConcreteReference(null,null),hf.prototype.getValue=function(n,t,i){var r=this.getActualValue(n,t,i);return this.SwithOrder?this.Action(this.Operand1,r):this.Action(r,this.Operand1)},e._BinaryCompositeConcreteReference=hf,f={isNumber:function(n){return typeof n===kf||!isNaN(n)&&!isNaN(parseFloat(n))||n instanceof Date},isError:function(n){return n instanceof w},_isCalcArray:function(n){return n instanceof g},_isCalcReference:function(n){return n instanceof ct},toResult:function(n){return isNaN(n)||!isFinite(n)?ne:n},_toArray:function(n){if(n instanceof g)return n;else if(n instanceof ct){if(n.getRangeCount()===1)return new ki(n)}else return new ir(n)},_isNaNOrInfinite:function(n){return isNaN(n)||!isFinite(n)},toInt:function(n){var t=f.toDouble(n);if(Math.abs(t)<1e21)return parseInt(t,10);throw hi;},toDouble:function(n){var t=null,u,r;if(n===i||n===null)t=0;else{u=typeof n;if(u===kf){t=new Number(n).valueOf();if(f._isNaNOrInfinite(t))throw hi;}else if(u===ht){r=bt._DateTimeHelper.parseLocale(n);if(r!==i&&r!==null)t=new bt._DateTimeHelper(r).toOADate();else{t=new Number(n).valueOf();if(f._isNaNOrInfinite(t))throw hi;}}else if(u===bf)t=n?1:0;else if(n instanceof Date)t=new bt._DateTimeHelper(n).toOADate();else throw hi;}return t},toBool:function(n){if(n===i||n===null)return!1;else if(typeof n===bf)return n;else if(n instanceof Date)return new bt._DateTimeHelper(n).toOADate()!==0;else if(f.isNumber(n))return n!==0;else throw hi;},toString:function(n){try{if(n===i||n===null)return"";else if(typeof n===bf)return n?ur:fr;else if(typeof n===ht)return n;else if(n instanceof Date)return new bt._DateTimeHelper(n).localeFormat("M/d/yyyy h:mm:ss");else if(n instanceof g)throw hi;else return n.toString()}catch(t){throw hi;}},toDateTime:function(n){var r=bt._DateTimeHelper,t;if(n===i||n===null)return bt._DateTimeHelper.fromOADate(0);else if(n instanceof Date)return new Date(n);else if(typeof n===ht){t=r.parseLocale(n),t!==i&&t!==null||isNaN(n)||(t=r.fromOADate(parseFloat(n)));if(t===i||t===null)throw au;return t}else if(typeof n===kf)return r.fromOADate(n);else throw hi;}},e.Convert=f,st={_argumentExists:function(n,t){return n&&t<n.length&&n[t]!==e.missingArgument},getArrayValue:function(n,t,r){return n===i||n===null?ut:t<n.getRowCount()&&r<n.getColumnCount()?n.getValue(t,r):r>=n.getColumnCount()&&n.getColumnCount()===1&&t<n.getRowCount()?n.getValue(t,0):t>=n.getRowCount()&&n.getColumnCount()===1&&r<n.getColumnCount()?n.getValue(0,r):ut},tryExtractToSingleValue:function(n){if(n instanceof ct){var t=f._toArray(n);n=t.getRowCount()===1&&t.getColumnCount()===1?t.getValue(0,0):t}return n instanceof g&&n.getRowCount()===1&&n.getColumnCount()===1&&(n=n.getValue(0,0)),{value:n,success:!(n instanceof g)}}},e._Helper=st,e._ArrayHelper={isArrayOrReference:function(n){return n instanceof g||n instanceof ct},getRangeCount:function(n){return n instanceof ct?n.getRangeCount():1},getLength:function(n,t){return pi(function(){return arguments.length===0?n.getRowCount()*n.getColumnCount():n.getRowCount(arguments[0])*n.getColumnCount(arguments[0])},n,t,1)},getRowCount:function(n,t){return pi(n.getRowCount,n,t,1)},getColumnCount:function(n,t){return pi(n.getColumnCount,n,t,1)},getValueByIndex:function(n,t,i){return pi(function(){if(arguments.length===0)return n.getValueByIndex(t);var i=n.getColumnCount(arguments[0]);return n.getValue(arguments[0],parseInt(t/i,10),t%i)},n,i,n)},getValue:function(n,t,i,r){return pi(function(){return arguments.length===0?n.getValue(t,i):n.getValue(arguments[0],t,i)},n,r,n)},isSubtotalByIndex:function(n,t,i){return pi(function(){var i=n.getColumnCount(arguments[0]);return n.isSubtotal(arguments[0],t/i,t%i)},n,i,!1,!0)},isSubtotal:function(n,t,i,r){return pi(function(){return n.isSubtotal(arguments[0],t,i)},n,r,!1,!0)}};var k={None:0,Sign:1,Int:2,Dot:3,Decimal:4,Exponent:5,SignExponent:6,ScientificNotation:7,Number:8},kt={UppercaseLetter:0,LowercaseLetter:1,DecimalDigitNumber:8,OtherNumber:10,SpaceSeparator:11,Control:14,ConnectorPunctuation:18,DashPunctuation:19,OpenPunctuation:20,ClosePunctuation:21,InitialQuotePunctuation:22,FinalQuotePunctuation:23,OtherPunctuation:24,MathSymbol:25,CurrencySymbol:26,ModifierSymbol:27,OtherSymbol:28},ni=[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,24,24,26,24,24,24,20,21,24,25,24,19,24,24,8,8,8,8,8,8,8,8,8,8,24,24,25,25,25,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,24,21,27,18,27,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,25,21,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,26,26,26,26,28,28,27,28,1,22,25,19,28,27,28,25,10,10,27,1,28,24,27,10,1,23,10,10,10,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,1,1,1,1,1,1,1,1];v.BAND_INDEX_CONST=-2147483648,v.maxRowCount=1048576,v.maxColumnCount=16384,v._isLetter=vu,v._isLetterOrDigit=wf,c={cell:0,row:1,column:2,sheet:3},b.Expression=fi,ft.prototype=new fi,b.ParenthesesExpression=ft,it.prototype=new fi,it.prototype.argCount=function(){return this.args?this.args.length:0},it.prototype.getArg=function(n){return this.args?this.args[n]:null},it.prototype.getFunctionName=function(){return typeof this.fn===ht?this.fn:this.fn.name},b.FunctionExpression=it,dt.prototype=new fi,b.NameExpression=dt,gu.prototype=new dt,b.BangNameExpression=gu,ei.prototype=new fi,b.ExternalNameExpression=ei,gt.prototype=new fi,b.ConstantExpression=gt,sr.prototype=new gt,b.BooleanExpression=sr,nf.prototype=new gt,b.DoubleExpression=nf,du.prototype=new gt,b.StringExpression=du,a.prototype=new gt,b.ErrorExpression=a,rr.prototype=new a,b.ExternalErrorExpression=rr,hr.prototype=new a,b.SheetRangeErrorExpression=hr,bu.prototype=new a,b.BangErrorExpression=bu,ku.prototype=new gt,b.ArrayExpression=ku,or.prototype=new gt,b.MissingArgumentExpression=or,er.prototype=new fi,b.OperatorExpression=er,rt.prototype=new er,b.UnaryOperatorExpression=rt,nt.prototype=new er,b.BinaryOperatorExpression=nt,ii.prototype=new fi,ii.prototype.getRange=function(n,t){},b.ReferenceExpression=ii,yt.prototype=new ii,b.ExternalReferenceExpression=yt,p.prototype=new ii,p.prototype.getRange=function(n,t){return so.call(this,n,t)},b.CellExpression=p,su.prototype=new p,b.BangCellExpression=su,d.prototype=new yt,d.prototype.getRange=function(n,t){return so.call(this,n,t)},b.ExternalCellExpression=d,o.prototype=new ii,o.prototype._initDefault=function(){var n=v.BAND_INDEX_CONST;this.init(n,n,n,n,!1,!1,!1,!1),this.isFullRow=!0,this.isFullColumn=!0},o.prototype.init=function(n,t,i,r,u,f,e,o){n>i?(this.startRow=i,this.endRow=n,this.startRowRelative=e,this.endRowRelative=u):(this.startRow=n,this.endRow=i,this.startRowRelative=u,this.endRowRelative=e),t>r?(this.startColumn=r,this.endColumn=t,this.startColumnRelative=o,this.endColumnRelative=f):(this.startColumn=t,this.endColumn=r,this.startColumnRelative=f,this.endColumnRelative=o),this.isFullRow=!1,this.isFullColumn=!1},o.prototype.initBand=function(n,t,i,r,u){var e,f;n>t&&(e=n,n=t,t=e,f=i,i=r,r=f),u?(this.startRow=n,this.startColumn=v.BAND_INDEX_CONST,this.endRow=t,this.endColumn=v.BAND_INDEX_CONST,this.startRowRelative=i,this.startColumnRelative=!1,this.endRowRelative=r,this.endColumnRelative=!1,this.isFullRow=!0,this.isFullColumn=!1):(this.startRow=v.BAND_INDEX_CONST,this.startColumn=n,this.endRow=v.BAND_INDEX_CONST,this.endColumn=t,this.startRowRelative=!1,this.startColumnRelative=i,this.endRowRelative=!1,this.endColumnRelative=r,this.isFullRow=!1,this.isFullColumn=!0)},o.prototype._getRangeType=function(){return this.isFullRow&&this.isFullColumn?c.sheet:this.isFullRow?c.row:this.isFullColumn?c.column:c.cell},o.prototype.getRange=function(n,t){return uo.call(this,n,t)},b.RangeExpression=o,eu.prototype=new o,b.BangRangeExpression=eu,h.prototype=new yt,h.prototype._initDefault=function(n){var t=v.BAND_INDEX_CONST;this.init(n,t,t,t,t,!1,!1,!1,!1),this.isFullRow=!0,this.isFullColumn=!0},h.prototype.init=function(n,t,i,r,u,f,e,o,s){this.source=n,t>r?(this.startRow=r,this.endRow=t,this.startRowRelative=o,this.endRowRelative=f):(this.startRow=t,this.endRow=r,this.startRowRelative=f,this.endRowRelative=o),i>u?(this.startColumn=u,this.endColumn=i,this.startColumnRelative=s,this.endColumnRelative=e):(this.startColumn=i,this.endColumn=u,this.startColumnRelative=e,this.endColumnRelative=s)},h.prototype.initBand=function(n,t,i,r,u,f){var o,e;this.source=n,t>i&&(o=t,t=i,i=o,e=r,r=u,u=e),f?(this.startRow=t,this.startColumn=v.BAND_INDEX_CONST,this.endRow=i,this.endColumn=v.BAND_INDEX_CONST,this.startRowRelative=r,this.startColumnRelative=!1,this.endRowRelative=u,this.endColumnRelative=!1,this.isFullRow=!0):(this.startRow=v.BAND_INDEX_CONST,this.startColumn=t,this.endRow=v.BAND_INDEX_CONST,this.endColumn=i,this.startRowRelative=!1,this.startColumnRelative=r,this.endRowRelative=!1,this.endColumnRelative=u,this.isFullColumn=!0)},h.prototype._getRangeType=function(){return this.isFullRow&&this.isFullColumn?c.sheet:this.isFullRow?c.row:this.isFullColumn?c.column:c.cell},h.prototype.getRange=function(n,t){return uo.call(this,n,t)},b.ExternalRangeExpression=h,wi.prototype=new ii,wi.prototype.init=function(n,t,i,r,u,f,e,o,s,h){this.startSource=n,this.endSource=t,i>u?(this.startRow=u,this.endRow=i,this.startRowRelative=s,this.endRowRelative=e):(this.startRow=i,this.endRow=u,this.startRowRelative=e,this.endRowRelative=s),r>f?(this.startColumn=f,this.endColumn=r,this.startColumnRelative=h,this.endColumnRelative=o):(this.startColumn=r,this.endColumn=f,this.startColumnRelative=o,this.endColumnRelative=h)},wi.prototype.initBand=function(n,t,i,r,u,f,e){var s,o;this.startSource=n,this.endSource=t,i>r&&(s=i,i=r,r=s,o=u,u=f,f=o),e?(this.startRow=i,this.startColumn=v.BAND_INDEX_CONST,this.endRow=r,this.endColumn=v.BAND_INDEX_CONST,this.startRowRelative=u,this.startColumnRelative=!1,this.endRowRelative=f,this.endColumnRelative=!1,this.isFullRow=!0):(this.startRow=v.BAND_INDEX_CONST,this.startColumn=i,this.endRow=v.BAND_INDEX_CONST,this.endColumn=r,this.startRowRelative=!1,this.startColumnRelative=u,this.endRowRelative=!1,this.endColumnRelative=f,this.isFullColumn=!0)},b.SheetRangeExpression=wi,dr.prototype=new ii,b.StructReferenceExpression=dr,iu.prototype={getName:function(){return this.name},compareTo:function(n){return ou(this.name,n.name)},toString:function(){return this.getName()}},s.Operator=iu,si.prototype=new iu,si.prototype._evaluateSingle=function(n,t){},si.prototype._evaluateImp=function(n,t){var r=null,o,u,e;n instanceof g&&(r=n),n instanceof ct&&(r=f._toArray(n));if(r===i||r===null)return this._evaluateSingle(n,t);if(r.length()<1)return ne;for(o=[],u=0;u<r.getRowCount();u++)for(o[u]=[],e=0;e<r.getColumnCount();e++)o[u][e]=this._evaluateSingle(r.getValue(u,e),t);return new pt(o,r.getColumnCount())},si.prototype.evaluate=function(n,t){},s.UnaryOperator=si,vf=s.plus=new si("+"),vf.evaluate=function(n,t){return this._evaluateImp(n,t)},vf._evaluateSingle=function(n,t){return n===i||n===null?0:f.toDouble(n)},yf=s.negate=new si("-"),yf.evaluate=function(n,t){return this._evaluateImp(n,t)},yf._evaluateSingle=function(n,t){return n===i||n===null?0:-f.toDouble(n)},pf=s.percent=new si("%"),pf.evaluate=function(n,t){return this._evaluateImp(n,t)},pf._evaluateSingle=function(n,t){return n===i||n===null?0:f.toDouble(n)/100},et.prototype=new iu,et.prototype._evaluateSingle=function(n,t,i){},et.prototype.evaluate=function(n,t,i){var e=st.tryExtractToSingleValue(n),o=st.tryExtractToSingleValue(t),h,f,s;if(e.success&&o.success)return this._evaluateSingle(e.value,o.value);n=e.value,t=o.value;var v=e.success?-1:n.getRowCount(),a=e.success?-1:n.getColumnCount(),l=o.success?-1:t.getRowCount(),c=o.success?-1:t.getColumnCount(),u=-1,r=-1;for(e.success||(u=v,r=a),o.success||(u=u===-1?l:l>1?u>1?Math.min(l,u):l:u,r=r===-1?c:c>1?r>1?Math.min(c,r):c:r),h=[],f=0;f<u;f++)for(h[f]=[],s=0;s<r;s++)h[f][s]=this._evaluateSingle(e.success?n:st.getArrayValue(n,f,s),o.success?t:st.getArrayValue(t,f,s));return new pt(h,r)},s.BinaryOperator=et,eo=s.add=new et("+",!1),eo._evaluateSingle=function(n,t,r){return f.isError(n)?n:f.isError(t)?t:((n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0),f.toDouble(n)+f.toDouble(t))},ho=s.subtract=new et("-",!1),ho._evaluateSingle=function(n,t,r){return f.isError(n)?n:f.isError(t)?t:((n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0),f.toDouble(n)-f.toDouble(t))},ao=s.multiply=new et("*",!1),ao._evaluateSingle=function(n,t,r){return f.isError(n)?n:f.isError(t)?t:((n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0),f.toDouble(n)*f.toDouble(t))},lo=s.divide=new et("/",!1),lo._evaluateSingle=function(n,t,r){if(t===i||t===null||t===""||t===0)return pu;if(f.isError(n))return n;if(f.isError(t))return t;return(n===i||n===null)&&(n=0),(t=f.toDouble(t))===0?pu:f.toDouble(n)/t},co=s.exponent=new et("^",!1),co._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;return(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0),n===0&&t<0?pu:Math.pow(f.toDouble(n),f.toDouble(t))},to=s.concatenate=new et("&",!1),to._evaluateSingle=function(n,t,r){return f.isError(n)?n:f.isError(t)?t:((n===i||n===null)&&(n=""),(t===i||t===null)&&(t=""),n.toString()+t.toString())},no=s.equal=new et("=",!1),no._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0);if(typeof n===ht||typeof t===ht)return n.toString().toUpperCase()===t.toString().toUpperCase();else{var e=f.toDouble(n),u=f.toDouble(t);return bi(e,u)}},ge=s.notEqual=new et("<>",!1),ge._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0);if(typeof n===ht||typeof t===ht)return n.toString().toUpperCase()!==t.toString().toUpperCase();else{var e=f.toDouble(n),u=f.toDouble(t);return!bi(e,u)}},io=s.lessThan=new et("<",!1),io._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0);if(typeof n===ht||typeof t===ht)return n.toString().toUpperCase()<t.toString().toUpperCase();else{var e=f.toDouble(n),u=f.toDouble(t);return e<u&&!bi(e,u)}},fo=s.greaterThan=new et(">",!1),fo._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0);if(typeof n===ht||typeof t===ht)return n.toString().toUpperCase()>t.toString().toUpperCase();else{var e=f.toDouble(n),u=f.toDouble(t);return e>u&&!bi(e,u)}},po=s.lessThanOrEqual=new et("<=",!1),po._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0);if(typeof n===ht||typeof t===ht)return n.toString().toUpperCase()<=t.toString().toUpperCase();else{var e=f.toDouble(n),u=f.toDouble(t);return e<u||bi(e,u)}},ro=s.greaterThanOrEqual=new et(">=",!1),ro._evaluateSingle=function(n,t,r){if(f.isError(n))return n;if(f.isError(t))return t;(n===i||n===null)&&(n=0),(t===i||t===null)&&(t=0);if(typeof n===ht||typeof t===ht)return n.toString().toUpperCase()>=t.toString().toUpperCase();else{var e=f.toDouble(n),u=f.toDouble(t);return e>u||bi(e,u)}},go=s.range=new et(":",!0),go.evaluate=function(n,t,r){var u;if(n===i||n===null||t===i||t===null||n.getRangeCount()!==1||t.getRangeCount()!==1)return ut;u=n.getSource();if(!u||u!==t.getSource())return ut;var s=n.getRow(0),h=n.getColumn(0),c=t.getRow(0),f=t.getColumn(0),e=Math.min(s,c),o=Math.min(h,f),a=Math.max(s+n.getRowCount(0),c+t.getRowCount(0))-e,l=Math.max(h+n.getColumnCount(0),f+t.getColumnCount(0))-o;return new ot(u,[{row:e,col:o,rowCount:a,colCount:l}])},ko=s.union=new et(",",!0),ko.evaluate=function(n,t,r){if(n===i||n===null||t===i||t===null||n.getRangeCount()!==1||t.getRangeCount()!==1)return ut;for(var f=[],u=0,u=0;u<n.getRangeCount();u++)f.push({row:n.getRow(u),col:n.getColumn(u),rowCount:n.getRowCount(u),colCount:n.getColumnCount(u)});for(u=0;u<t.getRangeCount();u++)f.push({row:t.getRow(u),col:t.getColumn(u),rowCount:t.getRowCount(u),colCount:t.getColumnCount(u)});return new ot(n.getSource(),f)},ns=s.intersection=new et(" ",!0),ns.evaluate=function(n,t,r){var u;if(n===i||n===null||t===i||t===null||n.getRangeCount()!==1||t.getRangeCount()!==1)return ut;u=n.getSource();if(!u||u!==t.getSource())return ut;var s=n.getRow(0),h=n.getColumn(0),c=t.getRow(0),f=t.getColumn(0),e=Math.max(s,c),o=Math.max(h,f),a=Math.min(s+n.getRowCount(0),c+t.getRowCount(0))-e,l=Math.min(h+n.getColumnCount(0),f+t.getColumnCount(0))-o;return new ot(u,[{row:e,col:o,rowCount:a,colCount:l}])},af.prototype={_init:function(n,t,i){this.name=n,this.minArgs=t,this.maxArgs=i},acceptsArray:function(n){return!1},acceptsReference:function(n){return!1},acceptsError:function(n){return!1},acceptsMissingArgument:function(n){return!1},isVolatile:function(){return!1},isContextSensitive:function(){return!1},isBranch:function(){return!1},findTestArgument:function(){return-1},findBranchArgument:function(n){return-1},evaluate:function(n){},evaluateWithContext:function(n,t){return this.evaluate(n)},toString:function(){return this.name}},af._create=function(n,t,i){var u=new tt.Function(n,0,255),r;t&&typeof t=="function"&&(u.evaluate=t);if(i)for(r in i)i.hasOwnProperty(r)&&r!=="override"&&(u[r]=i[r]);return u},tt.Function=af,tt._customFunctions={},tt.defineGlobalCustomFunction=function(n,t,r){var u,f;if(n===i||n===null)throw"Invalid function name";n=n.toUpperCase();if(tt._builtInFunctions.hasOwnProperty(n))throw"Can not override built-in function";if(tt._customFunctions.hasOwnProperty(n)){u=tt._customFunctions[n];if(u){if(!r||!r.override)throw"Attempt to override function while override is not allowed";}else tt._customFunctions[n]=new tt.Function(n,0,255),u=tt[n.toUpperCase()]}else u=new tt.Function(n,0,255),tt._customFunctions[n]=u;t&&typeof t=="function"&&(u.evaluate=t);if(r)for(f in r)r.hasOwnProperty(f)&&f!=="override"&&(u[f]=r[f]);return u},tt.findGlobalFunction=function(n){if(n===i||n===null)return null;return n=n.toUpperCase(),tt._builtInFunctions&&tt._builtInFunctions.hasOwnProperty(n)?tt._builtInFunctions[n]:tt._customFunctions.hasOwnProperty(n)?tt._customFunctions[n]:null},t.extend({ce:{createFunction:function(n,t,i){return tt.Function._create(n,t,i)},defineGlobalCustomFunction:function(n,t,i){return tt.defineGlobalCustomFunction(n,t,i)},findGlobalFunction:function(n){return tt.findGlobalFunction(n)}}}),r={Operand:0,Function:1,Subexpression:2,Argument:3,OperatorPrefix:4,OperatorInfix:5,OperatorPostfix:6,Whitespace:7,Unknown:8},u={Nothing:0,Start:1,Stop:2,Text:3,Number:4,Logical:5,Error:6,RangeOrName:7,Concatenation:8,Intersection:9,Union:10,RangeOp:11},sf.prototype={count:function(){return this._tokens.length},BOF:function(){return this._index<=0},EOF:function(){return this._index>=this._tokens.length-1},current:function(){return this._index===-1?null:this._tokens[this._index]},next:function(){return this.EOF()?null:this._tokens[this._index+1]},previous:function(){return this._index<1?null:this._tokens[this._index-1]},add:function(n){return this._tokens.push(n),n},removeAt:function(n){this._tokens.splice(n,1)},moveNext:function(){return this.EOF()?!1:(this._index++,!0)},reset:function(){this._index=-1},getItem:function(n){return n<0||n>=this.count()?null:this._tokens[n]}},ts.prototype={push:function(n){this._stack.push(n)},pop:function(){if(this._stack.length===0)return null;var n=this._stack.pop();return new y("",n.type,n.index,u.Stop)},current:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null}},te.prototype={getExternalSource:function(n,t){},getExternalSourceToken:function(n){}},e.ParserContext=te,v.prototype={_init:function(n){this.listSeparator=ff(n,"listSeparator",","),this.numberDecimalSeparator=ff(n,"numberDecimalSeparator","."),this.arrayGroupSeparator=ff(n,"arrayGroupSeparator",";"),this._arrayArgumentSepatator=this.listSeparator===this.arrayGroupSeparator?"\\":this.listSeparator,this._operatorInfix="\\+-*/^&=><: "+this.listSeparator},parse:function(n,t){t||(t={useR1C1:!1,row:0,column:0,option:null}),t.option&&this._init(t.option);var i=this._parseToToken(n);return this._buildExpressionTree(t,i)},unparse:function(n,t){if(!n)return"";t||(t={useR1C1:!1,row:0,column:0,option:null}),t.option&&this._init(t.option);var i={content:""};return this._unparseExpression(n,t,i),i.content},_unparseExpression:function(n,t,i){if(n instanceof gt)this._unparseConstantExpression(n,t,i);else if(n instanceof er)this._unParseOperatorExpressions(n,t,i);else if(n instanceof ii)this._unParseRefenceExpressions(n,t,i);else if(n instanceof gu)i.content+="!",i.content+=n.name;else if(n instanceof dt)i.content+=n.name;else if(n instanceof ei)this._unparseSource(n.source,t,i),i.content+="!",i.content+=n.name;else if(n instanceof ft)i.content+="(",this._unparseExpression(n.argument,t,i),i.content+=")";else if(n instanceof it){i.content+=n.getFunctionName(),i.content+="(";for(var r=0;r<n.argCount();r++)r!==0&&(i.content+=this.listSeparator),this._unparseExpression(n.getArg(r),t,i);i.content+=")"}else throw cr;},_unparseSource:function(n,t,i){t.getExternalSourceToken&&(i.content+=this._getValidSource(t.getExternalSourceToken(n),t.useR1C1))},_unparseSource2:function(n,t,i,r){var f={content:""};this._unparseSource(n,i,f);var o=this._removeApostrophe(f),s=this._removeWorkbook(f),h=s.success,e=s.workBookName,u={content:""};this._unparseSource(t,i,u),o|=this._removeApostrophe(u),e=this._removeWorkbook(u).workBookName,o?(r.content+="'",h&&(r.content+=e),r.content+=f.content,r.content+=":",r.content+=u.content,r.content+="'"):(h&&(r.content+=e),r.content+=f.content,r.content+=":",r.content+=u.content)},_getValidSource:function(n,t){if(n===i||n===null||n==="")return"";var r=this._readSheetReference(n,t,!0);if(r.success)return n.charAt(0)==="'"&&n.charAt(n.length-1)==="'"&&(n=n.substr(1,n.length-2),n=n.replace("'","''"),n="'"+n+"'"),n;return r=this._readSheetReference("'"+n+"'",t,!0),r.success?(n=n.replace("'","''"),n="'"+n+"'"):""},_unParseRefenceExpressions:function(n,t,i){var u=t.row,r=t.column;if(n instanceof su)i.content+="!",this._unParseCell(t.useR1C1,u,r,n.row,n.column,n.rowRelative,n.columnRelative,i);else if(n instanceof p)this._unParseCell(t.useR1C1,u,r,n.row,n.column,n.rowRelative,n.columnRelative,i);else if(n instanceof d)this._unparseSource(n.source,t,i),i.content+="!",this._unParseCell(t.useR1C1,u,r,n.row,n.column,n.rowRelative,n.columnRelative,i);else if(n instanceof eu)i.content+="!",this._unParseRange(t.useR1C1,u,r,n.startRow,n.startColumn,n.endRow,n.endColumn,n.startRowRelative,n.startColumnRelative,n.endRowRelative,n.endColumnRelative,i,n._getRangeType());else if(n instanceof o)this._unParseRange(t.useR1C1,u,r,n.startRow,n.startColumn,n.endRow,n.endColumn,n.startRowRelative,n.startColumnRelative,n.endRowRelative,n.endColumnRelative,i,n._getRangeType());else if(n instanceof h)this._unparseSource(n.source,t,i),i.content+="!",this._unParseRange(t.useR1C1,u,r,n.startRow,n.startColumn,n.endRow,n.endColumn,n.startRowRelative,n.startColumnRelative,n.endRowRelative,n.endColumnRelative,i,n._getRangeType());else if(n instanceof wi)this._unparseSource2(n.startSource,n.endSource,t,i),i.content+="!",this._unParseRange(t.useR1C1,u,r,n.startRow,n.startColumn,n.endRow,n.endColumn,n.startRowRelative,n.startColumnRelative,n.endRowRelative,n.endColumnRelative,i,n._getRangeType());else if(n instanceof dr)i.content+=n.structReference;else throw cr;},_removeApostrophe:function(n){return n.content.charAt(n.content.length-1)==="'"?(n.content=n.content.substr(1,n.content.length-2),!0):!1},_removeWorkbook:function(n){if(n.content.charAt(0)!=="[")return{success:!1,workBookName:""};var t=n.content.indexOf("]"),i=n.content.substr(0,t+1);return n.content=n.content.substr(t),{success:!0,workBookName:i}},_unParseCell:function(n,t,r,u,f,e,o,s,h){var g,b,k,y,a,p,w,d;(h===i||h===null)&&(h=c.cell),g=v.BAND_INDEX_CONST,b=v.maxRowCount-1,(h===c.cell||h===c.row)&&u!==g&&u>-b&&u<=2*b&&(u+=e?t:0,u=vo(u,b)),k=v.maxColumnCount-1,(h===c.cell||h===c.column)&&f!==g&&f>-k&&f<=2*k&&(f+=o?r:0,f=vo(f,k));if(this._isCellIndexsError(t,r,u,f,e,o,h)){s.content+=l.toString();return}y="",a="";if(n){y="R",u<0||t===u&&e||(e?y=y+"["+(u-t)+"]":(u++,y=y+u));if(f<0){s.content+=y;return}a="C",r===f&&o||(o?a=a+"["+(f-r)+"]":(f++,a=a+f));if(e&&u<0||!e&&u<=0){s.content+=a;return}s.content+=y,s.content+=a}else{u++,y=""+u,e||(y="$"+u);if(f<0){s.content+=y;return}for(p=f,w=1;w<yu.length;w++)d=yu[yu.length-w],f=parseInt(p/d,10),p=p%d,f!==0&&(a=a+String.fromCharCode(f+65-1));a=a+String.fromCharCode(p+65),o||(a="$"+a);if(u<=0){s.content+=a;return}s.content+=a,s.content+=y}},_isCellIndexsError:function(n,t,i,r,u,f,e){var o=!1;switch(e){case c.sheet:break;case c.cell:o|=i<0,o|=r<0;break;case c.row:o|=i<0;break;case c.column:o|=r<0;break}return o},_unParseRange:function(n,t,r,u,f,e,o,s,h,l,a,y,p){(p===i||p===null)&&(p=c.cell),this._unParseCell(n,t,r,u,f,s,h,y,p);var w=v.BAND_INDEX_CONST;if(n&&u===e&&f===o&&(e===w||o===w))return;(e!==w||o!==w)&&(y.content+=":",this._unParseCell(n,t,r,e,o,l,a,y,p))},_unParseOperatorExpressions:function(n,t,i){var f,u,r;if(n instanceof rt)f=n.operator,f===s.percent?(this._unparseExpression(n.operand,t,i),i.content+=f.name):(i.content+=f.name,this._unparseExpression(n.operand,t,i));else if(n instanceof nt){u={content:""},r={content:""},this._unparseExpression(n.right,t,r);var o=n.left instanceof nt,h=n.right instanceof nt,e=wr(n.operator.name);o&&wr(n.left.operator.name)>e?(u.content+="(",this._unparseExpression(n.left,t,u),u.content+=")"):this._unparseExpression(n.left,t,u),h&&wr(n.right.operator.name)>e&&(r.content+="(",this._unparseExpression(n.right,t,r),r.content+="("),i.content+=u.content,i.content+=n.operator instanceof s.UnaryOperator?this.listSeparator:n.operator.name,i.content+=r.content}else throw cr;},_unparseConstantExpression:function(n,t,r){var s="Invalid array",f,h,c,o,e,u;if(n instanceof du)r.content+='"',r.content+=n.value,r.content+='"';else if(n instanceof nf)r.content+=n.originalValue;else if(n instanceof sr)r.content+=n.value?ur:fr;else if(n instanceof ku){r.content+="{",f=n.value;if(f.getRowCount()<=0)throw s;for(h=v.BAND_INDEX_CONST,c=h,o=0;o<f.getRowCount();o++)for(o<1||(r.content+=this.arrayGroupSeparator),e=0;e<f.getColumnCount();e++){if(c!==h&&(c!==f.getColumnCount()||f.getColumnCount()===0))throw s;e!==0&&(r.content+=this._arrayArgumentSepatator),u=f.getValue(o,e);if(u===i||u===null)throw s;u instanceof fi?this._unparseExpression(u,t,r):u instanceof String?(r.content+='"',r.content+=u,r.content+='"'):r.content+=u instanceof Boolean?u?ur:fr:u.toString()}r.content+="}"}else if(n instanceof rr)this._unparseSource(n.source,t,r),r.content+="!",r.content+=n.value.toString();else if(n instanceof hr)this._unparseSource2(n.startSource,n.endSource,t,r),r.content+="!",r.content+=n.value.toString();else if(n instanceof bu)r.content+="!",r.content+=n.value.toString();else if(n instanceof a)r.content+=n.value.toString();else if(!(n instanceof or))throw cr;},_parseToToken:function(n){var v=n.length,f=new sf,s=new ts,i="",d="' at index on ",o=0,p=0,t,e,a,w,g,h,it,l,nt,tt,b,c,k;while(p<v&&n.charAt(p)===" ")p++;for(n.charAt(p)==="="&&p++,t=p;t<v;t++){e=n.charAt(t);if(e==='"')a=uu(n,t,'"','"'),f.add(new y(a.result,r.Operand,t,u.Text)),t=a.endIndex,o=t+1;else if(e==="'")a=uu(n,t,"'","'"),i+="'",i+=a.result,i+="'",t=a.endIndex;else if(e==="[")a=uu(n,t,"[","]"),i+="[",i+=a.result,i+="]",t=a.endIndex;else if(e==="\r"||e==="\n")continue;else if(e==="#")w=bo(n,t),g=t<v?n.charAt(t+1):"\x00",t>0&&n.charAt(t-1)==="!"?i+=w.result:tf===w.result.toUpperCase()&&t<v&&(wf(g)||g==="$")?i+=w.result:(f.add(new y(w.result,r.Operand,t,u.Error)),o=t+1),t=w.endIndex;else if(e==="+"||e==="-")h=f.getItem(f.count()-1),i.length!==0?(f.add(new y(i,r.Operand,o)),f.add(new y(e,r.OperatorInfix,t)),i="",o=t+1):(h&&h.type===r.Whitespace&&(f.removeAt(f.count()-1),h=f.getItem(f.count()-1)),h&&(h.type===r.Function&&h.subType===u.Stop||h.type===r.Subexpression&&h.subType===u.Stop||h.type===r.OperatorPostfix||h.type===r.Operand)?(f.add(new y(e,r.OperatorInfix,t)),o=t+1):(f.add(new y(e,r.OperatorPrefix,t)),o=t+1));else if(e===this.numberDecimalSeparator||gf(e))if(i.length>0)i+=e;else if((it=is(n,t,this.numberDecimalSeparator)).result){l=it.endIndex,nt=n.slice(t,l+1);while(l<=v-2&&n.charAt(l+1)===" ")l++;l>v-2||n.charAt(l+1)!==":"?f.add(new y(nt,r.Operand,t,u.Number)):(i+=nt,i+=":",l++),o=t+1,t=l}else i+=e;else if(e==="{"){if(i.length>0)throw gr+"'{"+d+t+".";s.push(f.add(new y(vr,r.Function,t,u.Start))),s.push(f.add(new y(tr,r.Function,t,u.Start))),o=t+1}else if(e===this.arrayGroupSeparator&&s.current()&&(s.current().value===vr||s.current().value===tr)){i.length>0&&(f.add(new y(i,r.Operand,o)),i="");if(!s.current())throw gr+"'"+e+d+t+".";f.add(s.pop()),f.add(new y(this.listSeparator,r.Argument,t)),s.push(f.add(new y(tr,r.Function,t+1,u.Start))),o=t+1}else if(e==="}"){i.length>0&&(f.add(new y(i,r.Operand,o)),i="");if(!s.current())throw gr+"'"+e+d+t+".";f.add(s.pop()),f.add(s.pop()),o=t+1}else if(e===" "){tt=t,t++;while(t<v&&i.charAt(i.length-1)===" ")t++;i.length>0&&i.charAt(i.length-1)!==":"&&t<v&&n.charAt(t)!==":"&&(f.add(new y(i,r.Operand,o)),i="",f.add(new y("",r.Whitespace,tt)),o=t),t--}else if((t+2>v||e!=="<"||n.charAt(t+1)!=="=")&&(e!==">"||n.charAt(t+1)!=="=")&&(e!=="<"||n.charAt(t+1)!==">"))if(e==="%")i.length>0&&(f.add(new y(i,r.Operand,o)),i=""),f.add(new y(n.charAt(t),r.OperatorPostfix,t)),o=t+1;else if(e==="+"||e==="-"||e==="*"||e==="/"||e==="="||e===">"||e==="<"||e==="&"||e==="^")i.length>0&&(f.add(new y(i,r.Operand,o)),i=""),f.add(new y(e,r.OperatorInfix,t)),o=t+1;else if(e==="(")i.length>0?(b=i.charAt(i.length-1),b===":"||b===this.listSeparator||b===" "?(i=i.slice(0,i.length-1),f.add(new y(i,r.Operand,o,u.RangeOrName)),f.add(new y(b,r.OperatorInfix,t-1,u.Nothing)),s.push(f.add(new y("",r.Subexpression,t,u.Start)))):(c=i.indexOf(":"),k=":",c===-1&&(c=i.indexOf(this.listSeparator),k=this.listSeparator),c===-1&&(c=i.indexOf(" "),k=" "),c!==-1&&c>0?(f.add(new y(i.substr(0,c),r.Operand,o,u.RangeOrName)),f.add(new y(k,r.OperatorInfix,c,u.Nothing)),i=i.slice(c+1),s.push(f.add(new y(i.toUpperCase(),r.Function,t,u.Start)))):s.push(f.add(new y(i.toUpperCase(),r.Function,t,u.Start)))),i=""):s.push(f.add(new y("",r.Subexpression,t,u.Start))),o=t+1;else if(e===this.listSeparator||e===this.arrayGroupSeparator)i.length>0&&(f.add(new y(i,r.Operand,o)),i=""),s.current()&&s.current().type===r.Function?f.add(new y(this._arrayArgumentSepatator,r.Argument,t)):f.add(new y(this.listSeparator,r.OperatorInfix,t,u.Union)),o=t+1;else if(e===")"){i.length>0&&(f.add(new y(i,r.Operand,o)),i="");if(!s.current())throw gr+"'"+e+d+t+".";f.add(s.pop()),o=t+1}else e===":"?i.length===0&&f.getItem(f.count()-1).subType===u.Stop?(f.add(new y(":",r.OperatorInfix,t,u.RangeOp)),o=t+1):i+=":":i+=e;else i.length>0&&(f.add(new y(i,r.Operand,o)),i=""),f.add(new y(n.slice(t,t+2),r.OperatorInfix,t,u.Logical)),t++,o=t+1}return i.length>0&&f.add(new y(i,r.Operand,o)),this._processTokens(f)},_processTokens:function(n){var s=this._removeWhiteSpace(n),f=[],l=new y("",r.Unknown,0,u.Start),h,t,i,e,o,c;f.push(l);while(s.moveNext()){t=s.current();if(!t)continue;i=s.previous(),e=s.next(),t.type===r.Operand&&t.subType===u.Nothing?(o=t.value.toUpperCase(),o===ur||o===fr?(t.subType=u.Logical,t.value=o):t.subType=u.RangeOrName):t.type===r.Function&&t.value.length>0&&t.value.charAt(0)==="@"&&(t.value=t.value.substr(1));if(f.length===0)throw ti+t.index+".";h=f[f.length-1];if(h.value===tr)if(t.type!==r.Argument&&t.subType!==u.Error&&t.subType!==u.Stop&&t.subType!==u.Logical&&t.subType!==u.Number&&t.subType!==u.Text&&t.type!==r.OperatorPrefix)throw"Invalid array at"+t.index+".";switch(t.type){case r.Operand:if(i&&(i.type===r.Operand||i.type===r.OperatorPostfix||i.type===r.Function&&i.subType===u.Stop||i.type===r.Subexpression&&i.subType===u.Stop))throw ti+t.index+".";break;case r.Function:case r.Subexpression:if(t.value!==vr||t.type!==r.Function||t.subType!==u.Start||i){if(t.subType===u.Stop&&(!i||i.type===r.OperatorPrefix||i.type===r.OperatorInfix)||t.subType===u.Start&&i&&(!e||i.type===r.OperatorPostfix||i.subType===u.Stop))throw ti+t.index+".";}else break;if(t.subType===u.Stop&&t.type===r.Subexpression&&i.subType===u.Start)throw ti+t.index+".";if(t.subType===u.Stop&&t.type===r.Function&&i.type===r.Subexpression&&i.subType===u.Start)throw ti+t.index+".";break;case r.Argument:if(!e||!i||i.type===r.OperatorInfix||i.type===r.OperatorPrefix)throw ti+t.index+".";break;case r.OperatorPrefix:if(!e||i&&i.type===r.OperatorPostfix)throw ti+t.index+".";break;case r.OperatorInfix:if(!e||!i||i.type===r.OperatorInfix||i.type===r.OperatorPrefix||i.type===r.Argument||i.type===r.Function&&i.subType===u.Start||i.type===r.Subexpression&&i.subType===u.Start)throw ti+t.index+".";break;case r.OperatorPostfix:if(!i||i.type===r.OperatorPrefix||i.type===r.OperatorInfix||i.type===r.Function&&i.subType===u.Start||i.type===r.Subexpression&&i.subType===u.Start)throw ti+t.index+".";break;default:throw ti+t.index+".";}if(t.subType===u.Start)f.push(t),h.children.push(t);else if(t.subType===u.Stop){if(f.length===0){c=t.value===vr||t.value===tr?"}":")";throw gr+"'"+c+"' at "+t.index+".";}f.pop()}else h.children.push(t)}return l.children},_removeWhiteSpace:function(n){var e=new sf,f,t,i;while(n.moveNext()){f=n.current();if(!f)continue;if(f.type!==r.Whitespace){e.add(f);continue}if(n.BOF()||n.EOF())continue;t=n.previous(),i=n.next();if(!t||!i)continue;(t.type===r.Function&&t.subType===u.Stop||t.type===r.Subexpression&&t.subType===u.Stop||t.type===r.Operand)&&(i.type===r.Function&&i.subType===u.Start||i.type===r.Subexpression&&i.subType===u.Start||i.type===r.Operand)&&e.add(new y(" ",r.OperatorInfix,f.index,u.Intersection))}return e},_buildExpressionNode:function(n,t){var i;return t.type===r.Function?i=t.value===vr?this._buildArraryExpression(n,t):this._buildFunctionExpression(n,t):t.type===r.Subexpression?i=this._buildSubExpression(n,t):t.type===r.Operand&&(t.subType===u.Number?i=new nf(parseFloat(t.value),t.value):t.subType===u.Error?i=new a(w.parse(t.value)):t.subType===u.Logical?ou(t.value,ur)?i=new sr(!0):ou(t.value,fr)&&(i=new sr(!1)):i=t.subType===u.RangeOrName?this._buildCellReferenceOrNameExpressions(n,t):new du(t.value)),i},_buildExpressionTree:function(n,t){for(var u=this._parseToBinaryOperatorList(n,t),f,s,h,o,e,i=3;i<u.length;){o=u[i],e=u[i-2];if(o&&o.type===r.OperatorInfix){while(i>=3&&wr(o.value)>=wr(e.value))s=u[i-3],h=u[i-1],f=new nt(yo(e),s,h),u.splice(i-3,1),u.splice(i-3,1),u.splice(i-3,1),u.splice(i-3,0,f),i-=2,i<3||(e=u[i-2]);i+=2}else i++}if(u.length===1)return u[0];else{for(i=u.length-2;i>0;i-=2)s=u[i-1],h=u[i+1],f=new nt(yo(u[i]),s,h),u.splice(i-1,1),u.splice(i-1,1),u.splice(i-1,1),u.push(f);return f}},_parseToBinaryOperatorList:function(n,t){for(var u=[],f,i,o,c,h,e=0;e<t.length;e++){i=t[e];if(i.type===r.OperatorPrefix){o=[];while(i.type===r.OperatorPrefix)o.push(i.value==="+"?s.plus:s.negate),e++,i=t[e];c=t[e],f=new rt(o.pop(),this._buildExpressionNode(n,c));while(o.length>0)f=new rt(o.pop(),f);u.push(f)}else i.type===r.OperatorPostfix?(h=u[u.length-1],f=new rt(s.percent,h),u.pop(),u.push(f)):i.type===r.OperatorInfix?u.push(i):(f=this._buildExpressionNode(n,i),u.push(f))}return u},_buildFunctionExpression:function(n,t){for(var i=[],u=[],o,f,e=0;e<t.children.length;e++)o=t.children[e],o.type!==r.Argument?u.push(o):u.length===0?i.push(new or):(i.push(this._buildExpressionTree(n,u)),u=[]);u.length!==0?i.push(this._buildExpressionTree(n,u)):t.children.length!==0&&i.push(new or),f=tt.findGlobalFunction(t.value);if(f){if(i.length<f.minArgs||i.length>f.maxArgs)throw"Invalid function parameters at "+t.index;return new it(f,i)}else return new it(t.value,i)},_buildSubExpression:function(n,t){return new ft(this._buildExpressionTree(n,t.children))},_buildArraryExpression:function(n,t){for(var c=[],w=-1,u,a,y,v,h,f,o,l,p,s=0;s<t.children.length;s++){u=t.children[s],a=s===0?null:t.children[s-1];if(u.type===r.Argument){if(!a||a.type===r.Argument||s===t.children.length-1)throw nr+u.index;continue}else if(a&&a.type!==r.Argument)throw nr+u.index;else if(u.type!==r.Function||u.value!==tr)throw nr+u.index;else if(w!==-1&&u.children.length!==w)throw"The length of array columns are unequal at "+u.index;else w=u.children.length;for(y=[],c.push(y),v=u.children.length,h=null,f=0;f<v;f++){o=u.children[f];if(o.type===r.Argument)h&&h.type!==r.Argument&&f!==v-1||y.push(e.missingArgument);else if(h&&h.type!==r.Argument)throw nr+u.index;else{if(o.type===r.OperatorPrefix){if(f+1>=v)throw nr+u.index;l=u.children[f+1],l.value=""+o.value+l.value,o=l,f++}else f+1<v&&u.children[f+1].type===r.OperatorPostfix&&(l=u.children[f+1],o.value=""+o.value+l.value,f++);p=this._buildExpressionNode(n,o),p&&y.push(p.value)}h=o}}if(c.length===0||c[0]===i||c[0]===null||c[0].length===0)throw nr+u.index;return new ku(c)},_buildCellReferenceOrNameExpressions:function(n,t){var u=t.value,e=this._buildCellReferenceOrNameExpressions2(n,u),i=e.endIndex,r=e.expression,f,h,o;if(!r)throw lu+t.index+".";if(i<=0||i>=u.length)return r;if(u.charAt(i)!==":")throw lu+t.index+".";i++,f=[],f.push(r);while(i++&&i<u.length){h=i,e=this._buildCellReferenceOrNameExpressions2(n,u.substr(i)),i=e.endIndex,r=e.expression;if(!r)throw lu+t.index+".";f.push(r),i+=h;if(i<u.length&&u.charAt(i)!==":")throw lu+t.index+".";i++}for(r=f[0],o=1;o<f.length;o++)r=new nt(s.range,r,f[o]);return r},_buildCellReferenceOrNameExpressions2:function(n,t){var e,y,k,h,tt,nt,g,b,p,ut,rt,d,it;if(t===i||t===null||t==="")return{endIndex:0,expression:null};e=t.length;if(t.match("^#REF"))return{endIndex:e,expression:new a(l)};y=t.charAt(0)==="!",k=y?1:0;if(e<1)return{endIndex:0,expression:null};var c=-1,w="",r=0;if(y)c=k;else if(t.charAt(0)==="'")c=t.indexOf("!")+1,w=t.substr(0,c-1);else{h=t.indexOf("!"),tt=t.indexOf(":");if(h!==-1){nt=t.substr(k,h-k);if(tt<0||h<tt)h<e-1&&(w=nt,c=h+1);else{g=this._parseToCellReference(n,nt,y);if(g.expression)return g;else h<e-1&&(w=nt,c=h+1);r=g.endIndex}}}var v="",o="",s="";if(c!==-1&&w&&w!==""){b=this._readSheetReference(w,n.useR1C1,!1);if(!b.success)return{endIndex:r,expression:null};v=b.workBookName,o=b.startSheetName,s=b.endSheetName}else c=k;d=!1;if(v&&v!==""||o&&o!==""){d=!0;if(n.getExternalSource){ut=n.getExternalSource(v,o);if(!ut)return{endIndex:r,expression:new a(l)}}}if(s&&s!==""){d=!0;if(n.getExternalSource){rt=n.getExternalSource(v,s);if(!rt)return{endIndex:r,expression:new a(l)}}}var f=t.substr(c),ft=this._parseToCellReference(n,f,y,ut,rt),u=ft.expression;r=ft.endIndex;if(u)if(!d||u instanceof wi||u instanceof yt||u instanceof rr||u instanceof hr||u instanceof ei)if(r<f.length-1){r=e-(f.length-1);if(t.charAt(r)!==":"){if(o&&o!==""){if(s&&s!=="")return{endIndex:r,expression:null};if(!n.getExternalSource)return{endIndex:r,expression:new a(l)};p=n.getExternalSource(v,o);if(!p)return{endIndex:r,expression:new a(l)};u=new ei(p,f)}else u=new dt(f);r=e}}else r=e;else return{endIndex:e,expression:new a(l)};else{if(y)u=new gu(f);else if(o&&o!==""){if(s&&s!=="")return{endIndex:r,expression:null};if(!n.getExternalSource)return{endIndex:r,expression:new a(l)};p=n.getExternalSource(v,o);if(!p)return{endIndex:r,expression:new a(l)};u=new ei(p,f)}else u=new dt(f);r=e}if(u instanceof dt||u instanceof ei){it=this._createStructExpression(f);if(it)u=it;else if(!this._validateName(f))return{endIndex:r,expression:null}}return{endIndex:r,expression:u}},_parseToCellReference:function(n,t,i,r,u){var c=0,s,o,f,e,h;if(t.charAt(0)==="#"){s=bo(t,0),c=s.endIndex+1,o=w.parse(s.result);if(o)return{endIndex:c,expression:this._createExternalErrorExpression(o,i,r,u)}}f=n.useR1C1?this._isR1C1CellReferance(t,n.row,n.column):this._isA1CellReferance(t),e=v.BAND_INDEX_CONST;if(f.success&&n.useR1C1&&f.startRow!==e&&f.startColumn===e&&f.endRow===e&&f.endColumn===e)f.endRow=f.startRow,f.endRowRelative=f.startRowRelative;else if(f.success&&n.useR1C1&&f.startColumn!==e&&f.startRow===e&&f.endRow===e&&f.endColumn===e)f.endColumn=f.startColumn,f.endColumnRelative=f.startColumnRelative;else if(!f.success||f.startRow===e&&(f.startColumn===e||f.endColumn===e)||f.startColumn===e&&f.endRow===e)return{endIndex:f.endIndex,expression:null};return h=this._createCellReferenceExpression(n,n.row,n.column,f.startRow,f.startColumn,f.endRow,f.endColumn,f.startRowRelative,f.startColumnRelative,f.endRowRelative,f.endColumnRelative,i,r,u),{endIndex:f.endIndex,expression:h}},_createExternalErrorExpression:function(n,t,i,r){return t?new bu(n):i&&r?new hr(i,r,n):i?new rr(i,n):new a(n)},_createCellReferenceExpression:function(n,t,i,r,u,f,e,s,c,l,a,y,w,b){var g=v.BAND_INDEX_CONST,k;return w&&b?(k=new wi,r===g?(u-=c?i:0,e-=a?i:0,k.initBand(w,b,u,e,c,a,!1)):u===g?(r-=s?t:0,f-=l?t:0,k.initBand(w,b,r,f,s,l,!0)):(r-=s?t:0,u-=c?i:0,f-=l?t:0,e-=a?i:0,k.init(w,b,r,u,f,e,s,c,l,a)),k):f===g&&e===g?(r-=s?t:0,u-=c?i:0,y?w||b?null:new su(r,u,s,c):w?new d(w,r,u,s,c):new p(r,u,s,c)):y?w&&b?null:(k=new eu,r===g?(u-=c?i:0,e-=a?i:0,k.initBand(u,e,c,a,!1)):u===g?(r-=s?t:0,f-=l?t:0,k.initBand(r,f,s,l,!0)):(r-=s?t:0,u-=c?i:0,f-=l?t:0,e-=a?i:0,k.init(r,u,f,e,s,c,l,a)),k):w?(k=new h,r===g?(u-=c?i:0,e-=a?i:0,k.initBand(w,u,e,c,a,!1)):u===g?(r-=s?t:0,f-=l?t:0,k.initBand(w,r,f,s,l,!0)):(r-=s?t:0,u-=c?i:0,f-=l?t:0,e-=a?i:0,k.init(w,r,u,f,e,s,c,l,a)),k):(k=new o,r===g?(u-=c?i:0,e-=a?i:0,k.initBand(u,e,c,a,!1)):u===g?(r-=s?t:0,f-=l?t:0,k.initBand(r,f,s,l,!0)):(r-=s?t:0,u-=c?i:0,f-=l?t:0,e-=a?i:0,k.init(r,u,f,e,s,c,l,a)),k)},_readSheetReference:function(n,t,i){var r={},o=!1,u,s,f,e;return n.charAt(0)==="'"&&n.charAt(n.length-1)==="'"&&(o=!0,n=n.substr(1,n.length-2)),u=n.indexOf("["),u!==-1&&(u!==0&&(r.workBookName=n.substr(0,u),r.workBookName.charAt(u-1)!=="\\"&&(r.workBookName=r.workBookName+"\\")),s=uu(n,u,"[","]"),r.workBookName=r.workBookName+s.result,n=n.substr(s.endIndex+1)),f=n.indexOf(":"),f===-1?r.startSheetName=n:(r.startSheetName=n.substr(0,f),r.endSheetName=n.substr(f+1)),!r.startSheetName||r.startSheetName===""?(r.success=!1,r):(e=this._validateWorkbook(r.workBookName,o),e=this._validateSheetName(r.startSheetName,t,o),e&=this._validateSheetName(r.endSheetName,t,o),i&&(r.startSheetName&&(r.startSheetName=r.startSheetName.replace("'","''")),r.endSheetName&&(r.endSheetName=r.endSheetName.replace("'","''"))),r.success=e,r)},_isStartWithCellReference:function(n,t){return t?this._isR1C1CellReferance(n):this._isA1CellReferance(n)},_isA1CellReferance:function(n){var e=v.BAND_INDEX_CONST,t={startRow:e,startColumn:e,endRow:e,endColumn:e,startRowRelative:!0,startColumnRelative:!0,endRowRelative:!0,endColumnRelative:!0,success:!1,endIndex:0},o,r,i,h,c,s,u,f;n=n.replace(" ",""),o=n.length,r=this._readOneA1Element(n,0),t.endIndex=r.endIndex;if(!r.success||t.endIndex>o)return t;if(r.isRow)return t.startRow=r.elementIndex,t.startRowRelative=r.isRelative,n.charAt(t.endIndex)===":"?(t.endIndex++,i=this._readOneA1Element(n,t.endIndex),t.endIndex=i.endIndex,!i.success||!i.isRow?t:(t.endRow=i.elementIndex,t.endRowRelative=i.isRelative,t.success=!0,t)):t;else{t.startColumn=r.elementIndex,t.startColumnRelative=r.isRelative;if(n.charAt(t.endIndex)===":")return t.endIndex++,i=this._readOneA1Element(n,t.endIndex),t.endIndex=i.endIndex,!i.success||i.isRow?t:(t.endColumn=i.elementIndex,t.endColumnRelative=i.isRelative,t.success=!0,t)}if(kr(n.charAt(t.endIndex))||n.charAt(t.endIndex)==="$"){i=this._readOneA1Element(n,t.endIndex),t.endIndex=i.endIndex;if(!i.success||!i.isRow)return t;t.startRow=i.elementIndex,t.startRowRelative=i.isRelative,h=t.endIndex;if(t.endIndex<o-1&&n.charAt(t.endIndex)===":"){if(n.charAt(t.endIndex+1)==="'")return t.success=!0,t;c=n.indexOf("!",t.endIndex+1),s=n.indexOf(":",t.endIndex+1);if(c!==-1&&(s===-1||s>c))return t.success=!0,t;t.endIndex++,u=this._readOneA1Element(n,t.endIndex);if(!u.success||u.isRow)return t.endIndex=h,t.success=!0,t;else t.endIndex=u.endIndex;t.endColumn=u.elementIndex,t.endColumnRelative=u.isRelative,f=this._readOneA1Element(n,t.endIndex);if(f.success&&f.isRow)t.endIndex=f.endIndex;else return t.endIndex=h,t.success=!0,t;return t.endRow=f.elementIndex,t.endRowRelative=f.isRelative,t.success=!0,t}else return t.success=!0,t}else return t},_isR1C1CellReferance:function(n,t,i){var h=v.BAND_INDEX_CONST,r={startRow:h,startColumn:h,endRow:h,endColumn:h,startRowRelative:!0,startColumnRelative:!0,endRowRelative:!0,endColumnRelative:!0,success:!1,endIndex:0},s,f,u,l,c,a,e,o;n=n.replace(" ",""),s=n.length,f=this._readOneR1C1Element(n,t,i,0),r.endIndex=f.endIndex;if(!f.success)return r;if(f.isRow){r.startRow=f.elementIndex,r.startRowRelative=f.isRelative;if(r.endIndex>=s)return r.success=!0,r;if(n.charAt(r.endIndex)===":")return r.endIndex++,u=this._readOneR1C1Element(n,t,i,r.endIndex),r.endIndex=u.endIndex,!u.success||!u.isRow?r:(r.endRow=u.elementIndex,r.endRowRelative=u.isRelative,r.success=!0,r)}else return r.startColumn=f.elementIndex,r.startColumnRelative=f.isRelative,r.endIndex>=s?(r.success=!0,r):n.charAt(r.endIndex)===":"?(r.endIndex++,u=this._readOneR1C1Element(n,t,i,r.endIndex),r.endIndex=u.endIndex,!u.success||u.isRow?r:(r.endColumn=u.elementIndex,r.endColumnRelative=u.isRelative,r.success=!0,r)):r;if(n.charAt(r.endIndex)==="C"||n.charAt(r.endIndex)==="c"){u=this._readOneR1C1Element(n,t,i,r.endIndex),r.endIndex=u.endIndex;if(!u.success||u.isRow)return r;r.startColumn=u.elementIndex,r.startColumnRelative=u.isRelative,l=r.endIndex;if(r.endIndex<s-1&&n.charAt(r.endIndex)===":"){if(n.charAt(r.endIndex+1)==="'")return r.success=!0,r;c=n.indexOf("!",r.endIndex+1),a=n.indexOf(":",r.endIndex+1);if(c!==-1&&(a===-1||a>c))return r.success=!0,r;r.endIndex++,e=this._readOneR1C1Element(n,t,i,r.endIndex);if(e.success&&e.isRow)r.endIndex=e.endIndex;else return r.endIndex=l,r.success=!0,r;r.endRow=e.elementIndex,r.endRowRelative=e.isRelative,o=this._readOneR1C1Element(n,t,i,r.endIndex);if(!o.success||o.isRow)return r.endIndex=l,r.success=!0,r;else r.endIndex=o.endIndex;return r.endColumn=o.elementIndex,r.endColumnRelative=o.isRelative,r.success=!0,r}else return r.success=!0,r}else return r},_readOneA1Element:function(n,t){var h=v.BAND_INDEX_CONST,i={endIndex:t,elementIndex:h,isRow:!0,isRelative:!0,success:!1},o=n.length,r,u,f,e,s;if(t>=o)return i;n.charAt(t)==="$"&&(i.isRelative=!1,t++);if(t>=o)return i;r=t,f=n.charAt(r);if(kr(f)&&f!=="0"){i.isRow=!0;while(r<o&&kr(f))r++,r<o&&(f=n.charAt(r));u=parseInt(n.substr(t,r-t),10);if(u>=1&&u<=v.maxRowCount)return i.elementIndex=u-1,i.endIndex=r,i.success=!0,i}else if(vu(f)){i.isRow=!1;while(r<o&&vu(f))r++,r<o&&(f=n.charAt(r));e=n.substr(t,r-t);if(e.length>3)return i;for(e=e.toUpperCase(),u=0,s=e.length-1;s>=0;s--)u+=(e.charCodeAt(s)-64)*yu[e.length-s-1];if(u<=v.maxColumnCount)return i.elementIndex=u-1,i.endIndex=r,i.success=!0,i}return i},_readOneR1C1Element:function(n,t,i,r){var l=v.BAND_INDEX_CONST,u={endIndex:r,elementIndex:l,isRow:!0,isRelative:!1,success:!1},s=n.length,f,e,h,c,o;if(r>=s)return u;f=r,e=n.charAt(f);if(e==="R"||e==="r")u.isRow=!0,h=t;else if(e==="C"||e==="c")u.isRow=!1,h=i;else return u;r++,f++;if(r>=s)return u.endIndex=r,u.elementIndex=h,u.isRelative=!0,u.success=!0,u;e=n.charAt(f),e==="["&&(r++,f++,u.isRelative=!0);if(r>=s)return u;c=!1,e=n.charAt(f),u.isRelative&&e==="-"&&(r++,f++,c=!0);if(r>=s)return u;e=n.charAt(f);if(kr(e)){while(f<s&&kr(e))f++,f<s&&(e=n.charAt(f));o=parseInt(n.substr(r,f-r),10);if(u.isRelative){if(f>=s||n.charAt(f)!=="]")return u;f++}if(o<(u.isRow?v.maxRowCount:v.maxColumnCount))return u.isRelative?(o=c?-o:o,u.elementIndex=o+h):u.elementIndex=o-1,u.endIndex=f,u.success=!0,u}else return u.isRelative?u:(u.endIndex=r,u.elementIndex=h,u.isRelative=!0,u.success=!0,u)},_validateWorkbook:function(n,t){var r,u;if(n===i||n===null||n==="")return!0;for(u=0;u<n.length;u++){r=n[u];if(t){if(r==="*"||r===":"||r==="["||r==="]"||r==="?")return!1;if(r==="'")if(u===0||u>=n.length-1||n.charAt(u+1)!=="'")return!1}else if(r==="'"||r==="["||r==="]"||r==="?"||r==="%"||this._operatorInfix.indexOf(r)!==-1)return!1}return!0},_validateSheetName:function(n,t,r){var e,u,f;if(n===i||n===null||n==="")return!0;if(!r&&gf(n.charAt(0)))return!1;e=this._isStartWithCellReference(n,t);if(!r&&e.success&&e.endIndex===n.length)return!1;for(f=0;f<n.length;f++){u=n.charAt(f);if(r){if(u==="*"||u===":"||u==="["||u==="]"||u==="?"||u==="\\"||u==="/")return!1}else if(u==="'"||u==="["||u==="]"||u==="?"||u==="\\"||u==="%"||u==='"'||this._operatorInfix.indexOf(u)!==-1)return!1}return!0},_createStructExpression:function(n){return n.charAt(n.length-1)==="]"?new dr(n):null},_validateName:function(n){var t,r;if(n===i||n===null||n==="")return!1;if(n.length===1&&(n==="R"||n==="r"||n==="C"||n==="c"))return!1;t=n.charAt(0);if(!(t==="_"||t==="\\"||vu(t)||oo(t)))return!1;for(r=1;r<n.length;r++){t=n.charAt(r);if(!(t==="_"||t==="\\"||t==="?"||t==="."||wf(t)||oo(t)))return!1}return!0}},e.Parser=v,nu.prototype={getValue:function(n,t,i){return n?n.getValue(t,i):l},getReference:function(n,t,i,r,u){return n?n.getReference(t,i,r,u):l},getFunction:function(n){return this.source&&this.source.getFunction?this.source.getFunction(n):null},getName:function(n){return this.source&&this.source.getName?this.source.getName(n,this.row,this.column):null},_expandArrayToMultiCallCount:0,_isExpandArrayToMultiCall:function(){return this._expandArrayToMultiCallCount>0},_beginExpandArrayToMultiCall:function(){this._expandArrayToMultiCallCount++},_endExpandArrayToMultiCall:function(){this._expandArrayToMultiCallCount--},_offset:function(n,t){return new nu(this.source,this.arrayFormulaMode,this.row+n,this.column+t,this.rowCount,this.columnCount)}},e.EvaluateContext=nu,wo=new v,ie.prototype={evaluateFormula:function(n,t,i){return this.evaluateExpression(wo.parse(n,t),i)},evaluateExpression:function(n,t){return this._evaluate(n,t,!1,!1)},_evaluate:function(n,t,i,r){if(!n)throw"Argument expr is null";while(n instanceof ft)n=n.argument;if(n instanceof gt)return this._evaluateConst(n,t,i);else if(n instanceof ii)return this._evaluateReference(n,t,r);else if(n instanceof ei){var f,u=null;return(f=n.source.getCalcService())&&(u=f._getEvaluatorContext4Cell(n.source._sheet,t.row,t.column,t.arrayFormulaMode)),u?this._evaluateName(n.name,u,t,i,r):gi}else if(n instanceof dt)return this._evaluateName(n.name,t,t,i,r);else if(n instanceof rt)return this._evaluateUnaryOperation(n,t,i);else if(n instanceof nt)return this._evaluateBinaryOperation(n,t,i);else if(n instanceof it)return this._evaluateFunction(n,t,i,r);throw cr;},_extractValueFromReference:function(n,t,i){var r,u,e,f;if(n instanceof vt&&n.getSheetCount()!==1)return l;r=n.getRowCount(0),u=n.getColumnCount(0);if(n.getRangeCount()<=0||r<=0||u<=0)return l;try{if(n.getRangeCount()!==1||r>1&&u>1)return ut;return e=t-n.getRow(0),f=i-n.getColumn(0),r===1&&u===1?n.getValue(0,0,0):r===1&&u===1&&f>=0&&f<u?n.getValue(0,0,f):r>1&&u===1&&r>=0&&e<r?n.getValue(0,e,0):ut}catch(o){return ut}},_evaluateConst:function(n,t,i){var r=n.value;return r instanceof g?i||t&&(t.arrayFormulaMode||t._isExpandArrayToMultiCall())?r:st.getArrayValue(r,0,0):r},_evaluateReference:function(n,t,i){var o,u,f,e,s;if(!t)return ut;if(n instanceof dr)return l;o=t.source,n instanceof yt&&(o=n.source);var c=t.row,h=t.column,r=n.getRange(c,h);if(i||t.arrayFormulaMode)return t.getReference(o,r.row,r.column,r.rowCount,r.columnCount);u=r.row,f=r.column;if(r.rowCount>1&&n.startRowRelative&&n.endRowRelative||r.columnCount>1&&n.startColumnRelative&&n.endColumnRelative){e=t.row>=r.row&&t.row<r.row+r.rowCount,s=t.column>=r.column&&t.column<r.column+r.columnCount;if(e||s)if(e&&!s&&r.columnCount===1)u=t.row;else if(!e&&s&&r.rowCount===1)f=t.column;else if(r.rowCount===1||r.columnCount===1)u=t.row,f=t.column;else return l;else return l}else if(r.row===-1&&r.rowCount===-1){if(r.columnCount!==1)return l;u=t.row}else if(r.column===-1&&r.columnCount===-1){if(r.rowCount!==1)return l;f=t.column}return t.getValue(o,u,f)},_evaluateName:function(n,t,i,r,u){if(!t||!i)return gi;var f=t.getName(n);return f?this._evaluate(f,i,r,u):gi},_evaluateOperationArg:function(n,t,i,r){var u=this._evaluate(n,t,i,r);return u instanceof w?u:u===e.missingArgument?cf:u},_evaluateUnaryOperation:function(n,t,i){var r=this._evaluateOperationArg(n.operand,t,i,!1);try{return n.operator.evaluate(r,t)}catch(u){return ut}},_evaluateBinaryOperation:function(n,t,i){var u=this._evaluateOperationArg(n.left,t,i,n.operator.acceptsReference),r;if(u instanceof w)return u;r=this._evaluateOperationArg(n.right,t,i,n.operator.acceptsReference);if(r instanceof w)return r;try{return n.operator.evaluate(u,r,t)}catch(f){return ut}},_evaluateFunction:function(n,t,r,u){var o=this._prepareFunctionArguments(n,t),e,d,rt,ut,h,s,p,y,tt,l,k,b,nt;if(!o||!o.success||!o.fn||!o.args)return o.error;var w=n.argCount(),a=o.args,it=o.fn;if(t&&t.arrayFormulaMode)return w>0?this._evaluateFunctionWithArrayFormulaMode(it,a,t,r,u):this._evaluateFunctionImp(it,a,t,r,u,0,0);e=o.arrayIndex;if(t&&t._isExpandArrayToMultiCall()&&e&&e.length>0){for(var c=[],v=[],ft=!0,f=0;f<w;f++)e.contains(f)?(d=a[f],d instanceof g?d.length()===1?(c[f]=d.getValueByIndex(0),v[f]=!0):(c[f]=d,v[f]=!1):(c[f]=null,v[f]=!0)):v[f]=!0;if(!ft){for(rt=[],ut=[],f=0;f<w;f++)v[f]?(rt[f]=-1,ut[f]=-1):(rt[f]=c[f].getRowCount(),ut[f]=c[f].getColumnCount());for(h=-1,s=-1,f=0;f<w;f++)v[f]||(p=rt[f],y=ut[f],h=h===-1?p:p>1?h>1?Math.min(p,h):p:h,s=s===-1?y:y>1?s>1?Math.min(y,s):y:s);for(tt=[],l=0;l<h;l++)for(k=tt[l],(k===i||k===null)&&(tt[l]=k=[]),b=0;b<s;b++){for(nt=[],f=0;f<w;f++)nt[f]=a[f];for(f=0;f<e.length;f++)nt[e[f]]=c[e[f]];k[b]=this._evaluateFunctionImp(it,nt,t,r,u,l,b)}return new pt(tt,h,s)}for(f=0;f<e.length;f++)a[e[f]]=c[e[f]]}return this._evaluateFunctionImp(it,a,t,r,u,0,0)},_tryGetFunction:function(n,t){var r=n.argCount(),i=n.fn;if(!(i instanceof tt.Function)){if(!t)return{success:!1,error:gi};i=t.getFunction(i);if(!i||!(i instanceof tt.Function))return{success:!1,error:gi};if(r<i.minArgs||i.maxArgs<r)return{success:!1,error:ut}}return{success:!0,fn:i}},_evaluateFunctionWithArrayFormulaMode:function(n,t,i,r,u){return!t||t.length===0?this._evaluateFunctionImp(n,t,i,r,u,0,0):n.maxArgs===1?this._evaluateFunctionOneArg(n,t[0],i,r,u):this._evaluateFunctionTwoOrMoreArgs(n,t,i,r,u)},_evaluateFunctionTwoOrMoreArgs:function(n,t,r,u,f){for(var w=t.length,a=[],tt=!0,b,k,nt,rt,it,ut,s,o,l,v,p,y,c,d,h,e=0;e<w;e++)k=n.acceptsReference&&n.acceptsReference(e),nt=st.tryExtractToSingleValue(t[e]),b=k||nt.success,tt=tt&&b,a[e]=b,k||(t[e]=nt.value);if(tt)return this._evaluateFunctionImp(n,t,r,u,f,0,0);for(rt=[],it=[],e=0;e<w;e++)ut=t[e]instanceof g,rt[e]=a||!ut?-1:t[e].getRowCount(),it[e]=a||!b?-1:t[e].getColumnCount();for(s=-1,o=-1,e=0;e<w;e++)a[e]||(l=rt[e],v=it[e],s=s===-1?l:l>1?s>1?Math.min(l,s):l:s,o=o===-1?v:v>1?o>1?Math.min(v,o):v:o);for(p=[],r._beginExpandArrayToMultiCall(),e=0;e<s;e++)for(y=p[e],(y===i||y===null)&&(p[e]=y=[]),c=0;c<o;c++){for(d=[],h=0;h<w;h++)d[h]=a[h]?t[h]:st.getArrayValue(t[h],e,c);y[c]=this._evaluateFunctionImp(n,d,r,u,f,e,c)}return r._endExpandArrayToMultiCall(),new pt(p,s,o)},_evaluateFunctionOneArg:function(n,t,r,u,f){var h,o,s,e;if(n.acceptsReference(0))return this._evaluateFunctionImp(n,[t],r,u,f,0,0);h=st.tryExtractToSingleValue(t);if(h.success)return this._evaluateFunctionImp(n,[h.value],r,u,f,0,0);var c=h.value,l=[],v=c.getRowCount(),a=c.getColumnCount();for(o=0;o<v;o++)for(s=l[o],(s===i||s===null)&&(l[o]=s=[]),e=0;e<a;e++)s[e]=this._evaluateFunctionImp(n,[c.getValue(o,e)],r,u,f,e,e);return new pt(l,v,a)},_evaluateFunctionImp:function(n,t,i,r,u,e,o){try{var h=e!==0&&o!==0?i?i._offset(e,o):null:i,s=n.isContextSensitive()?n.evaluate(t,h):n.evaluate(t);return s instanceof ct?h&&(h.arrayFormulaMode?i._isExpandArrayToMultiCall()&&(s=st.getArrayValue(f._toArray(s),e,o)):u||(s=this._extractValueFromReference(s,h.row,h.column))):s instanceof g&&(i?i.arrayFormulaMode?i._isExpandArrayToMultiCall()&&(s=st.getArrayValue(s,e,o)):!r&&i._isExpandArrayToMultiCall()&&(s=st.getArrayValue(s,e,o)):s=st.getArrayValue(s,e,o)),s}catch(c){return ut}},_prepareFunctionArguments:function(n,t){var b=this._tryGetFunction(n,t),a,v,y,o;if(!b.success)return b;var u=b.fn,h=[],k=n.argCount(),l=[],r,i,s;if(u.isBranch()){r=u.findTestArgument();if(r>=0&&r<k){s=this._evaluateFunctionArgument(n.getArg(r),t,u.acceptsArray(r),u.acceptsReference(r),u.acceptsError(r),u.acceptsMissingArgument(r)),i=s.value;if(!s.success)return{success:!1,error:i};if(t&&!t.arrayFormulaMode)if(i instanceof ct){i=this._extractValueFromReference(i,t.row,t.column);if(!u.acceptsError(r)&&i instanceof w)return{success:!1,error:i};u.acceptsMissingArgument(r)||i!==e.missingArgument||(i=null)}else if(i instanceof g&&!u.acceptsArray(r))if(t._isExpandArrayToMultiCall())h.push(r);else{i=st.getArrayValue(i,0,0);if(!u.acceptsError(r)&&i instanceof w)return{success:!1,error:i};u.acceptsMissingArgument(r)||i!==e.missingArgument||(i=null)}l[r]=i}var c=[],p=f._toArray(l[r]),nt=p.getRowCount(),d=p.getColumnCount();for(a=0;a<nt;a++)for(v=0;v<d;v++){y=u.findBranchArgument(p.getValue(a,v));if(y===-1)continue;c.contains(y)||c.push(y);if(c.length>=u.maxArgs-1)break}if(c.length===0)return{success:!1,error:ut};for(r=0;r<c.length;r++){o=c[r];if(o>=0&&o<k){s=this._evaluateFunctionArgument(n.getArg(o),t,u.acceptsArray(o),u.acceptsReference(o),u.acceptsError(o),u.acceptsMissingArgument(o)),i=s.value;if(!s.success)return{success:!1,error:i};if(t&&t.arrayFormulaMode)if(i instanceof g&&!u.acceptsArray(o))if(t._isExpandArrayToMultiCall())h.push(o);else{i=st.getArrayValue(i,0,0);if(!u.acceptsError(o)&&i instanceof w)return{success:!1,error:i};u.acceptsMissingArgument(o)||i!==e.missingArgument||(i=null)}l[o]=i}}h.length>0&&h.sort(function(n,t){return n-t})}else for(r=0;r<k;r++){s=this._evaluateFunctionArgument(n.getArg(r),t,u.acceptsArray(r),u.acceptsReference(r),u.acceptsError(r),u.acceptsMissingArgument(r)),i=s.value;if(!s.success)return{success:!1,error:i};if(t&&t.arrayFormulaMode)if(i instanceof g&&!u.acceptsArray(r))if(t._isExpandArrayToMultiCall())h.push(r);else{i=st.getArrayValue(i,0,0);if(!u.acceptsError(r)&&i instanceof w)return{success:!1,error:i};u.acceptsMissingArgument(r)||i!==e.missingArgument||(i=null)}l[r]=i}return{success:!0,args:l,fn:u,arrayIndex:h}},_evaluateFunctionArgumentImp:function(n,t,r,u,f,o){var s=this._evaluate(n,t,r,u);if(!f&&s instanceof w)return{success:!1,value:s};if(!o&&s===e.missingArgument)return{success:!0,value:null};if(t&&t.arrayFormulaMode){if(s instanceof g&&!r&&!t._isExpandArrayToMultiCall())return s.length()>0?{success:!0,value:s.getValueByIndex(0)}:{success:!1,value:cf};if(s instanceof ct&&!u){s=this._extractValueFromReference(s,0,0),(s===i||s===null)&&(s=0);if(!f&&s instanceof w)return{success:!1,value:s};if(!o&&s===e.missingArgument)return{success:!0,value:null}}}return{success:!0,value:s}},_evaluateFunctionArgument:function(n,t,i,r,u,f){if(t&&(i||t._isExpandArrayToMultiCall())&&!t.arrayFormulaMode){t._beginExpandArrayToMultiCall();var e=this._evaluateFunctionArgumentImp(n,t,i,r,u,f);return t._endExpandArrayToMultiCall(),e}return this._evaluateFunctionArgumentImp(n,t,i,r,u,f)}},e.Evaluator=ie,hu="intersects",cu="contains";var ui="cellListeners",oi="rowListeners",ri="columnListeners",uf="rowSliceListeners",lf="columnSliceListeners",we="addToAdjust",rf="addToDirty",pe="incrementDelay",be="decrementDelay";ar.prototype={hasListeners:function(){return os(this,this._listeners)},addCellListener:function(n){ai(this,ui,n)},removeCellListener:function(n){vi(this,ui,n)},addRowListener:function(n){ai(this,oi,n)},removeRowListener:function(n){vi(this,oi,n)},addColumnListener:function(n){ai(this,ri,n)},removeColumnListener:function(n){vi(this,ri,n)},addListenersToAdjust:function(){yr(this,this._listeners,we)},addListenersToDirty:function(){yr(this,this._listeners,rf)},incrementDelayOfListeners:function(){yr(this,this._listeners,pe)},decrementDelayOfListeners:function(){yr(this,this._listeners,be)}},ci.prototype=new ar,ci.prototype.incrementDelay=function(){this.delay+=1},ci.prototype.decrementDelay=function(){this.delay-=1},ci.prototype.startListening=function(){this.sheetSource.linkCellExpression(this.row,this.column,1,1)},ci.prototype.stopListening=function(){this.sheetSource.unlinkCellExpression(this.row,this.column,1,1)},ci.prototype.addToAdjust=function(){this.sheetSource._controller.addAdjustCell(this)},ci.prototype.addToDirty=function(){this.sheetSource._controller.addDirtyCell(this)},lt.prototype=new ar,lt.prototype.incrementDelay=function(){this.sheetSource.incrementDelay(this.row,-1,1,-1)},lt.prototype.incrementDelay2=function(n,t){this.sheetSource.incrementDelay(this.row,n,1,t)},lt.prototype.decrementDelay=function(){this.sheetSource.decrementDelay(this.row,-1,1,-1)},lt.prototype.decrementDelay2=function(n,t){this.sheetSource.decrementDelay(this.row,n,1,t)},lt.prototype.startListening=function(){this.sheetSource.linkRowExpression(this.row,1)},lt.prototype.stopListening=function(){this.sheetSource.unlinkRowExpression(this.row,1)},lt.prototype.addRowListener2=function(n,t){ai(this,uf,{row:n,columnOffset:t,columnCount:1})},lt.prototype.removeRowListenser2=function(n,t){vi(this,uf,{row:n,columnOffset:t,columnCount:1})},lt.prototype.addToAdjust=function(){this.sheetSource._controller.addAdjustRow(this)},lt.prototype.addToDirty=function(){this.sheetSource._controller.addDirtyRow(this)},at.prototype=new ar,at.prototype.incrementDelay=function(){this.sheetSource.incrementDelay(-1,this.column,-1,1)},at.prototype.incrementDelay2=function(n,t){this.sheetSource.incrementDelay(n,this.column,t,1)},at.prototype.decrementDelay=function(){this.sheetSource.decrementDelay(-1,this.column,-1,1)},at.prototype.decrementDelay2=function(n,t){this.sheetSource.decrementDelay(n,this.column,t,1)},at.prototype.startListening=function(){this.sheetSource.linkColumnExpression(this.column,1)},at.prototype.stopListening=function(){this.sheetSource.unlinkColumnExpression(this.column,1)},at.prototype.addColumnListener2=function(n,t){ai(this,lf,{column:n,rowOffset:t,rowCount:1})},at.prototype.removeColumnListenser2=function(n,t){vi(this,lf,{column:n,rowOffset:t,rowCount:1})},at.prototype.addToAdjust=function(){this.sheetSource._controller.addAdjustColumn(this)},at.prototype.addToDirty=function(){this.sheetSource._controller.addDirtyColumn(this)},yi.prototype=new ar,yi.prototype.incrementDelay=function(){this.delay+=1},yi.prototype.decrementDelay=function(){this.delay-=1},yi.prototype.updateListening=function(n,i){var r=this;t(this._listeners).each(function(u,f){r[f]&&t(r[f]).each(function(t,r){n&&r.stopListening(),i&&r.startListening()})})},yi.prototype.addToDirty=function(){yr(this,this._listeners,rf)};var ke="cell",ye="row",ce="column";he.prototype={addCellListener:function(n,t,i,r,u){ai(this,ui,{type:ke,row:n,column:t,rowCount:i,columnCount:r,listener:u})},removeCellListener:function(n,t,i,r,u){vi(this,ui,{type:ke,row:n,column:t,rowCount:i,columnCount:r,listener:u})},addRowListener:function(n,t,i,r,u,f,e,o){ai(this,oi,{type:ye,row:n,column:t,rowCount:i,columnCount:r,listener:u})},removeRowListener:function(n,t,i,r,u,f,e,o){vi(this,oi,{type:ye,row:n,column:t,rowCount:i,columnCount:r,listener:u})},addColumnListener:function(n,t,i,r,u,f,e,o){ai(this,ri,{type:ce,row:n,column:t,rowCount:i,columnCount:r,listener:u})},removeColumnListener:function(n,t,i,r,u,f,e,o){vi(this,ri,{type:ce,row:n,column:t,rowCount:i,columnCount:r,listener:u})},addListenersToAdjust:function(n,t,i,r){fu(this,this._listeners,{action:hu,row:n,column:t,rowCount:i,columnCount:r},we)},addListenersToDirty:function(n,t,i,r){fu(this,this._listeners,{action:hu,row:n,column:t,rowCount:i,columnCount:r},rf)},incrementDelayOfListeners:function(n,t){fu(this,this._listeners,{action:cu,row:n,column:t},pe)},decrementDelayOfListeners:function(n,t){fu(this,this._listeners,{action:cu,row:n,column:t},be)}},df.prototype={getRowOffset:function(){return this._toRow-this._fromRow},getColumnOffset:function(){return this._toColumn-this._fromColumn},sourceContains:function(n,t,i,r,u){return this._fromModel===n&&(this._fromRow===-1||this._fromRow<=t&&t+r<=this._fromRow+this._rowCount)&&(this._fromColumn===-1||this._fromColumn<=i&&i+u<=this._fromColumn+this._columnCount)},destinationContains:function(n,t,i,r,u){return this._toModel===n&&(this._toRow===-1||this._toRow<=t&&t+r<=this._toRow+this._rowCount)&&(this._toColumn===-1||this._toColumn<=i&&i+u<=this._toColumn+this._columnCount)},sourceIntersectWith:function(n,t,i,r,u){if(this._toModel!==n)return null;var e=this._createValidCellRange(n,t,i,r,u),f=this._createValidCellRange(n,this._fromRow,this._fromColumn,r,u);return f.intersectWith(e)},_createValidCellRange:function(n,t,i,r,u){var o=t===-1?0:t,s=t===-1||r===-1?n.rowCount:r,f=i===-1?0:i,e=i===-1||u===-1?n.columnCount:u;return{row:o,column:f,rowCount:s,columnCount:e,intersectWith:le}}},ru.prototype={autoCalculation:!0,iteration:!1,maximumIterations:1,maximumChange:.01,attachDataModel:function(n){this._dataModels.contains(n)||this._dataModels.push(n)},detachDataModel:function(n){for(var o=null,f,t,e,r,u,i=this._headDirtyCells;i;i=o)o=i.nextDirty,i.sheetSource===n&&this.removeDirtyCell(i);for(f=null,t=this._headDirtyRows;t;t=f)f=t.nextDirty,t.sheetSource===n&&this.removeDirtyRow(t);for(e=null,r=this._headDirtyColumns;r;r=e)e=r.nextDirty,r.sheetSource===n&&this.removeDirtyColumn(r);for(u=0;u<this._dataModels.length;u++)if(this._dataModels[u]===n){this._dataModels.splice(u,1);break}},addCustomFunctions:function(n){var t,r;if(n===i||n===null||n.length<=0)return;for(t=0;t<n.length;t++)r=n[t],this._customFunctions.push(r)},addCustomNames:function(n){var t,r;if(n===i||n===null||n.length<=0)return;for(t=0;t<n.length;t++)r=n[t],this._customNames.push(r)},isDirtyCell:function(n){return n.previousDirty||n===this._headDirtyCells},addDirtyCell:function(n){n&&!this.isDirtyCell(n)&&n.row<n.sheetSource.getRowCount()&&n.column<n.sheetSource.getColumnCount()&&(this._headDirtyCells?this._tailDirtyCells.nextDirty=n:this._headDirtyCells=n,n.previousDirty=this._tailDirtyCells,n.nextDirty=null,this._tailDirtyCells=n)},removeDirtyCell:function(n){if(this.isDirtyCell(n)){var i=n.previousDirty,t=n.nextDirty;i?i.nextDirty=t:this._headDirtyCells=t,t?t.previousDirty=i:this._tailDirtyCells=i,n.previousDirty=null,n.nextDirty=null}},isDirtyRow:function(n){return n.previousDirty||n===this._headDirtyRows},addDirtyRow:function(n){n&&!this.isDirtyRow(n)&&n.row<n.sheetSource.getRowCount()&&(this._headDirtyRows?this._tailDirtyRows.nextDirty=n:this._headDirtyRows=n,n.previousDirty=this._tailDirtyRows,n.nextDirty=null,this._tailDirtyRows=n)},removeDirtyRow:function(n){if(this.isDirtyRow(n)){var i=n.previousDirty,t=n.nextDirty;i?i.nextDirty=t:this._headDirtyRows=t,t?t.previousDirty=i:this._tailDirtyRows=i,n.previousDirty=null,n.nextDirty=null}},isDirtyColumn:function(n){return n.previousDirty||n===this._headDirtyColumns},addDirtyColumn:function(n){n&&!this.isDirtyColumn(n)&&n.column<n.sheetSource.getColumnCount()&&(this._headDirtyColumns?this._tailDirtyColumns.nextDirty=n:this._headDirtyColumns=n,n.previousDirty=this._tailDirtyColumns,n.nextDirty=null,this._tailDirtyColumns=n)},removeDirtyColumn:function(n){if(this.isDirtyColumn(n)){var i=n.previousDirty,t=n.nextDirty;i?i.nextDirty=t:this._headDirtyColumns=t,t?t.previousDirty=i:this._tailDirtyColumns=i,n.previousDirty=null,n.nextDirty=null}},isVolatileCell:function(n){return n.previousVolatile||n===this._headVolatileCells},addVolatileCell:function(n){n&&!this.isVolatileCell(n)&&n.row<n.sheetSource.getRowCount()&&n.column<n.sheetSource.getColumnCount()&&(this._headVolatileCells?this._tailVolatileCells.nextDirty=n:this._headVolatileCells=n,n.previousDirty=this._tailVolatileCells,n.nextDirty=null,this._tailVolatileCells=n)},removeVolatileCell:function(n){if(this.isVolatileCell(n)){var i=n.previousDirty,t=n.nextDirty;i?i.nextDirty=t:this._headVolatileCells=t,t?t.previousDirty=i:this._tailVolatileCells=i,n.previousDirty=null,n.nextDirty=null}},isAdjustCell:function(n){return n.previousAdjust||n===this._headAdjustCells},addAdjustCell:function(n){n&&!this.isAdjustCell(n)&&n.row<n.sheetSource.getRowCount()&&n.column<n.sheetSource.getColumnCount()&&(this._headAdjustCells?this._tailAdjustCells.nextAdjust=n:this._headAdjustCells=n,n.previousAdjust=this._tailAdjustCells,n.nextAdjust=null,this._tailAdjustCells=n)},removeAdjustCell:function(n){if(this.isAdjustCell(n)){var i=n.previousAdjust,t=n.nextAdjust;i?i.nextAdjust=t:this._headAdjustCells=t,t?t.previousAdjust=i:this._tailAdjustCells=i,n.previousAdjust=null,n.nextAdjust=null}},isAdjustRow:function(n){return n.previousAdjust||n===this._headAdjustRows},addAdjustRow:function(n){n&&!this.isAdjustRow(n)&&n.row<n.sheetSource.getRowCount()&&(this._headAdjustRows?this._tailAdjustRows.nextAdjust=n:this._headAdjustRows=n,n.previousAdjust=this._tailAdjustRows,n.nextAdjust=null,this._tailAdjustRows=n)},removeAdjustRow:function(n){if(this.isAdjustRow(n)){var i=n.previousAdjust,t=n.nextAdjust;i?i.nextAdjust=t:this._headAdjustRows=t,t?t.previousAdjust=i:this._tailAdjustRows=i,n.previousAdjust=null,n.nextAdjust=null}},isAdjustColumn:function(n){return n.previousAdjust||n===this._headAdjustColumns},addAdjustColumn:function(n){n&&!this.isAdjustColumn(n)&&n.column<n.sheetSource.getColumnCount()&&(this._headAdjustColumns?this._tailAdjustColumns.nextAdjust=n:this._headAdjustColumns=n,n.previousAdjust=this._tailAdjustColumns,n.nextAdjust=null,this._tailAdjustColumns=n)},removeAdjustColumn:function(n){if(this.isAdjustColumn(n)){var i=n.previousAdjust,t=n.nextAdjust;i?i.nextAdjust=t:this._headAdjustColumns=t,t?t.previousAdjust=i:this._tailAdjustColumns=i,n.previousAdjust=null,n.nextAdjust=null}},recalculate:function(){var c=null,p=!1,t,r,i,h,l,v,a,n,u,e,f,s,y,o,b,w;while(this._headVolatileCells)this.addDirtyCell(this._headVolatileCells),this.removeVolatileCell(this._headVolatileCells);while(this._headDirtyRows){for(t=this._headDirtyRows.sheetSource,a=t.getColumnCount(),i=0;i<a;i++)this.addDirtyCell(t._getCellCalc(this._headDirtyRows.row,i,!0));this.removeDirtyRow(this._headDirtyRows)}while(this._headDirtyColumns){for(t=this._headDirtyColumns.sheetSource,v=t.getRowCount(),r=0;r<v;r++)this.addDirtyCell(t._getCellCalc(r,this._headDirtyColumns.column,!0));this.removeDirtyColumn(this._headDirtyColumns)}for(n=this._headDirtyCells;n;n=n.nextDirty){t=n.sheetSource,h=n.row,l=n.column,u=t._getRowCalc(h,!1),e=t._getColumnCalc(l,!1),f=t._getRangeCalc(!1),n.addListenersToDirty(),u&&u.addListenersToDirty(l),e&&e.addListenersToDirty(h),f&&f.addListenersToDirty(h,l,1,1);while(this._headDirtyRows){for(t=this._headDirtyRows.sheetSource,a=t.getColumnCount(),i=0;i<a;i++)this.addDirtyCell(t._getCellCalc(this._headDirtyRows.row,i,!0));this.removeDirtyRow(this._headDirtyRows)}while(this._headDirtyColumns){for(t=this._headDirtyColumns.sheetSource,v=t.getRowCount(),r=0;r<v;r++)this.addDirtyCell(t._getCellCalc(r,this._headDirtyColumns.column,!0));this.removeDirtyColumn(this._headDirtyColumns)}}for(n=this._headDirtyCells;n;n=c)t=n.sheetSource,c=n.nextDirty,n.row<t.getRowCount()&&n.column<t.getColumnCount()?n.delay=0:this.removeDirtyCell(n);for(n=this._headDirtyCells;n;n=n.nextDirty)t=n.sheetSource,r=n.row,i=n.column,u=t._getRowCalc(r,!1),e=t._getColumnCalc(i,!1),f=t._getRangeCalc(!1),n.incrementDelayOfListeners(),u&&u.incrementDelayOfListeners(i),e&&e.incrementDelayOfListeners(r),f&&f.incrementDelayOfListeners(r,i);do for(p=!1,n=this._headDirtyCells;n;n=c)c=n.nextDirty,n.delay===0&&(t=n.sheetSource,r=n.row,i=n.column,u=t._getRowCalc(r,!1),e=t._getColumnCalc(i,!1),f=t._getRangeCalc(!1),t.recalculateCell(r,i),this.removeDirtyCell(n),n.decrementDelayOfListeners(),u&&u.decrementDelayOfListeners(i),e&&e.decrementDelayOfListeners(r),f&&f.decrementDelayOfListeners(r,i),p=!0);while(p);if(this.iteration&&this._headDirtyCells)for(s=!0,y=0;s&&y<this.maximumIterations;y++)for(s=!1,n=this._headDirtyCells;n;n=n.nextDirty)o=n.sheetSource,r=n.row,i=n.column,b=o.getValue(r,i),o.recalculateCell(r,i),w=o.getValue(r,i),this._iterationChange(b,w)<this.maximumChange||(s=!0)},_iterationChange:function(n,t){var r=parseFloat(n),i=parseFloat(t);return Math.abs(i-r)},clearDirties:function(){this._headAdjustCells=null,this._tailAdjustCells=null,this._headAdjustRows=null,this._tailAdjustRows=null,this._headAdjustColumns=null,this._tailAdjustColumns=null,this._headDirtyCells=null,this._tailDirtyCells=null,this._headDirtyRows=null,this._tailDirtyRows=null,this._headDirtyColumns=null,this._tailDirtyColumns=null,this._headVolatileCells=null,this._tailVolatileCells=null},_adjustIndexOnAdd:function(n,t,i,r,u,f,e,o){if(i>=0||!u){var s=r+(u?i:0);return f===n&&(e+o>i||(s-=u?o:0)),f===t&&(e>s||(s+=o)),s-=u?i:0}return r},_adjustCellExpressionOnAddRow:function(n,t,i,r,u,f,e,o){var h,s;if(t){h=u.rowRelative;if(i>=0||!h){s=this._adjustIndexOnAdd(n,t,i,u.row,u.rowRelative,f,e,o);if(s!==u.row)return n===t?new p(s,u.column,h,u.columnRelative):new d(t,s,u.column,h,u.columnRelative)}}return u},_adjustRangeExpressionOnAddRow:function(n,t,i,r,u,f,e,s){var w,a,l,p,v,y;if(t){w=u._getRangeType();if(w===c.sheet||w===c.column)return u;a=u.startRowRelative,l=u.endRowRelative;if(i>=0||!a||!l)return p=this._adjustIndexOnAdd(n,t,i,u.startRow,a,f,e,s),v=this._adjustIndexOnAdd(n,t,i,u.endRow,l,f,e,s),w===c.row?(n===t?(y=new o,y.initBand(p,v,a,l,!0)):(y=new h,y.initBand(t,p,v,a,l,!0)),y):n===t?new o(p,u.startColumn,v,u.endColumn,a,u.startColumnRelative,l,u.endColumnRelative):new h(t,p,u.startColumn,v,u.endColumn,a,u.startColumnRelative,l,u.endColumnRelative)}return u},_adjustCellExpressionOnAddColumn:function(n,t,i,r,u,f,e,o){var h,s;if(t){h=u.columnRelative;if(r>=0||!h){s=this._adjustIndexOnAdd(n,t,r,u.column,u.columnRelative,f,e,o);if(s!==u.column)return n===t?new p(u.row,s,u.rowRelative,h):new d(t,u.row,s,u.rowRelative,h)}}return u},_adjustRangeExpressionOnAddColumn:function(n,t,i,r,u,f,e,s){var w,a,l,p,v,y;if(t){w=u._getRangeType();if(w===c.sheet||w===c.row)return u;a=u.startColumnRelative,l=u.endColumnRelative;if(r>=0||!a||!l)return p=this._adjustIndexOnAdd(n,t,r,u.startColumn,a,f,e,s),v=this._adjustIndexOnAdd(n,t,r,u.endColumn,l,f,e,s),w===c.column?(n===t?(y=new o,y.initBand(p,v,a,l,!1)):(y=new h,y.initBand(t,p,v,a,l,!1)),y):n===t?new o(u.startRow,p,u.endRow,v,u.startRowRelative,a,u.endRowRelative,l):new h(t,u.startRow,p,u.endRow,v,u.startRowRelative,a,u.endRowRelative,l)}return u},adjustFormulaOnAddRows:function(n,t,r,u,f,e,s){var a=u,l,k,b,v,y,c,w;if(u instanceof p)a=this._adjustCellExpressionOnAddRow(n,n,t,r,u,f,e,s);else if(u instanceof o)a=this._adjustRangeExpressionOnAddRow(n,n,t,r,u,f,e,s);else if(u instanceof d)a=this._adjustCellExpressionOnAddRow(n,u.source,t,r,u,f,e,s);else if(u instanceof h)a=this._adjustRangeExpressionOnAddRow(n,u.source,t,r,u,f,e,s);else if(u instanceof ft)l=this.adjustFormulaOnAddRows(n,t,r,u.argument,f,e,s),l!==u.argument&&(a=new ft(l));else if(u instanceof rt)l=this.adjustFormulaOnAddRows(n,t,r,u.operand,f,e,s),l!==u.operand&&(a=new rt(u.operator,l));else if(u instanceof nt)k=this.adjustFormulaOnAddRows(n,t,r,u.left,f,e,s),b=this.adjustFormulaOnAddRows(n,t,r,u.right,f,e,s),(k!==u.left||b!==u.right)&&(a=new nt(u.operator,k,b));else if(u instanceof it){for(v=null,w=u.argCount(),c=0;c<w;c++){y=u.getArg(c),l=this.adjustFormulaOnAddRows(n,t,r,y,f,e,s);if(l!==y){v=[],v[c]=l;break}}if(v){for(c=0;c<w;c++)y=u.getArg(c),(v[c]===i||v[c]===null)&&(v[c]=this.adjustFormulaOnAddRows(n,t,r,y,f,e,s));a=new it(u.fn,v)}}return a},adjustFormulasOnAddRows:function(n,t,i){for(var s,r,f,u,e,o=0;o<this._customNames.length;o++)s=this._customNames[o].value,s.expression=this.adjustFormulaOnAddRows(null,-1,-1,s.expression,n,t,i);while(this._headAdjustCells)r=this._headAdjustCells.sheetSource,f=this._headAdjustCells.row,u=this._headAdjustCells.column,e=r.getExpression(f,u),e?r.setExpression(f,u,this.adjustFormulaOnAddRows(r,f,u,e,n,t,i)):(r.getRowExpression&&r.getRowExpression(f)||r.getColumnExpression&&r.getColumnExpression(u))&&r._addCellsToDirty(f,u,1,1),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)r=this._headAdjustRows.sheetSource,f=this._headAdjustRows.row,r.getExpression&&(e=r.getRowExpression(f),e&&r.setRowExpression&&r.setRowExpression(f,this.adjustFormulaOnAddRows(r,f,-1,e,n,t,i))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)r=this._headAdjustColumns.sheetSource,u=this._headAdjustColumns.column,r.getColumnExpression&&(e=r.getColumnExpression(u),e&&r._setColumnExpression&&r._setColumnExpression(u,this.adjustFormulaOnAddRows(r,-1,u,e,n,t,i))),this.removeAdjustRow(this._headAdjustColumns)},adjustFormulaOnAddColumns:function(n,t,r,u,f,e,s){var a=u,l,k,b,v,y,c,w;if(u instanceof p)a=this._adjustCellExpressionOnAddColumn(n,n,t,r,u,f,e,s);else if(u instanceof o)a=this._adjustRangeExpressionOnAddColumn(n,n,t,r,u,f,e,s);else if(u instanceof d)a=this._adjustCellExpressionOnAddColumn(n,u.source,t,r,u,f,e,s);else if(u instanceof h)a=this._adjustRangeExpressionOnAddColumn(n,u.source,t,r,u,f,e,s);else if(u instanceof ft)l=this.adjustFormulaOnAddColumns(n,t,r,u.argument,f,e,s),l!==u.argument&&(a=new ft(l));else if(u instanceof rt)l=this.adjustFormulaOnAddColumns(n,t,r,u.operand,f,e,s),l!==u.operand&&(a=new rt(u.operator,l));else if(u instanceof nt)k=this.adjustFormulaOnAddColumns(n,t,r,u.left,f,e,s),b=this.adjustFormulaOnAddColumns(n,t,r,u.right,f,e,s),(k!==u.left||b!==u.right)&&(a=new nt(u.operator,k,b));else if(u instanceof it){for(v=null,w=u.argCount(),c=0;c<w;c++){y=u.getArg(c),l=this.adjustFormulaOnAddColumns(n,t,r,y,f,e,s);if(l!==y){v=[],v[c]=l;break}}if(v){for(c=0;c<w;c++)y=u.getArg(c),(v[c]===i||v[c]===null)&&(v[c]=this.adjustFormulaOnAddColumns(n,t,r,y,f,e,s));a=new it(u.fn,v)}}return a},adjustFormulasOnAddColumns:function(n,t,i){for(var s,r,f,u,e,o=0;o<this._customNames.length;o++)s=this._customNames[o].value,s.expression=this.adjustFormulaOnAddColumns(null,-1,-1,s.expression,n,t,i);while(this._headAdjustCells)r=this._headAdjustCells.sheetSource,f=this._headAdjustCells.row,u=this._headAdjustCells.column,e=r.getExpression(f,u),e?r.setExpression(f,u,this.adjustFormulaOnAddColumns(r,f,u,e,n,t,i)):(r.getRowExpression&&r.getRowExpression(f)||r.getColumnExpression&&r.getColumnExpression(u))&&r._addCellsToDirty(f,u,1,1),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)r=this._headAdjustRows.sheetSource,f=this._headAdjustRows.row,r.getRowExpression&&(e=r.getRowExpression(f),e&&r._setRowExpression&&r._setRowExpression(f,this.adjustFormulaOnAddColumns(r,f,-1,e,n,t,i))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)r=this._headAdjustColumns.sheetSource,u=this._headAdjustColumns.column,r.getColumnExpression&&(e=r.getColumnExpression(u),e&&r._setColumnExpression&&r._setColumnExpression(u,this.adjustFormulaOnAddColumns(r,-1,u,e,n,t,i))),this.removeAdjustColumn(this._headAdjustColumns)},_adjustIndexOnRemove:function(n,t,i,r,u,f,e,o){if(i>=0||!u){var s=r+(u?i:0);f===n&&(e>i||(s+=u?o:0));if(f===t)if(e+o>s){if(e<=s)return l}else s-=o;return s-=u?i:0}return r},_adjustCellExpressionOnRemoveRow:function(n,t,i,r,u,f,e,o){var h,s;if(t){h=u.rowRelative;if(i>=0||!h){s=this._adjustIndexOnRemove(n,t,i,u.row,u.rowRelative,f,e,o);if(s instanceof w)return new a(s);if(s!==u.row)return n===t?new p(s,u.column,h,u.columnRelative):new d(t,s,u.column,h,u.columnRelative)}}return u},_adjustRangeExpressionOnRemoveRow:function(n,t,i,r,u,f,e,s){var k,p,y,l,v,b;if(t){k=u._getRangeType();if(k===c.sheet||k===c.column)return u;p=u.startRowRelative,y=u.endRowRelative;if(i>=0||!p||!y){l=this._adjustIndexOnRemove(n,t,i,u.startRow,p,f,e,s);if(l instanceof w)return new a(l);return v=this._adjustIndexOnAdd(n,t,i,u.endRow,y,f,e,s),v instanceof w?new a(v):k===c.column?(n===t?(b=new o,b.initBand(l,v,p,y,!1)):(b=new h,b.initBand(t,l,v,p,y,!1)),b):n===t?new o(l,u.startColumn,v,u.endColumn,p,u.startColumnRelative,y,u.endColumnRelative):new h(t,l,u.startColumn,v,u.endColumn,p,u.startColumnRelative,y,u.endColumnRelative)}}return u},_adjustCellExpressionOnRemoveColumn:function(n,t,i,r,u,f,e,o){var h,s;if(t){h=u.columnRelative;if(r>=0||!h){s=this._adjustIndexOnRemove(n,t,r,u.column,u.columnRelative,f,e,o);if(s instanceof w)return new a(s);if(s!==u.column)return n===t?new p(u.row,s,u.rowRelative,h):new d(t,u.row,s,u.rowRelative,h)}}return u},_adjustRangeExpressionOnRemoveColumn:function(n,t,i,r,u,f,e,s){var k,p,y,l,v,b;if(t){k=u._getRangeType();if(k===c.sheet||k===c.row)return u;p=u.startColumnRelative,y=u.endColumnRelative;if(r>=0||!p||!y){l=this._adjustIndexOnRemove(n,t,r,u.startColumn,p,f,e,s);if(l instanceof w)return new a(l);return v=this._adjustIndexOnRemove(n,t,r,u.endColumn,y,f,e,s),v instanceof w?new a(v):k===c.column?(n===t?(b=new o,b.initBand(l,v,p,y,!1)):(b=new h,b.initBand(t,l,v,p,y,!1)),b):n===t?new o(u.startRow,l,u.endRow,v,u.startRowRelative,p,u.endRowRelative,y):new h(t,u.startRow,l,u.endRow,v,u.startRowRelative,p,u.endRowRelative,y)}}return u},adjustFormulaOnRemoveRows:function(n,t,r,u,f,e,s){var a=u,l,y,c,b,k,v,w;if(u instanceof p)a=this._adjustCellExpressionOnRemoveRow(n,n,t,r,u,f,e,s);else if(u instanceof o)a=this._adjustRangeExpressionOnRemoveRow(n,n,t,r,u,f,e,s);else if(u instanceof d)a=this._adjustCellExpressionOnRemoveRow(n,u.source,t,r,u,f,e,s);else if(u instanceof h)a=this._adjustRangeExpressionOnRemoveRow(n,u.source,t,r,u,f,e,s);else if(u instanceof ft)l=this.adjustFormulaOnRemoveRows(n,t,r,u.argument,f,e,s),l!==u.argument&&(a=new ft(l));else if(u instanceof rt)l=this.adjustFormulaOnRemoveRows(n,t,r,u.operand,f,e,s),l!==u.operand&&(a=new rt(u.operator,l));else if(u instanceof nt)b=this.adjustFormulaOnRemoveRows(n,t,r,u.left,f,e,s),k=this.adjustFormulaOnRemoveRows(n,t,r,u.right,f,e,s),(b!==u.left||k!==u.right)&&(a=new nt(u.operator,b,k));else if(u instanceof it){for(v=null,w=u.argCount(),c=0;c<w;c++){y=u.getArg(c),l=this.adjustFormulaOnRemoveRows(n,t,r,y,f,e,s);if(l!==y){v=[],v[c]=l;break}}if(v){for(c=0;c<w;c++)y=u.getArg(c),(v[c]===i||v[c]===null)&&(v[c]=this.adjustFormulaOnRemoveRows(n,t,r,y,f,e,s));a=new it(u.fn,v)}}return a},adjustFormulasOnRemoveRows:function(n,t,i){for(var s,r,f,u,e,o=0;o<this._customNames.length;o++)s=this._customNames[o].value,s.expression=this.adjustFormulaOnRemoveRows(null,-1,-1,s.expression,n,t,i);while(this._headAdjustCells)r=this._headAdjustCells.sheetSource,f=this._headAdjustCells.row,u=this._headAdjustCells.column,e=r.getExpression(f,u),e?r.setExpression(f,u,this.adjustFormulaOnRemoveRows(r,f,u,e,n,t,i)):(r.getRowExpression&&r.getRowExpression(f)||r.getColumnExpression&&r.getColumnExpression(u))&&r._addCellsToDirty(f,u,1,1),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)r=this._headAdjustRows.sheetSource,f=this._headAdjustRows.row,r.getRowExpression&&(e=r.getRowExpression(f),e&&r.setRowExpression&&r.setRowExpression(f,this.adjustFormulaOnRemoveRows(r,f,-1,e,n,t,i))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)r=this._headAdjustColumns.sheetSource,u=this._headAdjustColumns.column,r.getColumnExpression&&(e=r.getColumnExpression(u),e&&r.setColumnExpression&&r.setColumnExpression(u,this.adjustFormulaOnRemoveRows(r,-1,u,e,n,t,i))),this.removeAdjustRow(this._headAdjustColumns)},adjustFormulaOnRemoveColumns:function(n,t,r,u,f,e,s){var a=u,l,y,c,b,k,v,w;if(u instanceof p)a=this._adjustCellExpressionOnRemoveColumn(n,n,t,r,u,f,e,s);else if(u instanceof o)a=this._adjustRangeExpressionOnRemoveColumn(n,n,t,r,u,f,e,s);else if(u instanceof d)a=this._adjustCellExpressionOnRemoveColumn(n,u.source,t,r,u,f,e,s);else if(u instanceof h)a=this._adjustRangeExpressionOnRemoveColumn(n,u.source,t,r,u,f,e,s);else if(u instanceof ft)l=this.adjustFormulaOnRemoveColumns(n,t,r,u.argument,f,e,s),l!==u.argument&&(a=new ft(l));else if(u instanceof rt)l=this.adjustFormulaOnRemoveColumns(n,t,r,u.operand,f,e,s),l!==u.operand&&(a=new rt(u.operator,l));else if(u instanceof nt)b=this.adjustFormulaOnRemoveColumns(n,t,r,u.left,f,e,s),k=this.adjustFormulaOnRemoveColumns(n,t,r,u.right,f,e,s),(b!==u.left||k!==u.right)&&(a=new nt(u.operator,b,k));else if(u instanceof it){for(v=null,w=u.argCount(),c=0;c<w;c++){y=u.getArg(c),l=this.adjustFormulaOnRemoveColumns(n,t,r,y,f,e,s);if(l!==y){v=[],v[c]=l;break}}if(v){for(c=0;c<w;c++)y=u.getArg(c),(v[c]===i||v[c]===null)&&(v[c]=this.adjustFormulaOnRemoveColumns(n,t,r,y,f,e,s));a=new it(u.fn,v)}}return a},adjustFormulasOnRemoveColumns:function(n,t,i){for(var r,f,u,e,s,o=0;o<this._customNames.length;o++)s=this._customNames[o].value,s.expression=this.adjustFormulaOnRemoveColumns(null,-1,-1,s.expression,n,t,i);while(this._headAdjustCells)r=this._headAdjustCells.sheetSource,f=this._headAdjustCells.row,u=this._headAdjustCells.column,e=r.getExpression(f,u),e?r.setExpression(f,u,this.adjustFormulaOnRemoveColumns(r,f,u,e,n,t,i)):(r.getRowExpression&&r.getRowExpression(f)||r.getColumnExpression&&r.getColumnExpression(u))&&r._addCellsToDirty(f,u,1,1),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)r=this._headAdjustRows.sheetSource,f=this._headAdjustRows.row,r.getRowExpression&&(e=r.getRowExpression(f),e&&r._setRowExpression&&r._setRowExpression(f,this.adjustFormulaOnRemoveColumns(r,f,-1,e,n,t,i))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)r=this._headAdjustColumns.sheetSource,u=this._headAdjustColumns.column,r.getColumnExpression&&(e=r.getColumnExpression(u),e&&r._setColumnExpression&&r._setColumnExpression(u,this.adjustFormulaOnRemoveColumns(r,-1,u,e,n,t,i))),this.removeAdjustColumn(this._headAdjustColumns)},adjustFormulaOnRemoveSheet:function(n,t,r){var o=t,f,s,u,v,y,c,e,h;if(t instanceof yt)v=t.source,(n!==r&&v===r||n===r&&v!==r)&&(o=new a(l));else if(t instanceof ft)f=this.adjustFormulaOnRemoveSheet(n,t.argument,r),f!==t.argument&&(o=new ft(f));else if(t instanceof rt)f=this.adjustFormulaOnRemoveSheet(n,t.operand,r),f!==t.operand&&(o=new rt(t.operator,f));else if(t instanceof nt)y=this.adjustFormulaOnRemoveSheet(n,t.left,r),c=this.adjustFormulaOnRemoveSheet(n,t.right,r),(y!==t.left||c!==t.right)&&(o=new nt(t.operator,y,c));else if(t instanceof it){for(e=null,h=t.argCount(),u=0;u<h;u++){s=t.getArg(u),f=this.adjustFormulaOnRemoveSheet(n,s,r);if(f!==s){e=[],e[u]=f;break}}if(e){for(u=0;u<h;u++)s=t.getArg(u),(e[u]===i||e[u]===null)&&(e[u]=this.adjustFormulaOnRemoveSheet(n,s,r));o=new it(t.fn,e)}}return o},adjustFormulasOnRemoveSheet:function(n){for(var e,t,u,r,i,f=0;f<this._customNames.length;f++)e=this._customNames[f].value,e.expression=this.adjustFormulaOnRemoveSheet(null,e.expression,n);while(this._headAdjustCells)t=this._headAdjustCells.sheetSource,u=this._headAdjustCells.row,r=this._headAdjustCells.column,i=t.getExpression(u,r),i&&t.setExpression(u,r,this.adjustFormulaOnRemoveSheet(t,i,n)),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)t=this._headAdjustRows.sheetSource,u=this._headAdjustRows.row,t.getRowExpression&&(i=t.getRowExpression(u),i&&t.setRowExpression&&t.setRowExpression(u,this.adjustFormulaOnRemoveSheet(t,i,n))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)t=this._headAdjustColumns.sheetSource,r=this._headAdjustColumns.column,t.getColumnExpression&&(i=t.getColumnExpression(r),i&&t.setColumnExpression&&t.setColumnExpression(r,this.adjustFormulaOnRemoveSheet(t,i,n))),this.removeAdjustColumn(this._headAdjustColumns)},_adjustCellExpressionOnMove:function(n,t,i,r,u){var c=r instanceof yt,h=c?r.source:n,o=r.rowRelative,s=r.columnRelative,f,e;if(t<0&&o||i<0&&s)if(t<0&&o||i!==-1){if(t===-1&&i>=0&&!s){e=r.column+(s?i:0),u.destinationContains(n,t,i,1,1)&&(e-=s?u.getColumnOffset():0);if(u.sourceContains(h,f,e,1,1))e+=u.getColumnOffset();else if(u.destinationContains(h,f,e,1,1))return new a(l);e-=s?i:0;if(f!==r.row||e!==r.column)if(r instanceof p)return new p(r.row,e,r.rowRelative,s);else if(r instanceof d)return new d(r.source,r.row,e,r.rowRelative,s)}}else{f=r.row+(o?t:0),u.destinationContains(n,t,i,1,1)&&(f-=o?u.getRowOffset():0);if(u.sourceContains(h,f,-1,o,-1))f+=u.getRowOffset();else if(u.destinationContains(h,f,-1,1,-1))return new a(l);f-=o?t:0;if(f!==r.row)if(r instanceof p)return new p(f,r.column,o,r.columnRelative);else if(r instanceof d)return new d(r.source,f,r.column,o,r.columnRelative)}else{f=r.row+(o?t:0),e=r.column+(s?i:0),u.destinationContains(n,t,i,1,1)&&(f-=o?u.getRowOffset():0,e-=s?u.getColumnOffset():0);if(u.sourceContains(c?h:u._fromModel,f,e,1,1))f+=u.getRowOffset(),e+=u.getColumnOffset();else if(u.destinationContains(h,f,e,1,1))return new a(l);f-=o?t:0,e-=s?i:0;if(f!==r.row||e!==r.column)if(r instanceof p)return new p(f,e,o,s);else if(r instanceof d)return new d(r.source,f,e,o,s)}return r},_adjustRangeExpressionOnMove:function(n,t,i,r,u){var d=r instanceof yt?r.source:n,ct=r._getRangeType(),y,w,p,b,f,v,e,s,k,g,tt,nt,ft,et,ut,rt,lt,it,at,ot,ht,st;if(ct===c.cell){y=r.startRowRelative,w=r.startColumnRelative,p=r.endRowRelative,b=r.endColumnRelative;if(t<0&&y&&p||i<0&&w&&b)if(t<0&&y&&p||i!==-1){if(t===-1&&(i>=0||!w||!b)){e=r.startColumn+(w?i:0),s=r.endColumn+(b?i:0);if(e>s)return new a(l);u.destinationContains(n,t,i,1,1)&&(ut=w?u.getColumnOffset():0,rt=b?u.getColumnOffset():0,e-=ut,s-=rt),g=s-e;if(u.sourceContains(d,-1,e,-1,g))nt=u.getColumnOffset(),e+=nt,s+=nt;else if(u.destinationContains(d,-1,e,-1,g))return new a(l);e-=w?i:0,s-=b?i:0;if(e!==r.startColumn||s!==r.endColumn)if(r instanceof o)return new o(r.startRow,e,r.endRow,s,r.startRowRelative,w,r.endRowRelative,b);else if(r instanceof h)return new h(r.source,r.startRow,e,r.endRow,s,r.startRowRelative,w,r.endRowRelative,b)}}else{f=r.startRow+(y?t:0),v=r.endRow+(p?t:0);if(f>v)return new a(l);u.destinationContains(n,t,i,1,1)&&(ft=y?u.getRowOffset():0,et=p?u.getRowOffset():0,f-=ft,v-=et),k=v-f;if(u.sourceContains(d,f,-1,k,-1))tt=u.getRowOffset(),f+=tt,v+=tt;else if(u.destinationContains(d,f,-1,k,-1))return new a(l);f-=y?t:0,v-=p?t:0;if(f!==r.startRow||v!==r.endRow)if(r instanceof o)return new o(f,r.startColumn,v,r.endColumn,y,r.startColumnRelative,p,r.endColumnRelative);else if(r instanceof h)return new h(r.source,f,r.startColumn,v,r.endColumn,y,r.startColumnRelative,p,r.endColumnRelative)}else{f=r.startRow+(y?t:0),v=r.endRow+(p?t:0),e=r.startColumn+(w?i:0),s=r.endColumn+(b?i:0);if(f>v||e>s)return new a(l);u.destinationContains(n,t,i,1,1)&&(ft=y?u.getRowOffset():0,et=p?u.getRowOffset():0,ut=w?u.getColumnOffset():0,rt=b?u.getColumnOffset():0,f-=ft,v-=et,e-=ut,s-=rt),k=v-f+1,g=s-e+1,lt=!1;if(u.sourceContains(d,f,e,k,g))tt=u.getRowOffset(),nt=u.getColumnOffset(),f+=tt,v+=tt,e+=nt,s+=nt;else if(u.destinationContains(d,f,e,k,g)){it=u.sourceIntersectWith(d,f,e,k,g);if(it&&(it.rowCount===k||it.columnCount===g))f=it.row+u.getRowOffset(),e=it.column+u.getColumnOffset(),v=f+it.rowCount,s=e+it.columnCount,lt=!0;else return new a(l)}f-=y?t:0,v-=p?t:0,e-=w?i:0,s-=b?i:0;if(f!==r.startRow||e!==r.startColumn||v!==r.endRow||s!==r.endColumn||lt)if(r instanceof o)return new o(f,e,v,s,y,w,p,b);else if(r instanceof h)return new h(r.source,f,e,v,s,y,w,p,b)}}else if(ct===c.row){y=r.startRowRelative,p=r.endRowRelative;if(t>=0||!y||!p){f=r.startRow+(y?t:0),v=r.endRow+(p?t:0);if(f>v)return new a(l);u.destinationContains(n,t,i,1,1)&&(ft=y?u.getRowOffset():0,et=p?u.getRowOffset():0,f-=ft,v-=et),k=v-f;if(u.sourceContains(d,f,-1,k,-1))tt=u.getRowOffset(),f+=tt,v+=tt;else if(u.destinationContains(d,f,-1,k,-1))return new a(l);f-=y?t:0,v-=p?t:0;if(f!==r.startRow||v!==r.endRow)if(r instanceof o)return at=new o,at.initBand(f,v,y,p,!0),at;else if(r instanceof h)return ot=new h,ot.initBand(r.source,f,v,y,p,!0),ot}}else if(ct===c.column){w=r.startColumnRelative,b=r.endColumnRelative,e=r.startColumn+(w?i:0),s=r.endColumn+(b?i:0);if(e<s)return new a(l);u.destinationContains(n,t,i,1,1)&&(ut=w?u.getColumnOffset():0,rt=b?u.getColumnOffset():0,e-=ut,s-=rt),g=s-e;if(u.sourceContains(d,-1,e,-1,g))nt=u.getColumnOffset(),e+=nt,s+=nt;else if(u.destinationContains(d,-1,e,-1,g))return new a(l);e-=w?i:0,s-=b?i:0;if(e!==r.startColumn||s!==r.endColumn)if(r instanceof o)return ht=new o,ht.initBand(e,s,w,b,!1),ht;else if(r instanceof h)return st=new h,st.initBand(r.source,e,s,w,b,!1),st}return r},adjustFormulaOnMove:function(n,t,r,u,f){var l=u,s,w,y,c,a,e,v;if(u instanceof p||u instanceof d)l=this._adjustCellExpressionOnMove(n,t,r,u,f);else if(u instanceof o||u instanceof h)l=this._adjustRangeExpressionOnMove(n,t,r,u,f);else if(u instanceof ft)s=this.adjustFormulaOnMove(n,t,r,u.argument,f),s!==u.argument&&(l=new ft(s));else if(u instanceof rt)s=this.adjustFormulaOnMove(n,t,r,u.operand,f),s!==u.operand&&(l=new rt(u.operator,s));else if(u instanceof nt)w=this.adjustFormulaOnMove(n,t,r,u.left,f),y=this.adjustFormulaOnMove(n,t,r,u.right,f),(w!==u.left||y!==u.right)&&(l=new nt(u.operator,w,y));else if(u instanceof it){for(c=null,v=u.argCount(),e=0;e<v;e++){a=u.getArg(e),s=this.adjustFormulaOnMove(n,t,r,a,f);if(s!==a){c=[],c[e]=s;break}}if(c){for(e=0;e<v;e++)a=u.getArg(e),(c[e]===i||c[e]===null)&&(c[e]=this.adjustFormulaOnMove(n,t,r,a,f));l=new it(u.fn,c)}}return l},adjustFormulasOnMove:function(n,t,i,r,u,f,e,o){for(var a=new df(n,t,i,r,u,f,e,o),y,s,h,c,l,v=0;v<this._customNames.length;v++)y=this._customNames[v].value,y.expression=this.adjustFormulaOnMove(null,-1,-1,y.expression,a);while(this._headAdjustCells)s=this._headAdjustCells.sheetSource,h=this._headAdjustCells.row,c=this._headAdjustCells.column,l=s.getExpression(h,c),l?s.setExpression(h,c,this.adjustFormulaOnMove(s,h,c,l,a)):(s.getRowExpression&&s.getRowExpression(h)||s.getColumnExpression&&s.getColumnExpression(c))&&s._addCellsToDirty(h,c,1,1),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)s=this._headAdjustRows.sheetSource,h=this._headAdjustRows.row,s.getRowExpression&&(l=s.getRowExpression(h),l&&s.setRowExpression&&s.setRowExpression(h,this.adjustFormulaOnMove(s,h,-1,l,a))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)s=this._headAdjustColumns.sheetSource,c=this._headAdjustColumns.column,s.getColumnExpression&&(l=s.getColumnExpression(c),l&&s.setColumnExpression&&s.setColumnExpression(c,this.adjustFormulaOnMove(s,-1,c,l,a))),this.removeAdjustColumn(this._headAdjustColumns)},_adjustCellExpressionOnSwap:function(n,t,i,r,u){var h=r instanceof yt?r.source:n,s=r.rowRelative,o=r.columnRelative,f,e;if(t<0&&s||i<0&&o)if(t<0&&s||i!==-1){if(t===-1&&i>=0&&!o){e=r.column+(o?i:0),u.destinationContains(n,-1,i,-1,1)?e-=o?u.getColumnOffset():0:u.sourceContains(n,-1,e,-1,1)&&(e+=o?u.getColumnOffset():0),u.sourceContains(h,-1,e,-1,1)?e+=u.getColumnOffset():u.destinationContains(h,-1,e,-1,1)&&(e-=u.getColumnOffset()),e-=o?i:0;if(f!==r.row||e!==r.column)if(r instanceof p)return new p(r.row,e,r.rowRelative,o);else if(r instanceof d)return new d(r.source,r.row,e,r.rowRelative,o)}}else{f=r.row+(s?t:0),u.destinationContains(n,t,-1,1,-1)?f-=s?u.getRowOffset():0:u.sourceContains(n,f,-1,1,-1)&&(f+=s?u.getRowOffset():0),u.sourceContains(h,f,-1,1,-1)?f+=u.getRowOffset():u.destinationContains(h,f,-1,1,-1)&&(f-=u.getRowOffset()),f-=s?t:0;if(f!==r.row||e!==r.column)if(r instanceof p)return new p(f,r.column,s,r.columnRelative);else if(r instanceof d)return new d(r.source,f,r.column,s,r.columnRelative)}else{f=r.row+(s?t:0),e=r.column+(o?i:0),u.destinationContains(n,t,i,1,1)?(f-=s?u.getRowOffset():0,e-=o?u.getColumnOffset():0):u.sourceContains(n,f,e,1,1)&&(f+=s?u.getRowOffset():0,e+=o?u.getColumnOffset():0),u.sourceContains(h,f,e,1,1)?(f+=u.getRowOffset(),e+=u.getColumnOffset()):u.destinationContains(h,f,e,1,1)&&(f-=u.getRowOffset(),e-=u.getColumnOffset()),f-=s?t:0,e-=o?i:0;if(f!==r.row||e!==r.column)if(r instanceof p)return new p(f,e,s,o);else if(r instanceof d)return new d(r.source,f,e,s,o)}return r},_adjustRangeExpressionOnSwap:function(n,t,i,r,u){var rt=r instanceof yt?r.source:n,ht=r._getRangeType(),e,s,f,v,ft,ut,y,p,b,w,d,k,tt,nt,g,it,ct,st,et,ot;if(ht===c.cell){y=r.startRowRelative,p=r.startColumnRelative,b=r.endRowRelative,w=r.endColumnRelative;if(t<0&&y&&b||i<0&&p&&w)if(t<0&&y&&b||i!==-1){if(t===-1&&(i>=0||!p||!w)){f=r.startColumn+(p?i:0),v=r.endColumn+(w?i:0);if(f<v)return new a(l);u.destinationContains(n,-1,i,-1,1)?(nt=p?u.getColumnOffset():0,it=w?u.getColumnOffset():0,f-=nt,v-=it):u.sourceContains(n,-1,i,-1,1)&&(nt=p?u.getColumnOffset():0,it=w?u.getColumnOffset():0,f+=nt,v+=it),ut=v-f,u.sourceContains(rt,-1,f,-1,ut)?(k=u.getColumnOffset(),f+=k,v+=k):u.destinationContains(rt,-1,f,-1,ut)&&(k=u.getColumnOffset(),f-=k,v-=k),f-=p?i:0,v-=w?i:0;if(f!==r.startColumn||v!==r.endColumn)if(r instanceof o)return new o(r.startRow,f,r.endRow,v,r.startRowRelative,p,r.endRowRelative,w);else if(r instanceof h)return new h(r.source,r.startRow,f,r.endRow,v,r.startRowRelative,p,r.endRowRelative,w)}}else{e=r.startRow+(y?t:0),s=r.endRow+(b?t:0);if(e<s)return new a(l);u.destinationContains(n,t,-1,1,-1)?(tt=y?u.getRowOffset():0,g=y?u.getRowOffset():0,e-=tt,s-=g):u.sourceContains(n,t,-1,1,-1)&&(tt=y?u.getRowOffset():0,g=y?u.getRowOffset():0,e+=tt,s+=g),ft=s-e,u.sourceContains(rt,e,-1,ft,-1)?(d=u.getRowOffset(),e+=d,s+=d):u.destinationContains(rt,e,-1,ft,-1)&&(d=u.getRowOffset(),e-=d,s-=d),e-=y?t:0,s-=b?t:0;if(e!==r.startRow||s!==r.endRow)if(r instanceof o)return new o(e,r.startColumn,s,r.endColumn,y,r.startColumnRelative,b,r.endColumnRelative);else if(r instanceof h)return new h(r.source,e,r.startColumn,s,r.endColumn,y,r.startColumnRelative,b,r.endColumnRelative)}else{e=r.startRow+(y?t:0),s=r.endRow+(b?t:0),f=r.startColumn+(p?i:0),v=r.endColumn+(w?i:0),ft=s-e,ut=v-f,u.destinationContains(n,t,i,1,1)?(tt=y?u.getRowOffset():0,nt=p?u.getColumnOffset():0,g=b?u.getRowOffset():0,it=w?u.getColumnOffset():0,e-=tt,s-=g,f-=nt,v-=it):u.sourceContains(n,e,f,ft,ut)&&(tt=y?u.getRowOffset():0,nt=p?u.getColumnOffset():0,g=b?u.getRowOffset():0,it=w?u.getColumnOffset():0,e+=tt,s+=g,f+=nt,v+=it),u.sourceContains(rt,e,f,ft,ut)?(d=u.getRowOffset(),k=u.getColumnOffset(),e+=d,s+=d,f+=k,v+=k):u.destinationContains(rt,e,f,ft,ut)&&(d=u.getRowOffset(),k=u.getColumnOffset(),e-=d,s-=d,f-=k,v-=k),e-=y?t:0,s-=b?t:0,f-=p?i:0,v-=w?i:0;if(e!==r.startRow||f!==r.startColumn||s!==r.endRow||v!==r.endColumn)if(r instanceof o)return new o(e,f,s,v,y,p,b,w);else if(r instanceof h)return new h(r.source,e,f,s,v,y,p,b,w)}}else if(ht===c.row){y=r.startRowRelative,b=r.endRowRelative;if(t>=0||!y||!b){e=r.startRow+(y?t:0),s=r.endRow+(b?t:0);if(e<s)return new a(l);u.destinationContains(n,t,-1,1,-1)?(tt=y?u.getRowOffset():0,g=b?u.getRowOffset():0,e-=tt,s-=g):u.sourceContains(n,t,-1,1,-1)&&(tt=y?u.getRowOffset():0,g=b?u.getRowOffset():0,e+=tt,s+=g),ft=s-e,u.sourceContains(rt,e,-1,ft,-1)?(d=u.getRowOffset(),e+=d,s+=d):u.destinationContains(rt,e,-1,ft,-1)&&(d=u.getRowOffset(),e-=d,s-=d),e-=y?t:0,s-=b?t:0;if(e!==r.startRow||s!==r.endRow)if(r instanceof o)return ct=new o,ct.initBand(e,s,y,b,!0),ct;else if(r instanceof h)return st=new h,st.initBand(r.source,e,s,y,b,!0),st}}else if(ht===c.column){p=r.startColumnRelative,w=r.endColumnRelative,f=r.startColumn+(p?i:0),v=r.endColumn+(w?i:0);if(f>v)return new a(l);u.destinationContains(n,-1,i,-1,1)?(nt=p?u.getColumnOffset():0,it=w?u.getColumnOffset():0,f-=nt,v-=it):u.sourceContains(n,-1,i,-1,1)&&(nt=p?u.getColumnOffset():0,it=w?u.getColumnOffset():0,f+=nt,v+=it),ut=v-f,u.sourceContains(rt,-1,f,-1,ut)?(k=u.getColumnOffset(),f+=k,v+=k):u.destinationContains(rt,-1,f,-1,ut)&&(k=u.getColumnOffset(),f-=k,v-=k),f-=p?i:0,v-=w?i:0;if(f!==r.startColumn||v!==r.endColumn)if(r instanceof o)return et=new o,et.initBand(f,v,p,w,!1),et;else if(r instanceof h)return ot=new h,ot.initBand(r.source,f,v,p,w,!1),ot}return r},adjustFormulaOnSwap:function(n,t,r,u,f){var l=u,s,w,y,c,a,e,v;if(u instanceof p||u instanceof d)l=this._adjustCellExpressionOnSwap(n,t,r,u,f);else if(u instanceof o||u instanceof h)l=this._adjustRangeExpressionOnSwap(n,t,r,u,f);else if(u instanceof ft)s=this.adjustFormulaOnSwap(n,t,r,u.argument,f),s!==u.argument&&(l=new ft(s));else if(u instanceof rt)s=this.adjustFormulaOnSwap(n,t,r,u.operand,f),s!==u.operand&&(l=new rt(u.operator,s));else if(u instanceof nt)w=this.adjustFormulaOnSwap(n,t,r,u.left,f),y=this.adjustFormulaOnSwap(n,t,r,u.right,f),(w!==u.left||y!==u.right)&&(l=new nt(u.operator,w,y));else if(u instanceof it){for(c=null,v=u.argCount(),e=0;e<v;e++){a=u.getArg(e),s=this.adjustFormulaOnSwap(n,t,r,a,f);if(s!==a){c=[],c[e]=s;break}}if(c){for(e=0;e<v;e++)a=u.getArg(e),(c[e]===i||c[e]===null)&&(c[e]=this.adjustFormulaOnSwap(n,t,r,a,f));l=new it(u.fn,c)}}return l},adjustFormulasOnSwap:function(n,t,i,r,u,f,e,o){for(var a=new df(n,t,i,r,u,f,e,o),y,s,h,c,l,v=0;v<this._customNames.length;v++)y=this._customNames[v].value,y.expression=this.adjustFormulaOnSwap(null,-1,-1,y.expression,a);while(this._headAdjustCells)s=this._headAdjustCells.sheetSource,h=this._headAdjustCells.row,c=this._headAdjustCells.column,l=s.getExpression(h,c),l?s.setExpression(h,c,this.adjustFormulaOnSwap(s,h,c,l,a)):(s.getRowExpression&&s.getRowExpression(h)||s.getColumnExpression&&s.getColumnExpression(c))&&s._addCellsToDirty(h,c,1,1),this.removeAdjustCell(this._headAdjustCells);while(this._headAdjustRows)s=this._headAdjustRows.sheetSource,h=this._headAdjustRows.row,s.getRowExpression&&(l=s.getRowExpression(h),l&&s.setRowExpression&&s.setRowExpression(h,this.adjustFormulaOnSwap(s,h,-1,l,a))),this.removeAdjustRow(this._headAdjustRows);while(this._headAdjustColumns)s=this._headAdjustColumns.sheetSource,c=this._headAdjustColumns.column,s.getColumnExpression&&(l=s.getColumnExpression(c),l&&s.setColumnExpression&&s.setColumnExpression(c,this.adjustFormulaOnSwap(s,-1,c,l,a))),this.removeAdjustColumn(this._headAdjustColumns)}},e._Controller=ru,ae.prototype={_getSheetReference:function(){return this._reference=this._reference||new wt(this)},getValue:function(n,t){if(n<0||t<0||n>=this.getRowCount()||t>=this.getColumnCount())return ut;var i=this._sheet;return i._isValidatingCell&&i._validatingRow===n&&i._validatingColumn===t?i._validatingValue:i.getValue(n,t)},getReference:function(n,t,i,r){return n===-1&&t===-1?this._getSheetReference():n===-1?new ot(this._getSheetReference(),[{row:0,rowCount:this.getRowCount(),col:t,colCount:r}]):t===-1?new ot(this._getSheetReference(),[{row:n,rowCount:i,col:0,colCount:this.getColumnCount()}]):new ot(this._getSheetReference(),[{row:n,rowCount:i,col:t,colCount:r}])},getFunction:function(n){return this._sheet?this._sheet._findCustomFunction(n):null},getName:function(n,t,i){var r=this._sheet?this._sheet._findCustomName(n):null;return r?r.getExpression():null},getColumnCount:function(){return this._sheet.getColumnCount()},getRowCount:function(){return this._sheet.getRowCount()},getCalcService:function(){return this._sheet?this._sheet.getCalcService():null},hasFormula:function(n,t){return n=n!==i?n:-1,t=t!==i?t:-1,!!this.getExpression(n,t)},setFormula:function(n,t,i){var r,u,f;i&&i.length===0&&(i=null),r=this.getFormula(n,t),r===i||r===""&&!i||!r&&i===""||(u=this.getCalcService(),u&&(f=i?u.parse(i,n>=0?n:0,t>=0?t:0):null,this.setExpression(n,t,f)),n<0||t<0||this._sheet._getModel(this._sheetArea).setFormula(n,t,i))},getFormula:function(n,t){var r=this.getCalcService(),i;return r?(i=this.getExpression(n,t),i?r.unparse(i,n,t):null):null},getRowFormula:function(n){return this.getFormula(n,-1)},setRowFormula:function(n,t){this.setFormula(n,-1,t)},getColumnFormula:function(n){this.getFormula(-1,n)},setColumnFormula:function(n,t){this.setFormula(-1,n,t)},getExpression:function(n,t){var i=null,u,e,f,r=this._sheet._getCalcModel(this._sheetArea);return this._sheet?(u=r.getNode(n,t),u&&(i=u.formula),!i&&n<r.getRowCount()&&(e=r.getNode(n,-1),e&&(i=e.formula)),!i&&t<r.getColumnCount()&&(f=r.getNode(-1,t),f&&(i=f.formula))):n<0||t!==-1?n!==-1||t<0?n===-1&&t===-1&&(u=r.getNode(-1,-1),u&&(i=u.formula)):i&&t<r.getColumnCount()&&(f=r.getNode(-1,t),f&&(i=f.formula)):!i&&n<r.getRowCount()&&(e=r.getNode(n,-1),e&&(i=e.formula)),i},setExpression:function(n,t,i){n<0||t<0?n<0||t!==-1?n!==-1||t<0||this._setColumnExpression(t,i):this._setRowExpression(n,i):this._setCellExpression(n,t,i),this._controller.autoCalculation&&this._controller.recalculate()},getRowExpression:function(n){return this.getExpression(n,-1)},getColumnExpression:function(n){return this.getExpression(-1,n)},_setCellExpression:function(n,t,i){var r=this._getCellCalc(n,t,!0),u;r&&(r.stopListening(),u=this._sheet._getCalcModel(this._sheetArea).getNode(n,t,!0),u.formula=i,r.startListening(),this._controller.addDirtyCell(r))},_setRowExpression:function(n,t){var r=this._getRowCalc(n,!0),u,i;r&&(r.stopListening(),u=this._sheet._getCalcModel(this._sheetArea),i=u._rowDataArray[n],i||(u._rowDataArray[n]=i={}),i.formula=t,r.startListening(),this._controller.addDirtyRow(r))},_setColumnExpression:function(n,t){var r=this._getColumnCalc(n,!0),u,i;r&&(r.stopListening(),u=this._sheet._getCalcModel(this._sheetArea),i=u._columnDataArray[n],i||(u._columnDataArray[n]=i={}),i.formula=t,r.startListening(),this._controller.addDirtyRow(r))},onBeforeAddRemoveRows:function(n){var t=this.getRowCount(),i=this.getColumnCount();this.unlinkCellExpression(n,0,t-n,i),this.unlinkRowExpression(n,t-n),this._addDependentsToAdjust(n,-1,t-n,-1)},onAfterAddRows:function(n,t){var r=this.getRowCount(),i=this.getColumnCount();this._addCellsToDirty(n,0,t,i),this._addCellsToAdjust(n,0,r-n,i),this._addRowsToAdjust(n,r-n),this._controller.adjustFormulasOnAddRows(this,n,t),this._controller.autoCalculation&&this._controller.recalculate()},onAfterRemoveRows:function(n,t){var i=this.getRowCount(),r=this.getColumnCount();this._addCellsToAdjust(n,0,i-n,r),this._addRowsToAdjust(n,i-n),this._controller.adjustFormulasOnRemoveRows(this,n,t),this._controller.autoCalculation&&this._controller.recalculate()},onBeforeAddRemoveColumns:function(n){var i=this.getRowCount(),t=this.getColumnCount();this.unlinkCellExpression(0,n,i,t-n),this.unlinkColumnExpression(n,t-n),this._addDependentsToAdjust(-1,n,-1,t-n)},onAfterAddColumns:function(n,t){var r=this.getRowCount(),i=this.getColumnCount();this._addCellsToDirty(0,n,r,t),this._addCellsToAdjust(0,n,r,i-n),this._addColumnsToAdjust(n,i-n),this._controller.adjustFormulasOnAddColumns(this,n,t)},onAfterRemoveColumns:function(n,t){var r=this.getRowCount(),i=this.getColumnCount();this._addCellsToAdjust(0,n,r,i-n),this._addColumnsToAdjust(n,i-n),this._controller.adjustFormulasOnRemoveColumns(this,n,t),this._controller.autoCalculation&&this._controller.recalculate()},_buildAction:function(n,t,i){return n[t+""+i]},_dealWithExpression:function(n,t,i,r){var b,g,w,k,y,tt,at,lt,v,ut,et,u,l,a,f,s,e,ot,ht,st,vt,ct;while(i instanceof ft)i=i.argument;if(i instanceof p||i instanceof d){e=i instanceof p?this:i.source;if(0>n||0>t)if(0>n||t!==-1){if(n===-1&&0<=t){b=i.row,g=i.column+(i.columnRelative?t:0),et=this._getColumnCalc(t,!0);if(i.rowRelative){a=e._getColumnCalc(g,!0);if(!a)return;this._buildAction(a,r,"ColumnListener2").call(a,et,-b)}else{u=e._getCellCalc(b,g,!0);if(!u)return;this._buildAction(u,r,"ColumnListener").call(u,et)}}}else{b=i.row+(i.rowRelative?n:0),g=i.column,ut=this._getRowCalc(n,!0);if(i.columnRelative){l=e._getRowCalc(b,!0);if(!l)return;this._buildAction(l,r,"RowListener2").call(l,ut,-g)}else{u=e._getCellCalc(b,g,!0);if(!u)return;this._buildAction(u,r,"RowListener").call(u,ut)}}else{b=i.row+(i.rowRelative?n:0),g=i.column+(i.columnRelative?t:0),v=this._getCellCalc(n,t,!0),u=e._getCellCalc(b,g,!0);if(!u)return;this._buildAction(u,r,"CellListener").call(u,v)}}else if(i instanceof o||i instanceof h){e=i instanceof o?this:i.source,ot=i._getRangeType();if(ot===c.cell)if(0>n||0>t)if(0>n||t!==-1){if(n===-1&&0<=t)for(w=i.startRow+(i.startRowRelative?n:0),y=i.startColumn+(i.startColumnRelative?t:0),k=i.endRow+(i.endRowRelative?n:0),tt=i.endColumn+(i.endColumnRelative?t:0),et=this._getColumnCalc(t,!0),f=w;f<=k;f++)for(s=y;s<=tt;s++)i.startRowRelative||i.endRowRelative?(a=e._getColumnCalc(f,!0),a&&this._buildAction(a,r,"ColumnListener2").call(a,et,-f)):(u=e._getCellCalc(f,s,!0),u&&this._buildAction(u,r,"ColumnListener").call(u,et))}else for(w=i.startRow+(i.startRowRelative?n:0),y=i.startColumn+(i.startColumnRelative?t:0),k=i.endRow+(i.endRowRelative?n:0),tt=i.endColumn+(i.endColumnRelative?t:0),ut=this._getRowCalc(n,!0),f=w;f<=k;f++)for(s=y;s<=tt;s++)i.startColumnRelative||i.endColumnRelative?(l=e._getRowCalc(f,!0),l&&this._buildAction(l,r,"RowListener2").call(l,ut,-s)):(u=e._getCellCalc(f,s,!0),u&&this._buildAction(u,r,"RowListener").call(u,ut));else{w=i.startRow+(i.startRowRelative?n:0),y=i.startColumn+(i.startColumnRelative?t:0),k=i.endRow+(i.endRowRelative?n:0),tt=i.endColumn+(i.endColumnRelative?t:0),at=Math.abs(k-w)+1,lt=Math.abs(tt-y)+1,v=this._getCellCalc(n,t,!0);if(rs(b,g,at,lt)){ht=e._getRangeCalc(!0);if(!ht)return;this._buildAction(ht,r,"CellListener").call(ht,w,y,at,lt,v)}else for(f=w;f<=k;f++)for(s=y;s<=tt;s++)u=e._getCellCalc(f,s,!0),u&&this._buildAction(u,r,"CellListener").call(u,v)}else if(ot===c.row)if(0>n||0>t)(0>n||t!==-1)&&n===-1&&0<=t;else for(w=i.startRow+(i.startRowRelative?n:0),k=i.endRow+(i.endRowRelative?n:0),v=this._getCellCalc(n,t,!0),f=w;f<=k;f++)l=e._getRowCalc(f,!0),l&&this._buildAction(l,r,"CellListener").call(l,v);else if(ot===c.column)if(0>n||0>t)(0>n||t!==-1)&&n===-1&&0<=t;else for(y=i.startColumn+(i.startColumnRelative?t:0),tt=i.endColumn+(i.endColumnRelative?t:0),v=this._getCellCalc(n,t,!0),s=y;s<=tt;s++)a=e._getColumnCalc(s,!0),a&&this._buildAction(a,r,"CellListener").call(a,v);else ot===c.sheet&&(0>n||0>t)&&(0>n||t!==-1)&&n===-1&&0<=t}else if(i instanceof rt)this._dealWithExpression(n,t,i.operand,r);else if(i instanceof nt)this._dealWithExpression(n,t,i.left,r),this._dealWithExpression(n,t,i.right,r);else if(i instanceof dt||i instanceof ei){e=i instanceof dt?this:i.source,v=this._getCellCalc(n,t,!0),st=e._getNameCalc(i.name,!0);if(!st)return;this._buildAction(st,r,"CellListener").call(st,v),this._dealWithExpression(n,t,e.getName(i.name,n,t),r)}else if(i instanceof it)for(vt=i.argCount(),ct=0;ct<vt;ct++)this._dealWithExpression(n,t,i.getArg(ct),r)},linkExpression:function(n,t,i){this._dealWithExpression(n,t,i,"add")},unlinkExpression:function(n,t,i){this._dealWithExpression(n,t,i,"remove")},_dealWithCellExpression:function(n,t,i,r,u){for(var s=this._sheet._getCalcModel(this._sheetArea),e,o,f=n;f!==-1&&f<n+i;f=s.nextNonNullRow(f))for(e=t;e!==-1&&e<t+r;e=s.nextNonNullColumn(f,e))o=s.getFormula(f,e),o&&u.call(this,f,e,o)},linkCellExpression:function(n,t,i,r){this._dealWithCellExpression(n,t,i,r,this.linkExpression)},unlinkCellExpression:function(n,t,i,r){this._dealWithCellExpression(n,t,i,r,this.unlinkExpression)},linkRowExpression:function(n,t){},unlinkRowExpression:function(n,t){},linkColumnExpression:function(n,t){},unlinkColumnExpression:function(n,t){},_addColumnsToDirty:function(n,t){var u=this._sheet._getCalcModel(this._sheetArea),i,r,f;if(u._columnDataArray)for(i=n;i!==-1&&i<n+t&&i<u._columnDataArray.length;i++){r=u._columnDataArray[i];if(!r||!r.columnCalc&&!r.formula)continue;f=this._getColumnCalc(i,!0),this._controller.addDirtyColumn(f)}},_addRowsToDirty:function(n,t){var u=this._sheet._getCalcModel(this._sheetArea),i,r,f;if(u._rowDataArray)for(i=n;i!==-1&&i<n+t&&i<u._rowDataArray.length;i++){r=u._rowDataArray[i];if(!r||!r.rowCalc&&!r.formula)continue;f=this._getRowCalc(i,!0),this._controller.addDirtyRow(f)}},_addCellsToDirty:function(n,t,i,r){for(var o=this._sheet._getCalcModel(this._sheetArea),f,e,s,u=n;u!==-1&&u<n+i;u=o.nextNonNullRow(u))for(f=t;f!==-1&&f<t+r;f=o.nextNonNullColumn(u,f)){e=o.getNode(u,f,!1);if(!e||!e.cellCalc&&!e.formula)continue;s=this._getCellCalc(u,f,!0),this._controller.addDirtyCell(s)}this._addRowsToDirty(n,i),this._addColumnsToDirty(t,r)},_addDependentsToAdjust:function(n,t,i,r){this._addDependents(n,t,i,r,!0,!1)},_iterateEachCell:function(n,t,i,r,u,f,e){for(var s,h,o=t;o!==-1&&o<t+r;o=n.nextNonNullRow(o))for(s=i;s!==-1&&s<i+u;s=n.nextNonNullColumn(o,s))h=this._getCellCalc(o,s,!1),h&&(f&&h.addListenersToAdjust(),e&&h.addListenersToDirty())},_iterateEachRow:function(n,t,i,r,u){var f,e,o;if(n._rowDataArray)for(f=t;f!==-1&&f<t+i&&f<n._rowDataArray.length;f++){e=n._rowDataArray[f];if(!e||!e.rowCalc)continue;o=e.rowCalc,r&&o.addListenersToAdjust(),u&&o.addListenersToDirty()}},_iterateEachColumn:function(n,t,i,r,u){var f,e,o;if(n._columnDataArray)for(f=t;f!==-1&&f<t+i&&f<n._columnDataArray.length;f++){e=n._columnDataArray[f];if(!e||!e.columnCalc)continue;o=e.columnCalc,r&&o.addListenersToAdjust(),u&&o.addListenersToDirty()}},_addDependents:function(n,t,i,r,u,f){var e,s,o;(u||f)&&(e=this._sheet._getCalcModel(this._sheetArea),0>n||0>t?0>n||t!==-1?n!==-1||0>t?n===-1&&t===-1&&(s=this.getRowCount(),o=this.getColumnCount(),this._iterateEachCell(e,0,0,s,o,u,f),this._iterateEachRow(e,0,s,u,f),this._iterateEachColumn(e,0,o,u,f),this._rangeCalc&&(u&&this._rangeCalc.addListenersToAdjust(n,t,i,r),f&&this._rangeCalc.addListenersToDirty(n,t,i,r))):(this._iterateEachCell(e,0,t,this.getRowCount(),r,u,f),this._iterateEachColumn(e,t,r,u,f),this._rangeCalc&&(u&&this._rangeCalc.addListenersToAdjust(n,t,i,r),f&&this._rangeCalc.addListenersToDirty(n,t,i,r))):(this._iterateEachCell(e,n,0,i,this.getColumnCount(),u,f),this._iterateEachRow(e,n,i,u,f),this._rangeCalc&&(u&&this._rangeCalc.addListenersToAdjust(n,t,i,r),f&&this._rangeCalc.addListenersToDirty(n,t,i,r))):(this._iterateEachCell(e,n,t,i,r,u,f),this._iterateEachRow(e,n,i,u,f),this._iterateEachColumn(e,t,r,u,f),this._rangeCalc&&(u&&this._rangeCalc.addListenersToAdjust(n,t,i,r),f&&this._rangeCalc.addListenersToDirty(n,t,i,r))))},_addCellsToAdjust:function(n,t,i,r){for(var o=this._sheet._getCalcModel(this._sheetArea),f,e,s,u=n;u!==-1&&u<n+i;u=o.nextNonNullRow(u))for(f=t;f!==-1&&f<t+r;f=o.nextNonNullColumn(u,f)){e=o.getNode(u,f,!1);if(!e||!e.cellCalc&&!e.formula)continue;e.cellCalc&&(e.cellCalc=null),s=this._getCellCalc(u,f,!0),this._controller.addAdjustCell(s)}},_addColumnsToAdjust:function(n,t){var u=this._sheet._getCalcModel(this._sheetArea),i,r,f;if(u._columnDataArray)for(i=n;i!==-1&&i<n+t&&i<u._columnDataArray.length;i++){r=u._columnDataArray[i];if(!r||!r.columnCalc&&!r.formula)continue;f=this._getColumnCalc(i,!0),this._controller.addAdjustColumn(f)}},_addRowsToAdjust:function(n,t){var u=this._sheet._getCalcModel(this._sheetArea),i,r,f;if(u._rowDataArray)for(i=n;i!==-1&&i<n+t&&i<u._rowDataArray.length;i++){r=u._rowDataArray[i];if(!r||!r.rowCalc&&!r.formula)continue;f=this._getRowCalc(i,!0),this._controller.addAdjustRow(f)}},_getCellCalc:function(n,t,i){var u=null,f,r;return n<0||t<0||(f=this._sheet._getCalcModel(this._sheetArea),r=f.getNode(n,t,i),r&&(u=r.cellCalc,!u&&i&&(r.cellCalc=u=new ci(this,n,t)))),u},_getRowCalc:function(n,t){var r=null,u,i;return n<0||(u=this._sheet._getCalcModel(this._sheetArea),i=u.getNode(n,-1,t),i&&(r=i.rowCalc,!r&&t&&(i.rowCalc=r=new lt(this,n)))),r},_getColumnCalc:function(n,t){var r=null,u,i;return n<0||(u=this._sheet._getCalcModel(this._sheetArea),i=u.getNode(-1,n,t),i&&(r=i.columnCalc,!r&&t&&(i.columnCalc=r=new at(this,n)))),r},_getRangeCalc:function(n){var t=this._sheet._getCalcModel(this._sheetArea);return!t._rangeCalc&&n&&(t._rangeCalc=new he(this)),t._rangeCalc},_getNameCalc:function(n,t){var r=null,i,u;return this._sheet.getCustomName(n)?(i=this._sheet._getCalcModel(this._sheetArea),i._names||(i._names={}),r=i._names[n],!r&&t&&(r=i._names[n]=new yi(n))):(u=this._sheet.getCalcService(),u&&u._getNameCalc&&(r=u._getNameCalc(n,t)),r||(i=this._sheet._getCalcModel(this._sheetArea),i._names||(i._names={}),r=i._names[n],!r&&t&&(r=i._names[n]=new yi(n)))),r},recalculateCell:function(n,t){var u=this.getExpression(n,t),r,i;if(u){r=this._sheet.getValue(n,t),i=this._sheet.getCalcService().evaluateParsedFormula(this,u,n,t);if(r===i)return;else if(r instanceof Date&&i instanceof Date)if(r.valueOf()===i.valueOf())return;this._sheet._getModel().setValue(n,t,i)}},shareCalculations:function(n){if(this._controller===n._controller)return;this._controller.detachDataModel(this);if(this._controller._dataModels.length>0){var t=this._controller._dataModels[0];t&&t.shareCalculations(n)}n._controller.addCustomFunctions(this._controller._customFunctions),n._controller.addCustomNames(this._controller._customNames),this._controller=n._controller,this._controller.attachDataModel(this)},unshareCalculations:function(){this._addCellsToAdjust(0,0,this.getRowCount(),this.getColumnCount()),this._addRowsToAdjust(0,this.getRowCount()),this._addColumnsToAdjust(0,this.getColumnCount()),this._addDependentsToAdjust(-1,-1,-1,-1),this._controller.adjustFormulasOnRemoveSheet(this),this._controller.autoCalculation&&this._controller.recalculate(),this._controller.detachDataModel(this),this._controller=new ru,this._controller.attachDataModel(this)}},e._SheetSource=ae,ve.prototype={contextChanged:function(){this.cachedContexts=null},_getExternalSource:function(n,t){var i,r,u;if(!this.context)return null;if(n&&(!(this.context instanceof bt.GcSpread)||this.context.name!==n))return null;i=this.getSheetContexts();if(i&&i.length>0)for(r=0;r<i.length;r++){u=i[r];if(ou(u.name,t))return u.target._getSheetSource()}return null},_getExternalSourceToken:function(n){return n._sheet._name},_getParserContext:function(n,t){var i=new te(this.useR1C1,n,t,null),r=this;return i.getExternalSource=function(n,t){return r._getExternalSource(n,t)},i.getExternalSourceToken=function(n){return r._getExternalSourceToken(n)},i},_getEvaluatorContext4Cell:function(n,t,i,r){return new nu(n._getSheetSource(),r,t,i)},_getEvaluatorContext4Range:function(n,t,i,r,u,f){return new nu(n._getSheetSource(),f,t,i,r,u)},getSheetContexts:function(){return this.cachedContexts||this.createSheetContexts(),this.cachedContexts},createSheetContexts:function(){if(!this.context)return;this.cachedContexts=this.context._getCalcContexts()},parse:function(n,t,i){var r=this._getParserContext(t,i);return r.row=t,r.column=i,this.parser.parse(n,r)},unparse:function(n,t,i){var r=this._getParserContext(t,i);return r.row=t,r.column=i,this.parser.unparse(n,r)},evaluateParsedFormula:function(n,t,i,r,u){var c=this._getEvaluatorContext4Cell(n._sheet,i,r,u),f=this.evaluator.evaluateExpression(t,c),o,e,s,h;if(u)return f;if(f instanceof ct){o=f.getRowCount(0),e=f.getColumnCount(0);if(f.getRangeCount()>0&&o>0&&e>0)if(f.getRangeCount()!==1||o>1&&e>1)return ut;else try{return s=i-f.getRow(0),h=r-f.getColumn(0),o===1&&e===1?f.getValue(0,0,0):o===1&&e>1&&h>=0&&h<e?f.getValue(0,0,h):o>1&&e===1&&s>=0&&s<o?f.getValue(0,s,0):ut}catch(a){return ut}else return l}else if(f instanceof g)return f.getValueByIndex(0);return f},evaluate:function(n,t,i,r){return this.evaluator.evaluateFormula(t,this._getParserContext(i,r),this._getEvaluatorContext4Cell(n._sheet,i,r,!1))},recalculate:function(n,t,i){var u=n.target,r;u&&(r=u._getSheetSource(),r&&(r._addCellsToDirty(t,i,1,1),this._suspended===0&&r._controller.recalculate()))},recalculateAll:function(n){var e=this.getSheetContexts(),r,i,t,f,u;if(e)for(r=0;r<e.length;r++)i=e[r].target,i&&(t=i._getSheetSource(),t&&(n!==!1&&(f=i.getColumnCount(),u=i.getRowCount(),t._addColumnsToDirty(0,f),t._addRowsToDirty(0,u),t._addCellsToDirty(0,0,u,f)),this._suspended===0&&t._controller.recalculate()))},suspend:function(){this._suspended++},resume:function(){this._suspended--,this._suspended<0&&(this._suspended=0),this._suspended===0&&this.recalculateAll(!1)}},e.Service=ve})(this,jQuery);(function(n,t){"use strict";var i=n.GrapeCity,r="undefined";typeof i===r&&(i=n.GrapeCity={}),typeof i.UI===r&&(i.UI={})})(window,jQuery),function(n){var y="backColor",a="foreColor",l="hAlign",c="vAlign",v="themeFont",w="font",p="formatter",e="borderLeft",h="borderTop",u="borderRight",r="borderBottom",i="locked",f="textIndent",s="wordWrap",o="shrinkToFit",b=n.GrapeCity,t=b.UI;t.Cell=function(n,i,r,u){this.sheet=n,this.row=i,this.row2=i,this.col=r,this.col2=r,(u===undefined||u===null)&&(u=t.SheetArea.viewport),this.sheetArea=u},t.Cell.prototype={value:function(n){var i,t;if(arguments.length===0)return this.sheet.getValue(this.row,this.col,this.sheetArea);else{for(i=this.row;i<=this.row2;i++)for(t=this.col;t<=this.col2;t++)this._isValidIndex(i,t)&&this.sheet.setValue(i,t,n,this.sheetArea);return this}},text:function(n){var i,t;if(arguments.length===0)return this.sheet.getText(this.row,this.col,this.sheetArea);else{for(i=this.row;i<=this.row2;i++)for(t=this.col;t<=this.col2;t++)this._isValidIndex(i,t)&&this.sheet.setText(i,t,n,this.sheetArea);return this}},formula:function(n){var i,t;if(arguments.length===0)return this.sheet.getFormula(this.row,this.col,this.sheetArea);else{for(i=this.row;i<=this.row2;i++)for(t=this.col;t<=this.col2;t++)this._isValidIndex(i,t)&&this.sheet.setFormula(i,t,n,this.sheetArea);return this}},dataValidator:function(n){var i,t;if(arguments.length===0)return this.sheet.getDataValidator(this.row,this.col,this.sheetArea);else{for(i=this.row;i<=this.row2;i++)for(t=this.col;t<=this.col2;t++)this._isValidIndex(i,t)&&this.sheet.setDataValidator(i,t,n,this.sheetArea);return this}},backColor:function(n){return arguments.length===0?this._getStyleProperty(y):this._setStyleProperty(y,n)},foreColor:function(n){return arguments.length===0?this._getStyleProperty(a):this._setStyleProperty(a,n)},hAlign:function(n){return arguments.length===0?this._getStyleProperty(l):this._setStyleProperty(l,n)},vAlign:function(n){return arguments.length===0?this._getStyleProperty(c):this._setStyleProperty(c,n)},themeFont:function(n){return arguments.length===0?this._getStyleProperty(v):this._setStyleProperty(v,n)},font:function(n){return arguments.length===0?this._getStyleProperty(w):this._setStyleProperty(w,n)},formatter:function(n){return arguments.length===0?this._getStyleProperty(p):this._setStyleProperty(p,n)},borderLeft:function(n){return arguments.length===0?this._getStyleProperty(e):this._setStyleProperty(e,n)},borderTop:function(n){return arguments.length===0?this._getStyleProperty(h):this._setStyleProperty(h,n)},borderRight:function(n){return arguments.length===0?this._getStyleProperty(u):this._setStyleProperty(u,n)},borderBottom:function(n){return arguments.length===0?this._getStyleProperty(r):this._setStyleProperty(r,n)},locked:function(n){return arguments.length===0?this._getStyleProperty(i):this._setStyleProperty(i,n)},textIndent:function(n){return arguments.length===0?this._getStyleProperty(f):this._setStyleProperty(f,n)},wordWrap:function(n){return arguments.length===0?this._getStyleProperty(s):this._setStyleProperty(s,n)},shrinkToFit:function(n){return arguments.length===0?this._getStyleProperty(o):this._setStyleProperty(o,n)},clearStyleProperty:function(n){for(var t,r,i=this.row;i<=this.row2;i++)for(t=this.col;t<=this.col2;t++)this._isValidIndex(i,t)&&(r=this.sheet.getStyle(i,t,this.sheetArea),r&&r.clear(n))},_getStyleProperty:function(n){var t=this.sheet.getActualStyle(this.row,this.col,this.sheetArea);return t?t[n]:undefined},_setStyleProperty:function(n,i){for(var r,f,u=this.row;u<=this.row2;u++)for(r=this.col;r<=this.col2;r++)this._isValidIndex(u,r)&&(f=this.sheet.getStyle(u,r,this.sheetArea),f||(f=new t.Style),f[n]=i,this.sheet.setStyle(u,r,f,this.sheetArea));return this},_isValidIndex:function(n,t){if(this.sheet){var r=this.sheet.getRowCount(this.sheetArea),i=this.sheet.getColumnCount(this.sheetArea);if(0<=n&&n<r&&0<=t&&t<i)return!0}return!1}},t.Row=function(n,i,r){this.sheet=n,this.index=i,this.index2=i,(r===undefined||r===null)&&(r=t.SheetArea.viewport),this.sheetArea=r},t.Row.prototype={height:function(n){if(arguments.length===0)return this.sheet.getRowHeight(this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setRowHeight(t,n,this.sheetArea);return this}},visible:function(n){if(arguments.length===0)return this.sheet.getRowVisible(this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setRowVisible(t,n,this.sheetArea);return this}},resizable:function(n){if(arguments.length===0)return this.sheet.getRowResizable(this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setRowResizable(t,n,this.sheetArea);return this}},dataValidator:function(n){if(arguments.length===0)return this.sheet.getDataValidator(this.index,-1,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setDataValidator(t,-1,n,this.sheetArea);return this}},backColor:function(n){return arguments.length===0?this._getStyleProperty(y):this._setStyleProperty(y,n)},foreColor:function(n){return arguments.length===0?this._getStyleProperty(a):this._setStyleProperty(a,n)},hAlign:function(n){return arguments.length===0?this._getStyleProperty(l):this._setStyleProperty(l,n)},vAlign:function(n){return arguments.length===0?this._getStyleProperty(c):this._setStyleProperty(c,n)},themeFont:function(n){return arguments.length===0?this._getStyleProperty(v):this._setStyleProperty(v,n)},font:function(n){return arguments.length===0?this._getStyleProperty(w):this._setStyleProperty(w,n)},formatter:function(n){return arguments.length===0?this._getStyleProperty(p):this._setStyleProperty(p,n)},borderLeft:function(n){return arguments.length===0?this._getStyleProperty(e):this._setStyleProperty(e,n)},borderTop:function(n){return arguments.length===0?this._getStyleProperty(h):this._setStyleProperty(h,n)},borderRight:function(n){return arguments.length===0?this._getStyleProperty(u):this._setStyleProperty(u,n)},borderBottom:function(n){return arguments.length===0?this._getStyleProperty(r):this._setStyleProperty(r,n)},locked:function(n){return arguments.length===0?this._getStyleProperty(i):this._setStyleProperty(i,n)},textIndent:function(n){return arguments.length===0?this._getStyleProperty(f):this._setStyleProperty(f,n)},wordWrap:function(n){return arguments.length===0?this._getStyleProperty(s):this._setStyleProperty(s,n)},shrinkToFit:function(n){return arguments.length===0?this._getStyleProperty(o):this._setStyleProperty(o,n)},clearStyleProperty:function(n){for(var r,i=this.index;i<=this.index2;i++)this._isValidIndex(i)&&(r=this.sheet.getStyle(i,-1,this.sheetArea),r&&(r.clear(n),this.sheet._trigger(t.Events.RowChanged,{sheet:this.sheet,sheetName:this.sheet._name,row:i,sheetArea:this.sheetArea,propertyName:n})))},_getStyleProperty:function(n){var t=this.sheet.getStyle(this.index,-1,this.sheetArea);return t?t[n]:undefined},_setStyleProperty:function(n,i){for(var u,r=this.index;r<=this.index2;r++)this._isValidIndex(r)&&(u=this.sheet.getStyle(r,-1,this.sheetArea),u||(u=new t.Style),u[n]=i,this.sheet.setStyle(r,-1,u,this.sheetArea));return this},_isValidIndex:function(n){if(this.sheet){var t=this.sheet.getRowCount(this.sheetArea);if(0<=n&&n<t)return!0}return!1}},t.Col=function(n,i,r){this.sheet=n,this.index=i,this.index2=i,(r===undefined||r===null)&&(r=t.SheetArea.viewport),this.sheetArea=r},t.Col.prototype={width:function(n){if(arguments.length===0)return this.sheet.getColumnWidth(this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setColumnWidth(t,n,this.sheetArea);return this}},visible:function(n){if(arguments.length===0)return this.sheet.getColumnVisible(this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setColumnVisible(t,n,this.sheetArea);return this}},resizable:function(n){if(arguments.length===0)return this.sheet.getColumnResizable(this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setColumnResizable(t,n,this.sheetArea);return this}},dataValidator:function(n){if(arguments.length===0)return this.sheet.getDataValidator(-1,this.index,this.sheetArea);else{for(var t=this.index;t<=this.index2;t++)this._isValidIndex(t)&&this.sheet.setDataValidator(-1,t,n,this.sheetArea);return this}},backColor:function(n){return arguments.length===0?this._getStyleProperty(y):this._setStyleProperty(y,n)},foreColor:function(n){return arguments.length===0?this._getStyleProperty(a):this._setStyleProperty(a,n)},hAlign:function(n){return arguments.length===0?this._getStyleProperty(l):this._setStyleProperty(l,n)},vAlign:function(n){return arguments.length===0?this._getStyleProperty(c):this._setStyleProperty(c,n)},themeFont:function(n){return arguments.length===0?this._getStyleProperty(v):this._setStyleProperty(v,n)},font:function(n){return arguments.length===0?this._getStyleProperty(w):this._setStyleProperty(w,n)},formatter:function(n){return arguments.length===0?this._getStyleProperty(p):this._setStyleProperty(p,n)},borderLeft:function(n){return arguments.length===0?this._getStyleProperty(e):this._setStyleProperty(e,n)},borderTop:function(n){return arguments.length===0?this._getStyleProperty(h):this._setStyleProperty(h,n)},borderRight:function(n){return arguments.length===0?this._getStyleProperty(u):this._setStyleProperty(u,n)},borderBottom:function(n){return arguments.length===0?this._getStyleProperty(r):this._setStyleProperty(r,n)},locked:function(n){return arguments.length===0?this._getStyleProperty(i):this._setStyleProperty(i,n)},textIndent:function(n){return arguments.length===0?this._getStyleProperty(f):this._setStyleProperty(f,n)},wordWrap:function(n){return arguments.length===0?this._getStyleProperty(s):this._setStyleProperty(s,n)},shrinkToFit:function(n){return arguments.length===0?this._getStyleProperty(o):this._setStyleProperty(o,n)},clearStyleProperty:function(n){for(var r,i=this.index;i<=this.index2;i++)this._isValidIndex(i)&&(r=this.sheet.getStyle(-1,i,this.sheetArea),r&&(r.clear(n),this.sheet._trigger(t.Events.ColumnChanged,{sheet:this.sheet,sheetName:this.sheet._name,col:i,sheetArea:this.sheetArea,propertyName:n})))},_getStyleProperty:function(n){var t=this.sheet.getStyle(-1,this.index,this.sheetArea);return t?t[n]:undefined},_setStyleProperty:function(n,i){for(var u,r=this.index;r<=this.index2;r++)this._isValidIndex(r)&&(u=this.sheet.getStyle(-1,r,this.sheetArea),u||(u=new t.Style),u[n]=i,this.sheet.setStyle(-1,r,u,this.sheetArea));return this},_isValidIndex:function(n){if(this.sheet){var t=this.sheet.getColumnCount(this.sheetArea);if(0<=n&&n<t)return!0}return!1}}}(window);(function(n){"use strict";var c="wijmo-wijsuperpanel ui-widget ui-widget-content",e="ui-corner-all",t="ui-state-disabled",u="ui-state-hover",o="ui-state-active",r="ui-state-default",i="wijmo-wijsuperpanel-handle",f="wijmo-wijsuperpanel-hbarcontainer",h="wijmo-wijsuperpanel-vbarcontainer",v="<div class='wijmo-wijsuperpanel-statecontainer'><div class='wijmo-wijsuperpanel-contentwrapper'><div class='wijmo-wijsuperpanel-templateouterwrapper'></div></div></div>",s="<div class='wijmo-wijsuperpanel-hbarcontainer ui-widget-header'><div class='wijmo-wijsuperpanel-handle ui-state-default ui-corner-all'><span class='ui-icon ui-icon-grip-solid-vertical'></span></div><div class='wijmo-wijsuperpanel-hbar-buttonleft ui-state-default ui-corner-bl'><span class='ui-icon ui-icon-triangle-1-w'></span></div><div class='wijmo-wijsuperpanel-hbar-buttonright ui-state-default ui-corner-br'><span class='ui-icon ui-icon-triangle-1-e'></span></div></div>",y="<div class='wijmo-wijsuperpanel-vbarcontainer ui-widget-header'><div class='wijmo-wijsuperpanel-handle ui-state-default ui-corner-all'><span class='ui-icon ui-icon-grip-solid-horizontal'></span></div><div class='wijmo-wijsuperpanel-vbar-buttontop ui-state-default ui-corner-tr'><span class='ui-icon ui-icon-triangle-1-n'></span></div><div class='wijmo-wijsuperpanel-vbar-buttonbottom ui-state-default ui-corner-br'><span class='ui-icon ui-icon-triangle-1-s'></span></div></div>",l="<div class='ui-state-default wijmo-wijsuperpanel-button wijmo-wijsuperpanel-buttonleft'><span class='ui-icon ui-icon-carat-1-w'></span></div><div class='ui-state-default wijmo-wijsuperpanel-button wijmo-wijsuperpanel-buttonright'><span class='ui-icon ui-icon-carat-1-e'></span></div>",a="<div class='ui-state-default wijmo-wijsuperpanel-button wijmo-wijsuperpanel-buttontop'><span class='ui-icon ui-icon-carat-1-n'></span></div><div class='ui-state-default wijmo-wijsuperpanel-button wijmo-wijsuperpanel-buttonbottom'><span class='ui-icon ui-icon-carat-1-s'></span></div>";n.widget("wijmo.wijspreadpanelex",{options:{allowResize:!1,autoRefresh:!1,animationOptions:{queue:!1,disabled:!1,duration:250,easing:undefined},hScrollerActivating:null,hScroller:{scrollBarPosition:"bottom",scrollBarVisibility:"auto",scrollMode:"scrollBar",scrollValue:null,scrollMax:100,scrollMin:0,scrollLargeChange:null,scrollSmallChange:null,scrollMinDragLength:6,increaseButtonPosition:null,decreaseButtonPosition:null,hoverEdgeSpan:20,firstStepChangeFix:0},keyboardSupport:!1,keyDownInterval:100,mouseWheelSupport:!0,bubbleScrollingEvent:!0,resizableOptions:{handles:"all",helper:"ui-widget-content wijmo-wijsuperpanel-helper"},resized:null,dragStop:null,painted:null,scrolling:null,scroll:null,scrolled:null,showRounder:!0,vScrollerActivating:null,vScroller:{scrollBarPosition:"right",scrollBarVisibility:"auto",scrollMode:"scrollBar",scrollValue:null,scrollMax:100,scrollMin:0,scrollLargeChange:null,scrollSmallChange:null,scrollMinDragLength:6,increaseButtonPosition:null,decreaseButtonPosition:null,hoverEdgeSpan:20,firstStepChangeFix:0}},_setOption:function(t,i){var r=this,o=r.options,s=r._fields(),e=s.hbarDrag,u=s.vbarDrag,f=s.resizer;t==="animationOptions"?i=n.extend(o.animationOptions,i):t==="hScroller"?(i.scrollLargeChange!==undefined&&i.scrollLargeChange!==null&&(r._autoHLarge=!1),i=n.extend(o.hScroller,i)):t==="vScroller"?(i.scrollLargeChange!==undefined&&i.scrollLargeChange!==null&&(r._autoVLarge=!1),i=n.extend(o.vScroller,i)):t==="resizableOptions"&&(i=n.extend(r.resizableOptions,i)),n.Widget.prototype._setOption.apply(r,arguments),n.isPlainObject(i)&&(r.options[t]=i);switch(t){case"allowResize":r._initResizer();break;case"disabled":i?(e!==undefined&&e.draggable("disable"),u!==undefined&&u.draggable("disable"),f!==undefined&&f.resizable("disable")):(e!==undefined&&e.draggable("enable"),u!==undefined&&u.draggable("enable"),f!==undefined&&f.resizable("enable"));break;case"mouseWheelSupport":case"keyboardSupport":r._bindElementEvents(r,s,r.element,o);break}return r},_create:function(){var n=this,t=n.options;t.vScroller.dir="v",t.hScroller.dir="h",n.paintPanel(),n._initResizer(),n.options.disabled&&n.disable(),n._detectAutoRefresh()},_detectAutoRefresh:function(){var i=this,t=n.wijmo.wijspreadpanelex.panels;t===undefined&&(t=[],n.wijmo.wijspreadpanelex.panels=t),t.push(i),i.options.autoRefresh&&(n.wijmo.wijspreadpanelex.setAutoRefreshInterval||(n.wijmo.wijspreadpanelex.setAutoRefreshInterval=i._setAutoRefreshInterval,n.wijmo.wijspreadpanelex.setAutoRefreshInterval()))},_setAutoRefreshInterval:function(){var i=n.wijmo.wijspreadpanelex.autoRereshInterval,t=n.wijmo.wijspreadpanelex.panels,r=window.setInterval(function(){window.clearInterval(r);for(var c=t.length,s=!1,i,o,h,f,u,e=0;e<c;e++)i=t[e],o=i.element[0],h=i.options.autoRefresh,h&&(s=!0),f=i.getContentElement(),u=i._paintedMark,i.options.autoRefresh&&f.is(":visible")&&(u===undefined||u.width!==f[0].offsetWidth||u.height!==f[0].offsetHeight||u.mainWidth!==o.offsetWidth||u.mainHeight!==o.offsetHeight)&&i.paintPanel();s&&window.setTimeout(n.wijmo.wijspreadpanelex.setAutoRefreshInterval,0)},i===undefined?500:i)},destroy:function(){var i=this,t=i._fields(),r=i.element,f,u;n.wijmo.wijspreadpanelex.panels=n.grep(n.wijmo.wijspreadpanelex.panels,function(n){return n!==i});if(!t.initialized)return;i._radiusKey&&i.element.css(i._radiusKey,""),t.intervalID!==undefined&&(window.clearInterval(t.intervalID),t.intervalID=undefined),t.resizer!==undefined&&t.resizer.resizable("destroy"),t.hbarContainer!==undefined&&(t.hbarDrag.remove(),t.hbarContainer.unbind("."+i.widgetName)),t.vbarContainer!==undefined&&(t.vbarDrag.remove(),t.vbarContainer.unbind("."+i.widgetName)),r.unbind("."+i.widgetName),t.contentWrapper.unbind("."+i.widgetName),f=t.stateContainer.find(">.wijmo-wijsuperpanel-button"),f.unbind("."+i.widgetName),u=t.templateWrapper,u.contents().each(function(n,t){r.append(t)}),t.stateContainer.remove(),t.tabindex&&r.removeAttr("tabindex"),r.removeClass(c+" "+e),n.Widget.prototype.destroy.apply(i,arguments)},_fields:function(){var t=this,i=t.element,r=t.widgetName+"-fields",n=t._fieldsStore;return n===undefined&&(n={},i.data(r,n),t._fieldsStore=n),n},_hasMode:function(t,i){var r=t.scrollMode.split(",");return r=n.map(r,function(t){return n.trim(t).toLowerCase()}),n.inArray(i.toLowerCase(),r)>-1},_bindElementEvents:function(n,t,i,r){var f=n._hasMode(r.hScroller,"edge"),e=n._hasMode(r.vScroller,"edge"),u=n.widgetName;f||e?n._mousemoveBind===undefined&&(n._mousemoveBind=!0,i.bind("mousemove."+u,n,n._contentMouseMove),i.bind("mouseleave."+u,null,function(){n._clearInterval()})):(i.unbind("mousemove",n._contentMouseMove),n._mousemoveBind=undefined),r.mouseWheelSupport?n._mouseWheelBind===undefined&&(n._mouseWheelBind=!0,i.bind("mousewheel."+u,n,n._panelMouseWheel)):(n.element.unbind("mousewheel",n._panelMouseWheel),n._mouseWheelBind=undefined),r.keyboardSupport?n._keyboardBind===undefined&&(n._keyboardBind=!0,i.bind("keydown."+u,n,n._panelKeyDown)):(i.unbind("keydown",n._panelKeyDown),n._keyboardBind=undefined)},_dragStop:function(n,t,i){var r={dragHandle:i};t._trigger("dragStop",n,r)},_contentMouseMove:function(t){var i=t.data,v=i.options,a,l,e,k,b,p,c,o,u,f,s,h,w,y,r;if(v.disabled)return;a=v.hScroller,l=v.vScroller,e=n(t.currentTarget),k=i._fields(),b=i._hasMode(a,"edge"),p=i._hasMode(l,"edge"),i._clearInterval(),c={X:t.pageX,Y:t.pageY},o=e.offset(),u=o.left,f=o.top,u=c.X-u,f=c.Y-f,s=a.hoverEdgeSpan,h=l.hoverEdgeSpan,w=e.innerHeight(),y=e.innerWidth(),r="",b&&(u<s&&(r="left"),u>y-s&&(r="right")),p&&(f<h&&(r="top"),f>w-h&&(r="bottom")),i._setScrollingInterval(k,r,i,!1)},_setScrollingInterval:function(n,t,i,r){var u=i.options;t.length>0&&(n.internalFuncID=window.setInterval(function(){i._doScrolling(t,i,r)},u.keyDownInterval))},_scrollButtonMouseOver:function(i){var r=i.data,f;if(r.options.disabled)return;f=n(i.currentTarget),f.hasClass(t)||(f.bind("mouseout."+r.widgetName,r,r._buttonMouseOut).bind("mousedown."+r.widgetName,r,r._buttonMouseDown).bind("mouseup."+r.widgetName,r,r._buttonMouseUp).addClass(u),r._buttonScroll(f,r,"buttonshover"))},_buttonScroll:function(n,t,i){var r="",e=t.options,o=t._fields(),u=t._hasMode(e.hScroller,i),f=t._hasMode(e.vScroller,i);n.hasClass("wijmo-wijsuperpanel-buttonleft")&&u?r="left":n.hasClass("wijmo-wijsuperpanel-buttonright")&&u?r="right":n.hasClass("wijmo-wijsuperpanel-buttontop")&&f?r="top":n.hasClass("wijmo-wijsuperpanel-buttonbottom")&&f&&(r="bottom"),r.length>0&&(t._clearInterval(),t._doScrolling(r,t,!0),t._setScrollingInterval(o,r,t,!0))},_buttonMouseDown:function(i){var u=i.data,r;if(u.options.disabled)return;r=n(i.currentTarget),r.hasClass(t)||(r.addClass(o),u._buttonScroll(r,u,"buttons"))},_buttonMouseUp:function(t){var r=t.data,i=n(t.currentTarget);i.removeClass("ui-state-active"),r._clearInterval()},_buttonMouseOut:function(t){var i=t.data,r=n(t.currentTarget);r.unbind("mouseout",i._buttonMouseOut).unbind("mousedown",i._buttonMouseDown).unbind("mouseup",i._buttonMouseUp).removeClass(u).removeClass(o),i._clearInterval()},_panelKeyDown:function(t){var i=t.data,f=i.options,r,u;if(!f.keyboardSupport||f.disabled)return;r=t.shiftKey,u=t.keyCode,u===n.ui.keyCode.LEFT?i._doScrolling("left",i,r):u===n.ui.keyCode.RIGHT?i._doScrolling("right",i,r):u===n.ui.keyCode.UP?i._doScrolling("top",i,r):u===n.ui.keyCode.DOWN&&i._doScrolling("bottom",i,r),t.stopPropagation(),t.preventDefault()},_draggingInternal:function(n,t,i,r){var f=i.dir,h=f==="h",s=h?"left":"top",a=n.position[s]-t._getScrollContainerPadding(s),c=t._getTrackLen(f)-r[h?"outerWidth":"outerHeight"](!0),l=a/c,e=i.scrollMax-i.scrollLargeChange+1,u=l*e,o;u<i.scrollMin&&(u=i.scrollMin),u>e&&(u=e),o={oldValue:i.scrollValue,newValue:u,dir:f};if(!t._scrolling(!0,t,o))return;i.scrollValue=u,t._setDragAndContentPosition(!0,!1,f,"dragging")},_dragging:function(t,i,r){var e=r.options,u=n(t.target),o=u.parent();o.hasClass(f)?r._draggingInternal(i,r,e.hScroller,u):r._draggingInternal(i,r,e.vScroller,u)},_panelMouseWheel:function(t,i){var u=t.data,h=u.options,l,r,c,o,s,e;if(!h.mouseWheelSupport||h.disabled)return;l=n(t.srcElement||t.originalEvent.target),r="",c=l.closest("."+f,u.element).size()>0,o=h.hScroller,s=h.vScroller,(t.wheelDelta===undefined||t.wheelDelta===null)&&(t.detail===undefined||t.detail===null)&&(t.wheelDelta=t.originalEvent.wheelDelta,t.detail=t.originalEvent.detail),t.wheelDelta&&(i=t.wheelDelta/120),t.detail&&(i=-t.detail/3),r=i>0?c?"left":"top":c?"right":"bottom",r.length>0&&u._doScrolling(r,u),e=!1,r==="left"&&(e=!u.hNeedScrollBar||Math.abs(o.scrollValue-o.scrollMin)<.001),r==="right"&&(e=!u.hNeedScrollBar||Math.abs(o.scrollValue-(o.scrollMax-u._getHScrollBarLargeChange()+1))<.001),r==="top"&&(e=!u.vNeedScrollBar||Math.abs(s.scrollValue-s.scrollMin)<.001),r==="bottom"&&(e=!u.vNeedScrollBar||Math.abs(s.scrollValue-(s.scrollMax-u._getVScrollBarLargeChange()+1))<.001),e&&h.bubbleScrollingEvent&&r!=="left"&&r!=="right"||(t.stopPropagation(),t.preventDefault())},_documentMouseUp:function(t){var i=t.data.self,r=t.data.ele;r.removeClass(o),i._clearInterval(),n(document).unbind("mouseup",i._documentMouseUp)},_scrollerMouseOver:function(t){var i=t.data,o,e,s;if(i.options.disabled)return;o=n(t.srcElement||t.originalEvent.target),e=null,s=!1,o.hasClass(r)?(e=o,s=!0):o.parent().hasClass(r)?(e=o.parent(),s=!0):(o.hasClass(h)||o.hasClass(f))&&(e=o),e!==undefined&&(s&&e.addClass(u),e.bind("mouseout."+i.widgetName,i,i._elementMouseOut),e.bind("mousedown."+i.widgetName,i,i._elementMouseDown),e.bind("mouseup."+i.widgetName,i,i._elementMouseUp))},_elementMouseUp:function(t){var i=n(t.currentTarget);i.removeClass("ui-state-active")},_elementMouseDown:function(t){var r=n(t.currentTarget),e=t.data,u,s,o,v,y,a,c,l;if(e.options.disabled||t.which!==1)return;u="",s=!1,o=!1;if(r.hasClass("wijmo-wijsuperpanel-vbar-buttontop"))u="top",o=!0;else if(r.hasClass("wijmo-wijsuperpanel-vbar-buttonbottom"))u="bottom",o=!0;else if(r.hasClass("wijmo-wijsuperpanel-hbar-buttonleft"))u="left",o=!0;else if(r.hasClass("wijmo-wijsuperpanel-hbar-buttonright"))u="right",o=!0;else if(r.hasClass(i)){r.addClass("ui-state-active");return}else r.hasClass(f)?(v=r.find("."+i),y=v.offset(),u=t.pageX<y.left?"left":"right",s=!0):r.hasClass(h)&&(a=r.find("."+i),c=a.offset(),u=t.pageY<c.top?"top":"bottom",s=!0);e._clearInterval(),e._doScrolling(u,e,s),l=e._fields(),e._setScrollingInterval(l,u,e,s),o&&r.addClass("ui-state-active"),n(document).bind("mouseup."+e.widgetName,{self:e,ele:r},e._documentMouseUp)},doScrolling:function(n,t){this._doScrolling(n,this,t)},_setScrollerValue:function(n,t,i,r,u,f,e){var c=t.scrollMin,v=f?r:i,s=t.scrollValue,o,h,a,l;s||(s=c),o=0;if(u){h=t.scrollMax-r+1;if(Math.abs(s-h)<.001)return e._clearInterval(),!1;a=t.firstStepChangeFix,o=s+v,f||Math.abs(s-c)>=.0001||isNaN(a)||(o+=a),o>h&&(o=h)}else{if(Math.abs(s-c)<.001)return e._clearInterval(),!1;o=s-v,o<0&&(o=c)}return l={oldValue:t.scrollValue,newValue:o,direction:n,dir:t.dir},e._scrolling(!0,e,l)?(t.scrollValue=l.newValue,!0):!1},_doScrolling:function(n,t,i){var r=t.options,o=r.vScroller,s=r.hScroller,h=t._getVScrollBarSmallChange(),u=t._getVScrollBarLargeChange(),f=t._getHScrollBarLargeChange(),e=t._getHScrollBarSmallChange();if(n==="top"||n==="bottom"){if(!t._setScrollerValue(n,o,h,u,n==="bottom",i,t))return;n="v"}else if(n==="left"||n==="right"){if(!t._setScrollerValue(n,s,e,f,n==="right",i,t))return;n="h"}t._setDragAndContentPosition(!0,!0,n)},_disableButtonIfNeeded:function(n){var i=n._fields(),r,e,c,o,h,a,y,f,s,p,v,u,l;i.intervalID>0&&window.clearInterval(i.intervalID),r=n.options,e=i.buttonLeft,c=i.buttonRight,o=i.buttonTop,h=i.buttonBottom,e!==undefined&&(a=n._getHScrollBarLargeChange(),y=r.hScroller.scrollMax-a+1,f=r.hScroller.scrollValue,s=r.hScroller.scrollMin,f===undefined&&(f=s),Math.abs(f-s)<.001||!i.hScrolling?e.addClass(t):e.removeClass(t),Math.abs(f-y)<.001||!i.hScrolling?c.addClass(t):c.removeClass(t)),o!==undefined&&(p=n._getVScrollBarLargeChange(),v=r.vScroller.scrollMax-p+1,u=r.vScroller.scrollValue,l=r.vScroller.scrollMin,u===undefined&&(u=l),Math.abs(u-l)<.001||!i.vScrolling?o.addClass(t):o.removeClass(t),Math.abs(u-v)<.001||!i.vScrolling?h.addClass(t):h.removeClass(t))},_clearInterval:function(){var t=this._fields(),n=t.internalFuncID;n>0&&(window.clearInterval(n),t.internalFuncID=-1)},_elementMouseOut:function(t){var i=n(t.currentTarget),r=t.data;i.unbind("mouseout",r._elementMouseOut),i.unbind("mousedown",r._elementMouseDown),i.unbind("mouseup",r._elementMouseUp),i.removeClass(u)},_getScorllOffset:function(t){var h=n(t),l,f,v,i,e,r,o,a,s,c,u={left:null,top:null};return h.size()===0?u:(l=this._fields(),f=l.contentWrapper,v=l.templateWrapper,i=h.offset(),e=v.offset(),i.leftWidth=i.left+h.outerWidth(),i.topHeight=i.top+h.outerHeight(),r=f.offset(),r.leftWidth=r.left+f.outerWidth(),r.topHeight=r.top+f.outerHeight(),s=i.left-e.left,i.left<r.left?u.left=s:i.leftWidth>r.leftWidth&&(c=i.leftWidth-e.left-f.innerWidth(),u.left=s<c?s:c),o=i.top-e.top,i.top<r.top?u.top=o:i.topHeight>r.topHeight&&(a=i.topHeight-e.top-f.innerHeight(),u.top=o<a?o:a),u)},needToScroll:function(n){var t=this._getScorllOffset(n);return t.top!==null||t.left!==null},scrollChildIntoView:function(n){var r=this._getScorllOffset(n),i=r.left,t=r.top;i!==null&&this.hScrollTo(i),t!==null&&this.vScrollTo(t)},hScrollTo:function(n){var t=this.options;t.hScroller.scrollValue=this.scrollPxToValue(n,"h"),this._setDragAndContentPosition(!0,!0,"h","nonestop")},vScrollTo:function(n){var t=this.options;t.vScroller.scrollValue=this.scrollPxToValue(n,"v"),this._setDragAndContentPosition(!0,!0,"v","nonestop")},scrollPxToValue:function(n,t){var f=this.options,v=t==="h"?"outerWidth":"outerHeight",a=t==="h"?"contentWidth":"contentHeight",o=t==="h"?"hScroller":"vScroller",e=this._fields(),s=e.contentWrapper,p=e[a],y=s[v](),u=f[o].scrollMin,l=f[o].scrollMax,h=l-u,c=t==="h"?this._getHScrollBarLargeChange():this._getVScrollBarLargeChange(),r=h-c+1,i=r*(n/(p-y));return i<u&&(i=u),i>r&&(i=r),i},scrollTo:function(n,t){this.hScrollTo(n),this.vScrollTo(t)},refresh:function(){this.paintPanel()},paintPanel:function(t){var i=this,f=i.element,o,e,r,u;return f.is(":visible")?(o=typeof document.activeElement!="unknown"?document.activeElement:undefined,e=i.options,r=i._fields(),r.initialized||i._initialize(r,f,i),i._resetLargeChange(i,r,e),i._bindElementEvents(i,r,f,e),u=r.templateWrapper,u.css({float:"left",left:"0px",top:"0px",width:"auto",height:"auto"}),u.hide(),u.show(),r.contentWidth=u.width(),r.contentHeight=u.height(),u.css("float",""),i._setRounder(i,f),i._setInnerElementsSize(r,f),i._testScroll(i,r,e)===!1?!1:(i._initScrollBars(i,r,e),i._initScrollButtons(i,r,e),i._trigger("painted"),i._paintedMark={date:new Date,mainWidth:f[0].offsetWidth,mainHeight:f[0].offsetHeight,width:r.contentWidth,height:r.contentWidth},o===undefined||t||n(o).focus(),!0)):!1},_resetLargeChange:function(n,t,r){var u;n._autoVLarge&&(r.vScroller.scrollLargeChange=null),n._autoHLarge&&(r.hScroller.scrollLargeChange=null),t.vTrackLen=undefined,t.hTrackLen=undefined,t.vbarContainer&&(u=t.vbarContainer.children("."+i+":eq(0)"),u.detach(),t.vbarContainer.remove(),t.vbarContainer=undefined),t.hbarContainer&&(u=t.hbarContainer.children("."+i+":eq(0)"),u.detach(),t.hbarContainer.remove(),t.hbarContainer=undefined)},_initialize:function(n,t,i){n.initialized=!0,t.addClass(c),n.oldHeight=t.css("height");var r=t.css("overflow");t.css("overflow",""),t.height(t.height()),t.css("overflow",r),i._createAdditionalDom(i,n,t)},getContentElement:function(){return this._fields().templateWrapper},_setButtonPosition:function(t,i,r,u,f,e,o){var s=u==="h",k="mouseover."+t.widgetName,y=s?"buttonLeft":"buttonTop",p=s?"buttonRight":"buttonBottom",c=e[y],v=e[p],b,w,h;t._hasMode(r,"buttons")||t._hasMode(r,"buttonshover")?(b=s?l:a,c===undefined&&(w=n(b).appendTo(o),w.bind(k,t,t._scrollButtonMouseOver),e[y]=c=o.children(s?".wijmo-wijsuperpanel-buttonleft":".wijmo-wijsuperpanel-buttontop"),e[p]=v=o.children(s?".wijmo-wijsuperpanel-buttonright":".wijmo-wijsuperpanel-buttonbottom")),h={my:s?"left":"top",of:f,at:s?"left":"top",collision:"none"},n.extend(h,r.decreaseButtonPosition),c.position(h),h={my:s?"right":"bottom",of:f,at:s?"right":"bottom",collision:"none"},n.extend(h,r.increaseButtonPosition),v.position(h)):c!==undefined&&(c.remove(),v.remove(),e[y]=e[p]=undefined)},_initScrollButtons:function(n,t,i){var u=t.contentWrapper,r=t.stateContainer;n._setButtonPosition(n,i,i.hScroller,"h",u,t,r),n._setButtonPosition(n,i,i.vScroller,"v",u,t,r)},_getVScrollBarSmallChange:function(){var n=this.options,t;return n.vScroller.scrollSmallChange||(t=this._getVScrollBarLargeChange(),n.vScroller.scrollSmallChange=t/2),n.vScroller.scrollSmallChange},_getVScrollBarLargeChange:function(){return this._getLargeChange("v")},_getLargeChange:function(n){var f=this,a=f.options,l=f._fields(),i=n==="v",t=i?a.vScroller:a.hScroller,w=i?"innerHeight":"innerWidth",p=i?"contentHeight":"contentWidth",y=i?"_autoVLarge":"_autoHLarge",v,c,o,h,u,s,e,r;return t.scrollLargeChange?t.scrollLargeChange:(v=t.scrollMax,c=t.scrollMin,o=v-c,h=l.contentWrapper,u=h[w](),s=l[p],e=u/(s-u),r=(o+1)*e/(1+e),isNaN(r)&&(r=0),t.scrollLargeChange=r,f[y]=!0,t.scrollLargeChange)},_getHScrollBarSmallChange:function(){var n=this.options,t;return n.hScroller.scrollSmallChange||(t=this._getHScrollBarLargeChange(),n.hScroller.scrollSmallChange=t/2),n.hScroller.scrollSmallChange},_getHScrollBarLargeChange:function(){return this._getLargeChange("h")},_initScrollBars:function(n,t,i){var p=i.hScroller,g=p.scrollMax,b=p.scrollMin,k=g-b,y=i.vScroller,d=y.scrollMax,tt=y.scrollMin,nt=d-tt,r=t.hbarDrag,u=t.vbarDrag,w,f,o,v,e,l,s,c,a,h;n.hNeedScrollBar&&r.is(":visible")&&(w=n._getHScrollBarLargeChange(),f=n._getTrackLen("h"),o=n._getDragLength(k,w,f,i.hScroller.scrollMinDragLength),r.width(o),v=r.outerWidth(!0)-r.width(),r.width(o-v),e=r.children("span"),e.css("margin-left",(r.width()-e[0].offsetWidth)/2),f>r.outerWidth(!0)?r.show():r.hide()),n.vNeedScrollBar&&u.is(":visible")&&(l=n._getVScrollBarLargeChange(),s=n._getTrackLen("v"),c=n._getDragLength(nt,l,s,i.vScroller.scrollMinDragLength),u.height(c),a=u.outerHeight(!0)-u.height(),u.height(c-a),h=u.children("span"),h.css("margin-top",(u.height()-h[0].offsetHeight)/2),s>u.outerHeight(!0)?u.show():u.hide()),n._setDragAndContentPosition(!1,!1,"both")},_getTrackLen:function(n){var f=this,t=f._fields(),u=n+"TrackLen",e,o,i,r;return t[u]!==undefined?t[u]:(e=t.hbarContainer,o=t.vbarContainer,i=0,r=0,n==="h"&&(r=f._getScrollContainerPadding("h"),i=e.innerWidth()),n==="v"&&(r=f._getScrollContainerPadding("v"),i=o.innerHeight()),t[u]=i-r)},_getScrollContainerPadding:function(n){var r=this,u=r._fields(),t=0,i,f;if(n==="h")t=r._getScrollContainerPadding("left")+r._getScrollContainerPadding("right");else if(n==="v")t=r._getScrollContainerPadding("top")+r._getScrollContainerPadding("bottom");else{i=n==="left"||n==="right"?u.hbarContainer:u.vbarContainer,f=n+"Padding";if(u[f]!==undefined)return t=u[f];i&&i.css&&(t=parseFloat(i.css("padding-"+n))),u[f]=t}return t},_triggerScroll:function(n,t,i){var r={position:n,dir:t,animationOptions:i};this._trigger("scroll",null,r)},_contentDragAnimate:function(t,i,r,u,f,e,o){var s=this,l=s.options,c=t==="v",b=c?l.vScroller:l.hScroller,st=c?"outerHeight":"outerWidth",ht=c?"innerHeight":"innerWidth",yt=c?"contentHeight":"contentWidth",vt=c?"top":"left",tt=b.scrollMin,lt=b.scrollMax,ct=lt-tt,v=b.scrollValue===undefined?tt:b.scrollValue-tt,pt=s._getLargeChange(t),p=ct-pt+1,g=s._fields(),at=g.contentWrapper,y=g.templateWrapper,h,a,rt,et,ut,it,d,ft,w,k,ot,nt;v>p&&(v=p),h=(g[yt]-at[ht]())*(v/p),Math.abs(h)<.001&&(h=0),h=Math.round(h),a=-1,r!==undefined&&(i&&u.is(":animated")&&f!=="nonestop"&&u.stop(!0,!1),rt=s._getTrackLen(t),et=u[st](!0),ut=rt-et,it=s._getScrollContainerPadding(vt),a=v/p*ut+it),i&&l.animationOptions&&!l.animationOptions.disabled?(a<0||o==="dragging"||(d=n.extend({},l.animationOptions),d.complete=undefined,ft=c?{top:a}:{left:a},u.animate(ft,d)),w=n.extend({},l.animationOptions),k=l.animationOptions.complete,w.complete=function(){s._scrollEnd(e,s,t),n.isFunction(k)&&k(arguments)},i&&y.is(":animated")&&f!=="nonestop"&&y.stop(!0,!1),ot=c?{top:-h}:{left:-h},y.animate(ot,w),s._triggerScroll(h,t,w)):(nt=c?"top":"left",a<0||o==="dragging"||(u[0].style[nt]=a+"px"),y[0].style[nt]=-h+"px",s._triggerScroll(h,t),s._scrollEnd(e,s,t))},_setDragAndContentPosition:function(n,t,i,r,u){var e=this,f=e._fields(),h=f.hbarContainer,c=f.hbarDrag,o=f.vbarContainer,s=f.vbarDrag;(i==="both"||i==="h")&&f.hScrolling&&e._contentDragAnimate("h",t,h,c,r,n,u),(i==="both"||i==="v")&&f.vScrolling&&e._contentDragAnimate("v",t,o,s,r,n,u),f.intervalID>0&&window.clearInterval(f.intervalID),f.intervalID=window.setInterval(function(){e._disableButtonIfNeeded(e)},500)},_scrolling:function(n,t,i){var r=!0;return n&&(i.beforePosition=t.getContentElement().position(),t._beforePosition=i.beforePosition,r=t._trigger("scrolling",null,i)),r},_scrollEnd:function(n,t,i){n&&window.setTimeout(function(){var u=t.getContentElement(),r,n;if(!u.is(":visible"))return;r=t.getContentElement().position(),n={dir:i,beforePosition:t._beforePosition,afterPosition:r},t._trigger("scrolled",null,n)},0)},_getDragLength:function(n,t,i,r){var e=n/t,u=i/e,f=r;return u<f?u=f:u+1<i||(u=i-1),Math.round(u)},_needScrollbar:function(n,t){var u=this._hasMode(n,"scrollbar"),i=n.scrollBarVisibility;return u&&(i==="visible"||i==="auto"&&t)},_bindBarEvent:function(t,i,r){var u=this;u._isDragging=!1,t.bind("mouseover."+u.widgetName,u,u._scrollerMouseOver),i.draggable({axis:r==="h"?"x":"y",start:function(n,t){u._isDragging=!0},drag:function(n,t){u._dragging(n,t,u)},containment:"parent",stop:function(t){u._dragStop(t,u,r),n(t.target).removeClass("ui-state-active"),u._isDragging=!1}})},_createBarIfNeeded:function(t,r,u,f,e){if(t){var c=this,y,v=c._fields(),w=u+"barContainer",p=u+"barDrag",o=u==="h",s=e[o?"innerHeight":"innerWidth"](),h=v[w]=n(f),l,a;r.append(h),l=h[0][o?"offsetHeight":"offsetWidth"],s=s-l,y={direction:o?"horizontal":"vertical",targetBarLen:l,contentLength:s};if(c._trigger(o?"hScrollerActivating":"vScrollerActivating",null,y)===!1)return!1;a=v[p]=h.find("."+i),c._bindBarEvent(h,a,u),e[o?"height":"width"](s)}},_setScrollbarPosition:function(n,t,i,r,u,f,e,o,s,h,c){var l=h==="h",v,k,d,p,g,b,y,w,a;f?(v=r[0][l?"offsetHeight":"offsetWidth"],k=t._getScrollContainerPadding(h),d=l?"top":"left",p=l?{top:"0px",bottom:"auto",left:"auto",right:"auto"}:{left:"0px",right:"auto",top:"auto",bottom:"auto"},g=l?{top:v+"px"}:{left:v+"px"},b=l?{top:"auto",right:"auto",left:"auto",bottom:"0px"}:{left:"auto",right:"0px",top:"auto",bottom:"auto"},y=l?{top:""}:{left:""},w=i[l?"innerWidth":"innerHeight"](),o===d?(r.css(p),i.css(g),l?(r.children(".wijmo-wijsuperpanel-hbar-buttonleft").removeClass("ui-corner-bl").addClass("ui-corner-tl"),r.children(".wijmo-wijsuperpanel-hbar-buttonright").removeClass("ui-corner-br").addClass("ui-corner-tr"),r.removeClass("ui-corner-bottom").addClass("ui-corner-top")):(r.children(".wijmo-wijsuperpanel-vbar-buttontop").removeClass("ui-corner-tr").addClass("ui-corner-tl"),r.children(".wijmo-wijsuperpanel-vbar-buttonbottom").removeClass("ui-corner-br").addClass("ui-corner-bl"),r.removeClass("ui-corner-right").addClass("ui-corner-left"))):(r.css(b),i.css(y),l?(r.children(".wijmo-wijsuperpanel-hbar-buttonleft").removeClass("ui-corner-tl").addClass("ui-corner-bl"),r.children(".wijmo-wijsuperpanel-hbar-buttonright").removeClass("ui-corner-bl").addClass("ui-corner-br"),r.removeClass("ui-corner-top").addClass("ui-corner-bottom")):(r.children(".wijmo-wijsuperpanel-vbar-buttontop").removeClass("ui-corner-tl").addClass("ui-corner-tr"),r.children(".wijmo-wijsuperpanel-vbar-buttonbottom").removeClass("ui-corner-bl").addClass("ui-corner-br"),r.removeClass("ui-corner-left").addClass("ui-corner-right"))),a=0,e&&(a=u[0][l?"offsetWidth":"offsetHeight"],s==="left"?r.css("right","0px"):s==="right"?r.css("left","0px"):s==="top"?r.css("bottom","0px"):s==="bottom"&&r.css("top","0px")),!l&&e&&(a=0),r[l?"width":"height"](w-k),t._enableDisableScrollBar(h,r,!c)):n.css(l?"left":"top","")},_testScroll:function(n,t,i){var u=t.templateWrapper,f=t.contentWrapper,l=t.stateContainer,v=f.innerWidth(),p=f.innerHeight(),b=t.contentWidth,w=t.contentHeight,r,e,c,o,h,a;t.hScrolling=b>v,t.vScrolling=w>p,r=n.hNeedScrollBar=n._needScrollbar(i.hScroller,t.hScrolling);if(n._createBarIfNeeded(r,l,"h",s,f)===!1)return!1;r&&!t.vScrolling&&(u.css("float","left"),t.contentHeight=u.height(),t.vScrolling=t.contentHeight>p-t.hbarContainer[0].offsetHeight,u.css("float","")),e=n.vNeedScrollBar=n._needScrollbar(i.vScroller,t.vScrolling);if(n._createBarIfNeeded(e,l,"v",y,f)===!1)return!1;if(e&&!t.hScrolling){u.css("float","left"),t.contentWidth=u.width(),t.hScrolling=t.contentWidth>v-t.vbarContainer[0].offsetWidth,u.css("float","");if(t.hScrolling&&!r){r=n.hNeedScrollBar=n._needScrollbar(i.hScroller,t.hScrolling);if(n._createBarIfNeeded(r,l,"h",s,f)===!1)return!1}}c=t.hbarContainer,o=t.vbarContainer,h=i.hScroller.scrollBarPosition,a=i.vScroller.scrollBarPosition,n._setScrollbarPosition(u,n,f,c,o,r,e,h,a,"h",t.hScrolling),n._setScrollbarPosition(u,n,f,o,c,e,r,a,h,"v",t.vScrolling)},_enableDisableScrollBar:function(n,u,f){n==="v"?(u[f?"addClass":"removeClass"]("wijmo-wijsuperpanel-vbarcontainer-disabled"),u.find("."+r)[f?"addClass":"removeClass"](t)):n==="h"&&(u[f?"addClass":"removeClass"]("wijmo-wijsuperpanel-hbarcontainer-disabled"),u.find("."+r)[f?"addClass":"removeClass"](t)),u.children("."+i)[f?"hide":"show"]()},_initResizer:function(){var t=this,f=t.options,r=t._fields(),e=r.resizer,i,u;!e&&f.allowResize&&(i=f.resizableOptions,u=i.stop,i.stop=function(i){t._resizeStop(i,t),n.isFunction(u)&&u(i)},r.resizer=e=t.element.resizable(i)),!f.allowResize&&r.resizer&&(e.resizable("destroy"),r.resizer=null)},_resizeStop:function(n,t){this.options.autoRefresh||t.paintPanel(!0),t._trigger("resized")},_createAdditionalDom:function(t,i,r){r.attr("tabindex")||(r.attr("tabindex","-1"),i.tabindex=!0);var u=i.stateContainer=n(v),f;i.contentWrapper=u.children(),f=i.templateWrapper=i.contentWrapper.children(),r.contents().each(function(t,r){var u=n(r);if(u.hasClass("wijmo-wijsuperpanel-header")){i.header=u;return}if(u.hasClass("wijmo-wijsuperpanel-footer")){i.footer=u;return}f[0].appendChild(r)}),i.header!==undefined&&r.prepend(i.header),r[0].appendChild(u[0]),i.footer!==undefined&&i.footer.insertAfter(u)},_setRounder:function(t,i){if(this.options.showRounder){i.addClass(e);if(t._rounderAdded)return;if(n.browser.msie)return;var r,u,o,f;r=u="",n.browser.webkit?(u="WebkitBorderTopLeftRadius",r="WebkitBorderRadius"):n.browser.mozilla?(u="MozBorderRadiusBottomleft",r="MozBorderRadius"):(u="border-top-left-radius",r="border-radius"),o=i.css(u),f=parseInt(o,10),i.css(r,f+1),t._rounderAdded=!0,t._radiusKey=r}else i.removeClass(e)},_setInnerElementsSize:function(n,t){var o=n.stateContainer,s=n.contentWrapper,e=0,i,u,f,r;n.header!==undefined&&(e+=n.header.outerHeight()),n.footer!==undefined&&(e+=n.footer.outerHeight()),i=o[0].style,u=t.innerHeight()-e,f=t.innerWidth(),i.display="none",i.height=u+"px",i.width=f+"px",r=s[0].style,r.height=u+"px",r.width=f+"px",i.display=""}})})(jQuery);(function(n,t){"use strict";var d="undefined",e=n.GrapeCity;typeof e===d&&(e=n.GrapeCity={}),typeof e.UI===d&&(e.UI={});var i=e.UI,u=n.document,s="refresh",h="scroll",w="resize",fi="horizontal",ui="vertical",oi="input",l="div",r="px",f="0",ot="3000",v="hidden",ct="visible",ei="top",ri="none",b="wijspreadpanelexscrolling",ni="wijspreadpanelexdragstop",o=".gcSpread",gt="_data";i.GcSpread=function(n,t,i){this._init(n,t,i)},i.GcSpread.prototype={_scrollbarSize:18,_host:null,_allowUndo:!0,_paintSuspended:!1,_availableSheetIndex:-1,sheets:null,name:null,_tabStripRatio:.5,_activeSheetIndex:0,_allowUserZoom:!0,_allowUserResize:!0,_tabStripVisible:!0,_tabEditable:!0,_newTabVisible:!0,useWijmoTheme:!1,_init:function(n,t,r){var f,o,s;for(this.name=n,this.calcService=new e.Calc.Service(this),this._userEvents=[],this._userEventsElem=u.createElement(oi),this._eventSuspended=0,this._undoManager=new i._UndoManager(this,-1,this.allowUndo()),this._clipboardHelper={fromSheet:null,range:null,isCutting:!1},this.sheets=[],f=0;f<t;f++)this.sheets.push(this._createSheet(this._getDefaultSheetName(f)));if(this.sheets.length>0){for(o=null,f=0;!o&&f<this.sheets.length;f++)o=this.sheets[f]._getSheetSource();if(o)for(f=0;f<this.sheets.length;f++)s=this.sheets[f]._getSheetSource(),s&&s.shareCalculations(o)}r&&this._setHost(r)},_getDefaultSheetName:function(n){var i,u,r,t,f;this._availableSheetIndex<this.getSheetCount()?this._availableSheetIndex=this.getSheetCount():this._availableSheetIndex++,(n===undefined||n===null||n<this._availableSheetIndex)&&(n=this._availableSheetIndex),i=!1;do{u="Sheet"+(n+1),r=this.sheets.length;if(r>0)for(t=0;t<r;t++)if(t in this.sheets){f=this.sheets[t];if(f._name===u){n++,i=!0;break}else i&&(i=!1)}}while(i);return u},_createSheet:function(n,t,r){var u=new i.GcSheet(n);return u.borderWidth=0,u.setRowCount(t?t:200),u.setColumnCount(r?r:20),u.calcService=this.calcService,u.parent=this,u.borderWidth=0,u},_setHost:function(c){var rt,a,k,y,p,et,it,d,tt,b,nt,ht,st,g,ft,ut;this._host=c;if(c){for(rt=[],y=this,a=0;a<c.children.length;a++)rt.push(c.children[a]);c.innerHTML="<table cellspacing=0 cellpadding=0 border=0><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>",p=c.firstChild;while(rt.length>0)c.insertBefore(rt.pop(),p);for(this._vp=u.createElement(l),this._vp.id=c.id+"vp",p.rows[0].cells[0].insertBefore(this._vp,null),et="100%",p.style.width=et,p.style.height=et,p.style.border=f,p.style.margin=f,a=0;a<p.rows.length;a++)for(k=0;k<p.rows[a].cells.length;k++)p.rows[a].cells[k].style.padding=f,p.rows[a].cells[k].style.border=f;for(this._vs=u.createElement(l),this._vs.id=c.id+"vs",this._vs.style.overflowY=h,this._vs.style.overflowX=v,this._vs.style.border=f,p.rows[0].cells[1].insertBefore(this._vs,null),this._vscrollDelegate=function(n,t){var u=y.getActiveSheet(),r;u&&t&&(r=parseInt(t.newValue,10),(t.oldValue===undefined||t.oldValue===null)&&(t.oldValue=0),t.oldValue=parseInt(t.oldValue,10),t.direction===ei?t.oldValue-t.newValue==10&&(r=u._getPrevPageTopRow()):t.direction==="bottom"&&t.newValue-t.oldValue==10&&(r=u._getNextPageTopRow()),t.newValue!==r&&(t.newValue=r),t.oldValue!==r&&(u._eventHandler.doVScroll(r),u._trigger(i.Events.TopRowChanged,{sheet:u,sheetName:u._name,oldTopRow:t.oldValue,newTopRow:r})))},this.initPaint=function(){var u=e.UI._isStandardCanvas(),r,t,i;if(u)return;r=this.getActiveSheet();if(!r)return;t=r._getCanvas(),t&&t.firstChild&&t.firstChild.loaded?(this.invalidateLayout(),this.repaint()):(i=this,n.setTimeout(function(){i.initPaint.call(i)},10))},this.vScrollStop=function(n,i){var r=y.getActiveSheet();if(r){var e=t(y._vs),u=e.wijspreadpanelex().data().wijspreadpanelex.options,o=u.vScroller.scrollValue,f=!1;o<r._getFirstPageTopRow()?(u.vScroller.scrollValue=r._getFirstPageTopRow(),f=!0):o>r._getLastPageTopRow()&&(u.vScroller.scrollValue=r._getLastPageTopRow(),f=!0),f&&(e.wijspreadpanelex(s),y._refreshScrollbar())}},t(this._vs).bind(h+o,this._vscrollDelegate),t(this._vs).bind(ni+o,this.vScrollStop),it=u.createElement(l),it.id=c.id+"vsDummy",this._vs.appendChild(it),it.style.height=ot+r,it.style.width="1"+r,p.rows[1].cells[0].innerHTML="<table cellspacing=0 cellpadding=0 border=0><tr><td></td><td></td></tr></table>",d=p.rows[1].cells[0].firstChild,d.style.border=f,d.style.margin=f,a=0;a<d.rows.length;a++)for(k=0;k<d.rows[a].cells.length;k++)d.rows[a].cells[k].style.padding=f,d.rows[a].cells[k].style.border=f;this._tabs=u.createElement(l),this._tabs.style.width=""+this._getActualTabStripRatio()*this._host.clientWidth+r,this._tabs.style.height=""+this._scrollbarSize+r,d.rows[0].cells[0].insertBefore(this._tabs,null),this._tab=new i._GcTab(c.getAttribute("id")+"_tabStrip"),this._tab.setOwner(this),this._tab._setHost(this._tabs),this._hs=u.createElement(l),this._hs.id=c.id+"hs",this._hs.style.overflowX=h,this._hs.style.overflowY=v,this._hs.style.border=f,d.rows[0].cells[1].insertBefore(this._hs,null),this._hscrollDelegate=function(n,t){var r=y.getActiveSheet(),u;r&&(u=parseInt(t.newValue,10),(t.oldValue===undefined||t.oldValue===null)&&(t.oldValue=0),t.oldValue=parseInt(t.oldValue,10),t.direction==="left"?t.oldValue-t.newValue==10&&(u=r._getPrevPageLeftColumn()):t.direction==="right"&&t.newValue-t.oldValue==10&&(u=r._getPageRightColumn()),t.newValue!==u&&(t.newValue=u),t.oldValue!==t.newValue&&(r._eventHandler.doHScroll(u),r._trigger(i.Events.LeftColumnChanged,{sheet:r,sheetName:r._name,oldLeftCol:t.oldValue,newLeftCol:t.newValue})))},this.hScrollStop=function(n,i){var r=y.getActiveSheet();if(r){var e=t(y._hs),f=e.wijspreadpanelex().data().wijspreadpanelex.options,o=f.hScroller.scrollValue,u=!1;o<r._getFirstPageLeftColumn()&&(f.hScroller.scrollValue=r._getFirstPageLeftColumn(),u=!0),u&&(e.wijspreadpanelex(s),y._refreshScrollbar())}},t(this._hs).bind(h+o,this._hscrollDelegate),t(this._hs).bind(ni+o,this.hScrollStop),tt=u.createElement(l),tt.id=c.id+"hsDummy",this._hs.appendChild(tt),tt.style.width=ot+r,tt.style.height="1"+r,t(n).bind(w+o,i.createEventHandler(this,this._doResize)),(t.browser.chrome||t.browser.safari)&&(b=u.createElement(l),b.id=c.id+"vsTest",b.style.overflowY=h,b.style.overflowX=v,b.style.border=f,b.style.height="200"+r,b.style.width="26"+r,b.style.position="absolute",b.style.left="-1000"+r,this._dummyScrollbar=b,u.body.insertBefore(b,null),nt=u.createElement(l),nt.id=c.id+"dummyPanel",b.appendChild(nt),nt.style.height=ot+r,nt.style.width="1"+r,ht={allowResize:!1,keyboardSupport:!1,bubbleScrollingEvent:!1,hScroller:{scrollBarVisibility:v},vScroller:{scrollSmallChange:1,scrollLargeChange:10,scrollMin:0,scrollMax:100,scrollBarVisibility:ct}},st=t(this._dummyScrollbar),st.css("overflowY",""),st.wijspreadpanelex(ht)),g=this.getActiveSheet(),g&&(g._setHost(this._vp),t(n).unbind("resize.gcSheet"),g._scrollCallback=function(n){var r,f,i,u;n.action===h?n.orientation===ui?(r=t(y._vs),f=r.wijspreadpanelex().data().wijspreadpanelex.options,f.vScroller.scrollValue=g._scrollTopRow,r.wijspreadpanelex(s),y._refreshScrollbar()):n.orientation===fi&&(i=t(y._hs),u=i.wijspreadpanelex().data().wijspreadpanelex.options,u.hScroller.scrollValue=g._scrollLeftCol,i.wijspreadpanelex(s),y._refreshScrollbar()):n.action===w&&y._doResize()}),this._doResize(),this._loadData(),ft=this._getFunction(this._host.id+"_onLoad"),ft&&ft(this),this.submitDelegate=function(n){var t=n.onsubmit;n.onsubmit=function(){y.saveData(),typeof t=="function"&&t.apply()}},ut=t(u.forms).get(0),ut&&this.submitDelegate(ut)}},_refreshScrollbar:function(){if(this._dummyScrollbar){var n=t(this._dummyScrollbar);n.wijspreadpanelex(s)}},_loadData:function(n){var ot=this._host.id,nt=u.getElementById(ot+gt),h,f,v,e,s,y,a,ut,k,b,t,it,rt,w,ft,l,g,c,r,p,tt;if(!nt||nt.value==="")return;h=typeof JSON!="undefined"&&JSON.parse?JSON.parse(nt.value):null;if(h===undefined||h===null)return;this.suspendEvent(),this.isPaintSuspended(!0),f=null,h.length>0&&(f=JSON.parse(h[0])),this.calcService.suspend(),this.setSheetCount(f.sheetCount),h.length>0&&f.referenceStyle!==null&&f.referenceStyle!==undefined&&this.referenceStyle(f.referenceStyle);if(h.length>1)for(ut=[],e=1;e<h.length;e++){t=JSON.parse(h[e]),r=this.sheets[e-1],it=t.name,k=t.rowCount,b=t.columnCount,r._allowCellOverflow=f.allowCellOverflow,v=t.data;if(v){if(n)for(s in v)typeof s!="function"&&(r._dataModel.dataTable[s]=v[s]);else r._dataModel.dataTable=v;r._dataModel.dataTable.length=k}t.dataSource&&t.dataSource.length>0&&(rt=JSON.parse(t.dataSource),rt&&(r._dataSource=rt)),t.rows&&(r._rowInfos=t.rows),t.columns&&(r._colInfos=t.columns,r._colInfos.length=b);if(t.spans)for(s=0;s<t.spans.length;s++)w=t.spans[s],r._addSpanImp(w.Row,w.Column,w.RowCount,w.ColumnCount);if(t.colStyles)for(y in t.colStyles)isNaN(y)||(a=parseInt(y,10),r.setStyle(-1,a,t.colStyles[y]));if(t.rowStyles)for(y in t.rowStyles)isNaN(y)||(ft=parseInt(y,10),r.setStyle(ft,-1,t.rowStyles[y],i.SheetArea.viewport));t.rowHeaderAutoText!==null&&t.rowHeaderAutoText!==undefined&&(r.rowHeaderAutoText=t.rowHeaderAutoText),t.colHeaderAutoText!==null&&t.colHeaderAutoText!==undefined&&(r.colHeaderAutoText=t.colHeaderAutoText),t.referenceStyle!==null&&t.referenceStyle!==undefined&&r.referenceStyle(t.referenceStyle),t.gridline!==null&&t.gridline!==undefined&&(r.gridline=t.gridline),r._dataModel.name=it,r._name=it,r.setRowCount(k),r.setColumnCount(b),r.setActiveCell(t.ar,t.ac),r.setFrozenCount(t.frozenRowCount,t.frozenColCount),ut[e]=v}if(h.length>0){this.setActiveSheetIndex(f.activeSheetIndex),typeof f.tabStripRatio!="undefined"&&this.setTabStripRatio(f.tabStripRatio),typeof f.tabStripVisible!="undefined"&&(this._tabStripVisible=f.tabStripVisible),typeof f.tabEditable!="undefined"&&(this._tabEditable=f.tabEditable),typeof f.newTabVisible!="undefined"&&(this._newTabVisible=f.newTabVisible),this.gcSpreadsheet=f.gcSpreadsheet,r=this.getActiveSheet();if(r){l=f.theme;if(typeof l=="string"||typeof l===d)r.currentTheme(l);else{var o=l.themeColor,et=new i.ThemeColor(l.name,o.text1,o.text2,o.background1,o.background2,o.accent1,o.accent2,o.accent3,o.accent4,o.accent5,o.accent6,o.link,o.followedLink),st=new i.SpreadTheme(l.name,et,l.headingFont,l.bodyFont);r.currentTheme(st)}}f.useWijmoTheme&&(this.useWijmoTheme=f.useWijmoTheme);if(f.names)for(g=0;g<f.names.length;g++)c=f.names[g],c.sn?(r=this.getSheetFromName(c.sn),r&&r.addCustomName(c.name,c.formula,c.row,c.col)):this.addCustomName(c.name,c.formula,c.row,c.col);for(e=1;e<h.length;e++){v=ut[e],r=this.sheets[e-1],k=r.getRowCount(),b=r.getColumnCount();for(s in v)if(typeof s!="function"){p=v[s];if(p)for(a=0;a<b;a++)tt=null,p[a]&&(tt=p[a].formula),tt&&(p[a].formula=null,r.setFormula(parseInt(s,10),a,tt))}}}for(this.calcService.resume(),this._recalcAll(),e=0;e<this.sheets.length;e++)r=this.sheets[e],r.clearPendingChanges();this.resumeEvent(),this.isPaintSuspended(!1),nt.value=""},_getFunction:function(t){if(t===undefined||t===null||t==="")return null;try{return n[t]}catch(i){}return null},_dispose:function(){t(n).unbind(w+o),t(this._vs).unbind(h+o),t(this._hs).unbind(h+o),this._disposeUserEvents();var i=this.getActiveSheet();i&&i._dispose(),this._host&&(this._host.innerHTML="",this._host.removeAttribute("gcUIElement"))},_disposeUserEvents:function(){var n,i;for(t(this._userEventsElem).unbind(o),n=0;n<this.sheets.length;n++)i=this.sheets[n],i._disposeUserEvents()},_getCalcContexts:function(){for(var i=[],r,n,t=0;t<this.sheets.length;t++){r=this.sheets[t],n=r._getCalcContexts();if(n)while(n.length>0)i.push(n.pop())}return i},_doResize:function(){var h,l,e,c,p,n,u,i,f;if(t.browser.msie&&parseInt(t.browser.version,10)<9){h=this.canvas;if(h){var y=h.parentElement,o=y.parentElement,a=h.firstChild;a&&o&&(l=function(n){return n===""||n==="auto"||/%$/ig.test(n)},l(y.style.width)&&o.offsetWidth>12&&(a.width=o.offsetWidth-12),l(y.style.height&&o.offsetHeight>10)&&(a.height=o.offsetHeight-10))}}e=this._scrollbarSize,c=this._host;if(!c)return;var d=t(this._vp).width(),w=c.clientWidth,g=c.clientHeight,k=this._getActualTabStripRatio()*d;this._tabs.style.width=""+(k-1)+r,this._vp.style.width=""+(w-e)+r,this._vp.style.height=""+(g-e)+r,this._vs.style.width=""+e+r,this._vs.style.height=this._vp.style.height,p=w-(this._tabStripVisible?k:0)-e,this._hs.style.width=""+(p>0?p:1)+r,this._hs.style.height=""+e+r,n=this.getActiveSheet(),n&&(n._scrollTopRow===0&&(n._scrollTopRow=n._getFirstPageTopRow()),n._scrollLeftCol===0&&(n._scrollLeftCol=n._getFirstPageLeftColumn())),u=t(this._vs),i=u.data().wijspreadpanelex?u.data().wijspreadpanelex.options:null,i||(i={allowResize:!1,keyboardSupport:!0,bubbleScrollingEvent:!0,hScroller:{scrollBarVisibility:v},vScroller:{scrollSmallChange:1,scrollLargeChange:10,scrollMin:0,scrollBarVisibility:ct}}),n&&(i.vScroller.scrollMin=n._getFirstPageTopRow(),i.vScroller.scrollMax=n.getRowCount()+i.vScroller.scrollLargeChange-2,i.vScroller.scrollValue<n._scrollTopRow&&(i.vScroller.scrollValue=n._scrollTopRow)),u.css("overflowY",""),u.wijspreadpanelex(i),u.unbind(b,this._vscrollDelegate),u.bind(b,this._vscrollDelegate),u.wijspreadpanelex(s),f=t(this._hs),i=f.data().wijspreadpanelex?f.data().wijspreadpanelex.options:null,i||(i={allowResize:!1,keyboardSupport:!0,bubbleScrollingEvent:!0,vScroller:{scrollBarVisibility:v},hScroller:{scrollSmallChange:1,scrollLargeChange:10,scrollMin:0,scrollBarVisibility:ct}}),n&&(i.hScroller.scrollMin=n._getFirstPageLeftColumn(),i.hScroller.scrollMax=n.getColumnCount()+i.hScroller.scrollLargeChange-2,i.hScroller.scrollValue<n._scrollLeftCol&&(i.hScroller.scrollValue=n._scrollLeftCol)),f.css("overflowX",""),f.wijspreadpanelex(i),f.unbind(b,this._hscrollDelegate),f.bind(b,this._hscrollDelegate),f.wijspreadpanelex(s),n&&n._eventHandler.doResize(),this._tabStripVisible===!0?t(this._tabs).show():t(this._tabs).hide(),this._tab.doResize()},_doTabHSResize:function(){var u=this._scrollbarSize,f=this._host,n;if(!f)return;var e=this._vp.clientWidth,o=f.clientWidth,i=this._getActualTabStripRatio()*e;this._tabs.style.width=""+(i-1)+r,n=o-(this._tabStripVisible?i:0)-u,this._hs.style.width=""+(n>0?n:1)+r,this._hs.style.height=""+u+r,this._tabStripVisible===!0?t(this._tabs).show():t(this._tabs).hide(),this._tab.doResize()},_trigger:function(n,i){this._eventSuspended===0&&t(this._userEventsElem).trigger(n,i)},_copyUserEvents:function(n){var i,t;for(n._eventHandler._eventSuspended=this._eventSuspended,i=0;i<this._userEvents.length;i++)t=this._userEvents[i],n.bind(t.type,t.data,t.fn)},_suspendInvalidate:function(){var n=this.getActiveSheet();n._suspendInvalidate()},_resumeInvalidate:function(){var n=this.getActiveSheet();n._resumeInvalidate()},allowUserZoom:function(n){return arguments.length===0?this._allowUserZoom:(this._allowUserZoom=n,this)},allowUserResize:function(n){return arguments.length===0?this._allowUserResize:(this._allowUserResize=n,this)},tabStripVisible:function(n){return arguments.length===0?this._tabStripVisible:(this._tabStripVisible=n,this._doResize(),this)},tabEditable:function(n){return arguments.length===0?this._tabEditable:(this._tabEditable=n,this)},newTabVisible:function(n){return arguments.length===0?this._newTabVisible:(this._newTabVisible=n,this._doTabHSResize(),this)},isPaintSuspended:function(n){if(arguments.length===0)return this._paintSuspended;else{if(this._paintSuspended!==n){this._paintSuspended=n;for(var t=0;t<this.sheets.length;t++)this.sheets[t].isPaintSuspended(n)}return this}},repaint:function(){this._tab&&this._tab.repaint();var n=this.getActiveSheet();n&&(n.invalidateLayout(),n.repaint())},invalidateLayout:function(){this._doResize();var n=this.getActiveSheet();n&&n.invalidateLayout()},getActiveSheet:function(){return this.sheets.length>0?this.sheets[this._activeSheetIndex]:null},getActiveSheetIndex:function(){return this._activeSheetIndex},setActiveSheetIndex:function(n){if(typeof n!="number")return;if(n===this._activeSheetIndex)return;var t=this.getActiveSheet();t&&t._dispose(),this._activeSheetIndex=n,t=this.getActiveSheet(),t&&this._setActiveSheetImp(t),this._doResize()},_setActiveSheetImp:function(i){i._setHost(this._vp);var r=this;i._scrollCallback=function(n){var f,o,u,e;n.action===h?n.orientation===ui?(f=t(r._vs),o=f.wijspreadpanelex().data().wijspreadpanelex.options,o.vScroller.scrollValue=i._scrollTopRow,f.wijspreadpanelex(s),r._refreshScrollbar()):n.orientation===fi&&(u=t(r._hs),e=u.wijspreadpanelex().data().wijspreadpanelex.options,e.hScroller.scrollValue=i._scrollLeftCol,u.wijspreadpanelex(s),r._refreshScrollbar()):n.action===w&&r._doResize()},n.gcGlobal.activeElement=i,i._syncHScollbarPosition(),i._syncVScrollbarPosition()},addSheet:function(n,t){var i,s,r,e,u;for((t===undefined||t===null)&&(t=this._createSheet(this._getDefaultSheetName(n),200,20)),(t._name===undefined||t._name===null||t._name==="")&&(t._name=this._getDefaultSheetName(n)),s=this.sheets.length,i=0;i<s;i++)if(this.sheets[i]._name===t._name)throw"NotSupportedException";this._copyUserEvents(t),r=null;if(this.sheets.length>0)for(i=0;!r&&i<this.sheets.length;i++)r=this.sheets[i]._getSheetSource();var o=this.getActiveSheet(),c=this._activeSheetIndex,h=this.sheets.length-n,f=[];for(i=0;i<h&&this.sheets.length>0;i++)f.push(this.sheets.pop());this.isPaintSuspended()!==t.isPaintSuspended()&&t.isPaintSuspended(this.isPaintSuspended()),this.sheets.push(t),t.parent=this,t.borderWidth=0,t.calcService=this.calcService,r&&(e=t._getSheetSource(),e&&e.shareCalculations(r));while(f.length>0)this.sheets.push(f.pop());this.sheets.length===1?(this._vp&&t._setHost(this._vp),this._activeSheetIndex=0):this._activeSheetIndex=c,u=this.getActiveSheet(),u!==o&&(o&&o._dispose(),u&&this._setActiveSheetImp(u),this._doResize()),this._tab&&this._tab.repaint()},removeSheet:function(n){var r,t,i;if(isNaN(n)||n<0||n>=this.sheets.length)throw new Error("index is out of range");r=n<=this._activeSheetIndex||n===this.sheets.length-1,t=this.getActiveSheet(),n<this._activeSheetIndex&&this._activeSheetIndex--,i=this.sheets[n],i._disposeUserEvents(),this.sheets.splice(n,1),this.sheets.length===0?this._activeSheetIndex=-1:this._activeSheetIndex<this.sheets.length||(this._activeSheetIndex=this.sheets.length-1),r&&(t&&t._dispose(),this._activeSheetIndex>-1&&this._setActiveSheetImp(this.sheets[this._activeSheetIndex])),this._tab&&(this._tab._firstTab<this.sheets.length||(this._tab._firstTab=this.sheets.length-1),this._tab._firstTab<0&&(this._tab._firstTab=0),this._tab.repaint())},clearSheets:function(){for(var n=0;n<this.sheets.length;n++)this.sheets[n]._disposeUserEvents(),this.sheets[n]._dispose();this.sheets.splice(0,this.sheets.length),this._activeSheetIndex=-1,this._tab&&(this._tab._firstTab=0,this._tab.repaint())},getSheet:function(n){return n>=0&&n<this.sheets.length?this.sheets[n]:null},getSheetFromName:function(n){for(var t=0;t<this.sheets.length;t++)if(this.sheets[t].getName()===n)return this.sheets[t];return null},getSheetCount:function(){return this.sheets.length},setSheetCount:function(n){if(n<0)throw"ArgumentOutOfRangeException";else n===0&&this.clearSheets();var i=this.sheets.length,t;if(n<i)for(t=i-1;t>=n;t--)this.removeSheet(t);else if(n>i)for(t=i;t<n;t++)this.addSheet(t)},search:function(n){var f,u,t,e,r;if(!n)return null;f=i.SearchFoundFlags.None,u=i.SearchResult;if(!n.searchString||n.searchTarget===f||this.getSheetCount()<=0)return new u;n.startSheetIndex===-1&&(n.startSheetIndex=0),n.endSheetIndex===-1&&(n.endSheetIndex=this.getSheetCount()-1);if(n.endSheetIndex>=n.startSheetIndex&&0<=n.startSheetIndex&&n.startSheetIndex<this.getSheetCount()&&0<=n.endSheetIndex&&n.endSheetIndex<this.getSheetCount())for(t=n.startSheetIndex;t<=n.endSheetIndex;t++){e=this.getSheet(t),r=e.search(n);if(r&&r.searchFoundFlag!==f)return r.foundSheetIndex=t,r}return new u},showCell:function(n,t,i,r){var u=this.getActiveSheet();u&&u.showCell(n,t,i,r)},showColumn:function(n,t){var i=this.getActiveSheet();i&&i.showColumn(n,t)},showRow:function(n,t){var i=this.getActiveSheet();i&&i.showRow(n,t)},showActiveCell:function(n,t){var i=this.getActiveSheet();i&&i.showCell(i._activeRowIndex,i._activeColIndex,n,t)},getCustomName:function(n){return this._names?this._names[n]:null},addCustomName:function(n,t,r,u){if(n===undefined||n===null||n===""||t===undefined||t===null||t==="")throw new Error("invalid custom name");this._names||(this._names={});var f=this.calcService.parse(t,r,u);this._names[n]=new i.NameInfo(n,f,r,u),this._recalcAll()},removeCustomName:function(n){this._names&&n!==undefined&&n!==null&&n!==""&&this._names.hasOwnProperty(n)&&(delete this._names[n],this._recalcAll())},clearCustomNames:function(){this._names&&(delete this._names,this._recalcAll())},_findCustomName:function(n){if(n===undefined||n===null||n==="")return null;var t=this.getCustomName(n);return(t===undefined||t===null)&&this.parent&&this.parent.getCustomName&&(t=this.parent.getCustomName(n)),t},addCustomFunction:function(n){if(n===undefined||n===null||!(n instanceof e.Calc.Functions.Function))throw new Error("invalid custom function");var t=n.name.toUpperCase();this._functions||(this._functions={}),this._functions[t]=n,this._recalcAll()},getCustomFunction:function(n){return this._functions&&n!==undefined&&n!==null&&n!==""?this._functions[n.toUpperCase()]:null},removeCustomFunction:function(n){this._functions&&n!==undefined&&n!==null&&n!==""&&(n=n.toUpperCase(),this._functions.hasOwnProperty(n)&&(delete this._functions[n],this._recalcAll()))},clearCustomFunctions:function(){var t,n;if(this._functions){t=[];for(n in this._functions)this._functions.hasOwnProperty(n)&&t.push(n);delete this._functions,this._recalcAll()}},_recalcAll:function(){this.calcService&&this.calcService.recalculateAll()},referenceStyle:function(n){var t=i.ReferenceStyle.R1C1,r=i.ReferenceStyle.A1;return arguments.length===0?this.calcService.useR1C1?t:r:(this.calcService.useR1C1=n===t,this)},bind:function(n,i,r){var u,f;for(this._userEvents.push({type:n,data:i,fn:r}),t(this._userEventsElem).bind(n+o,i,r),u=0;u<this.sheets.length;u++)f=this.sheets[u],f.bind(n,i,r)},unbind:function(n,i){for(var e,u,f,r=0;r<this._userEvents.length;r++)e=this._userEvents[r],e.type===n&&this._userEvents.splice(r,1);for(t(this._userEventsElem).unbind(n+o,i),u=0;u<this.sheets.length;u++)f=this.sheets[u],f.unbind(n,i)},unbindAll:function(){var n,i;for(this._userEvents.length=0,t(this._userEventsElem).unbind(o),n=0;n<this.sheets.length;n++)i=this.sheets[n],i.unbindAll()},suspendEvent:function(){var n,t;for(this._eventSuspended++,n=0;n<this.sheets.length;n++)t=this.sheets[n],t.suspendEvent()},resumeEvent:function(){var n,t;for(this._eventSuspended--,this._eventSuspended<0&&(this._eventSuspended=0),n=0;n<this.sheets.length;n++)t=this.sheets[n],t.resumeEvent()},saveData:function(){var v,e,i,n,c,o,t,r,h,f,l;if(!this._host)return;v=this._host.id,e=u.getElementById(v+gt);if(e===undefined||e===null)return;var a=this.getSheetCount(),s=[],y={activeSheetIndex:this.getActiveSheetIndex(),sheetCount:a,tabStripRatio:this.getTabStripRatio(),tabStripVisible:this._tabStripVisible,tabEditable:this._tabEditable,newTabVisible:this._newTabVisible,allowCellOverflow:this.getActiveSheet()?this.getActiveSheet()._allowCellOverflow:!1,theme:this.getActiveSheet().currentTheme().name()};for(s.push(JSON.stringify(y)),i=0;i<a;i++){n=this.getSheet(i),c="",n.deletedRows&&(c=JSON.stringify(n.deletedRows)),o={};for(t in n._rowInfos)typeof t!="function"&&(r=n._rowInfos[t],r&&r.dirty&&(o[t]=r));h={};for(t in n._colInfos)typeof t!="function"&&(f=n._colInfos[t],f&&f.dirty&&(h[t]=f));l={name:n._name,ar:n._activeRowIndex,ac:n._activeColIndex,columns:h,rows:o,rowCount:n.getRowCount(),columnCount:n.getColumnCount(),data:n._dataModel.dirtyNodes,deletedRows:c,spans:n._getSpanModel(),rowHeaderAutoText:n.rowHeaderAutoText,colHeaderAutoText:n.colHeaderAutoText,referenceStyle:n.referenceStyle(),gridline:n.gridline,frozenRowCount:n.frozenRowCount,frozenColCount:n.frozenColCount},s.push(JSON.stringify(l))}e.value=JSON.stringify(s)},doCommand:function(n){this._undoManager.doAction(n)},allowUndo:function(n){return arguments.length===0?this._allowUndo:(this._allowUndo=n,this._undoManager&&(this._undoManager._allowUndo=n),this)},undoManager:function(){return this._undoManager||(this._undoManager=new i._UndoManager(this,-1,this.allowUndo())),this._undoManager},canUserDragDrop:function(n){return arguments.length===0?((this._allowDragDrop===undefined||this._allowDragDrop===null)&&(this._allowDragDrop=!0),this._allowDragDrop):(this._allowDragDrop=n,this)},canUserDragFill:function(n){if(arguments.length===0)return(this._allowDragFill===undefined||this._allowDragFill===null)&&(this._allowDragFill=!0),this._allowDragFill;else{if(this._allowDragFill!==n){this._allowDragFill=n;var t=this.getActiveSheet();t&&t.getSelections().length===1&&t._render.repaintSelection(t.getSelections().toArray()[0])}return this}},toJSON:function(){for(var s=this.getSheetCount(),f={activeSheetIndex:this.getActiveSheetIndex(),sheetCount:s,tabStripRatio:this.getTabStripRatio(),tabStripVisible:this._tabStripVisible,tabEditable:this._tabEditable,newTabVisible:this._newTabVisible,referenceStyle:this.referenceStyle(),useWijmoTheme:this.useWijmoTheme},h={},u,r,i,t=0;t<s;t++)u=this.getSheet(t),h[u._name]=u.toJSON();f.sheets=h,r=[];if(this._names&&this.calcService)for(i in this._names)if(this._names.hasOwnProperty(i)){var n=this._names[i],a=n.getName(),o=n.getRow(),e=n.getColumn(),l=n.getExpression(),c=this.calcService.unparse(l,o,e);r.push({name:a,formula:c,row:o,col:e})}return f.names=r,f},fromJSON:function(n){var o,f,u,s,r,i,t;if(!n)return;o=this.isPaintSuspended(),this.isPaintSuspended(!0);try{this.calcService=new e.Calc.Service(this),this._availableSheetIndex=-1,this.clearSheets(),this.setSheetCount(n.sheetCount),n.referenceStyle!==null&&n.referenceStyle!==undefined&&this.referenceStyle(n.referenceStyle),t=0;if(n.sheets)for(u in n.sheets)typeof u=="string"&&(s=n.sheets[u],f=this.sheets[t],f.fromJSON(s),t++);this.setActiveSheetIndex(n.activeSheetIndex),typeof n.tabStripRatio!="undefined"&&this.setTabStripRatio(n.tabStripRatio),typeof n.tabStripVisible!="undefined"&&(this._tabStripVisible=n.tabStripVisible),typeof n.tabEditable!="undefined"&&(this._tabEditable=n.tabEditable),typeof n.newTabVisible!="undefined"&&(this._newTabVisible=n.newTabVisible),this.gcSpreadsheet=n.gcSpreadsheet,n.useWijmoTheme&&(this.useWijmoTheme=n.useWijmoTheme);if(n.names){for(r=0;r<n.names.length;r++)i=n.names[r],this.addCustomName(i.name,i.formula,i.row,i.col);for(t=0;t<n.sheetCount;t++)this.sheets[t]._rebuildCalcNodes()}}finally{this.isPaintSuspended(o)}},setTabStripRatio:function(n,i){var r,e,f,u;if(isNaN(r=parseFloat(n)))throw"ArgumentException";e=this._vp.clientWidth,f=this._tab._resizeBarWidth/e,this._tabStripRatio=r<f?f:r>1?1:r,this._tabStripRatioUserSet=r<0?0:r>1?1:r,this._doTabHSResize(),i||(u=t(this._hs),u.wijspreadpanelex&&u.wijspreadpanelex(s),this._refreshScrollbar())},getTabStripRatio:function(){return(this._tabStripRatioUserSet===undefined||this._tabStripRatioUserSet===null)&&(this._tabStripRatioUserSet=this._tabStripRatio),this._tabStripRatioUserSet},_getActualTabStripRatio:function(){return this._tabStripRatio}};var p=".gcTab",ht=".tabNameEditor",ii=".spliter",a="mouse",wi="down",ti="move",si="up",yi="out",pi="focusin",ki="focusout",bi="keydown",li=a+ti+ii,ci=a+si+ii,hi=bi+ht,vi=pi+ht,ai=ki+ht,st=a+wi+p,tt=a+ti+p,it=a+si+p,rt=a+yi+p,g="dblclick"+p,kt="canvas",et="2d",ft="resizeBar",ut="navButton",y="tab",nt="newTab",k="#FFFFFF",dt="#D8E7FA",wt="#D5E5F9",pt="#B6D2F5",vt="#D9E7F9",bt="#688CAF",lt="#92A5C7",yt="black",at="white";i._GcTab=function(n){this._init(n)},i._GcTab.prototype={_init:function(n){this._bounds=new i.Rect(0,0,200,20),this.name=n},_spread:null,_activeIndex:0,_firstTab:0,_tabStartPos:74,_tabLeftPadding:12,_tabRightPadding:8,_tabSpace:3,_activePos:70,_hoverNavButton:-1,_hoverTab:-1,_navButtonSize:18,_newTabSize:48,_firstTabSpace:5,_font:"10pt Arial",_resizeBarWidth:8,_tabSizes:[],_setHost:function(n){var f=u.createElement(kt),r,s,o;f.setAttribute("id",this.name),n.appendChild(f),f.gcObject=!0,this.canvas&&(r=t(this.canvas),r.unbind(st),r.unbind(tt),r.unbind(it),r.unbind(rt),r.unbind(g),this.canvas.parentNode.removeChild(this.canvas)),this.canvas=f,!e.UI._isStandardCanvas()&&e.UI._isSilverlightCanvas()&&(f.setAttribute("renderMethod","auto"),s=this,this.test=function(n){n._spread.initPaint.call(n._spread)},f.setAttribute("onload",this.test(s))),o=i.createEventHandler,r=t(f),r.bind(st,o(this,this.doMouseDown)),r.bind(tt,o(this,this.doMouseMove)),r.bind(it,o(this,this.doMouseUp)),r.bind(rt,o(this,this.doMouseOut)),r.bind(g,o(this,this.doMouseDbClick)),this.doResize()},setOwner:function(n){this._spread=n,n&&n._font&&n._font.length>0&&(this._font=n._font)},_dispose:function(){var n=this.canvas;n&&(t(n).unbind(st),t(n).unbind(tt),t(n).unbind(it),t(n).unbind(g),t(n).unbind(rt),n.parentNode.removeChild(n))},getBounds:function(){return this._bounds},setBounds:function(n){this._bounds.x=n.x,this._bounds.y=n.y,this._bounds.width=n.width,this._bounds.height=n.height},doNavButtonClick:function(t){var i=this._firstTab,u=this,r=200;switch(t){case 0:i=0;break;case 1:i-=1,i>0&&(this._repeatDown=n.setTimeout(function(){u.doNavButtonClick(1)},r)),i<0&&(i=0);break;case 2:i+=1,i<this._spread.sheets.length-1&&(this._repeatDown=n.setTimeout(function(){u.doNavButtonClick(2)},r)),i<this._spread.sheets.length||(i=this._spread.sheets.length-1),i<0&&(i=0);break;case 3:i=this._spread.sheets.length-1,i<0&&(i=0);break;default:return}i!==this._firstTab&&(this._firstTab=i,this.repaint())},_hitTest:function(n,t){var u=this.getBounds(),e,i,r,f;if(u.x+u.width-this._resizeBarWidth<n&&n<u.x+u.width)return{element:ft};for(e=-1,i=0,r=0;r<4;r++){if(i<=n&&n<i+this._navButtonSize){e=r;break}i+=this._navButtonSize}if(e!==-1)return{element:ut,index:r};i=this._tabStartPos;if(this._firstTab>0){if(i<n&&n<i+this._firstTabSpace+this._tabSpace)return{element:y,index:this._firstTab-1,position:i};i+=this._firstTabSpace}f=0;if(this._firstTab>-1)for(r=this._firstTab;r<this._spread.sheets.length&&r<this._tabSizes.length;r++){f=this._tabSizes[r];if(i<n&&n<i+f+this._tabSpace)return{element:y,index:r,position:i};i+=f+this._tabSpace}if(this._spread._newTabVisible)if(n>i&&n<i+this._newTabSize)return{element:nt,position:i};return{element:""}},doMouseDown:function(n){var a=t(this._getCanvas()).offset(),p=n.pageX-a.left,v=n.pageY-a.top,u=this._spread.getActiveSheet(),r,e,f,s,h,c,l,o;this._tabNameEditor&&this.endSheetTabEditing(u,!1),f=this._hitTest(p,v),s=i.Events;if(n.button===0){if(f.element===ft)return this.resizeTab=!0,this.activeX=n.pageX,this.handleDocumentMouseMove(),!1;else if(f.element===ut)return this.doNavButtonClick(f.index),!1;else if(f.element===y){h=f.index,c=f.position,this._activeIndex=h,this._activePos=c,r=this._spread.getSheet(h),this._spread._trigger(s.SheetTabClick,{sheet:r,sheetName:r._name,sheetTabIndex:h});if(h===this._spread._activeSheetIndex)return;e={oldSheet:u,newSheet:r,cancel:!1},this._spread._trigger(s.ActiveSheetChanging,e),e&&e.cancel===!1&&(this._spread.setActiveSheetIndex(h),this._spread._trigger(s.ActiveSheetChanged,{oldSheet:u,newSheet:r}),this._activeIndex<this._firstTab?this._firstTab--:this._activeIndex>this._firstTab&&this._activePos+this._tabSizes[this._activeIndex]>this.getBounds().width-this._resizeBarWidth&&this._firstTab++,this.repaint())}else if(f.element===nt){l=this._spread,l._trigger(s.SheetTabClick,{sheet:null,sheetName:null,sheetTabIndex:-1}),o=this._spread.sheets.length,r=this._spread._createSheet(this._spread._getDefaultSheetName(o)),this._spread.addSheet(o,r),this._activeIndex=o,this._activePos=f.position,e={oldSheet:u,newSheet:r,cancel:!1},this._spread._trigger(s.ActiveSheetChanging,e);if(e&&e.cancel===!1){r._eventHandler&&r._eventHandler._doCallBack("activeSheetChanged,"+this._spread._activeSheetIndex+","+o,{oldValue:this._spread._activeSheetIndex,newValue:o}),this._spread.setActiveSheetIndex(o),this._spread._trigger(s.ActiveSheetChanged,{oldSheet:u,newSheet:r});while(this._activeIndex>this._firstTab&&this._activePos+this._tabSizes[this._activeIndex]+this._newTabSize>this.getBounds().width-this._resizeBarWidth)this._activePos-=this._tabSizes[this._firstTab],this._firstTab++;this.repaint()}}u=this._spread.getActiveSheet(),u&&!u._isEditing&&u._eventHandler&&u._eventHandler._setFocus()}return!1},doMouseMove:function(n){var h="default",s="w-resize",u,f;if(this.resizeTab){this.canvas.style.cursor=s;var c=n.pageX-this.activeX,e=this._spread._vp.clientWidth,r=this._spread;r.setTabStripRatio(r._getActualTabStripRatio()+c/e,!0),u=this._resizeBarWidth/e,f=1,r._getActualTabStripRatio()<u?(r.setTabStripRatio(u,!0),this.activeX=this._resizeBarWidth):r._getActualTabStripRatio()<f?this.activeX=n.pageX:(r.setTabStripRatio(f,!0),this.activeX=e)}else{this._hoverNavButton=-1,this._hoverTab=-1;var o=t(this._getCanvas()).offset(),a=n.pageX-o.left,l=n.pageY-o.top,i=this._hitTest(a,l);if(i.element==="")return this.canvas.style.cursor=h,this.repaint(),!1;else i.element===ft?this.canvas.style.cursor=s:(this.canvas.style.cursor=h,i.element===ut?this._hoverNavButton=i.index:i.element===y?this._hoverTab=i.index:i.element===nt&&(this._hoverTab=-2));this.repaint()}return!1},doMouseUp:function(i){if(this.resizeTab){this.resizeTab=!1;var r=t(this._spread._hs);r.wijspreadpanelex&&r.wijspreadpanelex(s),this._spread._refreshScrollbar()}this._repeatDown&&(n.clearTimeout(this._repeatDown),this._repeatDown=null),this.unhandleDocumentMouseMove()},doMouseOut:function(n){var i=this._hoverNavButton,t;return this._hoverNavButton=-1,t=this._hoverTab,this._hoverTab=-1,(this._hoverNavButton!==i||this._hoverTab!==t)&&this.repaint(),!1},doMouseDbClick:function(e){var h,o,c;if(!this._spread._tabEditable)return!1;var v=t(this._getCanvas()).offset(),w=e.pageX-v.left,b=e.pageY-v.top,p=this._hitTest(w,b);if(p.element===y){h=n.gcGlobal.activeElement,h&&h.endEdit&&h.endEdit(),n.gcGlobal.activeElement=null;var l=this._activeIndex,s=this._spread.sheets[l],k=this._tabSizes[l],a=t(this._getCanvas()).offset();this._spread._trigger(i.Events.SheetTabDoubleClick,{sheet:s,sheetName:s._name,sheetTabIndex:l}),o=u.createElement(oi),o.type="text",o.value=s._name,o.setAttribute("contentEditable","true"),o.setAttribute("autocomplete","off"),o.style.position="absolute",o.style.margin=f,o.style.padding=f,o.style.margin=f,o.style.left=a.left+this._activePos+this._tabLeftPadding+r,o.style.top=a.top+1+r,o.style.width=k-this._tabLeftPadding-this._tabRightPadding+2+r,o.style.backgroundColor=at,o.style.borderWidth=0,o.style.outline=ri,u.body.insertBefore(o,null),this._tabNameEditor=o,c=this,t(o).addClass("sheetTabEditor"),t(o).bind(hi,function(n){var t=i.Key;if(n.keyCode===t.enter)return c.endSheetTabEditing(s,!1),!1;else if(n.keyCode===t.esc)return c.endSheetTabEditing(s,!0),!1}),t(o).bind(vi,function(n){o.selectionStart=0,o.selectionEnd=o.value.length}),t(o).bind(ai,function(n){c.endSheetTabEditing(s,!1)}),o.focus()}},_isValidSheetName:function(n){var r,t,i;if(n===undefined||n===null||n==="")return!1;for(r=this._spread.sheets.length,t=0;t<r;t++){i=this._spread.sheets[t];if(i!==this._spread.getActiveSheet())if(n===i._name)return!1}return!0},endSheetTabEditing:function(n,r){var u,f;this._tabNameEditor&&(u=this._tabNameEditor.value,r===!1&&u!==undefined&&u!==null&&u!==""&&this._isValidSheetName(u)&&(f=new i.UndoRedo.SheetRenameUndoAction(n,u),n._doCommand(f)),t(this._tabNameEditor).unbind(hi),t(this._tabNameEditor).unbind(vi),t(this._tabNameEditor).unbind(ai),this._tabNameEditor.parentNode.removeChild(this._tabNameEditor),delete this._tabNameEditor)},handleDocumentMouseMove:function(){var i,n;this._isCapture||(i=this,t(u).bind(li,function(n){i.doMouseMove(n)}),t(u).bind(ci,function(n){i.doMouseUp(n)}),n=this._spread.getActiveSheet(),n&&(n._continueMouseUpBubble=!0),this._isCapture=!0)},unhandleDocumentMouseMove:function(){if(this._isCapture){this._isCapture=!1,t(u).unbind(li),t(u).unbind(ci);var n=this._spread.getActiveSheet();n&&delete n._continueMouseUpBubble}},repaint:function(t){var i=this._getCanvas();if(i){if(!i.getContext&&e.UI._isSilverlightCanvas())if(!i.getContext)return;i.getContext||typeof n.FlashCanvas===d||n.FlashCanvas.initElement(i),i.getContext&&this.paint(i.getContext(et),t)}},doResize:function(){var n=this._getCanvas();if(!n||!n.parentNode)return;if(n.parentNode.clientWidth===0||n.parentNode.clientHeight===0)return;n.style.display=ri,n.width=Math.max(n.parentNode.clientWidth,0),n.height=Math.max(n.parentNode.clientHeight,0),n.style.display="",this._bounds.width=n.clientWidth,this._bounds.height=n.clientHeight,this.repaint()},paint:function(t,r){var f=this.getBounds(),s,v,p,o,l,h,a,y;if(r){if(r.x>=f.x+f.width)return;if(r.y>=f.y+f.height)return;if(r.x+r.width>f.width){r.width=f.width-r.x;if(r.width<=0)return}if(r.y+r.height>f.height){r.height=f.height-r.y;if(r.height<=0)return}if(r.width<=0||r.height<=0)return}v=e.UI._useDoubleBuffer();if(v){p=this,o=this.buffer,o&&o.width===f.width&&o.height===f.height||(this.buffer=o=u.createElement(kt),o.width=f.width,o.height=f.height);if(!o.getContext)if(e.UI._isSilverlightCanvas()){if(!o.getContext)return}else if(typeof n.FlashCanvas!="undefined"){n.FlashCanvas.initElement(c);if(!o.getContext)return}}s=v?this.buffer.getContext(et):t,s.clearRect(0,0,f.width,f.height),s.translate(-f.x,-f.y),this.paintTabs(s,r),s.translate(f.x,f.y);if(v){l=f.x>=0?0:-f.x,h=f.y>=0?0:-f.y,r&&(l=f.x+r.x,h=f.y+r.y,f=new i.Rect(f.x+r.x,f.y+r.y,r.width,r.height)),s=this.buffer.getContext(et),a=null;try{r?a=s.getImageData(r.x,r.y,r.width,r.height):(y=this._getCanvas(),a=y?s.getImageData(l,h,Math.min(f.width-l,Math.max(y.width-f.x,3)),Math.min(f.height-h,Math.max(y.height-f.y,3))):s.getImageData(l,h,Math.max(f.width-l,0),Math.max(f.height-h,0)))}catch(w){return}l=f.x>=0?f.x:0,h=f.y>=0?f.y:0,a&&f.width>0&&f.height>0&&t.putImageData(a,l,h)}},_getCanvas:function(){var n=this.canvas;return!n&&this.parent&&(n=this.parent.canvas),n&&!n.getContext&&n.firstChild&&(n.getContext=n.firstChild.getContext),n},paintTabs:function(n,t){var r,s,v,e,h,a,l,c,y,p;if(!n||!this._spread)return;for(r=this.getBounds(),n.save(),n.font=this._font,n.rect(r.x,r.y,r.width,r.height),n.clip(),n.beginPath(),s=null,this._spread.useWijmoTheme?(s=n.createLinearGradient(r.x,r.y,r.width,r.height),v=i.Global.prototype.getWijmoThemeStyle(i.VisualState.Normal),s.addColorStop(0,"#DDDDDD"),s.addColorStop(1,v.backgroundColor)):(s=n.createLinearGradient(r.x+.7*r.height,r.y+0,.7*r.height,r.height),s.addColorStop(0,"#7FA1D1"),s.addColorStop(.3,"#A1BADD"),s.addColorStop(1,"#9AB5DB")),n.fillStyle=s,n.fillRect(r.x,r.y,r.width,r.height),h=60,a=this._tabStartPos,this._tabSizes=[],e=0;e<this._spread.sheets.length;e++)h=n.measureText(this._spread.sheets[e]._name).width+this._tabRightPadding+this._tabLeftPadding,this._tabSizes.push(h);l=[],this._firstTab>0&&(a+=this._firstTabSpace);if(this._firstTab>=0)for(e=this._firstTab;e<this._spread.sheets.length;e++)h=this._tabSizes[e],l.push({i:e,x:a,w:h,t:this._spread.sheets[e]._name}),a+=h+this._tabSpace;this._spread._newTabVisible&&this.drawTab(n,a,0,this._newTabSize,r.height,5,!1,this._hoverTab===-2,"New\u2026"),this._activeIndex=this._spread.getActiveSheetIndex();if(this._spread.sheets.length>0){for(e=l.length-1;e>=0;e--)c=l[e],c.i!==this._activeIndex&&this.drawTab(n,c.x,0,c.w,r.height,5,!1,c.i===this._hoverTab,c.t);this._firstTab>0&&(y=this._firstTab-1,h=this._tabSizes[y],this.drawTab(n,this._tabStartPos+this._firstTabSpace-h-this._tabSpace,0,h,r.height,5,this._activeIndex===y,this._hoverTab===y,"")),this._activeIndex>=this._firstTab&&this._activeIndex<this._spread.sheets.length&&(p=l[this._activeIndex-this._firstTab],this.drawTab(n,p.x,0,p.w,r.height,5,!0,!1,p.t))}n.fillStyle=lt,n.fillRect(r.x,r.y,this._tabStartPos-1,r.height);var f=5,u=9,o=9;this.drawNavButton(n,u,o,u+f,o+f,u+f,o-f,!0,u-f,this._hoverNavButton===0),u+=this._navButtonSize,this.drawNavButton(n,u,o,u+f,o+f,u+f,o-f,!0,null,this._hoverNavButton===1),u+=this._navButtonSize,this.drawNavButton(n,u,o,u-f,o+f,u-f,o-f,!1,null,this._hoverNavButton===2),u+=this._navButtonSize,this.drawNavButton(n,u,o,u-f,o+f,u-f,o-f,!1,u+4,this._hoverNavButton===3);if(this._spread.useWijmoTheme){var k=i.Global.prototype.getWijmoThemeStyle,b=i.VisualState,w=k(b.Hover);v=k(b.Normal),n.fillStyle=v.backgroundColor,n.fillRect(r.x+r.width-this._resizeBarWidth,r.y,this._resizeBarWidth,r.height),n.fillStyle=w.backgroundColor,n.fillRect(r.x+r.width-7,r.y+1,6,r.height-2),n.fillStyle=w.color,n.fillRect(r.x+r.width-5,r.y+4,2,r.height-8)}else n.fillStyle=bt,n.fillRect(r.x+r.width-this._resizeBarWidth,r.y,this._resizeBarWidth,r.height),n.fillStyle="#D7E6F7",n.fillRect(r.x+r.width-7,r.y+1,6,r.height-2),n.fillStyle=at,n.fillRect(r.x+r.width-5,r.y+4,4,r.height-8),n.fillStyle=bt,n.fillRect(r.x+r.width-5,r.y+4,1,r.height-8);n.beginPath(),n.restore()},drawNavButton:function(n,t,r,u,f,e,o,s,h,c){var w,v,a;n.save();var p=null,y=null,l=this.getBounds();this._spread.useWijmoTheme?(w=i.Global.prototype.getWijmoThemeStyle,v=i.VisualState,p=w(v.Hover),y=w(v.Normal),c?(n.fillStyle=p.backgroundColor,n.fillRect(t-7,l.y+2,14,l.height-4)):(n.fillStyle=y.backgroundColor,n.fillRect(t-9,l.y+1,this._navButtonSize,l.height-2))):c?(n.fillStyle="orange",n.fillRect(t-8,l.y+1,16,l.height-2),n.fillStyle="lightyellow",n.fillRect(t-7,l.y+2,14,l.height-4)):(a=n.createLinearGradient(l.x+.7*l.height,l.y+0,.7*l.height,l.height),a.addColorStop(0,k),a.addColorStop(.1,dt),a.addColorStop(.45,wt),a.addColorStop(.45,pt),a.addColorStop(.9,vt),a.addColorStop(1,k),n.fillStyle=a,n.fillRect(t-9,l.y+1,this._navButtonSize,l.height-2)),n.fillStyle=this._spread.useWijmoTheme?c?p.color:y.color:yt,h!==undefined&&h!==null&&n.fillRect(h,Math.min(f,o),1,Math.max(f,o)-Math.min(f,o)),s?(t-=2,u-=2,e-=2):(t+=2,u+=2,e+=2),n.beginPath(),n.moveTo(t,r),n.lineTo(u,f),n.lineTo(e,o),n.lineTo(t,r),n.fill(),n.restore()},drawTab:function(n,t,r,u,f,e,o,s,h){var v,p,y;n.save(),n.beginPath(),n.moveTo(t,r),n.lineTo(t,r+f-e),n.arcTo(t,r+f,t+u,r+f,e),n.lineTo(t+u,r+f),n.lineTo(t+u+f,r),o||n.lineTo(t,r);var a=null,l=this.getBounds(),c=n.createLinearGradient(l.x+.7*l.height,l.y+0,.7*l.height,l.height);this._spread.useWijmoTheme?(v=i.VisualState.Normal,(o||s)&&(v=i.VisualState.Hover),a=i.Global.prototype.getWijmoThemeStyle(v),c.addColorStop(0,a.backgroundColor)):s||o?(c.addColorStop(0,k),c.addColorStop(.6,"#F1F6FD"),c.addColorStop(.9,"#BCD5F6"),c.addColorStop(1,k)):(c.addColorStop(0,dt),c.addColorStop(.45,wt),c.addColorStop(.6,pt),c.addColorStop(1,vt)),n.fillStyle=c,n.fill(),n.strokeStyle=lt,n.stroke(),n.textBaseline=ei,n.fillStyle=this._spread.useWijmoTheme&&a?a.color:yt,p=this._tabLeftPadding,y=1,n.fillText(h,t+p,r+y),n.restore()}}})(window,jQuery);(function(n,t){"use strict";var i=n.GrapeCity,f="string",u="boolean",e="number",o={sheetCount:1,name:"",font:"10pt Arial",_allowUserZoom:!0,_allowUserResize:!0,tabStripVisible:!0,tabEditable:!0,newTabVisible:!0,useWijmoTheme:!1,tabStripRatio:.5,activeSheetIndex:0,sheets:[]},r;t.widget("wijmo.wijspread",{_init:function(){var h=this.element.context,o,r,s,a,c,l;if(h){o=new i.UI.GcSpread(h.id,this.options.sheetCount),this.element.data("spread",o),h.setAttribute("gcUIElement","gcSpread"),i.UI.Global.prototype._createDummyObjects(),r=this.options,typeof r.name===f&&r.name.length>0&&(o.name=r.name),typeof r.font===f&&r.font.length>0&&(o._font=r.font),typeof r._allowUserZoom===u&&(o._allowUserZoom=r._allowUserZoom),typeof r._allowUserResize===u&&(o._allowUserResize=r._allowUserResize),typeof r.tabStripVisible===u&&(o._tabStripVisible=r.tabStripVisible),typeof r.tabEditable===u&&(o._tabEditable=r.tabEditable),typeof r.newTabVisible===u&&(o._newTabVisible=r.newTabVisible),typeof r.useWijmoTheme===u&&(o.useWijmoTheme=r.useWijmoTheme),typeof r.tabStripRatio===e&&(o._tabStripRatio=r.tabStripRatio),typeof r.activeSheetIndex===e&&(o._activeSheetIndex=r.activeSheetIndex),!i.UI._isStandardCanvas()&&i.UI._isSilverlightCanvas()?(s=document.createElement("canvas"),s.setAttribute("width",""+h.clientWidth),s.setAttribute("height",""+h.clientHeight),h.appendChild(s),o.canvas=s,s.setAttribute("renderMethod","auto"),s.setAttribute("gcSpreadsheet","true"),s.setAttribute("onload",'$("#'+h.id+'").wijspread("initPaint");'),t(n).bind("resize.gcSpread",i.UI.createEventHandler(o,o._doResize))):o._setHost(h);if(r.sheets&&r.sheets.length>0){if(o.getSheetCount()<r.sheets.length){c=o.getSheetCount();while(c<r.sheets.length)a=o._createSheet(o._getDefaultSheetName(c)),o.addSheet(c,a),c=o.getSheetCount()}for(l=0;l<r.sheets.length;l++)a=o.getSheet(l),a.applyOptions(r.sheets[l])}i.UI._isStandardCanvas()?(o.invalidateLayout(),o.repaint()):i.UI._isSilverlightCanvas()&&slcanvas&&slcanvas.autoLoad&&slcanvas.autoLoad()}},initPaint:function(){var f=i.UI._isStandardCanvas(),t,r,u;if(f)return;t=this,t._initPaintTimeout!==undefined&&t._initPaintTimeout!==null&&n.clearTimeout(t._initPaintTimeout),r=t.spread().canvas.firstChild,r&&r.loaded?(u=r.Content.SpreadsheetObject,t.spread().attachSpreadsheetObject(u)):t._initPaintTimeout=n.setTimeout(function(){t.initPaint.call(t)},10)},spread:function(){return this.element.data("spread")},destroy:function(){t(n).unbind("resize.gcSpread"),this.spread()._dispose()},repaint:function(){this.spread().repaint()},options:o}),r=n.ko,r&&(r.wijmo=r.wijmo||{},r.wijmo.wijspreadBinding={init:function(n,i,r,u){t("#"+n.id).wijspread(i())},update:function(n,t,i,r){}},r.bindingHandlers.wijspread=r.wijmo.wijspreadBinding)})(window,jQuery);(function(n,t){"use strict";function l(n){var t=n.toString(16);return t.length===1&&(t="0"+t),t}function o(n,t,i,r){this.a=n,this.r=t,this.g=i,this.b=r}function c(n,t,i){return i<0&&(i+=240),i>240&&(i-=240),i<40?n+((t-n)*i+20)/40:i<120?t:i<160?n+((t-n)*(160-i)+20)/40:n}function s(n,t,i){var f,e,s,u,r;return i===0?f=e=s=parseInt(t*255/240,10):(r=t>120?t+i-(t*i+120)/240:(t*(240+i)+120)/240,u=2*t-r,f=parseInt((c(u,r,n+80)*255+120)/240,10),e=parseInt((c(u,r,n)*255+120)/240,10),s=parseInt((c(u,r,n-80)*255+120)/240,10)),new o(255,f,e,s)}function p(n){var u=n.r,f=n.g,e=n.b,i=Math.max(Math.max(u,f),e),h=Math.min(Math.min(u,f),e),r=i+h,t;this.luminosity=parseInt((r*240+255)/510,10),t=i-h;if(t===0)this.saturation=0,this.hue=160;else{this.saturation=this.luminosity>120?parseInt((t*240+(510-r)/2)/(510-r),10):parseInt((t*240+r/2)/r,10);var c=((i-u)*40+t/2)/t,o=((i-f)*40+t/2)/t,s=((i-e)*40+t/2)/t;this.hue=u===i?parseInt(s-o,10):f===i?parseInt(80+c-s,10):parseInt(160+o-c,10),this.hue<0&&(this.hue+=240),this.hue>240&&(this.hue-=240)}}function st(n){return parseInt(n,16)}function at(n){return parseInt(n+n,16)}function a(n){return n.indexOf("%")>0?parseFloat(n)*2.55:n|0}function nt(n){var i=ut(n),t=RegExp,r;if(et.test(i))return[t.$1,t.$2,t.$3].map(st);else if(rt.test(i))return r=[t.$1,t.$2,t.$3].map(a),r.splice(0,0,parseFloat(t.$4)*255),r;else if(ft.test(i))return[t.$1,t.$2,t.$3].map(a);else if(ot.test(i))return[t.$1,t.$2,t.$3].map(at);return null}function f(n){var t;if(n instanceof o)return n;var u=0,r=0,f=0,i=0;return n&&n!==""&&(t=nt(n),t&&(t.length===3?(u=255,r=t[0],f=t[1],i=t[2]):t.length===4&&(u=t[0],r=t[1],f=t[2],i=t[3]))),new o(u,r,f,i)}function i(n,t,i,r,u,e,o,s,h,c,l,a,v){this._name=n,this._colorList=[f(r),f(u),f(t),f(i),f(e),f(o),f(s),f(h),f(c),f(l),f(a),f(v)]}function r(n,t,r,u){this._name=n,this._themeColor=t?t:new i(n),this._headingFont=r,this._bodyFont=u}var e=n.GrapeCity,h,u;typeof e=="undefined"&&(e=n.GrapeCity={}),typeof e.UI=="undefined"&&(e.UI={}),h=e.UI,o.prototype={a:1,r:0,g:0,b:0,toString:function(){return this.a===255?"#"+l(this.r)+l(this.g)+l(this.b):"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},getBrightness:function(){return(this.r*299+this.g*587+this.b*114)/1e3}},e.UI._Color=o,p.prototype={hue:160,luminosity:0,saturation:0,toColor:function(){return s(this.hue,this.luminosity,this.saturation)},getLighterColor:function(n){var t=this.luminosity,i=this.newLuma(this.luminosity,500,!0);return s(this.hue,t+(i-t)*n,this.saturation)},getDrakerColor:function(n){var t=this.newLuma(this.luminosity,-333,!0);return s(this.hue,t*(1-n),this.saturation)},newLuma:function(n,t,i){return t===0?n:i?t>0?(n*(1e3-t)+241*t)/1e3:n*(t+1e3)/1e3:(n+=t*240/1e3,n<0&&(n=0),n>240&&(n=240),n)}};var et=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,ot=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,ft=/^rgb\(([\s\d]*),([\s\d]*),([\s\d]*)\)$/i,rt=/^rgba\(([\s\d]*),([\s\d]*),([\s\d]*),([\s\d]*)\)$/i,ut=function(i){var u,r;return i?function(t){if(!r){var i=n.document.createElement("canvas");i&&i.getContext&&(r=i.getContext("2d"))}return r?r.fillStyle=t:t}:function(n){return typeof u=="undefined"&&(u=t("<span></span>")),u.css("color",n),u.css("color")}}(!e.UI._isStandardCanvas());o.parse=function(n){return f(n)};var vt=function(n,t){if(t===0)return n;var i=new p(n),r=parseInt(t>0?(240-i.luminosity)*t:i.luminosity*t,10);return s(i.hue,i.luminosity+r,i.saturation)},lt=0,ht=1,ct=2,it=3,k=4,b=5,w=6,d=7,g=8,tt=9,v=10,y=11;i.prototype={name:function(n){return arguments.length===0?this._name:(this._name=n,this)},background1:function(n){return this._property(lt,arguments.length===0,n)},background2:function(n){return this._property(ht,arguments.length===0,n)},textColor1:function(n){return this._property(ct,arguments.length===0,n)},textColor2:function(n){return this._property(it,arguments.length===0,n)},accent1:function(n){return this._property(k,arguments.length===0,n)},accent2:function(n){return this._property(b,arguments.length===0,n)},accent3:function(n){return this._property(w,arguments.length===0,n)},accent4:function(n){return this._property(d,arguments.length===0,n)},accent5:function(n){return this._property(g,arguments.length===0,n)},accent6:function(n){return this._property(tt,arguments.length===0,n)},hyperline:function(n){return this._property(v,arguments.length===0,n)},followedHyperline:function(n){return this._property(y,arguments.length===0,n)},_property:function(n,t,i){return t?this._colorList[n]:(this._colorList[n]=f(i),this)},getColor:function(n){var i,t,r,f,u,e;if(n&&n!==""){i=-1,t=n.split(" ");if(t){if(t.length>1){if(t[0]===undefined||t[0]===null)return n;r=t[0].toLowerCase(),r==="background"?i=parseInt(t[1],10)-1:r==="text"?i=parseInt(t[1],10)+1:r==="accent"&&(i=parseInt(t[1],10)+3)}else if(t.length===1){if(t[0]===undefined||t[0]===null)return n;f=t[0].toLowerCase(),f==="hyperlink"?i=v:f==="followedHyperlink"&&(i=y)}u=0,t.length>2&&(u=parseInt(t[2],10));if(i>=0&&i<=11)return e=vt(this._colorList[i],u/100),e.toString()}}return n}},h.ThemeColor=i,u={Default:new i("Default","#000000","#1F497D","#FFFFFF","#EEECE1","#4F81BD","#C0504D","#9BBB59","#8064A2","#4BACC6","#F79646","#0000FF","#800080"),Office:new i("Office","#000000","#1F497D","#FFFFFF","#EEECE1","#4F81BD","#C0504D","#9BBB59","#8064A2","#4BACC6","#F79646","#0000FF","#800080"),Apex:new i("Apex","#000000","#69676D","#FFFFFF","#C9C2D1","#CEB966","#9CB084","#6BB1C9","#6585CF","#7E6BC9","#A379BB","#410082","#932968"),Aspect:new i("Aspect","#000000","#323232","#FFFFFF","#E3DED1","#F07F09","#9F2936","#1B587C","#4E8542","#604878","#C19859","#6B9F25","#B26B02"),Concourse:new i("Concourse","#000000","#464646","#FFFFFF","#DEF5FA","#2DA2BF","#DA1F28","#EB641B","#39639D","#474B78","#7D3C4A","#FF8119","#44B9E8"),Civic:new i("Civic","#000000","#646B86","#FFFFFF","#C5D1D7","#D16349","#CCB400","#8CADAE","#8C7B70","#8FB08C","#D19049","#00A3D6","#694F07"),Oriel:new i("Oriel","#000000","#575F6D","#FFFFFF","#FFF39D","#FE8637","#7598D9","#B32C16","#F5CD2D","#AEBAD5","#777C84","#D2611C","#3B435B"),Origin:new i("Origin","#000000","#464653","#FFFFFF","#DDE9EC","#727CA3","#9FB8CD","#D2DA7A","#FADA7A","#B88472","#8E736A","#B292CA","#6B5680"),Paper:new i("Paper","#000000","#444D26","#FFFFFF","#FEFAC9","#A5B592","#F3A447","#E7BC29","#D092A7","#9C85C0","#809EC2","#8E58B6","#7F6F6F"),Solstice:new i("Solstice","#000000","#4F271C","#FFFFFF","#E7DEC9","#3891A7","#FEB80A","#C32D2E","#84AA33","#964305","#475A8D","#8DC765","#AA8A14"),Technic:new i("Technic","#000000","#3B3B3B","#FFFFFF","#D4D2D0","#6EA0B0","#CCAF0A","#8D89A4","#748560","#9E9273","#7E848D","#00C8C3","#A116E0"),Trek:new i("Trek","#000000","#4E3B30","#FFFFFF","#FBEEC9","#F0A22E","#A5644E","#B58B80","#C3986D","#A19574","#C17529","#AD1F1F","#FFC42F"),Urban:new i("Urban","#000000","#424456","#FFFFFF","#DEDEDE","#53548A","#438086","#A04DA3","#C4652D","#8B5D3D","#5C92B5","#67AFBD","#C2A874"),Verve:new i("Verve","#000000","#666666","#FFFFFF","#D2D2D2","#FF388C","#E40059","#9C007F","#68007F","#005BD3","#00349E","#17BBFD","#FF79C2"),Equity:new i("Equity","#000000","#696464","#FFFFFF","#E9E5DC","#D34817","#9B2D1F","#A28E6A","#956251","#918485","#855D5D","#CC9900","#96A9A9"),Flow:new i("Flow","#000000","#04617B","#FFFFFF","#DBF5F9","#0F6FC6","#009DD9","#0BD0D9","#10CF9B","#7CCA62","#A5C249","#E2D700","#85DFD0"),Foundry:new i("Foundry","#000000","#676A55","#FFFFFF","#EAEBDE","#72A376","#B0CCB0","#A8CDD7","#C0BEAF","#CEC597","#E8B7B7","#DB5353","#903638"),Median:new i("Median","#000000","#775F55","#FFFFFF","#EBDDC3","#94B6D2","#DD8047","#A5AB81","#D8B25C","#7BA79D","#968C8C","#F7B615","#704404"),Metro:new i("Metro","#000000","#4E5B6F","#FFFFFF","#D6ECFF","#7FD13B","#EA157A","#FEB80A","#00ADDC","#738AC8","#1AB39F","#EB8803","#5F7791"),Module:new i("Module","#000000","#5A6378","#FFFFFF","#D4D4D6","#F0AD00","#60B5CC","#E66C7D","#6BB76D","#E88651","#C64847","#168BBA","#680000"),Opulent:new i("Opulent","#000000","#B13F9A","#FFFFFF","#F4E7ED","#B83D68","#AC66BB","#DE6C36","#F9B639","#CF6DA4","#FA8D3D","#FFDE66","#D490C5")},e.UI.ThemeColors=u,r.prototype={name:function(n){return arguments.length===0?this._name:(this._name=n,this)},colors:function(n){return arguments.length===0?this._themeColor:(this._themeColor=n,this)},headerFont:function(n){return arguments.length===0?this._headingFont:(this._headingFont=n,this)},bodyFont:function(n){return arguments.length===0?this._bodyFont:(this._bodyFont=n,this)}},e.UI.SpreadTheme=r,h.SpreadThemes={Default:new r("Default",u.Default,"Cambria","Calibri"),Office:new r("Office",u.Office,"Cambria","Calibri"),Apex:new r("Apex",u.Apex,"Lucida Sans","Book Antiqua"),Aspect:new r("Aspect",u.Aspect,"Verdana","Verdana"),Concourse:new r("Concourse",u.Concourse,"Lucida Sans Unicode","Lucida Sans Unicode"),Civic:new r("Civic",u.Civic,"Georgia","Georgia"),Oriel:new r("Oriel",u.Oriel,"Century Schoolbook","Century Schoolbook"),Origin:new r("Origin",u.Origin,"Bookman Old Style","Gill Sans MT"),Paper:new r("Paper",u.Paper,"Constantia","Constantia"),Solstice:new r("Solstice",u.Solstice,"Gill Sans MT","Gill Sans MT"),Technic:new r("Technic",u.Technic,"Franklin Gothic Book","Arial"),Trek:new r("Trek",u.Trek,"Franklin Gothic Medium","Franklin Gothic Book"),Urban:new r("Urban",u.Urban,"Trebuchet MS","Georgia"),Verve:new r("Verve",u.Verve,"Century Gothic","Century Gothic"),Equity:new r("Equity",u.Equity,"Franklin Gothic Book","Perpetua"),Flow:new r("Flow",u.Flow,"Calibri","Constantia"),Foundry:new r("Foundry",u.Foundry,"Rockwell","Rockwell"),Median:new r("Median",u.Median,"Tw Cen MT","Tw Cen MT"),Metro:new r("Metro",u.Metro,"Consolas","Corbel"),Module:new r("Module",u.Module,"Corbel","Corbel"),Opulent:new r("Opulent",u.Opulent,"Trebuchet MS","Trebuchet MS")}})(window,jQuery);(function(n){"use strict";function i(n,t,i,r,u){if(n)return u?u.call(t,t[i]):t[i];var f=t[i];return t[i]=r,u&&u.call(t,f!==r),t}function a(n,t){if(t&&n&&n!=="")if(t.getColor){var i=t.getColor(n);if(i)return i}return n}function o(n,t,i,r){this.X=n,this.Y=t,this.Width=i,this.Height=r,this.Left=this.X,this.Right=this.Left+this.Width,this.Top=this.Y,this.Bottom=this.Y+this.Height}function s(n){this._minItemHeight=2,this.info=n,this._clearCache()}function l(n,i){return i===t.DataOrientation.Horizontal?n.colCount:n.rowCount}function c(n,i,r,u){return u===t.DataOrientation.Horizontal?n.getValue(r.row,r.col+i):n.getValue(r.row+i,r.col)}function h(n,i,r,u){return u===t.DataOrientation.Horizontal?n.getColumnWidth(r.col+i)<=0||n.getRowHeight(r.row)<=0:n.getRowHeight(r.row+i)<=0||n.getColumnWidth(r.col)<=0}var u=n.GrapeCity;typeof u=="undefined"&&(u=n.GrapeCity={}),typeof u.UI=="undefined"&&(u.UI={});var t=u.UI,e={Black:"black",Blue:"Blue",Brown:"Brown"},f={FromArgb:function(n,i,r,u){return new t._Color(n,i,r,u).toString()}},v={Empty:""},r={};t.EmptyValueStyle={Gaps:0,Zero:1,Connect:2},t.SparklineAxisMinMax={individual:0,group:1,custom:2},t.SparklineSetting=function(n){if(n)for(var i in n)i&&(this[i]=n[i]);else this._axisColor=e.Black,this._firstMarkerColor=f.FromArgb(255,149,179,215),this._highMarkerColor=e.Blue,this._lastMarkerColor=f.FromArgb(255,149,179,215),this._lowMarkerColor=e.Blue,this._markersColor=f.FromArgb(255,36,64,98),this._negativeColor=e.Brown,this._seriesColor=f.FromArgb(255,36,64,98),this.displayEmptyCellsAs=t.EmptyValueStyle.Gaps,this.rightToLeft=!1,this.displayHidden=!1,this.displayXAxis=!1,this._showFirst=!1,this._showHigh=!1,this._showLast=!1,this._showLow=!1,this._showNegative=!1,this._showMarkers=!1,this.manualMax=0,this.manualMin=0,this.maxAxisType=t.SparklineAxisMinMax.individual,this.minAxisType=t.SparklineAxisMinMax.individual,this.groupMaxValue=0,this.groupMinValue=0,this.lineWeight=1;this._worksheet=null},t.SparklineSetting.prototype={axisColor:function(n){return i(arguments.length===0,this,"_axisColor",n)},firstMarkerColor:function(n){return i(arguments.length===0,this,"_firstMarkerColor",n)},highMarkerColor:function(n){return i(arguments.length===0,this,"_highMarkerColor",n)},lastMarkerColor:function(n){return i(arguments.length===0,this,"_lastMarkerColor",n)},lowMarkerColor:function(n){return i(arguments.length===0,this,"_lowMarkerColor",n)},markersColor:function(n){return i(arguments.length===0,this,"_markersColor",n)},negativeColor:function(n){return i(arguments.length===0,this,"_negativeColor",n)},seriesColor:function(n){return i(arguments.length===0,this,"_seriesColor",n)},showFirst:function(n){return i(arguments.length===0,this,"_showFirst",n)},showHigh:function(n){return i(arguments.length===0,this,"_showHigh",n)},showLast:function(n){return i(arguments.length===0,this,"_showLast",n)},showLow:function(n){return i(arguments.length===0,this,"_showLow",n)},showNegative:function(n){return i(arguments.length===0,this,"_showNegative",n)},showMarkers:function(n){return i(arguments.length===0,this,"_showMarkers",n)},clone:function(){var n=new t.SparklineSetting;return n._axisColor=this._axisColor,n._firstMarkerColor=this._firstMarkerColor,n._highMarkerColor=this._highMarkerColor,n._lastMarkerColor=this._lastMarkerColor,n._lowMarkerColor=this._lowMarkerColor,n._markersColor=this._markersColor,n._negativeColor=this._negativeColor,n._seriesColor=this._seriesColor,n.displayEmptyCellsAs=this.displayEmptyCellsAs,n.rightToLeft=this.rightToLeft,n.displayHidden=this.displayHidden,n.displayXAxis=this.displayXAxis,n._showFirst=this._showFirst,n._showHigh=this._showHigh,n._showLast=this._showLast,n._showLow=this._showLow,n._showNegative=this._showNegative,n._showMarkers=this._showMarkers,n.manualMax=this.manualMax,n.manualMin=this.manualMin,n.maxAxisType=this.maxAxisType,n.minAxisType=this.minAxisType,n.groupMaxValue=this.groupMaxValue,n.groupMinValue=this.groupMinValue,n.lineWeight=this.lineWeight,n},_setThemeContext:function(n){this._worksheet=n},_getActualColor:function(n){return a(this[n](),new t._ThemeContext(this._worksheet))},toJSON:function(){return{_axisColor:this._axisColor,_firstMarkerColor:this._firstMarkerColor,_highMarkerColor:this._highMarkerColor,_lastMarkerColor:this._lastMarkerColor,_lowMarkerColor:this._lowMarkerColor,_markersColor:this._markersColor,_negativeColor:this._negativeColor,_seriesColor:this._seriesColor,displayEmptyCellsAs:this.displayEmptyCellsAs,rightToLeft:this.rightToLeft,displayHidden:this.displayHidden,displayXAxis:this.displayXAxis,_showFirst:this._showFirst,_showHigh:this._showHigh,_showLast:this._showLast,_showLow:this._showLow,_showNegative:this._showNegative,_showMarkers:this._showMarkers,manualMax:this.manualMax,manualMin:this.manualMin,maxAxisType:this.maxAxisType,minAxisType:this.minAxisType,groupMaxValue:this.groupMaxValue,groupMinValue:this.groupMinValue,lineWeight:this.lineWeight}}},t.SparklineType={line:0,column:1,winloss:2},t.DataOrientation={Vertical:0,Horizontal:1},t.SparklineGroup=function(n,i){this.setting=i,this.displayDateAxis=!1,this.sparklineType=n,this._sparklineGroupManager=null,this._innerList=[],this._axisReference=null,this._axisOrientation=t.DataOrientation.Horizontal},t.SparklineGroup.prototype={add:function(n){n&&(this._innerList.push(n),n.group(this),this._adjustGroupMaxMinValue(),this.onGroupChanged())},remove:function(n){var t=this._innerList.remove(n);return n.onSparklineChanged(),n._group=this.clone(),this._adjustGroupMaxMinValue(),this.onGroupChanged(),t},contains:function(n){return this._innerList.contains(n)},onGroupChanged:function(){var n,t;if(this._innerList)for(n=0;n<this._innerList.length;n++)t=this._innerList[n],t&&t.onSparklineChanged()},clone:function(){var i=this.setting?this.setting.clone():null,n=new t.SparklineGroup(this.sparklineType,i);return n.displayDateAxis=this.displayDateAxis,n._axisReference=this._axisReference,n._axisOrientation=this._axisOrientation,n},dateAxisData:function(n){return arguments.length===0?i(!0,this,"_axisReference",n):i(!1,this,"_axisReference",n,function(n){n&&this.onGroupChanged()})},dateAxisOrientation:function(n){return i(arguments.length===0,this,"_axisOrientation",n,function(n){n&&this.onGroupChanged()})},count:function(){return this._innerList.length},_adjustGroupMaxMinValue:function(){var n;if(!this.setting)return;this.setting.groupMaxValue=Number.MIN_VALUE,this.setting.groupMinValue=Number.MAX_VALUE;var o=this.setting.maxAxisType===t.SparklineAxisMinMax.group,e=this.setting.minAxisType===t.SparklineAxisMinMax.group,i=!1;if(o||e)for(n=0;n<this._innerList.length;n++){var s=this._innerList[n],r=this._getMaxMinValues(s),u=r.min,f=r.max;o&&this.setting.groupMaxValue<f&&(this.setting.groupMaxValue=f,i=!0),e&&this.setting.groupMinValue>u&&(this.setting.groupMinValue=u,i=!0)}return i},_getMaxMinValues:function(n){var f=Number.MIN_VALUE,e=Number.MAX_VALUE,s=n.data(),o,u,i,t;if(s)for(o=n._provideValues(s,n.dataOrientation(),!1),u=0;u<o.length;u++)i=o[u],i===r&&(i=0),typeof i=="number"&&(t=i,f=f<t?t:f,e=e>t?t:e);return{min:e,max:f}}},s.prototype={sparklineInfo:function(n){return i(arguments.length===0,this,"info")},paint:function(n,i,r,u,f){this._clearCache(),this.info.sparklineType()===t.SparklineType.line&&this._paintLines(n,i,r,u,f),this._paintDataPoints(n,i,r,u,f),this._paintAxis(n,i,r,u,f)},_clearCache:function(){this._cachedMinDatetime=Number.MAX_VALUE,this._cachedMaxDatetime=Number.MIN_VALUE,this._cachedMinValue=Number.MAX_VALUE,this._cachedMaxValue=Number.MIN_VALUE,this._cachedIndexMapping=null,this._cachedValues=null,this._cachedDatetimes=null},_getWorksheet:function(){if(this.info&&this.info.group()&&this.info.group()._sparklineGroupManager)return this.info.group()._sparklineGroupManager._sheet},_getSpace:function(n){return this.info.sparklineType()===t.SparklineType.line?3+this._getLineWeight()+1:3},_leftSpace:function(){return this._getSpace("left")},_rightSpace:function(){return this._getSpace("right")},_topSpace:function(){return this._getSpace("top")},_bottomSpace:function(){return this._getSpace("bottom")},_getCachedValues:function(){if(!this._cachedValues){var t=this.info.data(),n=this.info.dataOrientation();this._cachedValues=this.info._provideValues(t,n)}return this._cachedValues},_getCachedDatetimes:function(){if(!this._cachedDatetimes){var t=this.info.group().dateAxisData(),n=this.info.group().dateAxisOrientation();this._cachedDatetimes=this.info._provideValues(t,n,!0)}return this._cachedDatetimes},_getCachedIndexMaping:function(){var t,n,i,u;if(this._cachedIndexMapping)return this._cachedIndexMapping;if(this.sparklineInfo().displayDateAxis()){this._cachedIndexMapping=[];var s=this._getCachedValues().length,o=this._getCachedDatetimes().length,e=Math.min(s,o),f=[];for(e>0&&(f=this._getCachedDatetimes().slice(0,e)),f.sort(function(n,t){return n===t?0:(n===r&&(n=0),t===r&&(t=0),n-t)}),t=0;t<f.length;t++){i=f[t];if(i===undefined||i===null)continue;u=this._getCachedDatetimes().indexOf(i);while(this._cachedIndexMapping.contains(u))u=this._getCachedDatetimes().indexOf(i,u+1);isNaN(i)||(n=this._getCachedValues()[u],n!==undefined&&n!==null&&isNaN(n)&&n!==r||this._cachedIndexMapping.push(u))}}else for(this._cachedIndexMapping=[],t=0;t<this._getCachedValues().length;t++)n=this._getCachedValues()[t],n!==undefined&&n!==null&&isNaN(n)&&n!==r||this._cachedIndexMapping.push(t);return this._cachedIndexMapping},_getValue:function(n){var u=this._getCachedValues(),i=u[n];return i===undefined||i===null?this.sparklineInfo().setting().displayEmptyCellsAs===t.EmptyValueStyle.Zero&&(i=0):i===r&&(i=0),i},_paintLines:function(n,i,r,u,f){var e,h,c,y=this._getCachedIndexMaping().length-1,p,o,s,w,l,v;for(y<0&&(y=0),this.linePos=[],e=0;e<y;e++){p=this._getValue(this._getCachedIndexMaping()[e]);if(p!==undefined&&p!==null){o=e+1,s=this._getValue(this._getCachedIndexMaping()[o]);if(s===undefined||s===null){w=this.sparklineInfo().setting().displayEmptyCellsAs;if(w===t.EmptyValueStyle.Zero)s=0;else if(w===t.EmptyValueStyle.Connect)for(o=e+2;o<=y;o++){l=this._getCachedValues()[this._getCachedIndexMaping()[o]];if(l!==undefined&&l!==null){s=l;break}}}if(s!==undefined&&s!==null){var b=this._getDataPointPosition(this._getCachedIndexMaping()[e],{Width:u,Height:f}),k=this._getDataPointPosition(this._getCachedIndexMaping()[o],{Width:u,Height:f}),a=b.Width/2;h={X:b.X+a,Y:b.Y+a},c={X:k.X+a,Y:k.Y+a},this.linePos[e]={P1:h,P2:c}}else e++}}if(this.linePos.length>0)for(n.strokeStyle=this.info.setting().seriesColor(),n.lineCap="round",n.lineWidth=this._getLineWeight(),e=0;e<this.linePos.length;e++){v=this.linePos[e];if(!v)continue;n.beginPath(),h=v.P1,c=v.P2,n.moveTo(i+h.X,r+h.Y),n.lineTo(i+c.X,r+c.Y),n.stroke(),n.closePath()}},_getDataPointColor:function(n){var i=null,r=this._getValue(n),h=this._getWorksheet(),f,s,o,e,u;return r!==undefined&&r!==null&&(this.info.setting()._setThemeContext(h),(this._cachedMinValue===Number.MAX_VALUE||this._cachedMaxValue===Number.MIN_VALUE)&&this._getMaxMinValue(),f=this._cachedMinValue,r===f&&this.info.setting().showLow()&&(i=this.info.setting()._getActualColor("lowMarkerColor")),(i===undefined||i===null)&&(s=this._cachedMaxValue,r===s&&this.info.setting().showHigh()&&(i=this.info.setting()._getActualColor("highMarkerColor"))),(i===undefined||i===null)&&(this.info.group().displayDateAxis?(o=this._getCachedIndexMaping().indexOf(n),o===0&&this.info.setting().showFirst()&&(i=this.info.setting()._getActualColor("firstMarkerColor"))):n===0&&this.info.setting().showFirst()&&(i=this.info.setting()._getActualColor("firstMarkerColor"))),(i===undefined||i===null)&&(this.info.group().displayDateAxis?(e=this._getCachedIndexMaping().indexOf(n),e===this._getCachedIndexMaping().length-1&&this.info.setting().showLast()&&(i=this.info.setting()._getActualColor("lastMarkerColor"))):n===this._getCachedIndexMaping().length-1&&this.info.setting().showLast()&&(i=this.info.setting()._getActualColor("lastMarkerColor"))),(i===undefined||i===null)&&r<0&&this.info.setting().showNegative()&&(i=this.info.setting()._getActualColor("negativeColor")),(i===undefined||i===null)&&(u=this.info.sparklineType(),u===t.SparklineType.line?this.info.setting().showMarkers()&&(i=this.info.setting()._getActualColor("markersColor")):u===t.SparklineType.column?i=this.info.setting()._getActualColor("seriesColor"):u===t.SparklineType.winloss&&(i=this.info.setting()._getActualColor("seriesColor")))),i===undefined||i===null?"Transparent":i},_paintDataPoints:function(n,i,r,u,f){for(var w={Width:u,Height:f},c,h,o,s=0;s<this._getCachedIndexMaping().length;s++){var l=this._getCachedIndexMaping()[s],p=this._getDataPointColor(l),e=this._getDataPointPosition(l,w);n.fillStyle=p;if(this.info.sparklineType()===t.SparklineType.line)n.save(),c=i+e.X+e.Width/2,h=r+e.Y+e.Height/2,n.translate(c,h),n.rotate(Math.PI/4),n.fillRect(0-e.Width/2,0-e.Height/2,e.Width,e.Height),n.restore();else{o=i+e.X+e.Width/4,o=Math.floor(o);var y=r+e.Y,a=e.Width/2,v=e.Height;n.fillRect(o,y,a,v)}}},_paintAxis:function(n,t,i,r,u){if(!this.info.setting().displayXAxis||!this._hasAxis())return;var o={Width:r,Height:u},h=this._leftSpace(),c=o.Width-this._rightSpace(),f=this._getAxisY(o);f=Math.floor(f)+.5;var l=f,s=this.info.setting()._getActualColor("axisColor"),e=this._getWorksheet()._zoomFactor;e<1&&(e=1),n.strokeStyle=s,n.lineWidth=e,n.beginPath(),n.moveTo(t+h,i+f),n.lineTo(t+c,i+l),n.stroke()},_hasAxisNormal:function(){var t=this._getActualMaxValue(),n;if(t!==Number.MIN_VALUE){n=this._getActualMinValue();if(n!==Number.MAX_VALUE)return t===n||t*n<=0}return!0},_hasAxis:function(){var r=this._hasAxisNormal(),i,u,n;if(this.info.sparklineType()!==t.SparklineType.winloss)return r;if(!r&&this._getCachedIndexMaping().length>0)for(i in this._getCachedIndexMaping())if(i){u=this._getCachedIndexMaping()[i],n=this._getCachedValues()[u];if(n!==undefined&&n!==null)return!0}return r},_getMinDatetime:function(){return(isNaN(this._cachedMinDatetime)||this._cachedMinDatetime===Number.MAX_VALUE)&&this._getMaxMindatetimes(),this._cachedMinDatetime},_getMaxDatetime:function(){return(isNaN(this._cachedMaxDatetime)||this._cachedMaxDatetime===Number.MIN_VALUE)&&this._getMaxMindatetimes(),this._cachedMaxDatetime},_getMaxMindatetimes:function(){for(var r,n,t,i=0;i<this._getCachedIndexMaping().length;i++){r=this._getCachedIndexMaping()[i],n=this._getCachedDatetimes()[r];if(isNaN(n))continue;t=this._getValue(r);if(t!==null&&t===undefined||isNaN(t))continue;if(n===undefined||n===null)continue;n>this._cachedMaxDatetime&&(this._cachedMaxDatetime=n),n<this._cachedMinDatetime&&(this._cachedMinDatetime=n)}},_calcItemWidth:function(n){for(var c=this._getMinDatetime(),h=this._getMaxDatetime(),r=[],t,s,u,e,o,f,i=0;i<this._getCachedIndexMaping().length;i++){s=this._getCachedIndexMaping()[i],t=this._getCachedDatetimes()[s];if(t===undefined||t===null||isNaN(t))continue;if(!t)continue;r.push(t)}r.sort(function(n,t){return n-t});if(r.length>1&&c!==h){for(u=Number.MAX_VALUE,e=0,i=1;i<r.length;i++)o=r[i],t=o-r[i-1],t<u&&t>0&&(u=t),e+=t;return f=(n.Width-this._leftSpace()-this._rightSpace())*u/e/2,f<2&&(f=2),f}else return(n.Width-this._leftSpace()-this._rightSpace())/2},_getItemWidth:function(n){if(this.info.displayDateAxis())return this._calcItemWidth(n);else{var i=this._getCachedIndexMaping().length;return(n.Width-this._leftSpace()-this._rightSpace())/i}},_getItemX:function(n,t){var i,f,u,o,e,s,h,r;if(this.sparklineInfo().displayDateAxis()){i=this._getItemWidth(n),f=this._getMaxDatetime(),u=this._getMinDatetime();if(f===u)return this._leftSpace()+i/2;return o=this._getCachedDatetimes()[t],o?(e=n.Width-this._leftSpace()-this._rightSpace(),e-=i,s=f-u,this._leftSpace()+Math.floor((o-u)/s*e)):0}else return i=this._getItemWidth(n),h=this._getCachedIndexMaping().indexOf(t),r=this._leftSpace()+i*h,r=Math.floor(r)},_getCanvasSize:function(n){var i=n.Width-this._leftSpace()-this._rightSpace(),t;return i=Math.max(i,0),t=n.Height-this._topSpace()-this._bottomSpace(),t=Math.max(t,0),{Width:i,Height:t}},_getMaxMinValue:function(){for(var n,t=0;t<this._getCachedValues().length;t++){n=this._getCachedValues()[t];if(n===undefined)continue;n!==undefined&&n!==null&&(typeof n!="number"&&(n=0),n<this._cachedMinValue&&(this._cachedMinValue=n),n>this._cachedMaxValue&&(this._cachedMaxValue=n))}},_getActualMaxValue:function(){this._cachedMaxValue!==Number.MIN_VALUE&&this._cachedMaxValue||this._getMaxMinValue();var n=this.info.setting().maxAxisType;if(n===t.SparklineAxisMinMax.individual)return this._cachedMaxValue;else if(n===t.SparklineAxisMinMax.group)return this.info.setting().groupMaxValue;else if(n===t.SparklineAxisMinMax.custom)return this.info.setting().manualMax;return this._cachedMaxValue},_getActualMinValue:function(){this._cachedMinValue!==Number.MAX_VALUE&&this._cachedMinValue||this._getMaxMinValue();var n=this.info.setting().minAxisType;if(n===t.SparklineAxisMinMax.individual)return this._cachedMinValue;else if(n===t.SparklineAxisMinMax.group)return this.info.setting().groupMinValue;else if(n===t.SparklineAxisMinMax.custom)return this.info.setting().manualMin},_getItemHeightNormal:function(n,t){var o=this._getCanvasSize(n),r=this._getActualMaxValue(),e=this._getActualMinValue(),f=r-e,i,u;if(r===e){if(r===0)return 0;f=Math.abs(r)}return i=this._getCachedValues()[t],i||(i=0),u=o.Height/f,i*u},_getItemHeight:function(n,i){var e=this.info.sparklineType(),r,u,f;if(e===t.SparklineType.line)return this._getItemHeightNormal(n,i);else if(e===t.SparklineType.column){r=this._getCachedValues()[i];if(r===undefined||r===null)if(this.info.setting().displayEmptyCellsAs===t.EmptyValueStyle.Zero)return 0;u=this._getItemHeightNormal(n,i);if(u>-this._minItemHeight&&u<this._minItemHeight)if(r>0)return u+this._minItemHeight;else if(r<0)return u-this._minItemHeight;return u}else if(e===t.SparklineType.winloss)return r=this._getCachedValues()[i],r===undefined||r===null||r===0||isNaN(r)?0:(f=this._getCanvasSize(n),r<0?-f.Height/2:f.Height/2)},_getAxisYNormal:function(n){var f=this._getCanvasSize(n),t=this._getActualMaxValue(),r=this._getActualMinValue(),i,u;if(t===Number.MIN_VALUE||r===Number.MAX_VALUE)return n.Height/2;i=t-r;if(t===r){if(t===0)return n.Height/2;i=t,t<0&&(t=0)}return u=f.Height/i,this._topSpace()+t*u},_getAxisY:function(n){return this.info.sparklineType()===t.SparklineType.winloss?n.Height/2:this._getAxisYNormal(n)},_getItemVisibleHeightNormal:function(n,t){var s=this._getCanvasSize(n),r=this._getActualMaxValue(),u=this._getActualMinValue(),o=r-u,e,i,f;if(r===u){if(r===0)return 0;o=r}return e=s.Height/o,i=this._getValue(t),(i===undefined||i===null)&&(i=0),r!==u&&r*u>0?(f=0,f=i<0?(i-r)*e:(i-u)*e):i*e},_getItemVisibleHeight:function(n,i){var f=this.info.sparklineType(),r,u;if(f===t.SparklineType.line)return this._getItemVisibleHeightNormal(n,i);else if(f===t.SparklineType.column){r=this._getItemVisibleHeightNormal(n,i);if(r>-this._minItemHeight&&r<this._minItemHeight){u=this._getValue(i),(u===undefined||u===null)&&(u=0);if(u!==0)return u>0?r+this._minItemHeight:r-this._minItemHeight}return r}else if(f===t.SparklineType.winloss)return this._getItemHeight(n,i)},_getDataPointPositionNormal:function(n,t){var r=this._getItemWidth(t),l=this._getItemX(t,n),f,i,e;r<0&&(r=0),r=Math.floor(r),r%2==1&&(r+=1);var s=this._getItemHeight(t,n),h=this._getAxisY(t),c=this._getActualMaxValue(),a=this._getActualMinValue(),u=0;return c<0&&a<0?u=Math.max(this.info._topSpace(),h):(u=h,s<0||(u=h-s)),f=this._getItemVisibleHeight(t,n),i=new o(l,u,r,Math.abs(f)),s!==0&&(i.Y<this._topSpace()&&i.Bottom<this._topSpace()+1?i.Height=Math.floor(i.Height+1):(e=t.Height-this._bottomSpace(),i.Bottom>e&&i.Y>e-1&&(i.Y=e-f,i.Height=f))),i},_getLineWeight:function(){var n=this.info.setting().lineWeight*this._getWorksheet()._zoomFactor;return n<1&&(n=1),n},_getDataPointPosition:function(n,i){var u=this._getLineWeight(),r,f;u++,u<2&&(u=2),r=this._getDataPointPositionNormal(n,i),this.info.sparklineType()===t.SparklineType.line&&(r.X=r.X+(r.Width-u)/2,f=this._getValue(n),f!==undefined&&f!==null?(f<0?r.Y=r.Bottom-u/2:r.Y-=u/2,r.Width=u,r.Height=u):(r.Width=0,r.Height=0));if(this.info.group().setting.rightToLeft){var h=r.X,s=i.Width-h,e=s-r.Width;r=new o(e,r.Y,r.Width,r.Height)}return r}},t.Sparkline=function(n,i,r,u,f,e){this.row=n,this.column=i,this._dataOrientation=u,this._data=r,this._group=new t.SparklineGroup(f,e),this._group.add(this),this._renderer=new s(this)},t.Sparkline.prototype={group:function(n){if(arguments.length===0){if(this._group===undefined||this._group===null){var i=new t.SparklineGroup;i.add(this),this._group=i}return this._group}else return n!==this._group&&(this._group&&this._group.remove(this),this._group=n,this._group&&(this._group.contains(this)||this._group.add(this)),this.onSparklineChanged()),this},sparklineType:function(n){return arguments.length===0?this.group().sparklineType:(this.group().sparklineType!==n&&(this.group().sparklineType=n,this.onSparklineChanged()),this)},onSparklineChanged:function(){var n=this._getWorksheet(),i;n&&(i=this,n._trigger(t.Events.SparklineChanged,{sheet:n,sheetName:n._name,sparkline:i}))},setting:function(n){return arguments.length===0?this.group().setting:(this.group().setting=n,this)},data:function(n){return arguments.length===0?this._data:(this._data!==n&&(this._data=n,this.onSparklineChanged()),this)},dataOrientation:function(n){return arguments.length===0?this._dataOrientation:(this._dataOrientation!==n&&(this._dataOrientation=n,this.onSparklineChanged()),this)},dateAxisData:function(n){return arguments.length===0?this.group().dateAxisData():(this.group().dateAxisData(n),this)},dateAxisOrientation:function(n){return arguments.length===0?this.group().dateAxisOrientation():(this.group().dateAxisOrientation(n),this)},displayDateAxis:function(n){return arguments.length===0?this.group().displayDateAxis:(this.group().displayDateAxis=n,this)},clone:function(){var n=new t.Sparkline;return n.row=this.row,n.column=this.column,n.data(this.data()),n.dataOrientation(this.dataOrientation()),n.group(this.group().clone()),n},paintSparkline:function(n,t,i,r,u){this._renderer.paint(n,t,i,r,u)},_provideValues:function(n,t,i){var e=this._getWorksheet(),o=[],s,f,u;if(!e)return o;for(s=l(n,t),f=0;f<s;f++)u=c(e,f,n,t),!this.setting().displayHidden&&h(e,f,n,t)?u=NaN:u!==null&&u!==undefined&&(i?u=Date.parse(u):typeof u!="number"&&(u=r)),o.push(u);return o},_getWorksheet:function(){return this.group()&&this.group()._sparklineGroupManager?this.group()._sparklineGroupManager._sheet:null},toJSON:function(){return{row:this.row,col:this.column,orientation:this._dataOrientation,data:this._data,type:this._group.sparklineType,setting:this._group.setting,axisReference:this._group._axisReference,axisOrientation:this._group._axisOrientation}}},t.WorksheetSparklineGroupManager=function(n,t){this._groups=[],this._sheet=n,this.evaluator=t},t.WorksheetSparklineGroupManager.prototype={groups:function(n){return i(arguments.length===0,this,"_groups")},add:function(n){this.groups().push(n),n._sparklineGroupManager=this},remove:function(n){this.groups().remove(n)},contains:function(n){return this.groups().contains(n)},count:function(){return this.groups().length},_addRows:function(n,t){for(var i,o,u,r,e,f=0;f<this._groups.length;f++)for(i=this._groups[f],i.displayDateAxis&&(o=this._addRowRange(n,t,i.dateAxisData()),i.dateAxisData(o)),u=0;u<i._innerList.length;u++)r=i._innerList[u],n>r.row||(r.row+=t),e=this._addRowRange(n,t,r.data()),r.data(e)},_addColumns:function(n,t){for(var i,o,u,r,e,f=0;f<this._groups.length;f++)for(i=this._groups[f],i.displayDateAxis&&(o=this._addColumnRange(n,t,i.dateAxisData()),i.dateAxisData(o)),u=0;u<i._innerList.length;u++)r=i._innerList[u],n>r.column||(r.column+=t),e=this._addColumnRange(n,t,r.data()),r.data(e)},_removeRows:function(n,t){for(var i,s,u,e,r,f,o=0;o<this._groups.length;o++){i=this._groups[o];if(i.displayDateAxis){s=this._removeRowRange(n,t,i.dateAxisData());if(s!==null&&s!==undefined)i.dateAxisData(s);else{i.clear(),this.remove(i);continue}}for(u=[],u=u.concat(i._innerList),e=0;e<u.length;e++)r=u[e],r.row>=n&&r.row<n+t?i.remove(r):(n>r.row||(r.row-=t),f=this._removeRowRange(n,t,r.data()),f!==null&&f!==undefined?r.data(f):i.remove(r));i.count()>0||this.remove(i)}},_removeColumns:function(n,t){for(var i,s,u,e,r,f,o=0;o<this._groups.length;o++){i=this._groups[o];if(i.displayDateAxis){s=this._removeColumnRange(n,t,i.dateAxisData());if(s!==null&&s!==undefined)i.dateAxisData(s);else{i.clear(),this.remove(i);continue}}for(u=[],u=u.concat(i._innerList),e=0;e<u.length;e++)r=u[e],r.column>=n&&r.column<n+t?i.remove(r):(n>r.column||(r.column-=t),f=this._removeColumnRange(n,t,r.data()),f!==null&&f!==undefined?r.data(f):i.remove(r));i.count()>0||this.remove(i)}},clear:function(n,t,i,r){var o,h,s,u,f,e;if(arguments.length===0){for(o=0;o<this._groups.length;o++)h=this._groups[o],h&&(h.SparklineGroupManager=null);this._groups.clear();return}for(s=n;s<n+i;s++)for(u=t;u<t+r;u++)f=this._find(s,u),f&&(e=f.group(),e.remove(f),e.count()===0&&this.remove(e))},_find:function(n,t){for(var f,u,i,r=0;r<this._groups.length;r++)for(f=this._groups[r],u=0;u<f.count();u++){i=f[u];if(i&&i.row===n&&i.column===t)return i}return null},_copy:function(n,i,r,u,f,e){for(var w=new t._GcSheetModel(f,e,null),a=r-n,v=u-i,p=this._sheet._getModel(),o,y,h,c,l,s=0;s<f;s++)for(o=0;o<e;o++)y=p.getSparkline(n+s,i+o),y&&(h=y.clone(),h.row=r+s,h.column=u+o,c=h.dateAxisData(),c!==null&&c!==undefined&&this._canOffset(c,a,v,this._sheet.getRowCount(),this._sheet.getColumnCount())&&h.dateAxisData(c.offset(v,a)),l=h.data(),l!==undefined&&l!==null&&this._canOffset(l,a,v,this._sheet.getRowCount(),this._sheet.getColumnCount())&&h.data(l.offset(v,a)),this.add(h.group()),w.setValue(s,o,h));for(s=0;s<f;s++)for(o=0;o<e;o++)p.setSparkline(r+s,u+o,w.getValue(s,o))},_canOffset:function(n,t,i,r,u){var f=this._getExpressionRange(n);if(f){var o=f.row<0?0:f.row,e=f.col<0?0:f.col,h=f.row<0?r:f.rowCount,s=f.col<0?u:f.colCount;return!(o+t<0||e+i<0||o+h+t>r||e+s+i>u)}return!1},_move:function(n,i,r,u,f,e){var c,l,s,o,h;for(this._moveDataRange(n,i,r,u,f,e),c=this._sheet._getModel(),l=new t._GcSheetModel(f,e,null),s=0;s<f;s++)for(o=0;o<e;o++)h=c.getSparkline(n+s,i+o),h&&(h.row=r+s,h.column=u+o,l.setValue(s,o,h)),c.setSparkline(n+s,i+o,null);for(s=0;s<f;s++)for(o=0;o<e;o++)c.setSparkline(r+s,u+o,l.getValue(s,o))},_moveDataRange:function(n,i,r,u,f,e){for(var s=new t.Range(n,i,f,e),b=r-n,w=u-i,p,h,o,v,a,l,y,c=0;c<this._groups.length;c++)for(p=this._groups[c],h=0;h<p._innerList.length;h++){o=p._innerList[h];if(!o)continue;v=o.dateAxisData(),a=this._getExpressionRange(v),a&&s.containsRange(a)&&s.contains(o.row,o.column)&&o.dateAxisData(v.offset(w,b)),l=o.data(),y=this._getExpressionRange(l),y&&s.containsRange(y)&&s.contains(o.row,o.column)&&o.data(l.offset(w,b))}},_getExpressionRange:function(n){return n},_swap:function(n,t,i,r,u,f){},_exCopy:function(n,t,i,r,u,f,e){var s,h,y,o,c,l;if(n===this._sheet){this._copy(t,i,r,u,f,e);return}var v=r-t,a=u-i,w=n._getModel(),p=this._sheet._getModel();for(s=0;s<f;s++)for(h=0;h<e;h++)y=w.getSparkline(t+s,i+h),y?(o=y.clone(),o.row=r+s,o.column=u+h,c=o.dateAxisData(),c!==undefined&&c!==null&&this._canOffset(c,v,a,this._sheet.getRowCount(),this._sheet.getColumnCount())&&o.dateAxisData(c.offset(a,v)),l=o.data(),l!==undefined&&l!==null&&this._canOffset(l,v,a,this._sheet.getRowCount(),this._sheet.getColumnCount())&&o.data(l.offset(a,v)),this.add(o.group()),p.setSparkline(r+s,u+h,o)):p.setSparkline(r+s,u+h,null)},_exMove:function(n,t,i,r,u,f,e){var v,a,o,h,s,c,l;if(n===this._sheet){this._move(t,i,r,u,f,e);return}for(v=n._getModel(),a=this._sheet._getModel(),this._exMoveDataRange(n,t,i,r,u,f,e),o=0;o<f;o++)for(h=0;h<e;h++)s=v.getSparkline(t+o,i+h),s?(s.row=r+o,s.column=u+h,c=s.group(),l=c.clone(),c.remove(s),c.length>0||n._sparklineGroupManager.remove(c),l.add(s),this.add(l),a.setSparkline(r+o,u+h,s)):a.setSparkline(r+o,u+h,null),v.setSparkline(t+o,i+h,null)},_exMoveDataRange:function(n,i,r,u,f,e,o){var v,w,c,s,h,y,a,p;if(n===this._sheet){this._moveDataRange(i,r,u,f,e,o);return}var l=new t.Range(i,r,e,o),b=u-i,k=f-r;for(v=0;v<n._sparklineGroupManager._groups.length;v++)for(w=n._sparklineGroupManager._groups[v],c=0;c<w._innerList.length;c++){s=w._innerList[c];if(!s)continue;h=s.dateAxisData(),y=this._getExpressionRange(h),y&&this._sameSource(n,h)&&l.containsRange(y)&&l.contains(s.row,s.column)&&s.dateAxisData(h.offset(k,b)),a=s.data(),p=this._getExpressionRange(a),p&&this._sameSource(n,a)&&l.containsRange(p)&&l.contains(s.row,s.column)&&s.data(a.offset(k,b))}},_sameSource:function(n,t){return!0},_addRowRange:function(n,i,r){return r?n>r.row+r.rowCount-1?r:n>r.row?new t.Range(r.row,r.col,r.rowCount+i,r.colCount):new t.Range(r.row+i,r.col,r.rowCount,r.colCount):null},_addColumnRange:function(n,i,r){return r?n>r.col+r.colCount-1?r:n>r.col?new t.Range(r.row,r.col,r.rowCount,r.colCount+i):new t.Range(r.row,r.col+i,r.rowCount,r.colCount):null},_removeColumnRange:function(n,i,r){var u=this._rangeSubCat(r.col,r.col+r.colCount-1,n,n+i-1);return u?new t.Range(r.row,u.start,r.rowCount,u.end-u.start+1):null},_removeRowRange:function(n,i,r){var u=this._rangeSubCat(r.row,r.row+r.rowCount-1,n,n+i-1);return u?new t.Range(u.start,r.col,u.end-u.start+1,r.colCount):null},_rangeSubCat:function(n,t,i,r){var f=-1,e,u,h,c,s,o;if(r<n)return h=r-i+1,f=n-h,e=t-h,{start:f,end:e};if(i>t)return f=n,e=t,{start:f,end:e};if(i<=n){for(c=t-n+1,s=0,u=n;u<=r;u++)if(u>t)break;else s++;return f=i,e=f+c-s-1,{start:f,end:e}}for(o=0,u=n;u<=t;u++)f===-1&&(u<i||u>r)&&(f=u),(u<i||u>r)&&o++;return f!==-1&&o>0?(e=f+o-1,{start:f,end:e}):null}}})(window);(function(n){"use strict";var t=n.GrapeCity,r,i;typeof t=="undefined"&&(t=n.GrapeCity={}),typeof t.UI=="undefined"&&(t.UI={}),r=t.UI,Array.prototype.nextNonEmptyIndex=function(n){var i,t;for(n<0&&(n=-1),i=n+1,t=i;t<this.length;t++)if(this[t]!==undefined&&this[t]!==null)return t;return-1},Array.prototype.clear=function(n,t){var r,i;if(n<0)return;for(r=0,i=0;r<t&&i<this.length;i++)this[n+i]=null,r++},r.GroupState={Expanded:0,Collapsed:1},r.RangeGroupDirection={Backward:0,Forward:1},r.RangeGroupInfo=function(n,t,i,r){this.model=n,this.start=t,this.end=i,this.level=r},r.RangeGroupInfo.prototype={model:null,children:null,parent:null,start:0,end:0,level:0,getState:function(){return this.model?this.model.getState(this):t.UI.GroupState.Expanded},setState:function(n){this.model&&this.model.expand(this.level,n===t.UI.GroupState.Expanded)},contains:function(n){return this.start<=n&&n<=this.end},addChild:function(n){n&&(this.children||(this.children=[]),this.children.push(n),n.parent=this)}},t.UI.WorkingState=function(){this.count=0},t.UI.WorkingState.prototype={addRef:function(){this.count++},release:function(){this.count--},isWorking:function(){return this.count>0}},r.RangeGroup=function(n){this.items=new Array(n),this.suspendAddingGroup=new t.UI.WorkingState},r.RangeGroup.prototype={head:null,tail:null,items:null,_rootCached:null,direction:t.UI.RangeGroupDirection.Forward,suspendAddingGroup:null,_getCount:function(){return this.items?this.items.length:0},group:function(n,i){var u,f,r;if(!this._isIndexValid(n))throw new Error("index");if(!this._isIndexValid(n+i-1))throw new Error("count");for(this._rootCached=null,u=0;u<i;u++)f=n+u,r=this._getModelIndexFromViewIndex(f),this.items[r]?this.items[r].level++:this.items[r]=new t.UI.RangeGroupItemInfo;this._rootCached=this.createRangeGroup()},ungroupRange:function(n,i){var y,w,l,k,c,a,v;if(!this._isIndexValid(n))throw new Error("index");if(!this._isIndexValid(n+i-1))throw new Error("count");var e=!1,r=null,o=-1;if(this.direction===t.UI.RangeGroupDirection.Forward){o=n+i,e=this._isIndexValid(o);if(e){var h=n+i-1,p=h,f=null;do y=this._getModelIndexFromViewIndex(h),f=this.items[y],f!==undefined&&f!==null&&(p=h),h--;while((f===undefined||f===null)&&h>=n);f!==undefined&&f!==null&&(r=this._findImp(this._rootCached,p,f.level),r&&(o=r.end+1),e=r&&(r.end===n+i-1||this.getState(r)===t.UI.GroupState.Collapsed))}}else if(this.direction===t.UI.RangeGroupDirection.Backward){o=n-1,e=this._isIndexValid(o);if(e){var s=n,b=s,u=null;do w=this._getModelIndexFromViewIndex(s),u=this.items[w],u!==undefined&&u!==null&&(b=s),s++;while((u===undefined||u===null)&&s<n+i);u!==undefined&&u!==null&&(r=this._findImp(this._rootCached,b,u.level),r&&(o=r.start-1),e=r&&(r.start===n||this.getState(r)===t.UI.GroupState.Collapsed))}}for(this._rootCached=null,l=0;l<i;l++)k=n+l,c=this._getModelIndexFromViewIndex(k),this.items[c]&&this.items[c].level>-1&&this.items[c].level--;e&&(a=this._getModelIndexFromViewIndex(o),v=this.items[a],v&&v.level===r.level&&(this.items[a]=null)),this._rootCached=this.createRangeGroup()},ungroup:function(){this._rootCached=null;var n=this._getCount();this.items=new Array(n),this._rootCached=this.createRangeGroup()},_expand:function(n,t,i){if(!this._isIndexValid(n))throw new Error("index");if(t<-1)throw new Error("level");var r=this.find(n,t);r&&this.expandGroup(r,i)},expand:function(n,i){if(n<-1)throw new Error("level");var r=new t.UI.GroupedItemIndexEnumerator(this);while(r.moveNext())this._expand(r.current,n,i)},expandGroup:function(n,i){if(!n)throw new Error("groupInfo");var r=-1;switch(this.direction){case t.UI.RangeGroupDirection.Backward:r=n.start-1;break;case t.UI.RangeGroupDirection.Forward:r=n.end+1;break}this.setCollapsed(r,!i)},isCollapsed:function(n){var r,i,u;if(!this._isIndexValid(n))throw new Error("index");r=this.getLevel(n);if(r>-1)for(i=this.find(n,r),u=-1;u<=r;u++)if(i){if(i.getState()===t.UI.GroupState.Collapsed)return!0;i=i.parent;if(!i)break}return!1},find:function(n,t){if(this._rootCached){if(t===-1)return this._rootCached;if(!this._isIndexValid(n))throw new Error("index");return this._findImp(this._rootCached,n,t)}return null},getLevel:function(n){if(!this._isIndexValid(n))throw new Error("index");var i=this._getModelIndexFromViewIndex(n),t=this.items[i];return t?t.level:-1},getCollapsed:function(n){var i=this._getModelIndexFromViewIndex(n),t=this.items[i];return t?!!t.collapsed:!1},setCollapsed:function(n,i){if(n<0)this.head||(this.head=new t.UI.RangeGroupItemInfo),this.head.collapsed=i;else if(n>-1&&n<this._getCount()){var r=this._getModelIndexFromViewIndex(n);this.items[r]||(this.items[r]=new t.UI.RangeGroupItemInfo,this.items[r].level=-1),this.items[r].collapsed=i}else n<this._getCount()||(this.tail||(this.tail=new t.UI.RangeGroupItemInfo),this.tail.collapsed=i);this._rootCached=null,this.refresh()},getMaxLevel:function(){var i=-1,r=new t.UI.GroupedItemIndexEnumerator(this),n;while(r.moveNext())n=this.getLevel(r.current),i<n&&(i=n);return i},_move:function(n,i,r){var f,u,s,e,o;if(r>0){n<0&&(n=0),i<0&&(i=0);if(n===i)return;f=[],u=this.items.nextNonEmptyIndex(n-1);while(u>=0&&u<n+r)s=new t.UI.RangeGroupItemInfo(this.items[u]),f.push({index:u-n,value:s}),u=this.items.nextNonEmptyIndex(u);this.items.clear(n,r),this.items.clear(i,r);if(f.length>0)for(e=0;e<f.length;e++)o=f[e],this.items[i+o.index]=o.value;this._rootCached=null,this.refresh()}},_copy:function(n,i,r){var f,u,s,e,o;if(r>0){n<0&&(n=0),i<0&&(i=0);if(n===i)return;f=[],u=this.items.nextNonEmptyIndex(n-1);while(u>=0&&u<n+r)s=new t.UI.RangeGroupItemInfo(this.items[u]),f.push({index:u-n,value:s}),u=this.items.nextNonEmptyIndex(u);this.items.clear(i,r);if(f.length>0)for(e=0;e<f.length;e++)o=f[e],this.items[i+o.index]=o.value;this._rootCached=null,this.refresh()}},_add:function(n,i){var f,e,o,s,r,u;if(i>0){for(f=this._getModelIndexFromViewIndex(n),e=f>1?this.items[f-1]:null,o=0;o<i;o++)this.items.splice(f,0,!e?null:new t.UI.RangeGroupItemInfo(e));if(!this.suspendAddingGroup.isWorking)if(n>0){s=this._getModelIndexFromViewIndex(n-1),r=null,r=s<0?this.head:this.items[s];if(r)for(u=0;u<i;u++)this.items[n+u]=new t.UI.RangeGroupItemInfo({collapsed:r.collapsed,level:r.level})}this._rootCached=null,this.refresh()}},_remove:function(n,t){t>0&&(this.items.splice(n,t),this._rootCached=null,this.refresh())},equals:function(n){var t=n,i;if(t){if(!this.items&&t.items&&t.items.length>0)return!1;if(!t.items&&this.items&&this.items.length>0)return!1;if(!this.rangeGroupItemInfoEquals(this.head,t.head))return!1;if(!this.rangeGroupItemInfoEquals(this.tail,t.tail))return!1;if(this.items&&t.items){if(this.direction!==t.direction)return!1;if(this.items.length!==t.items.length)return!1;for(i=0;i<this.items.length;i++)if(!this.items[i]&&t.items[i]||this.items[i]&&!t.items[i])return!1}return!0}return!1},_isEmpty:function(){return this.items&&this.items.length>0?!1:!0},refresh:function(){this._isEmpty()||(this._rootCached=this.createRangeGroup())},_setCount:function(n){var i,u,r;this.items||(this.items=new Array(n)),this._rootCached=null,i=this._getCount();if(n<i)this.items.splice(n,i-n);else if(n>i){u=this.items[this.items.length-1];if(u)for(r=0;r<n;r++)this.items.push(new t.UI.RangeGroupItemInfo(u));else this.items=this.items.concat(new Array(n))}},getState:function(n){var i=-1,r,u;switch(this.direction){case t.UI.RangeGroupDirection.Forward:i=n.end+1;break;case t.UI.RangeGroupDirection.Backward:i=n.start-1;break}return r=null,i<0&&(r=this.head),i>-1&&i<this._getCount()?(u=this._getViewIndexFromModelIndex(i),r=this.items[u]):i<this._getCount()||(r=this.tail),r&&r.collapsed?t.UI.GroupState.Collapsed:t.UI.GroupState.Expanded},_setLevel:function(n,i){if(n<0)this.head||(this.head=new t.UI.RangeGroupItemInfo),this.head.level=i;else if(n>-1&&n<this._getCount()){var r=this._getModelIndexFromViewIndex(n);this.items[r]||(this.items[r]=new t.UI.RangeGroupItemInfo,this.items[r].level=-1),this.items[r].level=i}else n<this._getCount()||(this.tail||(this.tail=new t.UI.RangeGroupItemInfo),this.tail.level=i);this._rootCached=null,this.refresh()},suspendAdding:function(){this.suspendAddingGroup.addRef()},resumeAdding:function(){this.suspendAddingGroup.release()},_getViewIndexFromModelIndex:function(n){return n},_getModelIndexFromViewIndex:function(n){return n},rangeGroupItemInfoEquals:function(n,t){return n?t?n.level===t.level&&n.collapsed===t.collapsed:!1:!t},createRangeGroup:function(){var i=new t.UI.RangeGroupInfo(this,0,this._getCount()-1,-1),r=new t.UI.GroupedItemIndexEnumerator(this),n;while(r.moveNext())n=this._createRangeGroup(r,0),n&&n.level>-1&&i.addChild(n);return i},_createRangeGroup:function(n,i){var u=null,e;do{var r=n.current,s=this._getModelIndexFromViewIndex(r),o=this.items[s],f=n.nextToCurrent();if(o.level<i)continue;else o.level<i||u||(u=new t.UI.RangeGroupInfo(this,r,r,i));o.level>i&&(e=this._createRangeGroup(n,i+1),n.current>-1?(r=n.current,f=n.nextToCurrent()):(r=e.end,f=-1),u.addChild(e)),r>u.end&&(u.end=r);if(this.isGroupEnd(r,f,i))return u}while(n.moveNext());return u},isGroupEnd:function(n,t,i){var s=this._getModelIndexFromViewIndex(n),e=this.items[s],o,r,f,u;if(!this._isIndexValid(t))return!0;o=this._getModelIndexFromViewIndex(t),r=this.items[o];if(!r)return!0;if(r.level<e.level){f=e.level-r.level,u=e.level-i;if(f===u)return!1;if(u>=0&&u<f)return!0}return!1},_isIndexValid:function(n){return n>=-1&&n<this._getCount()},_findImp:function(n,t,i){var r,f,u;if(n)if(n.contains(t)&&n.level===i)return n;else if(n.children&&n.children.length>0)for(r=0;r<n.children.length;r++){f=n.children[r],u=this._findImp(f,t,i);if(u)return u}return null}},r.RangeGroupItemInfo=function(n){this!==n&&n&&(this.level=n.level,this.collapsed=n.collapsed),n||(this.level=0,this.collapsed=null)},r.GroupedItemIndexEnumerator=function(n){this.rangeGroup=n},r.GroupedItemIndexEnumerator.prototype={isEOF:!1,rangeGroup:null,current:-1,nextToCurrent:function(){return this.current+1},moveNext:function(){var t,n,i;if(this.isEOF||!this.rangeGroup||!this.rangeGroup.items)return!1;for(t=!1,n=this.current+1;n<this.rangeGroup.items.length;n++){i=this.rangeGroup._getModelIndexFromViewIndex(n);if(this.rangeGroup.items[i]){t=!0,this.current=n;break}}return t||(this.current=-1),this.current>-1?!0:(this.isEOF=!0,!1)},reset:function(){this.isEOF=!1,this.current=-1}},i={getThemeBackgroundColor:function(n,i){var u=n.parent?n.parent.useWijmoTheme:n.useWijmoTheme,r;return u===!0&&(r=t.UI.Global.prototype.getWijmoThemeStyle(t.UI.VisualState.Normal),r&&r.backgroundColor&&r.backgroundColor!==""&&(i=r.backgroundColor)),i},getThemeForeColor:function(n,i){var u=n.parent?n.parent.useWijmoTheme:n.useWijmoTheme,r;return u===!0&&(r=t.UI.Global.prototype.getWijmoThemeStyle(t.UI.VisualState.Normal),r&&r.color&&r.color!==""&&(i=r.color)),i}},t.UI._RangeGroupPresenter=function(n,t,i){this._sheet=n,this._rowGroup=t,this._viewportIndex=i},t.UI._RangeGroupPresenter.prototype={_sheet:null,_rowGroup:null,_viewportIndex:1,PADDING:2,LINE_SIZE:2,STARTLINE_SIZE:6,createGroupInfo:function(){var i,u,t,r;this._groupLineInfos=[],this._groupDotInfos=[],this._groupButtonInfos=[],i=this._rowGroup,u=this.getMaxLevel(i);if(u!==-1){var f=this._sheet._getGroupLayout(),e=this._calcMinWidthOrHeight({width:f.width,height:f.height},i),n=this.getGroupsByLevel(0,i);if(n&&n.length>0)for(t=0;t<n.length;t++)r=n[t],this._measureGroups(r,e)}},paintGroups:function(n){this._rowGroup?this._paintRowGroups(n):this._paintColumnGroups(n)},_calcMinWidthOrHeight:function(n,t){var i=0,r=this.getMaxLevel(t);return i=t?(n.width-this.PADDING*2)/(r+2):(n.height-this.PADDING*2)/(r+2),i=Math.max(0,i)},_measureGroups:function(n,i){var nt=this._rowGroup,e=this.getGroupDirection(nt),c=this.getViewportStartIndex(nt),l=this.getViewportEndIndex(nt),v=n.start,a=n.end,u,r,f,k,d,b,g,it,o,h,w,tt,p,s,y,ut,rt;if(n.getState()===t.UI.GroupState.Expanded){k=!0,d=n.parent,d&&(e===t.UI.RangeGroupDirection.Backward&&n.start===d.start||e===t.UI.RangeGroupDirection.Forward&&n.end===d.end)&&(k=!1),k&&(u={isExpanded:!0,level:n.level,paintLine:!0},e===t.UI.RangeGroupDirection.Forward?(r=a+1,r<c||r>l||(u.index=r,u.lineDirection=t.UI.RangeGroupDirection.Forward,this._groupButtonInfos.push(u))):e===t.UI.RangeGroupDirection.Backward&&(r=v-1,r<c||r>l||(u.index=r,u.lineDirection=t.UI.RangeGroupDirection.Backward,this._groupButtonInfos.push(u))));if(v<=l&&a>=c){for(b=Math.max(c,v),g=Math.min(l,a),k&&(it={start:b,end:g,level:n.level},(e===t.UI.RangeGroupDirection.Forward&&b===v||e===t.UI.RangeGroupDirection.Backward&&g===a)&&(it.startLine=!0),this._groupLineInfos.push(it)),o=[],f=b;f<=g;f++)o.push(f);if(n.children&&n.children.length>0)for(f=0;f<n.children.length;f++){h=n.children[f];if(h.getState()===t.UI.GroupState.Collapsed)for(w=h.start;w<=h.end;w++)o.remove(w);e===t.UI.RangeGroupDirection.Forward?o.remove(h.end+1):e===t.UI.RangeGroupDirection.Backward&&o.remove(h.start-1),this._measureGroups(h,i)}tt=!0;if(n.children)for(p=0;p<n.children.length;p++){s=n.children[p];if(s)if(s.start===n.start&&s.end===n.end){tt=!1;break}else if(e===t.UI.RangeGroupDirection.Forward&&s.end===n.end||e===t.UI.RangeGroupDirection.Backward&&s.start===n.start)for(y=s.start;y<=s.end;y++)o.remove(y)}if(tt&&o.length>0)for(f=0;f<o.length;f++)ut=o[f],rt={index:ut,level:n.level+1},this._groupDotInfos.push(rt)}}else n.getState()===t.UI.GroupState.Collapsed&&(u={isExpanded:!1,level:n.level},e===t.UI.RangeGroupDirection.Forward?(r=a+1,r<c||r>l||(u.index=r,u.lineDirection=t.UI.RangeGroupDirection.Forward,this._groupButtonInfos.push(u))):e===t.UI.RangeGroupDirection.Backward&&(r=v-1,r<c||r>l||(u.index=r,u.lineDirection=t.UI.RangeGroupDirection.Backward,this._groupButtonInfos.push(u))))},_paintRowGroups:function(n){var ct=this.getMaxLevel(!0),u,o,k,h,r,e,f,v,nt,st,ht,rt,ot,it,et,g,l,y,w,a,ut,ft,tt;if(ct===-1)return;u=this._sheet._getGroupLayout(),o=this._calcMinWidthOrHeight({width:u.width,height:u.height},!0);if(o===0)return;n.save(),k=Math.max(0,(o-this.STARTLINE_SIZE)/2)+this.PADDING,v=this._sheet._getRowLayout(this._viewportIndex,t.UI.SheetArea.viewport);if(this._groupDotInfos&&this._groupDotInfos.length>0)for(e=0;e<this._groupDotInfos.length;e++)nt=this._groupDotInfos[e],f=v.findRow(nt.index),f&&f.height>=this.LINE_SIZE&&(h=nt.level*o+k,r=f.y+Math.max(0,(f.height-this.LINE_SIZE)/2),st=this.LINE_SIZE,ht=this.LINE_SIZE,n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+h+.5,u.y+r,st,ht));rt=this._sheet.rowRangeGroup.direction;if(this._groupLineInfos&&this._groupLineInfos.length>0)for(e=0;e<this._groupLineInfos.length;e++){var d=this._groupLineInfos[e],b=d.start,p=d.end,c=null,s=null;do c=v.findRow(b),b++;while(!c&&b<=p);do s=v.findRow(p),p--;while(!s&&p>=b);if(c||s)!c&&s?c=s:c&&!s&&(s=c);else continue;h=d.level*o+k,r=c.y,rt===t.UI.RangeGroupDirection.Forward&&(r+=1),ot=this.LINE_SIZE,it=Math.max(0,s.y+s.height-c.y),n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+h+.5,u.y+r,ot,it),et=d.startLine,et&&(g=Math.min(this.STARTLINE_SIZE,o-this.LINE_SIZE),g>0&&(rt===t.UI.RangeGroupDirection.Backward&&(r=r+it-this.LINE_SIZE),r>=c.y&&r<s.y+s.height&&(n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+h+.5,u.y+r,g,this.LINE_SIZE))))}if(this._groupButtonInfos&&this._groupButtonInfos.length>0)for(e=0;e<this._groupButtonInfos.length;e++){l=this._groupButtonInfos[e],f=v.findRow(l.index);if(!f||f&&f.height<=0)continue;y=Math.max(0,(f.height-o)/2),h=l.level*o+this.PADDING,r=f.y+y,w=o,a=Math.min(o,f.height),n.strokeStyle="gray",n.lineWidth=1,n.strokeRect(u.x+h+.5,u.y+r,w,a),l.isExpanded||n.fillRect(u.x+h+w/2-1+.5,u.y+r+4,2,a-8),n.fillRect(u.x+h+4+.5,u.y+r+a/2-1,w-8,2),ut=l.paintLine,ut&&a<f.height&&(h=l.level*o+k,r=f.y,ft=this.LINE_SIZE,tt=y,l.lineDirection===t.UI.RangeGroupDirection.Backward&&(r+=y+a,tt=f.height-a-y),n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+h+.5,u.y+r,ft,tt))}n.stroke(),n.beginPath(),n.restore()},_paintColumnGroups:function(n){var ct=this.getMaxLevel(!1),u,h,k,r,s,e,f,v,nt,ht,et,rt,it,ot,st,g,l,y,a,w,ft,tt,ut;if(ct===-1)return;u=this._sheet._getGroupLayout(),h=this._calcMinWidthOrHeight({width:u.width,height:u.height},!1);if(h===0)return;for(k=Math.max(0,(h-this.STARTLINE_SIZE)/2)+this.PADDING,v=this._sheet._getColumnLayout(this._viewportIndex,t.UI.SheetArea.viewport),n.save(),e=0;e<this._groupDotInfos.length;e++)nt=this._groupDotInfos[e],f=v.findCol(nt.index),f&&f.width>=this.LINE_SIZE&&(r=f.x+Math.max(0,(f.width-this.LINE_SIZE)/2),s=nt.level*h+k,ht=this.LINE_SIZE,et=this.LINE_SIZE,n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+r,u.y+s+.5,ht,et));for(rt=this._sheet.colRangeGroup.direction,e=0;e<this._groupLineInfos.length;e++){var d=this._groupLineInfos[e],b=d.start,p=d.end,c=null,o=null;do c=v.findCol(b),b++;while(!c&&b<=p);do o=v.findCol(p),p--;while(!o&&p>=b);if(c||o)!c&&o?c=o:c&&!o&&(o=c);else continue;r=c.x,rt===t.UI.RangeGroupDirection.Forward&&(r+=1),s=d.level*h+k,it=Math.max(0,o.x+o.width-c.x),ot=this.LINE_SIZE,n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+r,u.y+s+.5,it,ot),st=d.startLine,st&&(g=Math.min(this.STARTLINE_SIZE,h-this.LINE_SIZE),g>0&&(rt===t.UI.RangeGroupDirection.Backward&&(r=r+it-this.LINE_SIZE),r>=c.x&&r<o.x+o.width&&(n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+r,u.y+s+.5,this.LINE_SIZE,g))))}for(e=0;e<this._groupButtonInfos.length;e++){l=this._groupButtonInfos[e],f=v.findCol(l.index);if(!f||f&&f.width<=0)continue;y=Math.max(0,(f.width-h)/2),r=f.x+y,s=l.level*h+this.PADDING,a=Math.min(h,f.width),w=h,n.strokeStyle="gray",n.lineWidth=1,n.strokeRect(u.x+r,u.y+s+.5,a,w),l.isExpanded||n.fillRect(u.x+r+a/2-1,u.y+s+4.5,2,w-8),n.fillRect(u.x+r+4,u.y+s+w/2-.5,a-8,2),ft=l.paintLine,ft&&a<f.width&&(r=f.x,s=l.level*h+k,tt=y,ut=this.LINE_SIZE,l.lineDirection===t.UI.RangeGroupDirection.Backward&&(r+=y+a,tt=f.width-a-y),n.fillStyle=i.getThemeForeColor(this._sheet,"black"),n.fillRect(u.x+r,u.y+s+.5,tt,ut))}n.beginPath(),n.restore()},getRowOrColumnStartIndex:function(n){var i,t;return n?(i=this._sheet.getViewportTopRow(this._viewportIndex),Math.max(0,i-1)):(t=this._sheet.getViewportLeftColumn(this._viewportIndex),Math.min(0,t-1))},getRowOrColumnCount:function(n){var i,t;return n?(i=this._sheet.getViewportBottomRow(this._viewportIndex),Math.min(this._sheet.getRowCount(),i+2)):(t=this._sheet.getViewportRightColumn(this._viewportIndex),Math.min(this._sheet.getColumnCount(),t+2))},getGroupsByLevel:function(n,t){var u=[],r=this.getRowOrColumnStartIndex(t),f=this.getRowOrColumnCount(t),i;while(r<f)i=null,i=t?this._sheet.rowRangeGroup.find(r,n):this._sheet.colRangeGroup.find(r,n),i?(r=i.end+1,u.push(i)):r++;return u},getMaxLevel:function(n){var t=-1;return t=n?this._sheet.rowRangeGroup.getMaxLevel():this._sheet.colRangeGroup.getMaxLevel()},getGroupDirection:function(n){return n?this._sheet.rowRangeGroup.direction:this._sheet.colRangeGroup.direction},getViewportStartIndex:function(n){return n?this._sheet.getViewportTopRow(this._viewportIndex):this._sheet.getViewportLeftColumn(this._viewportIndex)},getViewportEndIndex:function(n){return n?this._sheet.getViewportBottomRow(this._viewportIndex):this._sheet.getViewportRightColumn(this._viewportIndex)},getRowGroupButton:function(n,i){var y=this.getMaxLevel(!0),f,u,h,c,l,o,e,r,s;if(y===-1)return null;f=this._sheet._getGroupLayout(),u=this._calcMinWidthOrHeight({width:f.width,height:f.height},!0);if(u===0)return null;l=this._sheet._getRowLayout(this._viewportIndex,t.UI.SheetArea.viewport);if(this._groupButtonInfos&&this._groupButtonInfos.length>0)for(o=0;o<this._groupButtonInfos.length;o++){e=this._groupButtonInfos[o],r=l.findRow(e.index);if(!r||r&&r.height<=0)continue;s=Math.max(0,(r.height-u)/2),h=e.level*u+this.PADDING,c=r.y+s;var p=u,a=Math.min(u,r.height),v=new t.UI.Rect(f.x+h+.5,f.y+c+.5,p,a);if(v.contains(n,i))return e}return null},getColGroupButton:function(n,i){var y=this.getMaxLevel(!1),f,u,h,c,l,o,e,r,s;if(y===-1)return null;f=this._sheet._getGroupLayout(),u=this._calcMinWidthOrHeight({width:f.width,height:f.height},!1);if(u===0)return null;l=this._sheet._getColumnLayout(this._viewportIndex,t.UI.SheetArea.viewport);if(this._groupButtonInfos&&this._groupButtonInfos.length>0)for(o=0;o<this._groupButtonInfos.length;o++){e=this._groupButtonInfos[o],r=l.findCol(e.index);if(!r||r&&r.width<=0)continue;s=Math.max(0,(r.width-u)/2),h=r.x+s,c=e.level*u+this.PADDING;var p=Math.min(u,r.width),a=u,v=new t.UI.Rect(f.x+h+.5,f.y+c+.5,p,a);if(v.contains(n,i))return e}return null}},t.UI._RangeGroupHeaderPresenter=function(n,t){this._sheet=n,this._rowGroup=t},t.UI._RangeGroupHeaderPresenter.prototype={_sheet:null,_rowGroup:null,PADDING:2,paintGroupHeader:function(n){var y,p,t,u,w,l,a,e,f,o,s,c,h,v,r;if(!this._sheet)return;y=this._rowGroup,p=this.getMaxLevel(y);if(p!==-1){t=this._sheet._getGroupLayout(),u=this._calcMinWidthOrHeight({width:t.width,height:t.height},y);if(u===0)return;w=p+2,r=this._sheet._getSheetLayout(),n.fillStyle=i.getThemeBackgroundColor(this._sheet,"#D7E6F7"),n.strokeStyle="gray",n.font="8.25pt Arial",n.lineWidth=1;if(y){n.fillRect(t.x,t.y,t.width,r.height),n.strokeRect(t.x-.5,t.y-.5,t.width,r.height+1),n.strokeRect(t.x-.5,r.headerY-.5,t.width,r.colHeaderHeight),n.fillStyle=i.getThemeForeColor(this._sheet,"black");if(this._sheet.colHeaderVisible&&r.colHeaderHeight>=u)for(l=this.PADDING,a=Math.max(0,r.headerY+(r.colHeaderHeight-u)/2),e=0;e<w;e++)f=u-1,o=t.x+l+.5,s=t.y+a,n.strokeRect(o,s,f,f),c=""+(e+1),h=n.measureText(c).width,v=this._sheet._getFontHeight(n.font),f<h||u<v||n.fillText(c,o+(f-h)/2,s+11),l+=u}else{n.fillRect(t.x,t.y,r.width,t.height),n.strokeRect(t.x-.5,t.y-.5,r.width+1,t.height),n.strokeRect(r.headerX-.5,t.y-.5,r.rowHeaderWidth,t.height),n.fillStyle=i.getThemeForeColor(this._sheet,"black");if(this._sheet.rowHeaderVisible&&r.rowHeaderWidth>=u)for(l=Math.max(0,r.headerX+(r.rowHeaderWidth-u)/2),a=this.PADDING,e=0;e<w;e++)f=u-1,o=t.x+l,s=t.y+a+.5,n.strokeRect(o,s,f,f),c=""+(e+1),h=n.measureText(c).width,v=this._sheet._getFontHeight(n.font),f<h||u<v||n.fillText(c,o+(f-h)/2,s-.5+11),a+=u}}},getGroupButton:function(n,i){var c,l,f,r,a,s,o,u,h,e;if(!this._sheet)return null;c=this._rowGroup,l=this.getMaxLevel(c);if(l!==-1){f=this._sheet._getGroupLayout(),r=this._calcMinWidthOrHeight({width:f.width,height:f.height},c);if(r===0)return null;a=l+2,e=this._sheet._getSheetLayout();if(c)for(s=this.PADDING,o=Math.max(0,e.headerY+(e.colHeaderHeight-r)/2),u=0;u<a;u++){h=new t.UI.Rect(f.x+s,f.y+o,r,r);if(h.contains(n,i))return{index:u};s+=r}else for(s=Math.max(0,e.headerX+(e.rowHeaderWidth-r)/2),o=this.PADDING,u=0;u<a;u++){h=new t.UI.Rect(f.x+s,f.y+o,r,r);if(h.contains(n,i))return{index:u};o+=r}}return null}},t.UI._RangeGroupHeaderPresenter.prototype._calcMinWidthOrHeight=t.UI._RangeGroupPresenter.prototype._calcMinWidthOrHeight,t.UI._RangeGroupHeaderPresenter.prototype.getMaxLevel=t.UI._RangeGroupPresenter.prototype.getMaxLevel})(window);(function(n){"use strict";var t=n.GrapeCity,r,i;typeof t=="undefined"&&(t=n.GrapeCity={}),typeof t.UI=="undefined"&&(t.UI={}),r=t.UI,i={All:0,HasValue:1,HasStyle:2},t.UI.CellsEnumerator=function(n,t){if(!n)throw new Error("sheet is null.");this.actualEndRow=-1,this.isActualEndRowSet=!1,this.isBlockRange=!1,this.options=i.HasValue,this.worksheet=n,this.sheetArea=t.sheetArea,this.searchOrder=t.searchOrder,this.rowStart=t.rowStart,this.columnStart=t.columnStart,this.rowEnd=t.rowEnd,this.columnEnd=t.columnEnd,this.findBeginRow=t.findBeginRow,this.findBeginColumn=t.findBeginColumn,this.init(),this.block=this.worksheet._getModel(this.sheetArea)},t.UI.CellsEnumerator.prototype={init:function(){this.currentRow=-1,this.currentColumn=-1},moveNext:function(){if(this.currentRow===-1&&this.currentColumn===-1)if(this.rowStart<=this.rowEnd&&this.columnStart<=this.columnEnd){this.currentRow=this.findBeginRow,this.currentColumn=this.findBeginColumn;if(this.isIndexAcceptable(this.currentRow,this.currentColumn))if(!this.skipCurrent())return!0}if(this.rowStart<=this.rowEnd&&this.columnStart<=this.columnEnd)while(this.tryMoveNext())if(!this.skipCurrent())return!0;return this.currentRow=-1,this.currentColumn=-1,!1},isIndexAcceptable:function(n,t){if((this.options&i.HasValue)>0)if(this.block)if(this.block.getValue(n,t)!==null||this.block.getFormula(n,t)!==null)return!0;return this.options===i.All},skipCurrent:function(){return!1},tryMoveNext:function(){var r=this.currentRow,u=this.currentColumn,f=!1,t,n;return(this.options&i.HasValue)>0&&(t={value:r},n={value:u},this.nextValue(t,n)&&(r=t.value,u=n.value,f=!0)),this.options===i.HasValue&&(f?(this.currentRow=r,this.currentColumn=u):(this.currentRow=-1,this.currentColumn=-1)),!(this.currentRow===-1&&this.currentColumn===-1)},nextValue:function(n,t){while(this.next(n,t))if(this.isIndexAcceptable(n.value,t.value))return!0;return!1},nextZOrder:function(n,t,i){var f,u,r;if(n){f=this.getNextNonEmptyColumnInRow(n,t.value,i.value+1);if(f!==-1){i.value=f;if(this.isZOrderOver(t.value,i.value))return!0}do{u=n.nextNonNullRow(t.value),u===-1||u>this.rowEnd?t.value=-1:(u!==-1&&(t.value=u),u!==-1&&u<t.value&&(t.value=u));if(t.value!==-1){i.value=t.value===this.rowStart||this.isBlockRange?this.columnStart-1:-1;do{r=this.getNextNonEmptyColumnInRow(n,t.value,i.value+1),r===-1||r>this.columnEnd?i.value=-1:(r!==-1&&(i.value=r),r!==-1&&r<i.value&&(i.value=r));if(i.value!==-1)return this.isZOrderOver(t.value,i.value)}while(i.value!==-1)}}while(t.value!==-1)}return!1},getNextNonEmptyColumnInRow:function(n,t,i){for(var r=i;r<=this.columnEnd;r++)if(n.getValue(t,r)!==null)return r;return-1},isZOrderOver:function(n,t){if(this.isBlockRange)return n>=this.rowStart&&n<=this.getActualEndRow()&&t>=this.columnStart&&t<=this.actualEndColumn();else{if(n>this.getActualEndRow())return!1;if(n===this.getActualEndRow())if(t<0||t>this.actualEndColumn())return!1;if(n<this.rowStart)return!1;if(n===this.rowStart)if(t<this.columnStart)return!1}return!0},getActualEndRow:function(){var n,t,r;return this.isActualEndRowSet?this.actualEndRow:(n=-1,t=!1,(this.options&i.HasValue)>0&&this.block&&(r=this.block.getRowCount()-1,n=Math.max(n,r),t=!0),n=t?Math.min(n,this.rowEnd):this.rowEnd,this.actualEndRow=n,this.isActualEndRowSet=!0,this.actualEndRow)},actualEndColumn:function(){return this.columnEnd},next:function(n,i){var u,r;if(this.searchOrder===t.UI.SearchOrder.ZOrder)return u=this.getActualEndColumnZOrder(n.value),i.value+1>u?n.value+1>this.getActualEndRow()?!1:(n.value+=1,i.value=this.isBlockRange?this.columnStart:0,this.isZOrderOver(n.value,i.value)):(i.value+=1,this.isZOrderOver(n.value,i.value));else if(this.searchOrder===t.UI.SearchOrder.NOrder)return r=this.getActualEndRowNOrder(i.value),n.value+1>r?i.value+1>this.actualEndColumn()?!1:(i.value+=1,n.value=this.isBlockRange?this.rowStart:0,this.isNOrderOver(n.value,i.value)):(n.value+=1,this.isNOrderOver(n.value,i.value));return!1},getActualEndColumnZOrder:function(n){if(n<this.rowStart||n>this.rowEnd)return-1;else{var t=-1,r=!1;return(this.options&i.HasValue)>0&&this.block&&(t=Math.max(t,this.block.getColumnCount()-1),r=!0),t=n===this.rowEnd||this.isBlockRange?r?Math.min(t,this.columnEnd):this.columnEnd:r?Math.max(t,this.worksheet.getColumnCount(this.sheetArea)-1):this.worksheet.getColumnCount(this.sheetArea)-1}},getActualEndRowNOrder:function(n){if(n<this.columnStart||n>this.columnEnd)return-1;else{var t=-1,r=!1;return(this.options&i.HasValue)>0&&this.block&&(t=Math.max(t,this.rowEnd),r=!0),t=n===this.columnEnd||this.isBlockRange?r?Math.min(t,this.rowEnd):this.rowEnd:r?Math.max(t,this.worksheet.getRowCount(this.sheetArea)-1):this.worksheet.getRowCount(this.sheetArea)-1}},isNOrderOver:function(n,t){if(this.isBlockRange)return n>=this.rowStart&&n<=this.getActualEndRow()&&t>=this.columnStart&&t<=this.actualEndColumn();else{if(t>this.actualEndColumn())return!1;if(t===this.actualEndColumn())if(n<0||n>this.getActualEndRow())return!1;if(t<this.columnStart)return!1;if(t===this.columnStart)if(n<this.rowStart)return!1}return!0},current:function(){return 0<=this.currentRow&&this.currentRow<this.worksheet.getRowCount(this.sheetArea)&&0<=this.currentColumn&&this.currentColumn<this.worksheet.getColumnCount(this.sheetArea)?new t.UI.Cell(this.worksheet,this.currentRow,this.currentColumn,this.sheetArea):null}},t.UI.SearchCondition=function(){this.startSheetIndex=-1,this.endSheetIndex=-1,this.searchString=null,this.searchFlags=t.UI.SearchFlags.None,this.searchOrder=t.UI.SearchOrder.ZOrder,this.searchTarget=t.UI.SearchFoundFlags.CellText,this.sheetArea=t.UI.SheetArea.viewport,this.rowStart=-1,this.columnStart=-1,this.rowEnd=-1,this.columnEnd=-1,this.findBeginRow=-1,this.findBeginColumn=-1},t.UI.SearchResult=function(){this.searchFoundFlag=t.UI.SearchFoundFlags.None,this.foundSheetIndex=-1,this.foundRowIndex=-1,this.foundColumnIndex=-1,this.foundString=null},r.SearchFlags={None:0,IgnoreCase:1,ExactMatch:2,UseWildCards:4,BlockRange:8},r.SearchOrder={ZOrder:0,NOrder:1},r.SearchFoundFlags={None:0,CellText:1,CellFormula:8}})(window);(function(n){"use strict";function r(n){this.range=n,this.reset()}function i(n){this.range=n,this.filterInRows=[],this.filterItemMap=[],this.filteredColMap=[],this.filteredItems=[],this.filteredInRowsWithColIndexs={},this.sortInfo=null}var t=n.GrapeCity,u;typeof t=="undefined"&&(t=n.GrapeCity={}),typeof t.UI=="undefined"&&(t.UI={}),u=t.UI,r.prototype={sheet:null,range:null,filterInRows:null,filterItemMap:null,filteredColMap:null,filteredItems:null,filteredInRowsWithColIndexs:null,sortInfo:null,addFilterItem:function(n,t){var r,i;if(t===undefined||t===null)throw new Error("FilterItem is null.");if(n<-1||n>=this.sheet.getColumnCount())throw new Error("Invalid column index.");if(!this.range)return;r=this.sheet._getActualRange(this.range);if(n<r.col||n>=r.col+r.colCount)return;i=this.filterItemMap[n],i||(i=[]),i.push(t),this.filterItemMap[n]=i},addAverageFilter:function(n,i){var r=new t.UI.AverageCondition(i);this.addFilterItem(n,r)},addBackgroundFilter:function(n,i){var r=new t.UI.ColorCondition(t.UI.ColorCompareType.BackgroundColor,i);this.addFilterItem(n,r)},addDateFilter:function(n,i,r){var u=new t.UI.DateCondition(i,r);this.addFilterItem(n,u)},addForegroundFilter:function(n,i){var r=new t.UI.ColorCondition(t.UI.ColorCompareType.ForegroundColor,i);this.addFilterItem(n,r)},addNumberFilter:function(n,i,r){var u=new t.UI.NumberCondition(i,r);this.addFilterItem(n,u)},addTextFilter:function(n,i,r){var u=new t.UI.TextCondition(i,r);this.addFilterItem(n,u)},addTop10Filter:function(n,i,r){var u=new t.UI.Top10Condition(i,r);this.addFilterItem(n,u)},removeFilterItems:function(n){this.filterItemMap[n]&&this.filterItemMap.splice(n,1,null),this.unfilter(n)},unfilter:function(n){if(this.sheet){var t=this;this.sheet._bindToAutoRefresh(function(n){if(n!==null&&n!==undefined)t._unfilterColumn(n);else if(t.filteredColMap)for(var i=0;i<t.filteredColMap.length;i++)t._unfilterColumn(t.filteredColMap[i])})(n)}},_filterColumn:function(n){var i,r,u,t;this._unfilterColumn(n);if(this.filterItemMap[n]){if(this.range&&this.range.col!==-1&&(n<this.range.col||n>this.range.col+this.range.colCount-1))return;for(u=this.sheet.getRowCount(),this.range&&(i=this.range.row,r=this.range.rowCount,i===-1&&(i=0,r=u)),t=0;t<u;t++){if(this.range&&(t<i||t>=i+r)){this._addRowFilteredIn(t);continue}this._filterRowByCell(t,n)}this._setColumnFilteredState(n,!0)}},filter:function(n){if(this.sheet){var t=this;this.sheet._bindToAutoRefresh(function(n){if(n!==null&&n!==undefined)t._filterColumn(n);else if(t.filterItemMap)for(var i=0;i<t.filterItemMap.length;i++)t.filterItemMap[i]&&t.filterItemMap[i].length>0&&t._filterColumn(i)})(n)}},isHideRowFilter:function(){return!1},isFiltered:function(){return this.filteredColMap.length>0},isColumnFiltered:function(n){return this.filteredColMap.contains(n)},isRowFilteredOut:function(n){return this.isFiltered()?!this.filterInRows.contains(n):!1},reset:function(){this.filterInRows=[],this.filterItemMap=[],this.filteredColMap=[],this.filteredItems=[],this.filteredInRowsWithColIndexs={},this.showFilterButton=!0,this.sortInfo=null},isFilterHeader:function(n,i,r){var f=!1,u;return this.range&&(u=this.sheet._getActualRange(this.range,r),r===t.UI.SheetArea.colHeader&&n===this.sheet.getRowCount(r)-1&&u.row-1<0?i>=u.col&&i<u.col+u.colCount&&(f=!0):r===t.UI.SheetArea.viewport&&n===u.row-1&&i>=u.col&&i<u.col+u.colCount&&(f=!0)),f},isLastFilteredColumn:function(n){var t=this.filteredColMap.length;return t>0?this.filteredColMap[t-1]===n:!1},getFilterItems:function(n){var t=this.filterItemMap[n];return t||(t=[]),t},getFilteredItems:function(){return this.filteredItems},sortColumn:function(n,t){if(this.sheet){var i=this;this.sheet._bindToAutoRefresh(function(n,t){var r=i.sheet._getActualRange(i.range),f=i.sheet.isPaintSuspended(),u;i.sheet.isPaintSuspended(!0),u=i.sheet.sortRange(r.row,r.col,r.rowCount,r.colCount,!0,[{index:n,ascending:t}]),i.sheet.isPaintSuspended(f),u&&(i.sortInfo={index:n,ascending:t},i.isColumnFiltered(n)&&i.reFilter())})(n,t)}},getSortState:function(n){var i=t.UI.SortState.None;return this.sortInfo&&this.sortInfo.index===n&&(i=this.sortInfo.ascending?t.UI.SortState.Ascending:t.UI.SortState.Descending),i},reFilter:function(){var n,t;this.filteredInRowsWithColIndexs={},(this.filteredItems||this.filteredItems.length>0)&&(this.filteredItems.length=0);if(this.filteredColMap||this.filteredColMap.length>0)for(n=[],n=n.concat(this.filteredColMap),this.filteredColMap.length=0,t=0;t<n.length;t++)this.filter(n[t])},_addRowFilteredIn:function(n){this.filterInRows.contains(n)||this.filterInRows.push(n)},_addFilteredInRowsWithColumnIndex:function(n,t){var i=this.filteredInRowsWithColIndexs[n];i===undefined||i===null?i=[t]:(i.contains(t)&&i.remove(t),i.push(t)),this.filteredInRowsWithColIndexs[n]=i},_addFilteredItem:function(n){this.filteredItems.contains(n)||this.filteredItems.push(n)},_unfilterColumn:function(n){var i,t,u,r;if(!this.range)return;i=this.sheet._getActualRange(this.range);if(this.isColumnFiltered(n)){if(!(this.filteredColMap.length>1&&n===this.filteredColMap[0]))for(t=i.row;t<i.row+i.rowCount;t++)u=this._isRowfilteredOutByColumn(t,n),u&&this._addRowFilteredIn(t);this._setColumnFilteredState(n,!1),this._removeFilteredInRowsWithColumnIndex(n),this._removeFilteredItems(n)}else for(t=i.row;t<i.row+i.rowCount;t++)r=this.isRowFilteredOut(t),r||this._addRowFilteredIn(t)},_setColumnFilteredState:function(n,t){if(t){if(this.filteredColMap.length>0)if(this.filteredColMap[this.filteredColMap.length-1]===n)return;else this.filteredColMap.remove(n);this.filteredColMap.push(n)}else this.filteredColMap.remove(n)},_removeFilteredItems:function(n){var r,f,t,i,u;if(!this.filterItemMap[n])return;r=[],f=[];for(t in this.filterItemMap)t===n?r.concat(this.filterItemMap[t]):f.concat(this.filterItemMap[t]);for(i=0;i<r.length;i++)u=r[i],f.contains(u)||this.filteredItems.remove(u)},_removeFilteredInRowsWithColumnIndex:function(n){var i,t;for(i in this.filteredInRowsWithColIndexs)i&&(t=this.filteredInRowsWithColIndexs[i],t.contains(n)&&t.remove(n))},_filterRowByCell:function(n,i){for(var o=this.filterItemMap[i],r,f,e,u=0;u<o.length;u++){r=o[u],r.conditionType==="RelationCondition"||r instanceof t.UI.RelationCondition?(r.item1&&(f=this._getActualValue(r.item1,n,i),r.item1.conditionType==="Top10Condition"||r.item1 instanceof t.UI.Top10Condition?r.item1.ranges=this._getReviseRanges(i,this.range):(r.item1.conditionType==="AverageCondition"||r.item1 instanceof t.UI.AverageCondition)&&(r.item1.ranges=this._getReviseRanges(i,this.range))),r.item2&&(e=this._getActualValue(r.item2,n,i),r.item2.conditionType==="Top10Condition"||r.item2 instanceof t.UI.Top10Condition?r.item2.ranges=this._getReviseRanges(i,this.range):(r.item2.conditionType==="AverageCondition"||r.item2 instanceof t.UI.AverageCondition)&&(r.item2.ranges=this._getReviseRanges(i,this.range)))):(f=this._getActualValue(r,n,i),r.conditionType==="Top10Condition"||r instanceof t.UI.Top10Condition?r.ranges=this._getReviseRanges(i,this.range):(r.conditionType==="AverageCondition"||r instanceof t.UI.AverageCondition)&&(r.ranges=this._getReviseRanges(i,this.range)));if(r.evaluate(this.sheet,n,i,f,e)){this._addRowFilteredIn(n),this._addFilteredInRowsWithColumnIndex(n,i),this._addFilteredItem(r);break}else this.filterInRows.remove(n)}},_getReviseRanges:function(n,i){var u=[],r;return i&&(r=this.sheet._getActualRange(i),r.col<=n&&n<r.col+r.colCount&&u.push(new t.UI.Range(r.row,n,r.rowCount,1))),u},_getActualValue:function(n,i,r){var u=null,f;return n.conditionType==="TextCondition"||n.conditionType==="TextLengthCondition"?u=this.sheet.getText(i,r):n.conditionType==="ColorCondition"?(f=this.sheet.getActualStyle(i,r),f&&(n.compareType===t.UI.ColorCompareType.BackgroundColor?u=f.backColor:n.compareType===t.UI.ColorCompareType.ForegroundColor&&(u=f.foreColor))):u=this.sheet.getValue(i,r),u},_getCandindateDataItems:function(n,i){var f=[],e=this.sheet._getActualRange(this.range),o,r,u;if(n<e.col||n>e.col+e.colCount-1)return f;for(o=!1,r=e.row;r<e.row+e.rowCount;r++){u=this.sheet.getText(r,n);if(u===""){o=!0;continue}f.contains(u)||(this.isRowFilteredOut(r)?!this.isFiltered()||this.isLastFilteredColumn(n)&&this._isRowfilteredOutByColumn(r,n)?f.push(u):this.sheet.getRowHeight(r,t.UI.SheetArea.viewport)>0&&f.push(u):this.sheet.getRowHeight(r,t.UI.SheetArea.viewport)>0&&f.push(u))}return o&&i&&(i.hasBlank=!0),f},_isRowfilteredOutByColumn:function(n,t){var r,u,i;return this.filteredColMap.length===0?!1:this.filteredInRowsWithColIndexs?(r=-1,u=this.filteredColMap.indexOf(t),u>0&&(r=this.filteredColMap[u-1]),i=this.filteredInRowsWithColIndexs[n],r>-1?i&&i.length!==0?r===i[i.length-1]:!1:this.filteredColMap.length===1?!i||i.length===0:!1):!1},_addRows:function(n,i){var e,r,f,u,s,o;if(!this.range)return;e=this.sheet.getRowCount()-i-1,this.range.row>-1&&(r=this.range,e=r.row+r.rowCount-1,r.row<n?r.row<n&&n<r.row+r.rowCount&&this._setRangeInternal(new t.UI.Range(r.row,r.col,r.rowCount+i,r.colCount)):this._setRangeInternal(new t.UI.Range(r.row+i,r.col,r.rowCount,r.colCount)));if(this.isFiltered()&&this.filterInRows)for(f=this.filterInRows.length-1;f>=0;f--)u=this.filterInRows[f],u<n||u>e||(s=this.filterInRows[u],o=u+i,this.filterInRows[o]=s,this.filterInRows.remove(u));this.reFilter()},_addColumns:function(n,i){var u,h,s,l,c,e;if(!this.range)return;if(n>=0&&this._isSortted()){for(h=0,s=0;s<i;s++)u=s+n,u>this._sorttedColumn()||h++;this._sorttedColumn(this._sorttedColumn()+h)}var f=-1,o=0,r=this.range;for(r.col>-1&&(r.col<n?r.col<n&&n<r.col+r.colCount&&(f=n,o=r.columnCount-(n-r.col),this._setRangeInternal(new t.UI.Range(r.row,r.col,r.rowCount,r.colCount+i))):(f=this.range.col,this._setRangeInternal(new t.UI.Range(r.row,r.col+i,r.rowCount,r.colCount)),o=this.range.colCount)),f<0&&(f=0,o=this.sheet.getColumnCount()-i),u=f+o-1;u>=f;u--)u<n||(l=u+i,c=this.filteredColMap.indexOf(u),c<0||(this.filteredColMap[c]=l),e=this.filterItemMap[u],e&&e.length>0&&(this.filterItemMap.remove(u),this.filterItemMap[l]=e));this.reFilter()},_removeRows:function(n,i){var o,s,r,u,f,e,h;if(!this.range)return;o=0,s=this.sheet.getRowCount()+i-1,this.range.row>-1&&(r=this.range,o=r.row,s=r.row+r.rowCount-1,r.row<n?r.row<n&&n<r.row+r.rowCount&&this._setRangeInternal(new t.UI.Range(r.row,r.col,r.rowCount-Math.min(r.row+r.rowCount-n,i),r.colCount)):r.row===n+1?this._setRangeInternal(null):r.row+r.rowCount>n+i?r.row<n+i?this._setRangeInternal(new t.UI.Range(n,r.col,r.row+r.rowCount-(n+i),r.colCount)):this._setRangeInternal(new t.UI.Range(r.row-i,r.col,r.rowCount,r.colCount)):this._setRangeInternal(null));if(this.isFiltered()&&this.filterInRows)for(u=o;u<=s;u++)u<n||(u<n+i?this.filterInRows.remove(u):(f=u,e=this.filterInRows[f],e!==undefined&&e!==null&&(h=f-i,this.filterInRows[h]=e,this.filterInRows.remove(f))));this.reFilter()},_setRangeInternal:function(n){this.range=n},_removeColumns:function(n,i){var f,u,c,h,o;if(!this.range)return;n>=0&&this._isSortted()&&(n<=this._sorttedColumn()&&this._sorttedColumn()<n+i?this._sorttedColumn(-1):this._sorttedColumn()<n||this._sorttedColumn(this._sorttedColumn()-i));var r=this.range,e=r.col,s=r.colCount;for(e<0?(e=0,s=this.sheet.getColumnCount()+i):s=this.range.colCount,f=n+i,u=e;u<e+s;u++)u<n||(u<f?this.removeFilterItems(u):(c=u-i,h=this.filteredColMap.indexOf(u),h<0||(this.filteredColMap[h]=c),o=this.filterItemMap[u],o&&o.length>0&&(this.filterItemMap.remove(u),this.filterItemMap[c]=o)));r.col<0||(n<r.col?f>r.col?f>r.col+r.colCount?this._setRangeInternal(null):this._setRangeInternal(new t.UI.Range(r.row,n,r.rowCount,r.col+r.colCount-f)):this._setRangeInternal(new t.UI.Range(r.row,r.col-i,r.rowCount,r.colCount)):n<r.col+r.colCount&&(f>r.col+r.colCount?this._setRangeInternal(new t.UI.Range(r.row,r.col,r.rowCount,n-r.col)):this._setRangeInternal(new t.UI.Range(r.row,r.col,r.rowCount,r.colCount-i)))),this.reFilter()},_isSortted:function(){return this.sortInfo?this.sortInfo.index>-1&&this.getSortState(this.sortInfo.index)!==t.UI.SortState.None:!1},_sorttedColumn:function(n){return arguments.length===0?this.sortInfo?this.sortInfo.index:-1:(this.sortInfo?this.sortInfo.index=n:this.sortInfo={index:n,ascending:!1},this)},_clear:function(n,i,r,u){var o,f,e;if(!this.range)return;o=new t.UI.Range(n,i,r,u),this.showFilterButton?(f=this.range.row-1,e=this.range.rowCount+1,f<0&&(f=-1,e=-1),o.containsRange(new t.UI.Range(f,this.range.col,e,this.range.colCount))&&this.unfilter()):o.containsRange(this.range)&&this.unfilter()}},i.prototype=new r,i.prototype.isHideRowFilter=function(){return!0},u.RowFilterBase=r,u.HideRowFilter=i})(window);(function(n,t){"use strict";function i(n,i,r,u,f){var e="<"+n+" ";return i&&(e+="id='"+i+"' "),u&&t.each(u,function(n,t){e+=n+"='"+t+"' "}),e+=r?">"+r+"</"+n+">":f===!0?">":"/>"}function e(n,t){this.sheet=n,this.filterButtonInfo=t,this._init()}var u=n.GrapeCity,s;typeof u=="undefined"&&(u=n.GrapeCity={}),typeof u.UI=="undefined"&&(u.UI={}),s=u.UI;var f="div",l="table",h="tr",o="td",a="img",p="ul",v="li",y="select",c="input",r={noSortFilter:0,ascend:1,descend:2,filter:3,filterAscend:4,filterDescend:5,sortAscending:6,sortDescending:7};e.prototype={_init:function(){var n,r,o,i;this.dialogID="gc_filterDialog",this.topMenuID="gc_filterTopMenu",this.sortAscID="gc_sortAsc",this.sortDesID="gc_sortDes",this.itemListID="gc_filterItemList",this.okID="gc_filterOK",this.cancelID="gc_filterCancel",this.superPanelID="gc_filterSuperPanel",this.allItemsLength=-1,n=this,this._creatDom(),this.dialog=t("#"+this.dialogID).wijsheetfilterdialog({show:"blind",_filterDialog:this}),this.dialog.parent().css("boxShadow","2px 4px 5px rgba(0,0,0,0.4)"),r=t("#"+this.topMenuID),r.menu({select:function(i,r){var u=t(r.item).attr("id");u===n.sortAscID?n._sortByUser(!0):u===n.sortDesID&&n._sortByUser(!1),n.close()}})[0].tabIndex=-1,o=r.data("menu")._activate,r.data("menu")._activate=function(n){this.active&&o.apply(this,arguments)};var f=t("#"+this.itemListID),e=t("#"+this.okID),u=t("#"+this.cancelID);this.itemList=f.wijsheetmultiselect().wijsheetmultiselectfilter(),e.button(),u.button(),e.unbind("click"),e.click(function(){n.dialog.wijsheetfilterdialog("close");var t=n._getCheckedValuesByUser();n._updateData(t),n._filter(t)}),u.unbind("click"),u.click(function(){n.dialog.wijsheetfilterdialog("close")}),f.unbind("change"),f.bind("change",function(){n._setButtonState()}),t("#"+this.superPanelID).wijspreadpanelex(),i=t(".ui-multiselect-filter > input"),i.unbind(".gcSheetInternal"),i.bind("keyup.gcSheetInternal",function(){t("#"+n.superPanelID).wijspreadpanelex("refresh")}),i.bind("search.gcSheetInternal",function(){n.itemList.wijsheetmultiselect("refresh"),n.itemList.wijsheetmultiselectfilter("updateCache"),t("#"+n.superPanelID).wijspreadpanelex("refresh")})},_setButtonState:function(){var n=this.itemList.wijsheetmultiselect("getChecked").length;n>0?t("#"+this.okID).button("option","disabled",!1):t("#"+this.okID).button("option","disabled",!0)},_sortByUser:function(n){var i=this.sheet.rowFilter(),t;if(!i)return;t=this.filterButtonInfo.col,this.sheet._trigger(u.UI.Events.RangeSorting,{sheet:this.sheet,sheetName:this.sheet._name,col:t,ascending:n}),i.sortColumn(t,n),this.sheet._trigger(u.UI.Events.RangeSorted,{sheet:this.sheet,sheetName:this.sheet._name,col:t,ascending:n}),this.sheet.invalidateLayout(),this.sheet.repaint()},_getCheckedValuesByUser:function(){var n=[];return this.itemList.wijsheetmultiselect("getChecked").each(function(){n.push(this.value)}),this.allItemsLength===n.length&&(n=[]),n},_getDomString:function(){return i(f,this.dialogID,i(l,null,i(h,null,i(o,null,i(f,null,i(f,null,"",{style:"height: 10px"})+i(f,null,i(a,null,null,{src:e.getImageSrc(r.sortAscending)},!0))+i(f,null,"",{style:"height: 5px"})+i(f,null,i(a,null,null,{src:e.getImageSrc(r.sortDescending)})),{style:"text-align: left"}),{style:"border-right: 1px solid #CCC;vertical-align: top"})+i(o,null,i(l,null,i(h,null,i(o,null,i(f,null,i(p,this.topMenuID,i(v,this.sortAscID,"<a style='cursor:default'>Sort Ascending</a>",{style:"width: 195px",tabindex:0})+i(v,this.sortDesID,"<a style='cursor:default'>Sort Descending</a>",{tabindex:0}),{style:"border-width: 0;"}),{style:"text-align: left"}),{style:"border-bottom: 1px solid #CCC"}))+i(h,null,i(o,null,i(y,this.itemListID,""))))+i(f,null,i(c,this.okID,null,{type:"button",value:"OK",style:"width: 70px;"})+i(c,this.cancelID,null,{type:"button",value:"Cancel",style:"width: 70px;"}),{style:"text-align: right;"})))),{style:"font-size: 10pt;padding: 0;display: none;"})},_hasDom:function(){return!!n.document.getElementById(this.dialogID)},_creatDom:function(){var r=this.sheet._getCanvas(),i,n;r&&!this._hasDom()&&(i=this._getDomString(),n=t(i)[0],r.appendChild(n))},_initData:function(n){var u=this.sheet.rowFilter(),i,t,r;if(!u)return;i=this._getAllData(n),this._bindData(i),t=[],t=u.isColumnFiltered(n)?this._getCheckedData(n):i,r=this._getActualValues(i,t),this._setCheckedValues(r),this.itemList.wijsheetmultiselect("refresh",!0),this.itemList.wijsheetmultiselectfilter("updateCache")},_updateData:function(n){var f=this.filterButtonInfo.col,r=this.sheet.rowFilter(),t,i,e;if(!r)return;for(r.unfilter(f),r.removeFilterItems(f),t=0;t<n.length;t++)i=n[t],i==="(Blanks)"&&(i=""),e=new u.UI.TextCondition(u.UI.TextCompareType.EqualsTo,i,null),r.addFilterItem(f,e)},_filter:function(n){var t=this.sheet.rowFilter();if(!t)return;n&&n.length>0&&this.sheet._trigger(u.UI.Events.RangeFiltering,{sheet:this.sheet,sheetName:this.sheet._name,col:this.filterButtonInfo.col,filterValues:n}),t.filter(this.filterButtonInfo.col),n&&n.length>0&&this.sheet._trigger(u.UI.Events.RangeFiltered,{sheet:this.sheet,sheetName:this.sheet._name,col:this.filterButtonInfo.col,filterValues:n}),this.sheet.invalidateLayout(),this.sheet.repaint()},_setCheckedValues:function(n){t("#"+this.itemListID+" option").each(function(){var i=t(this).val();n.contains(i)?t(this).attr("aria-selected","true"):t(this).attr("aria-selected","false")})},_getActualValues:function(n,t){for(var u=[],i,r=0;r<t.length;r++)i=t[r],(i===undefined||i===null||i==="")&&(i="(Blanks)"),n.contains(i)&&!u.contains(i)&&u.push(i);return u},_bindData:function(i){var f=t("#"+this.itemListID)[0],r,u;for(f.options.length=0,r=0;r<i.length;r++)u=i[r],f.options.add(new n.Option(u,u));this.allItemsLength=f.options.length},_getAllData:function(n){var t=[],u=this.sheet.rowFilter(),i,r;if(!u)return t;return i=this.sheet._getActualRange(u.range),n<i.col||n>i.col+i.colCount-1?t:(r={hasBlank:!1},t=u._getCandindateDataItems(n,r),r.hasBlank&&t.push("(Blanks)"),t)},_getCheckedData:function(n){var u=[],t=this.sheet.rowFilter(),e,o,i,f,r;if(!t)return u;if(t.isColumnFiltered(n))for(e=t.range.row===-1?0:t.range.row,o=t.range.rowCount===-1?this.sheet.getRowCount():t.range.rowCount,i=e;i<e+o;i++)t.isRowFilteredOut(i)||(f=this.sheet.getValue(i,n),r=null,r=f instanceof Date?f:this.sheet.getText(i,n),u.contains(r)||u.push(r));return u},open:function(){var o,r,i,f,e;if(this.dialog){o=this,this._initData(this.filterButtonInfo.col);var s=t(this.sheet._getCanvas()).offset(),c=this.dialog.wijsheetfilterdialog("option","width"),l=this.dialog.wijsheetfilterdialog("option","height"),h=this.filterButtonInfo.x+this.filterButtonInfo.width-c,u=this.filterButtonInfo.y+this.filterButtonInfo.height;h+=s.left-8,u+=s.top,this.dialog.wijsheetfilterdialog({show:"blind",position:[h,u],open:function(){n.gcGlobal.suspendEvent(),t("#"+o.superPanelID).wijspreadpanelex("refresh")},close:function(){n.gcGlobal.resumeEvent()}}),this.dialog.wijsheetfilterdialog("open"),t(".ui-multiselect-filter > input").val(""),this.itemList.wijsheetmultiselectfilter("clearFirstOpenCache"),t("#"+this.dialogID+" *").removeClass("ui-state-hover"),r=this.dialog.find("ul").last(),i=0,r.find("span").each(function(n,t){i=Math.max(i,t.offsetWidth)}),f=r.find("label").width(),e=r.find("input").outerWidth(!0),i+=e,i>f&&this.dialog.find("ul").last().find("label").width(i)}},close:function(){this.dialog&&this.dialog.wijsheetfilterdialog("close")},isOpen:function(){return this.dialog?this.dialog.wijsheetfilterdialog("isOpen"):!1}},e.getImageSrc=function(n){if(n===r.noSortFilter)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMOSURBVHjaXJNdaJRHFIbfM7PfGremUTfkpxgpiheiBOmFtYUgRXNRqNnd75sEhBoIKhrwQpFUUSsihhIQ41+FNrUGqYhRY43STZqgARNRTIzRaFqz6xJTtals3K8xRQ3x7UV215+LB2bOxTNn3jMDs+mEIgmS+LwQiqSQ9JG03FHX54666pn7TLmJEZVIjCCRGMkYGxvNiI9FvaENZzLw/PmqtCDFV/4WkERw8TI03K6XqqrNWLBgPoafDmNwMCbd3TestpMDHpJAuIcWSZjSUrnS0SFOWamXJLpuDYAkAiYAkioYDCIej0+Lx12QrervFxOemjWfCvIyIcmTVeLVC1986OkUklhRtlgutLYrkpnOKlt1dl0BSfTHmnCnm5oTm0AS6I0xLaDLrK1PusTp/cb7/rUAyH8kSL+Vqt0ebpuGP699LCRROAdqf/suGforCpLi4DMpAOQQLAEgfE2sRDZIv5cknGxi74HDFnZ/32olk9f//vOTPIj05ZnKZpp14QlnfZgpTOXvNGsvjrvuH9MnOwAOYlhQ/UPYmxRkJVvzPHw8JF8EdrKoZEeapSt2cHDo4Sxn7R0hiV8/hEQe3Ad21jZNJQnbDklSBBas0ddvRj2Fi4qZIhaL+Q3ni8N0ZohGe4Dv6sKZfFP0kvkSWLZdGvLpiUTuTS9cVMxI5H5+fz+UfXyOto/Ns5bUL7dyjsBjTsKDbbVnM0iqYNHXYi9ZLiSlaRbFn089zlzvwN1IzkDlmDhfdiin5KgOBY5qO9iojX1K9+VRcOCXnlySsFkOkjj/WGschtR0Kt/Ga9D2aYj5DWKaIeYSxTlFMS2T66udBDbXHS94Z97ZUB8Ayt7+iVVddlkzl5LCvrklvQ9dr1fnF0IQbng5O/VQsmAJSfnxSLuqCG3Rxxpfz3xbXv0IEkzm5YR7lXOCGs6+PVNJYjaQnoKwSgBIDSqkjjPUuv3QLP9ImW+hG1/lKJtzp5jaCmW2nrNAUpOUkqrWrJUb23T5rhZf0eoWhbeEKX7O4eTPHe8DSTjF59T/AwCfnhbaDaIICgAAAABJRU5ErkJggg==";else if(n===r.ascend)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAALLSURBVHjadJNtaNVlGMav+/kfjy3GTDfcsQW1CMrhWSZ6AsmXmflFDts5/0eYA52i02M6tdBIRQQJBLX8Yg4xYlMEJaHphzxKzoiaZptN0MBtacyXoYIobUgT/fXhtOMS+vBw89wXXPfLdd0CLNxwyACF648YYH7tnuEYAeQbv3CA/EeHBcivazbAUo1fv6hwfYtJEjDy2XP//8vpGbA9ZiE7xQ6USs3S7sUx9YHNbMqYn1IerGmQ3pr8uYXsNUAqnZ+LvqHJAA2BeIoGT6DJbMqBbAwArR77vs4/uhOje9BxlXEcww13pXDvtwaoes1MB6iz8xfxGkIIiLCUIEXaDTxiFJOmKp5YxDcciS6jVpRi8g1H87PVgLYslwO0GYzf+x377ubwXoLKafXEE/WUTfC9tBIhwNTJdAPkw4R1fdkkOmJW1/LAYNBV54iDJK8HH7NPd+/9MTqeWER//62YHxrrJvCDydd99Z/tpjLboz7znQF2/vSfufwY9Ne1e9r9JtHKaUvxqWY3UgXX23dNbccOlhQUFxUN9GweVsaWIQNZRfkeByidrnDxRD19N29U5AnChkMO0BMYAwRA4GkPAKuZc/2F8JWTDlB716sCIm9PXcz1K9+/lCc4erstABQmP3U8LBvlV2VJr8yyIHMSv+LUk1QmCzADBjQnrB0dT9TT0/243NfqXx8szwaAzq6Q1bDJnWnrmlKV3EZVchvvJbfQ2nqmDLDqD0/YXFqs8t0l/Haxu3j+vOPDO9ifu4P9jwPAeSk6RE/RpHc+4KefL8waYWEDrOPX9ol/cycA1KH7pvCTsxFAPxZGXQ1YmDhlgNIHsoWQd5wONw4JxgfhwmeKXSUjXbq0Oi/j80el28UjqpdqK1ivcCB7KJwXTuHKcwWAPtPCoJkShy7kjKU3dIXLAvQyVdq1C3WVXNbE2RgUOphuqVXH3T8DAFTcPgRQEEuLAAAAAElFTkSuQmCC";else if(n===r.descend)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHjanJJfSJNhFMaf9/02R9MFCVZLUOgfpLMCmwrd7KIIm6X4fXoTY1oXltaN86oEi4xodtNNeNMHJZQ0gpDQmUKEyUAiyKCFW4PNtSFMoyKJSp4uputbJIUX5+K855zfe85zDkhiza4u2+HXn4M64dcBvw5BTotLtyDJ49KvI2fapK/Q/8qkwAjYiEHj4rrBG+ft4p+AB51f8pKazxxDY/djhLYj95bJLKG5fR+w5whUVxNUtR6qOiHUrmABNH3AkgcoqsBM11O56gvVUy2GV6CQNA/WjFdkMpnyhYV0NjZOAf6ksQMZCGQL3e526fUWm0kKrlAJRT7CUXeac+Gp3bRTaJpHXsReoLl3yGQAKPUtlaJh8yHxKI0s+C3xLHHXwjIqlbXtTKc/lKTScaRSFItMAWReB4WtdfdMJCVJTI18xihLNzFCyWXC4WxjMpksjiOK5BytjXIGUH0XCowjkFsESeF27BQLSy9F/2FK0ip6wa2VtV7OxxNF8XgciUQCKpMCZFoaRdQ6PXIHshvQDtACUJDARA/tVTVe6rHrSs97mMPh16j3vQECvpKc4iSLWzrGqXWMrahnx6h1jP5oPRf8Ho1FLA5nG/c7vayq8TIajdoikRi0nqCEdn9gDaCQLNVOXZOuk310nbhCV0Mvhx+OWlbhykGnh+Hou20sy2rUdLtbAJxUfs9PwW9PQM4qjuqjfDEd6ssX+VP56kdZ/+s80H9nZJcBYDxT6x8b+vspDw4Fbf+TuC7gpn7ZtoFCSdJE0vxrAN8Jcr/DWZzEAAAAAElFTkSuQmCC";else if(n===r.filter)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMuSURBVHjaZJN/aNR1GMefz+f7/d6P3aZGDGVKERLDbXdMJAQhlr+ujWo62g5DpUBiEyJjpxi0ZRtyDSQvV0cDd2uw213b1EHiFjbGZq5bIbc5dTuyybRyK+ZCDrG0evWHdwfWHx8+PDwPz/vzeb2fR451DGvpQB2ODJvnP24zDkewD7Zct6h9qD1j4TzPWNgsip80isbCxuS7vzinGm5aZwcwbwVPGoAhgAIEsAAN2NKxSscmYKRvE1iRPrY3Vt7Ski4WQKaJOmbjyF3WS//3jfr4hVXGEA55J5aXc+ZMdF0yOZWbFtCAKtx5zCUQLQBk32svPFJ8eHN16u+fCn6fv+MErKWlRWdvPzr9QpUVnIroxravlYz0tTvWdi9XRFGA6ugKOMPh7qHu7u5Ue3s7ra2tBIMnaG4+Sl1dHTU1NZSXl7P42x39zRxKYl82mYD8Q0wA8bjFmv855Xqzdu/swsICDx78xfz8r0xMXKa+/iBer5fx8W+PDi22PjH43pKSoi2bzIS+reVlUYCVn18q11hl9vb2GIFAgFQqxczMDKFQCK/Xy8WLF4ozkN2e00o8O07YA1KpxCUCyKYSUX1fxDQgc3NzRjAY/DMej+Pz+ejpiTkzAAEpqfpEJHeP2PZJXO32VBsbKryydY3IPZB1a3IVIH6/n1AoREVFBWmQjzknK7aLHm4bWXs5cel48uq0ziQGolE9e/uG8vsPceDttygrK8s2cBfkZ9zQ8syGbeaVyQmp3v8VNXWDvFo3SPX+8/hqzxEPjqiD9X5eqqoiN8fFjzeu5wHidh9xZTjIgZr1BqAaWi6Zm3e8z/OVDZS90kBv74AdUH7/IbZu3oJps0h8N7N62IXpLt2VnVbZWfKc+jTx+aM/3bti85RuZ3RsvBjQxFgWO9VnTSebzB+SMyvhtMMTFsv9+l4r26Czq0sxcV9F+3eprnOJwumr14ozpMMfnLV/duQjPdeDmiTiaGrutLs3Nhjujc86sxD/uHs/DxCPjFrbXly0N7ZEbR9GcPb0jz4NS/q/1P/nwlOFlYpOrZ4UkeUiOt8nRk6xyGNzT3YXTGBZeqEcgP53ACxeTBjELwuFAAAAAElFTkSuQmCC";else if(n===r.filterAscend)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMNSURBVHjalJNfaFt1FMfP796bm9hublCwa93AVd3W5d67ddisFFw1lovUl7r0jx2rWWW6prpCkzfrUwjVFx0LwSrYPtiO0YJPDsuwIOJKq1PL0q43iZ3OuUp04p8owmbl40PXMgaCPnzhcPjCOef7PV8BxD6WETrKjXcviUbjTlW870/ta9mqfiqv1kuRQePjk68pkj4FSfX66HRA8ujfDPapvveWN4n1xKAC5H9CB3SRo767m9uhvRxQUGXAEXOt3uCodViWpT4Yi+tC1Rrhj99/luV8QQ43unrkxWaNVSqvXSNgHSeQSqU2A4Zt2xUdHR3bp6amwp8uTNU91jRgij2PAWg1da+sTwmeGTv768TExN8jIyOk0xlOnTpNMpkiFovR3t6O67rcuPHDJkCtr6U7zVH/gffPKrwravLzC75EIkGxWOTWrVWKxR+Zn79EPB7HdV3m5uYaAK12/xfmxm0P1uwW62D36p77nzdXVr4Txwn5h4aGVkqlEp6XJ5PJ4LouMzMzDYAGiPXkGwGJLGIAyqmPYod6sEM9vziRF0xALMvS0+n0zdnZWTo7O5mcnNwHaNevi27bqN0v+w1pWyj5AOUEjygn1I3VeLzaund/xfj4uAASi8WWM5kMLS0tAAYgV69+K5cvvyq/zZ7TpG1hzZaqbZbsDR3DPnSi2n6ka0uhUJB8Pt+QSCTo7++nqamJ204YXV1PG5aF2nFxUgn7PlGAWIefVXYoihVufcBWorLZrOTz+YMDAwN/tba2UlZWRi6Xq7itmQbb9JnU25qMvvmRAKrmoafEqY/edOqf2bljV/iebDYrgPT29q6Ew2FM06RQKFQMDw+L4ziabaP3nXwpIBy9oACVnBblHOh52N4Vqaxr7jYAFQwGty4uLm72PE/3PK8yt+QZuawnjgSN0TOiDj36nCmP9364pjiY1hJ67RX8F5dMBUjtW7Xav+Xh3PRnIiK6CF/qd/66886YHvW3Sfh8lQHfy11Z2MCegBgioknbCZQTPr1l71di/IcUqjsgLfHzvn8GACNDKumTxWELAAAAAElFTkSuQmCC";else if(n===r.filterDescend)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAANBSURBVHjaXJNfSGR1HMXP73fvdcYdo7Vy1KRlZ9DdnOvv5uTODK0s1mxDyKIYSRYoUwQikkgzPUS0RuW6QRCEuIiM/XuxNdiH6m17WnZFCMSHtjuOszONf0ZnGgW1iLbw9DBl0sPhy3k5HDjfD0h6w/VvSJJC8a5sOPeUYQ1TIjAuPOc+kN6Kae2JthodGBCVrSEdpmXAd8pJUrb2julgiWgJ9MMXABIXYADApQA0ACLc8Jjg9bAkKbhbD5LimDTgNQn15sc6SZD1onyPZIAUSyQOSS124oLzDxL7hwRJjaTIFbYcUJ5xB0lYp29oZ8+OypZnPhfvkXiHdGz8nHHs7++6e+vede6UiiiVio69vR2v1+2S5slqQRJ4XvdXkBS7O+uuUv43bO79UvPZp4nfr8/N/Tk7O8urVz9cu3x5zH6x76Xvuru7f+zq6joIhUKFYrHYSBJA4yVBUm5sbWPm15nqH1bvOpRScnBwcL1QKPD+/b+4vV3k0tIy4/E4I5EIFxcXu0nKckDwWUlSV6peqGCUW/mvJUmoNr82MTHBg4MD2rbNqakpRiIR3r59a5ykzOc3QBJob5txkZSbuQ00h/q5ub7htZSJ9NYmlDLF5OQkFxYW2NfXx/n5+YskhWk2G0p9IV5BXgDBAZ1k5Z07tx6wAlHmcjlHjrUim13D8vIaYrEYr12bZmdnJ0k6ygvVHi0GOD2SpHGPhApGmclkKjKZ15HJpHHzJrV4PM6RkRF2dHQwm83WeTweMTw8cCwA1YKkUwWjVMEofaFXeS99w1CksKwWIxaLsaenh1VVVUyn0yf8fmBoKCpIoqeBAr3n50DywdXVlWorEGUqufp0imnpM8eEaZpaPB5nOBymrutMpVKuM2dGdQvjGh+icfFxCCA0YJB0tKC9Mpn8qTKZhLSS0BOJUWmaprBtu8K2bW1lZeVR27alUq3SwpDBh2t1fAUN/eepkYfCOvW26/grWxNB6XukvYJJwgKE+c1zUs270TQdkmq4WeKtTwS+hETiCgUJafrb/89CWTU9/8JT9k2UnP7HN1Ag+OQV8Ps6Yb78vigj/a08ahGCaGzql/zIrbmhy/9IzAmSztMvzJz8ewAvdf7cUVI5hQAAAABJRU5ErkJggg==";else if(n===r.sortAscending)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAABy0lEQVR42pyST2gTQRTGv9nEpCnqTasHES8VLCioiFDIYYum+I/ebFXQm1BbsdSDhKgoXhS8tLQSqAhexIInETwJIqJiexJEZXupwRJNbRsy2Z3dzHxesjGEChs/eMx7A+837817giQAYCD3cZuScqG8Wtj19tG5n/iHhBAkKcLYCh3fdSd04HXCq5xHG2oAdOAdNIG3qAJ5tW1A/9hrm8ZsV+7vDLTe2nsmP9AWwATuXe27330lLwvLkloHY5EBR0dexkB0xxKp9Ieno8MbOjYP1ZRMHz77YE8kAMk35V/fkpWSc6L3dL7Tl6uPAaAm155EAYhwjFHVOsY4AEwPXXkG7W+0EqmCodlRW17oCkrO5Pjc55lon7i2mBqenc7ETTmLFWdvaenLpijJDUBcywsAYFRwu/jja1dMWNfWKf2WEOJ43T8ihLgHACAJkpgZvNQ3kTnJG/u6Z8O7ZgNwAACbzCb5dxNVLPnQW3aKyY7EKABM2XZPcwUk5wG8qIfvSL5qtJAfHLnvF+Z2GsPr2fefipPH0luq5aXsOi3frJ+5xhSm+k/1VErOxRWlqgkrfujO/t191ZqxLeB5azbJeSFELnz9v/agVX8GAIjG5r9I9yjkAAAAAElFTkSuQmCC";else if(n===r.sortDescending)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgVjMuNS41Tib51gAAAXlJREFUOE9jYACCqRH5a6eGZu6cHl00d2pUwa6J7r4Xe4w1U0ByWMB/DLHJnoHbQIKzI1PEp3r6vKjVU72HQzNIGNOA6W5uYiCZmUHxM+v0Vf836KuHkWQASPGciGznSe6+/+v01Vbh0YzdBeBwiC560GWi+aLVXEccxJ/i6KhNdBjMCM/u7be3+99hpJEK0jTJ01a0y1hjKVEGTHH31e4w1vxSrqP0tVZPbXazodqKSl2VV9W6KnOJMoCAf4mLRpAq/+pTEh4F+79aJSwGxwjJseBZdHCVa/b2/1YR00vJMsAtd+c957T1D42De17iMKARKO4NTUiuQLoLrs694IAT0PbvNrFzNYwDOv9bRc4IwGKIMVQzKCWCsBNcDVDzaafUdbfMwiZNMwnq/mIeNvkgDldsgWo+hqyZ2TVr+0egIRIgQcuomb7G/h3/zaOmaeFxBcJ2l6xtx8xDJ/6wDJ+cYhU2g8vYv/M9yABj//aLOFxRTUbU49YCALt6h216b0oVAAAAAElFTkSuQmCC";return""},s._GcFilterDialog=e,s._FilterButtonState=r})(window,jQuery),function(n,t){"use strict";var u="ui-dialog ui-widget ui-widget-content ",f={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},e={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},o=t.attrFn||{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0,click:!0},i,r;t.widget("wijmo.wijsheetfilterdialog",{options:{autoOpen:!1,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!1,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:235,modal:!0,position:{my:"center",at:"center",collision:"fit",using:function(n){var i=t(this).css(n).offset().top;i<0&&t(this).css("top",n.top-i)}},resizable:!1,show:null,stack:!0,title:"",width:235,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var r=this,i=r.options,s=i.title||"&#160;",e=t.ui.dialog.getTitleId(r.element),f=(r.uiDialog=t("<div></div>")).appendTo(n.document.body).hide().addClass(u+i.dialogClass).css({zIndex:i.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(n){i.closeOnEscape&&n.keyCode&&n.keyCode===t.ui.keyCode.ESCAPE&&(r.close(n),n.preventDefault())}).attr({role:"dialog","aria-labelledby":e}).mousedown(function(n){r.moveToTop(!1,n)}),o=r.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(f);t.isFunction(i.beforeclose)&&!t.isFunction(i.beforeClose)&&(i.beforeClose=i.beforeclose),i.draggable&&t.fn.draggable&&r._makeDraggable(),i.resizable&&t.fn.resizable&&r._makeResizable(),r._createButtons(i.buttons),r._isOpen=!1,t.fn.bgiframe&&f.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var n=this;return n.overlay&&n.overlay.destroy(),n.uiDialog.hide(),n.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),n.uiDialog.remove(),n.originalTitle&&n.element.attr("title",n.originalTitle),n},widget:function(){return this.uiDialog},close:function(n){var i=this,r,u;if(!1!==i._trigger("beforeClose",n))return i.overlay&&(i.overlay.$el.unbind("mousedown.wijsheetfilterdialog-overlay"),i.overlay.destroy()),i.uiDialog.unbind("keydown.ui-dialog"),i._isOpen=!1,i.options.hide?i.uiDialog.hide(i.options.hide,function(){i._trigger("close",n)}):(i.uiDialog.hide(),i._trigger("close",n)),t.ui.dialog.overlay.resize(),i.options.modal&&(r=0,t(".ui-dialog").each(function(){this!==i.uiDialog[0]&&(u=t(this).css("z-index"),isNaN(u)||(r=Math.max(r,u)))}),t.ui.dialog.maxZ=r),i},isOpen:function(){return this._isOpen},moveToTop:function(n,i){var r=this,u=r.options,f;return u.modal&&!n||!u.stack&&!u.modal?r._trigger("focus",i):(u.zIndex>t.ui.dialog.maxZ&&(t.ui.dialog.maxZ=u.zIndex),r.overlay&&(t.ui.dialog.maxZ+=1,r.overlay.$el.css("z-index",t.ui.dialog.overlay.maxZ=t.ui.dialog.maxZ)),f={scrollTop:r.element.attr("scrollTop"),scrollLeft:r.element.attr("scrollLeft")},t.ui.dialog.maxZ+=1,r.uiDialog.css("z-index",t.ui.dialog.maxZ),r.element.attr(f),r._trigger("focus",i),r)},open:function(){if(this._isOpen)return;var i=this,u=i.options,r=i.uiDialog;return i.overlay=u.modal?new t.ui.dialog.overlay(i):null,i._size(),i._position(u.position),r.show(u.show),i.moveToTop(!0),u.modal&&(r.bind("keydown.ui-dialog",function(n){var u=i.options._filterDialog,e,f,r;if(n.keyCode===t.ui.keyCode.ENTER){e=n.target.id,e===u.sortAscID?(u._sortByUser(!0),u.close()):e===u.sortDesID&&(u._sortByUser(!1),u.close());return}else if(n.keyCode!==t.ui.keyCode.TAB)return;return f=t(":tabbable",this),r=t.inArray(n.target,f),r=r!==-1?n.shiftKey?r===0?f.length-1:r-1:r===f.length-1?0:r+1:0,t("#"+u.dialogID+" *").removeClass("ui-state-hover"),t(f[r]).focus(1).addClass("ui-state-hover"),!1}),i.overlay.$el.css({opacity:0}),i.overlay.$el.bind("mousedown.wijsheetfilterdialog-overlay",function(n){i.isOpen()&&i.close()}),t(n).trigger("resize.dialog-overlay")),t(i.element.find(":tabbable").get().concat(r.find(".ui-dialog-buttonpane :tabbable").get().concat(r.get()))).eq(0).focus(),i._isOpen=!0,i._trigger("open"),r.focus(1),i},_createButtons:function(n){var i=this,u=!1,r=t("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),f=t("<div></div>").addClass("ui-dialog-buttonset").appendTo(r);i.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof n=="object"&&n!==null&&t.each(n,function(){return!(u=!0)}),u&&(t.each(n,function(n,r){r=t.isFunction(r)?{click:r,text:n}:r;var u=t('<button type="button"></button>').click(function(){r.click.apply(i.element[0],arguments)}).appendTo(f);t.each(r,function(n,t){if(n==="click")return;n in o?u[n](t):u.attr(n,t)}),t.fn.button&&u.button()}),r.appendTo(i.uiDialog))},_makeDraggable:function(){function r(n){return{position:n.position,offset:n.offset}}var i=this,e=i.options,u=t(n.document),f;i.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,u){f=e.height==="auto"?"auto":t(this).height(),t(this).height(t(this).height()).addClass("ui-dialog-dragging"),i._trigger("dragStart",n,r(u))},drag:function(n,t){i._trigger("drag",n,r(t))},stop:function(n,o){e.position=[o.position.left-u.scrollLeft(),o.position.top-u.scrollTop()],t(this).removeClass("ui-dialog-dragging").height(f),i._trigger("dragStop",n,r(o)),t.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function u(n){return{originalPosition:n.originalPosition,originalSize:n.originalSize,position:n.position,size:n.size}}n=n===undefined?this.options.resizable:n;var i=this,r=i.options,f=i.uiDialog.css("position"),e=typeof n=="string"?n:"n,e,s,w,se,sw,ne,nw";i.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:i.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:i._minHeight(),handles:e,start:function(n,r){t(this).addClass("ui-dialog-resizing"),i._trigger("resizeStart",n,u(r))},resize:function(n,t){i._trigger("resize",n,u(t))},stop:function(n,f){t(this).removeClass("ui-dialog-resizing"),r.height=t(this).height(),r.width=t(this).width(),i._trigger("resizeStop",n,u(f)),t.ui.dialog.overlay.resize()}}).css("position",f).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var n=this.options;return n.height==="auto"?n.minHeight:Math.min(n.minHeight,n.height)},_position:function(i){var r=[],f=[0,0],u;i?((typeof i=="string"||typeof i=="object"&&"0"in i)&&(r=i.split?i.split(" "):[i[0],i[1]],r.length===1&&(r[1]=r[0]),t.each(["left","top"],function(n,t){+r[n]===r[n]&&(f[n]=r[n],r[n]=t)}),i={my:r.join(" "),at:r.join(" "),offset:f.join(" ")}),i=t.extend({},t.ui.dialog.prototype.options.position,i)):i=t.ui.dialog.prototype.options.position,u=this.uiDialog.is(":visible"),u||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(t.extend({of:n},i)),u||this.uiDialog.hide()},_setOptions:function(n){var u=this,i={},r=!1;t.each(n,function(n,t){u._setOption(n,t),n in f&&(r=!0),n in e&&(i[n]=t)}),r&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",i)},_setOption:function(n,i){var f=this,r=f.uiDialog,o,e;switch(n){case"beforeclose":n="beforeClose";break;case"buttons":f._createButtons(i);break;case"dialogClass":r.removeClass(f.options.dialogClass).addClass(u+i);break;case"disabled":i?r.addClass("ui-dialog-disabled"):r.removeClass("ui-dialog-disabled");break;case"draggable":o=r.is(":data(draggable)"),o&&!i&&r.draggable("destroy"),!o&&i&&f._makeDraggable();break;case"position":f._position(i);break;case"resizable":e=r.is(":data(resizable)"),e&&!i&&r.resizable("destroy"),e&&typeof i=="string"&&r.resizable("option","handles",i),e||i===!1||f._makeResizable(i);break}t.Widget.prototype._setOption.apply(f,arguments)},_size:function(){var n=this.options,r,i,f=this.uiDialog.is(":visible"),u;this.element.show().css({width:"auto",minHeight:0,height:0}),n.minWidth>n.width&&(n.width=n.minWidth),r=this.uiDialog.css({height:"auto",width:n.width}).height(),i=Math.max(0,n.minHeight-r),n.height==="auto"?t.support.minHeight?this.element.css({minHeight:i,height:"auto"}):(this.uiDialog.show(),u=this.element.css("height","auto").height(),f||this.uiDialog.hide(),this.element.height(Math.max(u,i))):this.element.height(Math.max(n.height-r,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),i=0,t.widget("wijmo.wijsheetmultiselect",{options:{header:!0,height:175,minWidth:200,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:!1,multiple:!0,position:{}},_create:function(){var f=this.element.hide(),n=this.options;this.speed=t.fx.speeds._default,this._isOpen=!1;var i=(this.menu=t("<div />")).addClass("ui-multiselect-menu ui-widget ui-corner-all").addClass(n.classes).insertAfter(f),u=(this.header=t("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(i),o=(this.headerLinkContainer=t('<ul style="cursor: pointer" />')).addClass("ui-helper-reset").html(function(){return n.header===!0?'<li><a class="ui-multiselect-all"><span class="ui-icon ui-icon-check"></span><span>'+n.checkAllText+'</span></a></li><li><a class="ui-multiselect-none"><span class="ui-icon ui-icon-closethick"></span><span>'+n.uncheckAllText+"</span></a></li>":typeof n.header=="string"?"<li>"+n.header+"</li>":""}).appendTo(u),r=t("<div id='gc_filterSuperPanel' />").addClass("ui-multiselect-superpanel").appendTo(i),e=(this.checkboxContainer=t("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(r);this._bindEvents(),this.refresh(!0),n.multiple||i.addClass("ui-multiselect-single")},_init:function(){this.options.header===!1&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(n){var e=this.element,o=this.options,s=this.menu,h=this.checkboxContainer,u=[],r=[],f=e.attr("id")||i++;e.find("option").each(function(n){var p=t(this),l=this.parentNode,a=this.innerHTML,y=this.title,v=this.value,h=this.id||"ui-multiselect-"+f+"-option-"+n,e=this.disabled,c=p.attr("aria-selected"),s=["ui-corner-all"],i;l.tagName.toLowerCase()==="optgroup"&&(i=l.getAttribute("label"),t.inArray(i,u)===-1&&(r.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+i+"</a></li>"),u.push(i))),e&&s.push("ui-state-disabled"),c&&!o.multiple&&s.push("ui-state-active"),r.push('<li class="'+(e?"ui-multiselect-disabled":"")+'">'),r.push('<label for="'+h+'" title="'+y+'" class="'+s.join(" ")+'">'),r.push('<input id="'+h+'" name="multiselect_'+f+'" type="'+(o.multiple?"checkbox":"radio")+'" value="'+v+'" title="'+a+'"'),c==="true"&&(r.push(' checked="checked"'),r.push(' aria-selected="true"')),e&&(r.push(' disabled="disabled"'),r.push(' aria-disabled="true"')),r.push(' /><span style="font-weight:normal">'+a+"</span></label></li>")}),h.html(r.join("")),this.labels=s.find("label"),n||this._trigger("refresh")},update:function(){var n=this.options,f=this.labels.find("input"),u=f.filter("[checked]"),r=u.length,i;return i=r===0?n.noneSelectedText:t.isFunction(n.selectedText)?n.selectedText.call(this,r,f.length,u.get()):/\d/.test(n.selectedList)&&n.selectedList>0&&r<=n.selectedList?u.map(function(){return t(this).next().text()}).get().join(", "):n.selectedText.replace("#",r).replace("#",f.length)},_bindEvents:function(){function r(){return i[i._isOpen?"close":"open"](),!1}var i=this;this.header.delegate("a","click.multiselect",function(n){t(this).hasClass("ui-multiselect-close")?i.close():(i[t(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),i.element.trigger("change")),n.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(n){n.preventDefault();var e=t(this),r=e.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),u=r.get(),f=e.parent().text();if(i._trigger("beforeoptgrouptoggle",n,{inputs:u,label:f})===!1)return;i._toggleChecked(r.filter("[checked]").length!==r.length,r),i._trigger("optgrouptoggle",n,{inputs:u,label:f,checked:u[0].checked})}).delegate("label","mouseenter.multiselect",function(){t(this).hasClass("ui-state-disabled")||(i.labels.removeClass("ui-state-hover"),t(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(n){n.preventDefault();switch(n.which){case 9:case 27:break;case 38:case 40:case 37:case 39:i._traverse(n.which,this);break;case 13:t(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(r){var f=t(this),e=this.value,u=this.checked,o=i.element.find("option");if(this.disabled||i._trigger("click",r,{value:e,text:this.title,checked:u})===!1){r.preventDefault();return}f.focus(),f.attr("aria-selected",u),o.each(function(){this.value===e?this.selected=u:i.options.multiple||(this.selected=!1)}),i.options.multiple||(i.labels.removeClass("ui-state-active"),f.closest("label").toggleClass("ui-state-active",u),i.close()),i.element.trigger("change"),n.setTimeout(t.proxy(i.update,i),10)}),t(n.document).bind("mousedown.multiselect",function(n){!i._isOpen||t.contains(i.menu[0],n.target)||t.contains(i.button[0],n.target)||n.target===i.button[0]||i.close()}),t(this.element[0].form).bind("reset.multiselect",function(){n.setTimeout(t.proxy(i.refresh,i),10)})},_traverse:function(n,i){var e=t(i),r=n===38||n===37,f=e.parent()[r?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[r?"last":"first"](),u;f.length?f.find("label").trigger("mouseover"):(u=this.menu.find("ul").last(),this.menu.find("label")[r?"last":"first"]().trigger("mouseover"),u.scrollTop(r?u.height():0))},_toggleState:function(n,t){return function(){this.disabled||(this[n]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(n,i){var r=i&&i.length?i:this.labels.find("input"),f=this,u;r.each(this._toggleState("checked",n)),r.eq(0).focus(),this.update(),u=r.map(function(){return this.value}).get(),this.element.find("option").each(function(){!this.disabled&&t.inArray(this.value,u)>-1&&f._toggleState("selected",n).call(this)}),r.length&&this.element.trigger("change")},_toggleDisabled:function(n){this.button.attr({disabled:n,"aria-disabled":n})[n?"addClass":"removeClass"]("ui-state-disabled"),this.menu.find("input").attr({disabled:n,"aria-disabled":n}).parent()[n?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:n,"aria-disabled":n})},open:function(n){var h=this,r=this.button,e=this.menu,f=this.speed,i=this.options;if(this._trigger("beforeopen")===!1||r.hasClass("ui-state-disabled")||this._isOpen)return;var s=e.find("ul").last(),u=i.show,o=r.offset();t.isArray(i.show)&&(u=i.show[0],f=i.show[1]||h.speed),s.scrollTop(0).height(i.height),t.ui.position&&!t.isEmptyObject(i.position)?(i.position.of=i.position.of||r,e.show().position(i.position).hide().show(u,f)):e.css({top:o.top+r.outerHeight(),left:o.left}).show(u,f),this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),r.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")},close:function(){if(this._trigger("beforeclose")===!1)return;var n=this.options,r=n.hide,i=this.speed;t.isArray(n.hide)&&(r=n.hide[0],i=n.hide[1]||this.speed),this.menu.hide(r,i),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close")},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(n){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter("[checked]")},destroy:function(){return t.Widget.prototype.destroy.call(this),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(n,i){var r=this.menu;switch(n){case"header":r.find("div.ui-multiselect-header")[i?"show":"hide"]();break;case"checkAllText":r.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":r.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":r.find("ul").last().height(parseInt(i,10));break;case"minWidth":this.options[n]=parseInt(i,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[n]=i,this.update();break;case"classes":r.add(this.button).removeClass(this.options.classes).addClass(i);break}t.Widget.prototype._setOption.apply(this,arguments)}}),r=/[\-\[\]{}()*+?.,\\\^$|#\s]/g,t.widget("wijmo.wijsheetmultiselectfilter",{options:{label:"",width:165,placeholder:"Search",autoReset:!1},_create:function(){var i=this,r=this.options,u=this.instance=t(this.element).data("wijsheetmultiselect"),o=this.header=u.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter"),e=this.wrapper=t('<div class="ui-multiselect-filter">'+(r.label.length?r.label:"")+'<input placeholder="'+r.placeholder+'" type="search"'+(/\d/.test(r.width)?'style="width:'+r.width+'px"':"")+" /></div>").prependTo(this.header),f;this.inputs=u.menu.find('input[type="checkbox"], input[type="radio"]'),this.input=e.find("input").bind({keydown:function(n){n.which===13&&n.preventDefault()},keyup:t.proxy(i._handler,i),click:t.proxy(i._handler,i)}),this.updateCache(),u._toggleChecked=function(n,r){var u=r&&r.length?r:this.labels.find("input"),e=this,o=i.instance._isOpen?":disabled, :hidden":":disabled",f;u=u.not(o).each(this._toggleState("checked",n)),this.update(),f=u.map(function(){return this.value}).get(),this.element.find("option").filter(function(){!this.disabled&&t.inArray(this.value,f)>-1&&e._toggleState("selected",n).call(this)})},f=t(n.document).bind("wijsheetmultiselectrefresh",function(){i.updateCache(),i._handler()}),this.options.autoReset&&f.bind("wijsheetmultiselectclose",t.proxy(this._reset,this))},_handler:function(n){var o=t.trim(this.input[0].value.toLowerCase()),f=this.rows,i=f.find("input"),s=this.cache,u,e;o?(f.hide(),i.prop("checked",!1),e=new RegExp(o.replace(r,"\\$&"),"gi"),this._trigger("filter",n,t.map(s,function(n,r){if(n.search(e)!==-1){f.eq(r).show();var u=i.get(r);return t(u).prop("checked",!0),u}return null}))):(f.show(),this._firstOpenCache?(i.prop("checked",!1),u=this,t.each(i,function(n,i){t.inArray(i.value,u._firstOpenCache)!==-1&&t(i).prop("checked",!0)})):(this._firstOpenCache=[],u=this,t.each(i,function(n,i){t(i).prop("checked")===!0&&u._firstOpenCache.push(i.value)}))),this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var n=t(this),i=n.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return t.css(this,"display")!=="none"}).length;n[i?"show":"hide"]()}),this.instance.element.trigger("change")},clearFirstOpenCache:function(){this._firstOpenCache=null},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)"),this.cache=this.element.children().map(function(){var n=t(this);return this.tagName.toLowerCase()==="optgroup"&&(n=n.children()),n.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){t.Widget.prototype.destroy.call(this),this.input.val("").trigger("keyup"),this.wrapper.remove()}})}(window,jQuery);(function(n){"use strict";function r(n,i,r,u){return new t.Range(n,i,r,u)}function s(n){return new t._DateTimeHelper(n)}function o(n){return t.FormatConverter.IsNumber(n)}function h(n){return t._DateTimeHelper.fromOADate(n)}function a(n){this._sheet=n}function e(n){this._startIndex=n===undefined||n===null?-1:n,this._indexes=[],this._innerValues=[],this._type=null}function c(n,t){function r(n,r,u,f){var o=i.Calc.Functions.findGlobalFunction(t),e=o.evaluate([r,u,f]);return e[0][0]}return function(){return r.apply(n,arguments)}}function l(n){this._worksheet=n,this._fillCache=new a(n)}var i=n.GrapeCity,t,u,f;typeof i=="undefined"&&(i={}),typeof i.UI=="undefined"&&(i.UI={}),t=i.UI,t.FillSeries={Column:0,Row:1},t.FillType={Direction:0,Linear:1,Growth:2,Date:3,Auto:4},t.FillDateUnit={Day:0,Weekday:1,Month:2,Year:3},u=Math.floor,e.prototype={dataCount:function(){return this._innerValues.length},values:function(){var r,n,i,t;if(this._innerValues.length>0){for(r=[],n=0;n<this._innerValues.length;n++)i=this._innerValues[n],t=this._type==="object"?this.toDateTime(i):i,r.push(t);return r}return[]},indexes2:function(){var t=this._indexes.length,u,r,n;if(t>0){for(u=this._startIndex,u===-1&&(u=this._indexes[0]),r=new Array(1),r[0]=new Array(t),n=0;n<t;n++)r[0][n]=this._indexes[n]-u+1;return new i.Calc._ConcreteArray(r,t)}return null},values2:function(){var t=this._innerValues.length,n;return t>0?(n=[this._innerValues],new i.Calc._ConcreteArray(n,t)):null},insert:function(n,t,r){if(!o(r))throw new Error("Only works for Numbers");(this._type===undefined||this._type===null)&&(this._type=r instanceof Date?"date":"number");var u=i.UI._ArrayHelper;new u(this._indexes).insert(n,t),new u(this._innerValues).insert(n,this.toDouble(r))},add:function(n,t){(this._type===undefined||this._type===null)&&(this._type=t instanceof Date?"date":"number"),this._indexes.push(n),this._innerValues.push(this.toDouble(t))},toActualValue:function(n){var t;return t=this._type==="date"?this.toDateTime(n):n},toDouble:function(n){return t.FormatConverter.ToDouble(n)},toDateTime:function(n){var t=null;return t=n instanceof Date?n:i.Calc.Convert.toDateTime(n)}},f={TREND:c(this,"Trend"),GROWTH:c(this,"Growth"),FORECAST:c(this,"Forecast")},l.prototype={fillLinear:function(n,i,r,u){(r===undefined||r===null)&&(u===undefined||u===null)?this.seriesTrendFillRange(n,i,t.FillType.Linear):this.seriesFillRange(n,i,t.FillType.Linear,r,u,null)},fillGrowth:function(n,i,r,u){(r===undefined||r===null)&&(u===undefined||u===null)?this.seriesTrendFillRange(n,i,t.FillType.Growth):this.seriesFillRange(n,i,t.FillType.Growth,r,u,null)},fillDate:function(n,i,r,u,f){this.seriesFillRange(n,i,t.FillType.Date,u,f,r)},seriesTrendFillRange:function(n,i,r){var a=this.fixRange(n),h=a.row,c=a.col,l=a.rowCount,v=a.colCount,u,f,e,o,s;if(this.hasSpans(h,c,l,v))throw new Error("Range should not have merged cell.");if(i===t.FillSeries.Row)for(o=h;o<h+l;o++){u=this.getSeriesSource(o,c,1,v,i);if(u&&u.dataCount()>0){f=this.calcSeriesTrendData(u,v,r);if(f&&f.length>0)for(e=0;e<f.length;e++)this.copyCell(this._worksheet,o,u._indexes[0],o,c+e,u.toActualValue(f[e]),r)}}else if(i===t.FillSeries.Column)for(s=c;s<c+v;s++){u=this.getSeriesSource(h,s,l,1,i);if(u&&u.dataCount()>0){f=this.calcSeriesTrendData(u,l,r);if(f&&f.length>0)for(e=0;e<f.length;e++)this.copyCell(this._worksheet,u._indexes[0],s,h+e,s,u.toActualValue(f[e]),r)}}},getSeriesSource:function(n,i,r,u,f){var s=null,h,l,c;if(f===t.FillSeries.Row){l=i+u-1;while(l>=i)h=this._worksheet.getValue(n,l),o(h)&&(s||(s=new e(i)),s.insert(0,l,h)),l--}else if(f===t.FillSeries.Column){c=n+r-1;while(c>=n)h=this._worksheet.getValue(c,i),o(h)&&(s||(s=new e(n)),s.insert(0,c,h)),c--}return s},calcSeriesTrendData:function(n,i,r){var e,u;if(n&&n.dataCount()>0)if(r===t.FillType.Linear||r===t.FillType.Growth){for(e=[],n.dataCount()===1&&(r===t.FillType.Linear?n.add(n._indexes[0]+1,n.toActualValue(n._innerValues[0]+1)):r===t.FillType.Growth&&n.add(n._indexes[0]+1,n.values()[0])),u=0;u<i;u++)r===t.FillType.Linear?e.push(f.TREND(this._worksheet,n.values2(),n.indexes2(),u+1)):r===t.FillType.Growth&&e.push(f.GROWTH(this._worksheet,n.values2(),n.indexes2(),u+1));return e}return null},fillAuto:function(n,t){var o=this._worksheet,r=this.fixRange(n),e=r.row,s=r.col,f=r.rowCount,u=r.colCount,i=this.fixRange(o._eventHandler._dragFillStartRange);if(i){if(this.hasPartSpans(i.row,i.col,i.rowCount,i.colCount)||this.hasPartSpans(e,s,f,u))throw new Error("Can not change part of merged cell.");this.autoFillRange(i,f,u,t)}},fixRange:function(n){var i=n.row,t=n.col,f=n.rowCount,u=n.colCount;return i===-1&&(i=0,f=this._worksheet.getRowCount()),t===-1&&(t=0,u=this._worksheet.getColumnCount()),r(i,t,f,u)},autoFillRange:function(n,i,f,e){var o,c,s,h;if(e===t.FillSeries.Row){o=u(f/n.colCount),c=f%n.colCount;if(o>1)for(h=1;h<o;h++)s=r(n.row,n.col+h*n.colCount,n.rowCount,n.colCount),this.copyRange(n,s,e,t.FillType.Auto);o>0&&c>0&&(s=r(n.row,n.col+o*n.colCount,n.rowCount,c),this.copyRange(n,s,e,t.FillType.Auto))}else if(e===t.FillSeries.Column){o=u(i/n.rowCount),c=i%n.rowCount;if(o>1)for(h=1;h<o;h++)s=r(n.row+h*n.rowCount,n.col,n.rowCount,n.colCount),this.copyRange(n,s,e,t.FillType.Auto);o>0&&c>0&&(s=r(n.row+o*n.rowCount,n.col,c,n.colCount),this.copyRange(n,s,e,t.FillType.Auto))}},copyRange:function(n,i,r,u){var v=this._worksheet,l,a,c,s,w,b,h,d,y,k,f=null,p=null;if(r===t.FillSeries.Row)for(l=0;l<n.rowCount;l++){f=null,p=null,s=n.row+l,w=i.row+l,a=0;while(a<n.colCount){c=n.col+a,b=i.col+a,h=null,d=v.getFormula(s,c),d&&d!==""||(h=v.getValue(s,c));if(u===t.FillType.Auto)if(o(h)){f||(f=new e),y=null,y=h instanceof Date?"date":"number",p||(p=y);if(p===y){f.add(c,h),a++;continue}}if(h&&f&&f.dataCount()>0){this.autoFillRowTrendValues(n,i,s,w,f),f=null,p=null;continue}k=v._spanModel.find(s,c),k?(k.row===s&&b<i.col+i.colCount&&this.copyCell(v,s,c,w,b,h,u),a+=k.colCount):(b<i.col+i.colCount&&this.copyCell(v,s,c,w,b,h,u),a++)}f&&f.dataCount()>0&&this.autoFillRowTrendValues(n,i,s,w,f)}else if(r===t.FillSeries.Column)for(a=0;a<n.colCount;a++){f=null,p=null,c=n.col+a,b=i.col+a,l=0;while(l<n.rowCount){s=n.row+l,w=i.row+l,h=null,d=v.getFormula(s,c),d&&d!==""||(h=v.getValue(s,c));if(u===t.FillType.Auto)if(o(h)){f||(f=new e),y=null,y=h instanceof Date?"date":"number",p||(p=y);if(p===y){f.add(s,h),l++;continue}}if(h&&f&&f.dataCount()>0){this.autoFillColumnTrendValues(n,i,c,b,f),f=null,p=null;continue}k=v._spanModel.find(s,c),k?(k.col===c&&w<i.row+i.rowCount&&this.copyCell(v,s,c,w,b,h,u),l+=k.rowCount):(w<i.row+i.rowCount&&this.copyCell(v,s,c,w,b,h,u),l++)}f&&f.dataCount()>0&&this.autoFillColumnTrendValues(n,i,c,b,f)}},autoFillRowTrendValues:function(n,r,u,e,o){var p=this._worksheet,h,s,y,c,l,a,b,v,k,w;if(o&&o.dataCount()>0){a=(r.col-n.col)/n.colCount;if(this.isArithmeticProgression(o._indexes,o._innerValues)){for(b=o.values2(),v=new Array(1),h=o.dataCount(),v[0]=new Array(h),s=0;s<h;s++)v[0][s]=s+1;for(k=new i.Calc._ConcreteArray(v,h),s=0;s<h;s++)y=f.TREND(p,b,k,h*a+s+1),c=o._indexes[s],l=c+a*n.colCount,l<r.col+r.colCount&&this.copyCell(p,u,c,e,l,o.toActualValue(y),t.FillType.Auto)}else for(w=o._indexes[0],h=o._indexes[o.dataCount()-1]-w+1,o.dataCount()===1&&o.add(o._indexes[0]+1,o.toActualValue(o._innerValues[0]+1)),s=0;s<h;s++)y=f.TREND(p,o.values2(),o.indexes2(),h*a+s+1),c=w+s,l=c+a*n.colCount,l<r.col+r.colCount&&this.copyCell(p,u,c,e,l,o.toActualValue(y),t.FillType.Auto)}},copyCell:function(n,r,u,f,e,o,s){var a,c,l,h;(n.hasFormula(r,u)||n.hasFormula(f,e))&&(n.setFormula(f,e,null),(s===t.FillType.Direction||s===t.FillType.Auto)&&(a=n.getFormula(r,u),a&&n._copyFormula(r,u,f,e,1,1))),n.setValue(f,e,o),c=n.getCompositeStyle(r,u),c?(l=new i.UI.Style,l.copyFrom(c),n.setStyle(f,e,l,i.UI.SheetArea.viewport)):n.setStyle(f,e,null,i.UI.SheetArea.viewport),n._spanModel.isEmpty()||(n.removeSpan(f,e,i.UI.SheetArea.viewport),h=n._spanModel.find(r,u),h&&n._addSpanImp(f,e,h.rowCount,h.colCount,i.UI.SheetArea.viewport))},autoFillColumnTrendValues:function(n,r,u,e,o){var p=this._worksheet,h,s,w,l,c,a,b,v,k,y;if(o&&o.dataCount()>0){a=(r.row-n.row)/n.rowCount;if(this.isArithmeticProgression(o._indexes,o._innerValues)){for(b=o.values2(),v=new Array(1),h=o.dataCount(),v[0]=new Array(h),s=0;s<h;s++)v[0][s]=s+1;for(k=new i.Calc._ConcreteArray(v,h),s=0;s<h;s++)w=f.TREND(p,b,k,h*a+s+1),l=o._indexes[s],c=l+a*n.rowCount,c<r.row+r.rowCount&&this.copyCell(p,l,u,c,e,o.toActualValue(w),t.FillType.Auto)}else for(y=o._indexes[0],h=o._indexes[o.dataCount()-1]-y+1,o.dataCount()===1&&o.add(o._indexes[0]+1,o.toActualValue(o._innerValues[0]+1)),s=0;s<h;s++)w=f.TREND(p,o.values2(),o.indexes2(),h*a+s+1),l=y+s,c=l+a*n.rowCount,c<r.row+r.rowCount&&this.copyCell(p,y,u,c,e,o.toActualValue(w),t.FillType.Auto)}},isArithmeticProgression:function(n,t){var r,u,f,i;if(n.length!==t.length)return!1;r=t.length;if(r>1)if(r===2)return!0;else{for(u=n[1]-n[0],f=t[1]-t[0],i=2;i<r;i++){if(n[i]-n[i-1]!==u)return!1;if(t[i]-t[i-1]!==f)return!1}return!0}else return!1},fillAutobyDirection:function(n,t){var i=this.fixRange(n),e=i.row,o=i.col,f=i.rowCount,r=i.colCount,u=this.getDirectionFillSourceRange(e,o,f,r,t);u&&this.directionFillRange(u,e,o,f,r,t)},directionFillRange:function(n,i,f,e,o,s){var v="Target range should not have merged cells.",p="This operation requires the merged cells to be identically sized.",y=t.FillDirection,c,a,l,h;if(s===y.Left){if(this.hasSpans(i,f,e,o-n.colCount))throw new Error(v);c=u(o/n.colCount),a=o%n.colCount;if(a!==0)throw new Error(p);if(c>1)for(h=1;h<c;h++)l=r(n.row,n.col-h*n.colCount,n.rowCount,n.colCount),this.copyRange(n,l,t.FillSeries.Row,t.FillType.Direction)}else if(s===y.Right){if(this.hasSpans(i,f+n.colCount,e,o-n.colCount))throw new Error(v);c=u(o/n.colCount),a=o%n.colCount;if(a!==0)throw new Error(p);if(c>1)for(h=1;h<c;h++)l=r(n.row,n.col+h*n.colCount,n.rowCount,n.colCount),this.copyRange(n,l,t.FillSeries.Row,t.FillType.Direction)}else if(s===y.Up){if(this.hasSpans(i,f,e-n.rowCount,o))throw new Error(v);c=u(e/n.rowCount),a=e%n.rowCount;if(a!==0)throw new Error(p);if(c>1)for(h=1;h<c;h++)l=r(n.row-h*n.rowCount,n.col,n.rowCount,n.colCount),this.copyRange(n,l,t.FillSeries.Column,t.FillType.Direction)}else if(s===y.Down){if(this.hasSpans(i+n.rowCount,f,e-n.rowCount,o))throw new Error(v);c=u(e/n.rowCount),a=e%n.rowCount;if(a!==0)throw new Error(p);if(c>1)for(h=1;h<c;h++)l=r(n.row+h*n.rowCount,n.col,n.rowCount,n.colCount),this.copyRange(n,l,t.FillSeries.Column,t.FillType.Direction)}},getDirectionFillSourceRange:function(n,i,u,f,e){var o=null,s=t.FillDirection;return e===s.Left?o=r(n,i+f-1,u,1):e===s.Right?o=r(n,i,u,1):e===s.Up?o=r(n+u-1,i,1,f):e===s.Down&&(o=r(n,i,1,f)),this.inflateCellRange(o)},inflateCellRange:function(n){var t=this._worksheet.getSpans();return t&&n&&(n=this._worksheet._cellRangeInflate(t,n)),n},hasPartSpans:function(n,t,i,r){var f=this._worksheet._spanModel.getEnumerator(n,t,i,r),u;while(f.moveNext()){u=f.current();if(u.row<n||u.row+u.rowCount>n+i)return!0;if(u.col<t||u.col+u.colCount>t+r)return!0}return!1},hasSpans:function(n,t,i,r){var u=this._worksheet._spanModel.getEnumerator(n,t,i,r);return u.moveNext()},seriesFillRange:function(n,i,r,u,f,e){var y=this.fixRange(n),a=y.row,v=y.col,w=y.rowCount,p=y.colCount,o,h,s,c,l;if(this.hasSpans(a,v,w,p))throw new Error("The range should not have a merged cell.");if(i===t.FillSeries.Row)for(c=a;c<a+w;c++){o=this.getSeriesSource(c,v,1,1,i);if(o&&o.dataCount()>0){h=this.calcSeriesData(o,p,r,u,f,e);if(h&&h.length>0)for(s=0;s<h.length;s++)this.copyCell(this._worksheet,c,o._indexes[0],c,v+s,o.toActualValue(h[s]),r)}}else if(i===t.FillSeries.Column)for(l=v;l<v+p;l++){o=this.getSeriesSource(a,l,1,1,i);if(o&&o.dataCount()>0){h=this.calcSeriesData(o,w,r,u,f,e);if(h&&h.length>0)for(s=0;s<h.length;s++)this.copyCell(this._worksheet,o._indexes[0],l,a+s,l,o.toActualValue(h[s]),r)}}},calcSeriesData:function(n,i,r,u,f,e){var s;if(n&&n.dataCount()>0){var c=[],h=n._innerValues[0],o=h;for(s=0;s<i;s++)f!==undefined&&f!==null&&o>f||(c.push(o),r===t.FillType.Linear?o+=u:r===t.FillType.Growth?o*=u:r===t.FillType.Date&&e!==undefined&&e!==null&&(o=this.getNextDateValue(e,h,o,u,s+1)));return c}return null},getNextDateValue:function(n,i,r,f,e){var l=r,o,c;if(n===t.FillDateUnit.Day)o=h(r),l=s(o.setDate(o.getDate()+f)).toOADate();else if(n===t.FillDateUnit.Weekday){o=h(r),c=Math.abs(f);while(c>0)f>0?o.setDate(o.getDate()+Math.min(1,c)):o.setDate(o.getDate()-Math.min(1,c)),o.getDay()!==6&&o.getDay()!==0&&(c-=1);l=s(o).toOADate()}else n===t.FillDateUnit.Month?(o=h(i),l=s(o.setMonth(o.getMonth()+u(e*f))).toOADate()):n===t.FillDateUnit.Year&&(o=h(i),l=s(o.setFullYear(o.getFullYear()+u(e*f))).toOADate());return l}},t.FillImp=l})(window);(function(n,t){"use strict";function o(n,t){this.sheet=n,this.fillInfo=t,this._init()}function r(n,i,r,u,f){var e="<"+n+" ";return i&&(e+="id='"+i+"' "),u&&t.each(u,function(n,t){e+=n+"='"+t+"' "}),e+=r?">"+r+"</"+n+">":f===!0?">":"/>"}var u=n.GrapeCity,p,e;typeof u=="undefined"&&(u=n.GrapeCity={}),typeof u.UI=="undefined"&&(u.UI={}),p=u.UI,e={Tag:0,Down:1};var s="div",w="img",b="label",k="input",i="auto",f="gc_smartTag",h="gc_smartTagDown",c="gc_smartMenu",l="gc_smartMenuItem",v="gc_fillTypeRadioLable",y="gc_fillTypeText",a="gc_fillTypeRadio";o.prototype={_init:function(){this._creatDom();var r=t("#"+f),n=t("#"+c);this.dialogTag=r.wijsheetfilterdialog({height:i,width:i,minHeight:i,minWidth:i}),this.dialogTag.removeClass("ui-dialog-content"),this.dialogTag.parent().removeClass("ui-widget-content"),this.dialog=n.wijsheetfilterdialog({height:i,width:i,minHeight:i,minWidth:i,show:i}),this.dialog.removeClass("ui-dialog-content"),this.dialog.parent().removeClass("ui-widget-content"),r.addClass("ui-widget-header"),n.addClass("ui-widget-content")},_getMenuItemDomString:function(n,t,i,u){var o={name:"gc_fillType","class":a,type:"radio",value:t},e,f;return u&&(o.checked=""),e=r(s,null,r(k,n,null,o,!0),{"class":v}),f=r(s,null,r(b,null,i,{"class":y})),r(s,null,e+f,{"class":l})},_getDomString:function(){var t=r(s,f,r(w,null,null,{src:o.getImageSrc(e.Tag)})+r(w,h,null,{src:o.getImageSrc(e.Down)})),n=r(s,c,this._getMenuItemDomString("gc_smartMenuCopyCells","0","Copy Cells",!0)+this._getMenuItemDomString("gc_smartMenuFillSeries","1","Fill Series")+this._getMenuItemDomString("gc_smartMenuFillFormattingOnly","2","Fill Formatting Only")+this._getMenuItemDomString("gc_smartMenuFillWithoutFormatting","3","Fill Without Formatting"));return t+n},_hasDom:function(){var t=n.document.getElementById(f);return!!t},_creatDom:function(){var i=this.sheet._getCanvas(),n;i&&!this._hasDom()&&(n=this._getDomString(),t(n).appendTo(i),this._prepareLayout())},_prepareLayout:function(){var r,u,n,i;t("#"+h).hide(),r=t("#"+c),r.hide(),r.css({width:"170px",boxShadow:"1px 2px 5px rgba(0,0,0,0.4)"}),u=t("."+l),u.css({width:"150px",height:"20px"}),u.addClass("ui-state-default"),n=t("."+a),n.css({display:"none"}),n.parent().css({width:"16px",height:"16px",margin:"1px",float:"left"}),t("."+a+"[checked]").parent().addClass("ui-icon ui-icon-check"),i=t("."+y),i.parent().css({paddingTop:"3px",paddingLeft:"20px"}),i.css({fontSize:"9pt",fontFamily:"Arial",fontWeight:"normal"}),t("#"+f).css({width:"18px",height:"18px",padding:"0px",overflow:"hidden"})},_registerEvent:function(){var r=this,i=t("#"+f),u,e;i.unbind(),i.hover(function(){var n=r.dialog.wijsheetfilterdialog("isOpen");if(n)return;t(this).css({width:"32px",height:"18px"}),t(this).addClass("ui-state-hover"),t("#"+h).show()},function(){var n=r.dialog.wijsheetfilterdialog("isOpen");if(n)return;t(this).css({width:"18px",height:"18px"}),t(this).removeClass("ui-state-hover"),t("#"+h).hide()}),i.toggle(function(){t(this).addClass("ui-state-active"),r._openMenu()},function(){t(this).removeClass("ui-state-active"),r._closeMenu()}),u=t("."+l),u.unbind(),u.hover(function(){t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")}),u.click(function(){t(this).find(":radio")[0].checked=!0,t(this).find(":radio").change(),i.click(),i.mouseleave();var u=parseInt(t(this).find(":radio")[0].value,10);n.setTimeout(function(){r._changeFill(u)},10)}),e=t("#"+c+" :radio"),e.unbind(),e.change(function(){t("."+v).removeClass("ui-icon ui-icon-check"),t(this).parent().addClass("ui-icon ui-icon-check")})},_changeFill:function(n){var t=this.sheet;t._skipCloseDragFillSmartTag=!0,u.UI.SpreadActions.undo.call(t),t._skipCloseDragFillSmartTag=!1,t._eventHandler.executeDragFillAction(t._eventHandler._currentFillRange,n)},_initData:function(){var i=this.fillInfo.fillType,n=this.dialog.find(":radio")[i];n&&n.checked===!1&&(n.checked=!0,t(n).change())},open:function(){var r;if(this.dialogTag){r=this,this._initData(),this._registerEvent();var u=t(this.sheet._getCanvas()).offset(),n=this.fillInfo.x,i=this.fillInfo.y;n+=u.left-3,i+=u.top-3,this.dialogTag.wijsheetfilterdialog({position:[n,i],open:function(){},close:function(){r.close()}}),this.reset(),this.dialogTag.wijsheetfilterdialog("open")}},_openMenu:function(){if(this.dialog){var u=this,n=t(this.dialogTag).offset(),i=n.left-2.5,r=n.top+17.5;this.dialog.wijsheetfilterdialog({position:[i,r],modal:!1}),this.dialog.wijsheetfilterdialog("open")}},_closeMenu:function(){this.dialog&&this.dialog.wijsheetfilterdialog("close")},reset:function(){if(this.dialog){var i=this.dialog.wijsheetfilterdialog("isOpen"),n=t("#"+f);i&&n.click(),n.mouseleave()}},close:function(){this.reset(),this.isOpen()&&(this.dialog.wijsheetfilterdialog("close"),this.dialogTag.wijsheetfilterdialog("close"))},isOpen:function(){return this.dialogTag?this.dialogTag.wijsheetfilterdialog("isOpen"):!1}},o.getImageSrc=function(n){if(n===e.Tag)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFJJREFUeNrclEEKACAIBOfp/Xy7i4WSRnRYBIVRVhFJVIhyEAxllQa5E/wBSnsU6Rza2nugqNmASi57C/KKNg/Iqn+iVWzx6M4bOdUEAAD//wMAAYRMfiNaiqEAAAAASUVORK5CYII=";else if(n===e.Down)return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAASCAYAAACXScT7AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGCSURBVHjafNFPKKRxHAbw5/v7GYdBYUQjLm5SkoNykCQHtcx431/KgdKumJvSrAO7Nwc3RQ5kd3OkHJC/hUJREluonVcToqRh3sRFPA6M1Mbhc3z6Pj1fkMRHQNJL0uPeul731lU37o1y49cqHr8GvvgWQRLBsmpM/P0j4XAXiooKcXl1CZDEzl4EJBEwAZBUwWAQsVgsFSRR11gmM8trimSa3WypzZ31l5v2/vfk/4oAcv9aSGyUSz4gg/AIAOET0YQswIQWaNrnH+2OeSaY0BJN2+wDTi/OpCrwkxX1vW8q63p5cnaaB+Z/09u7x0nFJTVMiEajPsNCQaC6Ryb8THKcw/Tikho6zj//0RGUNV6gMZ1H8fmpH5iTHDlwsiOhO7FrN5RdP6aBIUj/pvJ2bkFbkxAzBzELELNCQQqgrJ5ST1/jqmYOJcHa7dYYGV5TrQ3d+vfUU+b7IfrOIRCGBYD0o1VGmaHaB6DZkqvMD2hUfF1UAISkvE/+yqbCZ89+HgBtwgFOrBUzJgAAAABJRU5ErkJggg==";return""},p._FillSmartTag=e,u.UI._GcFillDialog=o})(window,jQuery);(function(n,t){"use strict";function u(n){return!0}function wt(n){return n!==0}function c(n){return n===1}function s(n){return n===2}function dt(n){return n===0||n===2}function gt(n){return n===0||n%2==1}function st(n){return n===3}function g(){return!0}function nt(n){return n===1||n===2}function ce(){return!0}function ni(n){return n===0}function y(n,r,u){var c=i.Convert,f,e,o,s,h;if(c.isError(n))return u.value=n,!1;else if(c._isCalcReference(n)){for(f=0;f<n.getRangeCount();f++)for(e=0;e<n.getRowCount(f);e++)for(o=0;o<n.getColumnCount(f);o++)if(n instanceof i._SheetRangeReference){for(s=0;s<n.getSheetCount();s++)if(u.includeSubtotal||!n.isSubtotal(s,f,e,o))if(r(n.getValue(s,f,e,o),u)===!1)return!1}else if(u.includeSubtotal||!n.isSubtotal(f,e,o))if(r(n.getValue(f,e,o),u)===!1)return!1}else if(c._isCalcArray(n)){for(h=0;h<n.length();h++)if(r(n.getValueByIndex(h),u)===!1)return!1}else if(t.isArray(n))t.each(n,function(n,t){return r(t,u)});else if(r(n,u)===!1)return!1;return!0}function he(){return 0}function ae(n){var r=i.Convert,t;if(r.isError(n))return-1;t=!1;try{t=r.toBool(n)}catch(u){}return t?1:2}function l(n,t){this.Key=n,this.Value=t}function le(n){if(n===""||n===undefined||n===null)return n;for(var t in b)b.hasOwnProperty(t)&&(n=n.replace(b[t],b[t].source));return n=n.replace("~?","{113E2532-EAF5-444c-A5CB-3D7446971C4D}"),n=n.replace("~*","{E21523B3-0F1F-458f-B547-23D25713D0EC}"),n=n.replace("?","."),n=n.replace("*","((.|\\n)*)"),n=n.replace("{113E2532-EAF5-444c-A5CB-3D7446971C4D}","\\?"),n=n.replace("{E21523B3-0F1F-458f-B547-23D25713D0EC}","\\*"),n.toString()}function se(n){var r,t=i.Convert;return isNaN(r=t.toDouble(n[0]))?i.Errors.Value:t.toResult(Math.abs(r))}function fe(n){var t=parseFloat(n[0]);return t===undefined||t===null?i.Errors.Value:f._MathHelper.approxFloor(t)}function ue(n){var u=i.Convert,r=u.toDouble(n[0]),t=u.toDouble(n[1]);return isNaN(r)||isNaN(t)?i.Errors.Value:r===0||t===0?0:r>0&&t<0?i.Errors.Number:r<0&&0<t?(t=-t,f._MathHelper.approxFloor(r/t)*t):f._MathHelper.approxCeiling(r/t)*t}function oe(n){var u=parseFloat(n[0]),t=parseFloat(n[1]),f,r;if(isNaN(u)||isNaN(t))return i.Errors.Value;if(u<0||t<0||u<t)return i.Errors.Number;for(f=1,t=Math.min(u-t,t),r=1;r<=t;r++)f*=u-r+1,f/=r;return i.Convert.toResult(f)}function ee(n){var t;return isNaN(t=parseFloat(n[0]))?i.Errors.Value:180*t/Math.PI}function de(n){var t=parseFloat(n[0]);return t<0?(t=Math.floor(t),t%2!=0&&(t-=1)):(t=Math.ceil(t),t%2!=0&&(t+=1)),t}function ke(n){var r=parseInt(n[0],10),u=1,t;if(isNaN(r))return i.Errors.Value;if(r<0||170<r)return i.Errors.Number;for(t=1;t<=r;t++)u*=t;return u}function no(n){var r=parseInt(n[0],10),u=1,t;if(isNaN(r))return i.Errors.Value;if(r<0||300<r)return i.Errors.Number;for(t=r;t>1;t-=2)u*=t;return u}function ge(n){var t=parseFloat(n[0]);return t===undefined||t===null?i.Errors.Value:t<=0?i.Errors.Number:i.Convert.toResult(Math.log(t))}function be(n){var i=parseFloat(n[0]),t=parseFloat(n[1]);return t===0?"DivideByZero":i-t*Math.floor(i/t)}function ye(n){var t=parseFloat(n[0]);return t<0?(t=Math.floor(t),t%2==0&&(t-=1)):(t=Math.ceil(t),t%2==0&&(t+=1)),t}function ve(n){return Math.PI}function we(n){var i=parseFloat(n[0]),t=parseFloat(n[1]);return Math.pow(i,t)}function ut(n,r){var f=i.Convert,u;if(f.isError(n))return r.value=n,!1;else if(f._isCalcReference(n)||f._isCalcArray(n)||t.isArray(n))return y(n,ut,r);else u=parseFloat(n),!isNaN(u)&&isFinite(u)&&(r.value+=u);return!0}function pe(n){var i,t;if(!n||n.length<1)throw d;for(i={value:0,includeSubtotal:!0},t=0;t<n.length;t++)if(y(n[t],ut,i)===!1)break;return i.value}function re(n){var t=parseFloat(n[0]);return t>0?1:t===0?0:-1}function rt(n,t){while(t!==0){var i=n%t;n=t,t=i}return n}function af(n){for(var r=0,l=n.length,e=i.Convert,s=i._ArrayHelper,c,f,u,h,o,t=0;t<l;t++){if(e.isError(n[t]))return n[t];if(s.isArrayOrReference(n[t]))for(c=s.getLength(n[t]),f=0;f<c;f++){u=s.getValueByIndex(n[t],f);if(e.isError(u))return u;else{h=e.toInt(u);if(h<0)return i.Errors.Number;r=rt(r,h)}}else{o=e.toInt(n[t]);if(o<0)return i.Errors.Number;r=rt(r,o)}}return r}function lf(n){for(var h=1,s=[],o=i.Convert,c=i._ArrayHelper,u,f,e,r,t=0;t<n.length;t++){if(o.isError(n[t]))return n[t];if(c.isArrayOrReference(n[t]))for(u=0;u<c.getLength(n[t]);u++){f=c.getValueByIndex(n[t],u);if(o.isError(f))return f;else s.push(o.toInt(f))}else s.push(o.toInt(n[t]));for(e=0;e<s.length;e++){r=s[e];if(r<0)return i.Errors.Number;else if(r===0)return 0;h/=rt(h,r),h*=r}}return h}function at(n,t){for(var v=1,a=0,o=i.Convert,c,l,e,u,f,y,s,h,r=0;r<n.length;r++){if(o.isError(n[r]))return n[r];if(o._isCalcArray(n[r]))for(l=n[r].getColumnCount(),c=n[r].getRowCount(),u=0;u<l;u++)for(e=0;e<c;e++){f=n[r].getValue(e,u);if(o.isNumber(f))v*=o.toDouble(f),a++;else if(o.isError(f))return f}else if(o._isCalcReference(n[r]))for(y=n[r].getRangeCount(),l=0,c=0,s=0;s<y;s++)for(l=n[r].getColumnCount(s),u=0;u<l;u++)for(c=n[r].getRowCount(s),e=0;e<c;e++){if(n[r]instanceof i._SheetRangeReference)for(h=0;h<n[r].getSheetCount();h++)(t||!n[r].isSubtotal(h,s,e,u))&&(f=n[r].getValue(h,s,e,u));else(t||!n[r].isSubtotal(s,e,u))&&(f=n[r].getValue(s,e,u));if(o.isNumber(f))v*=o.toDouble(f),a++;else if(o.isError(f))return f}else{if(isNaN(o.toDouble(n[r])))return i.Errors.Value;v*=n[r],a++}}return o.toResult(a>0?v:0)}function yf(n){return at(n,!0)}function vf(n){var t=parseFloat(n[0]);return t<0?i.Errors.Number:Math.sqrt(t)}function cf(n){var r=i.Convert,u,t;if(r.isError(n[0]))return n[0];if(r.isError(n[1]))return n[1];return u=r.toDouble(n[0]),t=r.toDouble(n[1]),isNaN(u)||isNaN(t)?i.Errors.Value:t===0?i.Errors.DivideByZero:parseInt(u/t,10)}function of(n){for(var t=i.Convert.toInt(n[0]),r=[],u,s,o,e=1;e<n.length;e++)r[e-1]=n[e];u=f.StatHelper;if(t===1||t===101)return u.__averageIncludeSubtotals(r,!1);else if(t===2||t===102)return u.__countIncludeSubtotals(r,!1);else if(t===3||t===103)return u.__countaIncludeSubtotals(r,!1);else if(t===4||t===104)return u.__maxIncludeSubtotals(r,!1);else if(t===5||t===105)return u.__minIncludeSubtotals(r,!1);else if(t===6||t===106)return at(r,!1);else if(t===7||t===107)return u.__stdevIncludeSubtotals(r,!1);else if(t===8||t===108)return u.__stdevpIncludeSubtotals(r,!1);else if(t===9||t===109){if(!r||r.length<1)throw d;for(s={value:0,includeSubtotal:!1},o=0;o<r.length;o++)if(y(r[o],ut,s)===!1)break;return s.value}else if(t===10||t===110)return u.__varrIncludeSubtotals(r,!1);else if(t===11||t===111)return u.__varpIncludeSubtotals(r,!1);return i.Errors.Value}function ef(n){var e=i.Convert,r=e.toDouble(n[0]),t=e.toDouble(n[1]),u;if(isNaN(r)||isNaN(t))return i.Errors.Value;if(r===0||t===0)return 0;if(r>0&&t<0)return i.Errors.Number;return u=f._MathHelper,r<0&&0<t?(t=-t,u.approxCeiling(r/t)*t):u.approxFloor(r/t)*t}function hf(n){var u=i.Convert,r=u.toDouble(n[0]),t=u.toDouble(n[1]);return isNaN(r)||isNaN(t)?i.Errors.Value:r===0||t===0?0:r<0&&0<t||t<0&&0<r?i.Errors.Number:f._MathHelper.approxFloor(r/t+.5)*t}function ft(n){var u=i.Convert,t=u.toDouble(n[0]);if(isNaN(t))return i.Errors.Value;var o=u.toInt(n[1]),e=f._MathHelper,r=e.pow10(Math.abs(o));return o<0?t/=r:t*=r,t=t<0?e.approxCeiling(t-.5):e.approxFloor(t+.5),o<0?t*=r:t/=r,u.toResult(t)}function sf(n){var u=i.Convert,t=u.toDouble(n[0]);if(isNaN(t))return i.Errors.Value;var o=u.toInt(n[1]),e=f._MathHelper,r=e.pow10(Math.abs(o));return o<0?t/=r:t*=r,t=t<0?e.approxCeiling(t):e.approxFloor(t),o<0?t*=r:t/=r,u.toResult(t)}function ne(n){var u=i.Convert,t=u.toDouble(n[0]);if(isNaN(t))return i.Errors.Value;var o=u.toInt(n[1]),e=f._MathHelper,r=e.pow10(Math.abs(o));return o<0?t/=r:t*=r,t=t<0?e.approxFloor(t):e.approxCeiling(t),o<0?t*=r:t/=r,u.toResult(t)}function gf(n){var u=i.Convert,t=u.toDouble(n[0]);if(isNaN(t))return i.Errors.Value;var o=i._Helper._argumentExists(n,1)?u.toInt(n[1]):0,e=f._MathHelper,r=e.pow10(Math.abs(o));return o<0?t/=r:t*=r,t=t<0?e.approxCeiling(t):e.approxFloor(t),o<0?t*=r:t/=r,u.toResult(t)}function ie(n){var r,t=i.Convert;return isNaN(r=t.toDouble(n[0]))?i.Errors.Value:t.toResult(Math.exp(r))}function te(n){var r=i.Convert,u=r.toDouble(n[0]),t;if(isNaN(u))return i.Errors.Value;if(i._Helper._argumentExists(n,1)){t=r.toDouble(n[1]);if(isNaN(t))return i.Errors.Value}else t=10;return u<=0||t<=0?i.Errors.Number:t===1?i.Errors.DivideByZero:r.toResult(v.log(u,t))}function df(n){var r=i.Convert,t=r.toDouble(n[0]);return isNaN(t)?i.Errors.Value:t<=0?i.Errors.Number:r.toResult(v.log10(t))}function k(n,t,r){var c=0,o,h,e;if(n===undefined||n===null)return c;var s=i.Convert,u=i._ArrayHelper,l=f._MathHelper.parseCriteria(n);if(u.getRowCount(t)!==u.getRowCount(r)||u.getColumnCount(t)!==u.getColumnCount(r))return i.Errors.Value;for(o=0;o<u.getLength(t);o++){h=u.getValueByIndex(t,o);if(s.isError(h))return h;if(l&&l(h)){e=u.getValueByIndex(r,o);if(s.isNumber(e))c+=s.toDouble(e);else if(s.isError(e))return e}}return s.toResult(c)}function wf(n){var h=n[0],c=n[1],u,l,e,f;if(c===undefined||c===null)throw"criteria";var s=i._Helper._argumentExists(n,2)?n[2]:n[0],a=i.Convert,t=n[1],o,r;if(a._isCalcReference(t))return o=t.getRowCount(0),r=t.getColumnCount(0),o===1&&r===1?k(t.getValue(0,0,0),h,s):new i._TernaryCompositeConcreteReference(t.getSource(),t.getRow(0),t.getColumn(0),o,r,k,h,s);u=n[1];if(a._isCalcArray(u)){for(o=u.getRowCount(),r=u.getColumnCount(),l=new i._ConcreteArray(u,r),e=0;e<o;e++)for(f=0;f<r;f++)l._value[e][f]=k(u.getValue(e,f),h,s);return l}return k(c,h,s)}function pf(n){var i,r,t;if(n.length<3||n.length%2!=1)return!1;for(i=e.Calc._ArrayHelper.getRowCount(n[0]),r=e.Calc._ArrayHelper.getColumnCount(n[0]),t=1;t<n.length;t=t+2){if(i!==e.Calc._ArrayHelper.getRowCount(n[t]))return!1;if(r!==e.Calc._ArrayHelper.getColumnCount(n[t]))return!1}return!0}function kf(n){var r,o,t,u;if(!pf(n))return i.Errors.Value;var c=0,a=n[0],e=i.Convert,s=i._ArrayHelper,v=s.getLength(n[0]);for(r=0;r<v;r++){for(o=!0,t=1;t<n.length;t=t+2){var y=n[t],p=n[t+1],h=f._MathHelper.parseCriteria(p),l=s.getValueByIndex(y,r);o=h&&h(l);if(!o)break}if(o){u=s.getValueByIndex(a,r);if(e.isNumber(u))c+=e.toDouble(u);else if(e.isError(u))return u}}return e.toResult(c)}function bf(n){for(var l=0,h=i.Convert,u=i._ArrayHelper,a=u.getRowCount(n[0]),c=u.getColumnCount(n[0]),s,e,o,f,t,r=1;r<n.length;r++){if(a!==u.getRowCount(n[r]))return i.Errors.Value;if(c!==u.getColumnCount(n[r]))return i.Errors.Value}for(s=0;s<a;s++)for(e=0;e<c;e++){for(o=1,f=0;f<n.length;f++){t=u.getValue(n[f],s,e);if(h.isError(t))return t;else h.isNumber(t)?o*=h.toDouble(t):o=0}l+=o}return h.toResult(l)}function to(n){for(var u,o=0,r=i.Convert,s=i._ArrayHelper,e,f,t=0;t<n.length;t++){if(r.isError(n[t]))return n[t];if(s.isArrayOrReference(n[t]))for(e=0;e<s.getLength(n[t]);e++){f=s.getValueByIndex(n[t],e);if(r.isNumber(f))u=r.toDouble(f),o+=u*u;else if(r.isError(f))return f}else{if(isNaN(u=r.toDouble(n[t])))return i.Errors.Value;o+=u*u}}return r.toResult(o)}function os(n){var h=0,f,u,t=i.Convert,r=i._ArrayHelper,s,e,o;if(r.getLength(n[0])!==r.getLength(n[1]))return i.Errors.NotAvailable;if(t.isError(n[0]))return n[0];if(t.isError(n[1]))return n[1];if(r.isArrayOrReference(n[0]))for(s=0;s<r.getLength(n[0]);s++){e=r.getValueByIndex(n[0],s),o=r.getValueByIndex(n[1],s);if(t.isNumber(e)&&t.isNumber(o))f=t.toDouble(e),u=t.toDouble(o),h+=f*f-u*u;else if(t.isError(e))return e;else if(t.isError(o))return o}else{if(isNaN(f=t.toDouble(n[0]))||isNaN(u=t.toDouble(n[1])))return i.Errors.Value;h+=f*f-u*u}return h}function es(n){var h=0,f,u,t=i.Convert,r=i._ArrayHelper,s,e,o;if(r.getLength(n[0])!==r.getLength(n[1]))return i.Errors.NotAvailable;if(t.isError(n[0]))return n[0];if(t.isError(n[1]))return n[1];if(r.isArrayOrReference(n[0]))for(s=0;s<r.getLength(n[0]);s++){e=r.getValueByIndex(n[0],s),o=r.getValueByIndex(n[1],s);if(t.isNumber(e)&&t.isNumber(o))f=t.toDouble(e),u=t.toDouble(o),h+=f*f+u*u;else if(t.isError(e))return e;else if(t.isError(o))return o}else{if(isNaN(f=t.toDouble(n[0]))||isNaN(u=t.toDouble(n[1])))return i.Errors.Value;h+=f*f+u*u}return t.toResult(h)}function hs(n){var h=0,f,u,t=i.Convert,r=i._ArrayHelper,s,e,o;if(r.getLength(n[0])!==r.getLength(n[1]))return i.Errors.NotAvailable;if(t.isError(n[0]))return n[0];if(t.isError(n[1]))return n[1];if(r.isArrayOrReference(n[0]))for(s=0;s<r.getLength(n[0]);s++){e=r.getValueByIndex(n[0],s),o=r.getValueByIndex(n[1],s);if(t.isNumber(e)&&t.isNumber(o))f=t.toDouble(e),u=t.toDouble(o),h+=(f-u)*(f-u);else if(t.isError(e))return e;else if(t.isError(o))return o}else{if(isNaN(f=t.toDouble(n[0]))||isNaN(u=t.toDouble(n[1])))return i.Errors.Value;h+=(f-u)*(f-u)}return t.toResult(h)}function ss(n){var o,s,c,t=i.Convert,h=i._ArrayHelper,f,u,r,e;if(isNaN(o=t.toDouble(n[0]))||isNaN(c=t.toInt(n[1]))||isNaN(s=t.toInt(n[2])))return i.Errors.Value;for(f=n[3],u=0,r=0;r<h.getLength(f);r++){if(isNaN(e=t.toDouble(h.getValueByIndex(f,r))))return i.Errors.Value;u+=e*Math.pow(o,c+r*s)}return t.toResult(u)}function fs(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:t<0?i.Errors.Number:r.toResult(Math.sqrt(t*Math.PI))}function is(n){var t;return isNaN(t=i.Convert.toDouble(n[0]))?i.Errors.Value:Math.PI*t/180}function ts(n){var r,t=i.Convert;return isNaN(r=t.toDouble(n[0]))?i.Errors.Value:t.toResult(Math.cos(r))}function us(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:t<-1||1<t?i.Errors.Number:r.toResult(Math.acos(t))}function rs(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:r.toResult((Math.exp(t)+Math.exp(-t))/2)}function ws(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:t<1?i.Errors.Number:r.toResult(Math.log(t+Math.sqrt(t*t-1)))}function ps(n){var r,t=i.Convert;return isNaN(r=t.toDouble(n[0]))?i.Errors.Value:t.toResult(Math.sin(r))}function ks(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:t<-1||1<t?i.Errors.Number:r.toResult(Math.asin(t))}function bs(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:r.toResult((Math.exp(t)-Math.exp(-t))/2)}function ys(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:r.toResult(Math.log(t+Math.sqrt(t*t+1)))}function ls(n){var r,t=i.Convert;return isNaN(r=t.toDouble(n[0]))?i.Errors.Value:t.toResult(Math.tan(r))}function cs(n){var r,t=i.Convert;return isNaN(r=t.toDouble(n[0]))?i.Errors.Value:t.toResult(Math.atan(r))}function vs(n){var u,r,t=i.Convert;return isNaN(u=t.toDouble(n[0]))||isNaN(r=t.toDouble(n[1]))?i.Errors.Value:u===0&&r===0?i.Errors.DivideByZero:t.toResult(Math.atan2(r,u))}function as(n){var u,f=i.Convert,t,r;return isNaN(u=f.toDouble(n[0]))?i.Errors.Value:(t=Math.exp(u),r=Math.exp(-u),f.toResult(t-r)/(t+r))}function ns(n){var t,r=i.Convert;return isNaN(t=r.toDouble(n[0]))?i.Errors.Value:t<=-1||1<=t?i.Errors.Number:r.toResult(Math.log((1+t)/(1-t))/2)}function so(n){var y=i.Convert,v=y._toArray(n[0]),u,r,s,l,c,w,t,p,o,f,b,e,k,h,a;if(v.getRowCount()!==v.getColumnCount())return i.Errors.Value;for(u=v.getRowCount(),r=[],s=0;s<u;s++)for(r[s]=[u],l=0;l<u;l++){c=v.getValue(s,l);if(y.isError(c))return c;if(!y.isNumber(c))return i.Errors.Value;r[s][l]=y.toDouble(c)}for(w=1,t=0;t<u-1;t++){if(r[t][t]===0){for(p=!1,o=t+1;!p&&o<u;o++)if(r[o][t]!==0){for(f=t;f<u;f++)b=r[t][f],r[t][f]=r[o][f],r[o][f]=b;w*=-1,p=!0}if(!p)return 0}for(e=t+1;e<u;e++)if(r[e][t]!==0)for(k=r[e][t]/r[t][t],h=t;h<u;h++)r[e][h]-=k*r[t][h]}for(a=0;a<u;a++)w*=r[a][a];return w}function oo(n){var d=i.Convert,g=d._toArray(n[0]),l,w,v,a,p,t,nt,o,s,ut,h,it,e,tt,y,b,c,rt,k;if(g.getRowCount()!==g.getColumnCount())return i.Errors.Value;var r=g.getRowCount(),u=[],f=[];for(l=0;l<r;l++)for(u[l]=[r],w=0;w<r;w++){v=g.getValue(l,w);if(d.isError(v))return v;if(!d.isNumber(v))return i.Errors.Value;u[l][w]=d.toDouble(v)}for(a=0;a<r;a++)for(f[a]=[r],p=0;p<r;p++)f[a][p]=a===p?1:0;for(t=0;t<r;t++){if(u[t][t]===0){for(nt=!1,o=t+1;!nt&&o<r;o++)if(u[o][t]!==0){for(s=t;s<r;s++)ut=u[t][s],u[t][s]=u[o][s],u[o][s]=ut;for(h=1;h<r;h++)it=f[t][h],f[t][h]=f[o][h],f[o][h]=it;nt=!0}if(!nt)return i.Errors.Number}for(e=0;e<r;e++)if(e!==t&&u[e][t]!==0){for(tt=u[e][t]/u[t][t],y=t;y<r;y++)u[e][y]-=tt*u[t][y];for(b=0;b<r;b++)f[e][b]-=tt*f[t][b]}}for(c=0;c<r;c++)for(rt=u[c][c],k=0;k<r;k++)f[c][k]/=rt;return new i._ConcreteArray(f)}function co(n){var t=i.Convert,v=t._toArray(n[0]),y=t._toArray(n[1]),nt=v.getRowCount(),g=v.getColumnCount(),d=y.getRowCount(),a=y.getColumnCount(),r,e,s,u,h,o,f,c,p,l;if(g!==d)return i.Errors.Value;var k=[],b=[],w=[];for(r=0;r<nt;r++)for(k[r]=[g],e=0;e<g;e++){s=v.getValue(r,e);if(t.isError(s))return s;if(!t.isNumber(s))return i.Errors.Value;k[r][e]=t.toDouble(s)}for(u=0;u<d;u++)for(b[u]=[a],h=0;h<a;h++){o=y.getValue(u,h);if(t.isError(o))return o;if(!t.isNumber(o))return i.Errors.Value;b[u][h]=t.toDouble(o)}for(f=0;f<nt;f++)for(w[f]=[a],c=0;c<a;c++){for(p=0,l=0;l<d;l++)p+=k[f][l]*b[l][c];w[f][c]=p}return new i._ConcreteArray(w)}function et(n){for(var i=1,t=n;t>1;t--)i*=t;return i}function ho(n){for(var f=0,c=1,s=i.Convert,h=i._ArrayHelper,o,e,u,r,t=0;t<n.length;t++){if(s.isError(n[t]))return n[t];if(h.isArrayOrReference(n[t]))for(o=0;o<h.getLength(n[t]);o++){e=h.getValueByIndex(n[t],o);if(s.isError(e))return e;else{u=s.toInt(e);if(u<0||170<u)return i.Errors.Number;f+=u,c*=et(u)}}else{r=s.toInt(n[t]);if(r<0||170<r)return i.Errors.Number;f+=r,c*=et(r)}}return f<0||170<f?i.Errors.Number:et(f)/c}function eo(n){var i=Math.random(),t=-1+i*2;return Math.abs(t)}function ro(n){var t=i.Convert,r,u,f;return t.isError(n[1])?n[1]:t.isError(n[0])?n[0]:isNaN(r=t.toInt(n[0]))||isNaN(u=t.toInt(n[1]))?i.Errors.Value:u<r?i.Errors.Number:(f=Math.random(),t.toInt(r+f*(u-r+1)))}function io(){var n=[];return n.push(new l("M",1e3)),n.push(new l("D",500)),n.push(new l("C",100)),n.push(new l("L",50)),n.push(new l("X",10)),n.push(new l("V",5)),n.push(new l("I",1)),n}function fo(n){var h=i.Convert,y=i._Helper,u,s,f,t,r,e,c,v,o,l,a;if(h.isError(n[0]))return n[0];u=h.toInt(n[0]),s=0;if(y._argumentExists(n,1)){if(h.isError(n[1]))return n[1];s=typeof n[1]=="boolean"?n[1]?0:4:h.toInt(n[1])}f=[];if(u<0||3999<u||s<0||4<s)return i.Errors.Value;for(t=io(),r=0;r<t.length;r+=2){if(2<=r&&t[r-2].Value-t[r].Value<=u){for(e=r,c=r-2,v=0;v<s&&e+1<t.length&&t[c].Value-t[e+1].Value<=u;v++)e++;f.push(t[e].Key),f.push(t[c].Key),u+=t[e].Value,u-=t[c].Value}1>r||t[r-1].Value>u||(f.push(t[r-1].Key),u-=t[r-1].Value);if(1<=r&&t[r-1].Value-t[r].Value<=u){for(o=r,l=r-1,a=0;a<s&&o+1<t.length&&t[l].Value-t[o+1].Value<=u;a++)o++;f.push(t[o].Key),f.push(t[l].Key),u+=t[o].Value,u-=t[l].Value}while(t[r].Value<=u)f.push(t[r].Key),u-=t[r].Value}return f.join("")}function uo(n){for(var e=!0,h=i.Convert,s=i._ArrayHelper,f,r,u,o,t=0;t<n.length;t++)for(f=n[t],r=0;r<s.getLength(f);r++){u=s.getValueByIndex(f,r);if(u!==undefined&&u!==null){try{o=h.toBool(u)}catch(c){return i.Errors.Value}e&=o}else return!1}return!!e}function bo(n){for(var e=!1,h=i.Convert,s=i._ArrayHelper,f,r,u,o,t=0;t<n.length;t++)for(f=n[t],r=0;r<s.getLength(f);r++){u=s.getValueByIndex(f,r);if(u!==undefined&&u!==null){try{o=h.toBool(u)}catch(c){return i.Errors.Value}e|=o}}return!!e}function ot(n){try{var t=i.Convert.toBool(n);return!t}catch(r){return i.Errors.Value}}function wo(n){var f=i.Convert,t,r;if(f._isCalcReference(n[0]))return n[0].getRangeCount()>1?i.Errors.Value:new i._UnaryCompositeConcreteReference(n[0].getSource(),n[0].getRow(0),n[0].getColumn(0),n[0].getRowCount(0),n[0].getColumnCount(0),ot);if(f._isCalcArray(n[0])){var u=[],o=n[0].getRowCount(),e=n[0].getColumnCount();for(t=0;t<o;t++)for(u[t]=[e],r=0;r<e;r++)u[t][r]=ot(n[0].getValue(t,r));return new i._ConcreteArray(u)}return ot(n[0])}function lt(n,t,r){try{var f=i.Convert.toBool(n),u=f?t:r;return u!==undefined&&u!==null?u:0}catch(e){return i.Errors.Value}}function go(n){var e=n[0],o=n[1],f=i._Helper,s=f._argumentExists(n,2)?n[2]:!1,t=f.tryExtractToSingleValue(e),l,r,u;if(t.success)return e=t.value,lt(e,o,s);t=f.tryExtractToSingleValue(o),o=t.value,l=t.success,t=f.tryExtractToSingleValue(s),s=t.value;var v=t.success,a=e.getRowCount(),c=e.getColumnCount(),h=[];for(r=0;r<a;r++)for(h[r]=[c],u=0;u<c;u++)h[r][u]=lt(e.getValue(r,u),l?o:f.getArrayValue(o,r,u),v?s:f.getArrayValue(s,r,u));return new i._ConcreteArray(h)}function ko(n,t){return i.Convert.isError(n)?t!==undefined&&t!==null?t:0:n!==undefined&&n!==null?n:0}function po(n){var r=i.Convert,u=r.isError(n[0]),t;return!u&&r._isCalcReference(n[0])?(t=n[0],t.getRangeCount()>1?i.Errors.Value:new i._BinaryCompositeConcreteReference(t.getSource(),t.getRow(0),t.getColumn(0),t.getRowCount(0),t.getColumnCount(0),ko,n[1])):u?n[1]!==undefined&&n[1]!==null?n[1]:0:n[0]!==undefined&&n[0]!==null?n[0]:0}function ao(n){return!0}function lo(n){return!1}function yo(n){var r,t,e,f,u;try{r=i.Convert;if(isNaN(t=r.toInt(n[0]))||isNaN(e=r.toInt(n[1]))||isNaN(f=r.toInt(n[2])))return i.Errors.Value;if(t<0||9999<t)return i.Errors.Number;return t>1899||(t+=1900),u=new Date(t,e-1,f),u<new Date(1899,11,30)?i.Errors.Number:u}catch(o){return i.Errors.Number}}function vo(n){var f,o,u,r,t;try{r=i.Convert;if(isNaN(f=r.toInt(n[0]))||isNaN(o=r.toInt(n[1]))||isNaN(u=r.toInt(n[2])))return i.Errors.Value;return t=e.UI._DateTimeHelper.fromOADate(0),t.setHours(f),t.setMinutes(o),t.setSeconds(u),t.setMilliseconds(0),t.getHours()<0&&t.getMinutes()<0&&t.getSeconds()<0?i.Errors.Number:t}catch(s){return i.Errors.Number}}function a(n){return n%400==0||n%4==0&&n%100!=0||n===1900}function ff(n){var o=i.Convert.toString(n[0]),e,u,r,f;if(o===undefined||o===null||o==="")return i.Errors.Value;try{e=h._DateTimeHelper.parseLocale(o),u=e.getFullYear();if(u<1900)return i.Errors.Value;var s=e.getMonth(),c=e.getDate(),t=0;for(r=1900;r<u;r++)t+=a(r)?366:365;for(f=0;f<s;f++)switch(f){case 0:case 2:case 4:case 6:case 7:case 9:case 11:t+=31;break;case 1:t+=a(u)?29:28;break;case 3:case 5:case 8:case 10:t+=30;break}return t+=c}catch(l){return i.Errors.Value}}function nr(n){try{return h._DateTimeHelper.parseLocale(n)}catch(t){return i.Errors.Value}}function ct(n){var t=i.Convert.toString(n[0]);if(t===undefined||t===null||t==="")return i.Errors.Value;try{var r=nr(t),f=(r.getHours()*60+r.getMinutes())*60+r.getSeconds(),u=86400;return f/u}catch(e){return i.Errors.Value}}function tr(n){return new Date}function ir(n){var t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}function gi(n){try{var t=i.Convert.toDateTime(n[0]);return t.getHours()}catch(r){return i.Errors.Value}}function bi(n){try{var t=i.Convert.toDateTime(n[0]);return t.getMinutes()}catch(r){return i.Errors.Value}}function ki(n){try{var t=i.Convert.toDateTime(n[0]);return t.getSeconds()}catch(r){return i.Errors.Value}}function di(n){try{var t=i.Convert.toDateTime(n[0]);return t.getDate()}catch(r){return i.Errors.Value}}function sr(n){try{var t=i.Convert.toDateTime(n[0]);return t.getMonth()+1}catch(r){return i.Errors.Value}}function hr(n){try{var t=i.Convert.toDateTime(n[0]);return t.getFullYear()}catch(r){return i.Errors.Value}}function cr(n){for(var u=n.getFullYear(),r=n.getMonth(),f=n.getDate(),t=0,i=0;i<r;i++)switch(i){case 0:case 2:case 4:case 6:case 7:case 9:case 11:t+=31;break;case 1:t+=a(u)?29:28;break;case 3:case 5:case 8:case 10:t+=30;break}return t+=f}function or(n,t){var f=cr(n),u=new Date(n.getFullYear(),0,1).getDay(),r;return t===2&&(u-=1,u<0&&(u=6)),r=f-1-(6-u),r<0&&(r=0),1+i.Convert.toInt(r/7)+(r%7!=0?1:0)}function ur(n){var u,r=i.Convert,t,e;try{u=r.toDateTime(n[0])}catch(f){return i.Errors.Value}if(isNaN(t=r.toInt(i._Helper._argumentExists(n,1)?n[1]:1)))return i.Errors.Value;switch(t){case 1:case 2:return or(u,t);default:return i.Errors.Number}}function ht(n){var r,u,t;try{r=i.Convert.toDateTime(n[0])}catch(f){return i.Errors.Value}if(isNaN(u=i.Convert.toInt(i._Helper._argumentExists(n,1)?n[1]:1)))return i.Errors.Value;switch(u){case 1:t=r.getDay()+1;break;case 2:t=r.getDay()===0?7:r.getDay();break;case 3:t=r.getDay()===0?6:r.getDay()-1;break;default:return i.Errors.Number}return t}function er(n){var t,u,r=i.Convert;try{t=r.toDateTime(n[0])}catch(f){return i.Errors.Value}return isNaN(u=r.toInt(n[1]))?i.Errors.Value:(t.setMonth(t.getMonth()+u),t)}function fi(n,t){switch(t){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 1:return a(n)?29:28;case 3:case 5:case 8:case 10:return 30}}function ui(n){var t,f,u=i.Convert,r;try{t=u.toDateTime(n[0])}catch(e){return i.Errors.Value}return isNaN(f=u.toInt(n[1]))?i.Errors.Value:(t.setMonth(t.getMonth()+f),r=fi(t.getFullYear(),t.getMonth()),t.setDate(r),t)}function pt(n,t){return n-t}function tt(n,t){for(var u=n.length,r,i=0;i<u;i++){r=n[i];if(pt(r,t)===0)return!0}return!1}function ti(n){for(var f=i.Convert,a=i._Helper,l=i._ArrayHelper,r=f.toDateTime(n[0]),u=f.toInt(n[1]),v=a._argumentExists(n,2)?l.getLength(n[2]):0,c=[],s,h,t,o=0;o<v;o++)c.push(f.toDateTime(l.getValueByIndex(n[2],o)));s=[],s[0]=r,s[1]=3,h=ht(s);if(f.isError(h))return h;for(t=f.toInt(h);u<0;++u){try{r.setDate(r.getDate()-1)}catch(p){return i.Errors.Number}t===0?t=6:t--,t===5||t===6?u--:tt(c,r)&&u--}for(;u>0;--u){try{r.setDate(r.getDate()+1)}catch(y){return i.Errors.Number}t===6?t=0:t++,t===5||t===6?u++:tt(c,r)&&u++}return new e.UI._DateTimeHelper(r).toOADate()}function yt(n){var e=i.Convert,a=i._Helper,f=e.toDateTime(n[0]),o=e.toDateTime(n[1]),c=a._argumentExists(n,2)?e.toBool(n[2]):!1,t=f.getDate(),r=o.getDate(),l=f.getMonth(),u=o.getMonth(),h=f.getFullYear(),s=o.getFullYear();return c?(r=r===31?30:r,t=t===31?30:t):(t=t===31?30:t,r===31&&(t<30?(r=1,u++,u>12&&(u=1,s++)):r=30)),((s-h)*12+(u-l))*30+(r-t)}function ri(n){return n.getDay()===6||n.getDay()===0}function si(n,t,r,u){for(var a=i.Convert,l=i._Helper,c=i._ArrayHelper,v=l._argumentExists(n,2)?c.getLength(n[2]):0,s=[],f,h,o=0;o<v;o++)f=a.toDateTime(c.getValueByIndex(n[2],o)),h=new e.UI._DateTimeHelper(f).toOADate(),tt(s,f)||ri(f)||h<t||h>r||s.push(f);return u-=s.length}function vi(n,t,r){var e=i.Convert,s=h._DateTimeHelper,u=e.toInt(new s(t).toOADate()-new s(n).toOADate())%7,c=e.toInt(ht([n,2])+u),f,o;return u=c>5?c-5:0,f=n.getDay()===0?1:2,u=u>f?f:u,r-=u,o=e.toInt(r/7*2),r-=o}function yi(n){var e=i.Convert,c=h._DateTimeHelper,f=e.toDateTime(n[0]),o=e.toDateTime(n[1]),r=e.toInt(new c(f).toOADate()),u=e.toInt(new c(o).toOADate()),l=!1,a,s,t;return r>u&&(a=f,s=r,r=u,u=s,f=o,o=a,l=!0),t=u-r+1,t=vi(f,o,t),t<=0?0:(t=si(n,r,u,t),t=l?-t:t)}function pi(n,t,r){var l=i.Convert,b=f._FinancialHelper,c=b.days_between_basis(n,t,r),p,k,e,o,u,d,s,v,y,w;return c<0&&(c=-c,k=n,n=t,t=k),r===1?(e=n.getFullYear(),o=t.getFullYear(),u=n,u.setFullYear(u.getFullYear()+1),pt(t,u)>0?(v=o+1-e,u=new Date(e,0,1),d=new Date(o+1,0,1),y=h._DateTimeHelper,s=l.toInt(new y(d).toOADate()-new y(u).toOADate())-365*(o+1-e)):(v=1,s=a(e)&&n.getMonth()<3||a(o)&&t.getMonth()*256+t.getDate()>=541?1:0),w=l.toDouble(s)/l.toDouble(v),p=365+w):p=b.annual_year_basis(new Date,r),c/p}function vt(n){var r=i.Convert,u=i._Helper,e=r.toDateTime(n[0]),f=r.toDateTime(n[1]),t=u._argumentExists(n,2)?r.toInt(n[2]):0;return t<0||t>4?i.Errors.Number:pi(e,f,t)}function hi(){var n=[];return n[0]=function(n,t){return t.getFullYear()-n.getFullYear()+(t.getMonth()<n.getMonth()||t.getMonth()===n.getMonth()&&t.getDate()<n.getDate()?-1:0)},n[1]=function(n,t){return 12*(t.getFullYear()-n.getFullYear())+(t.getMonth()-n.getMonth())+(t.getDate()<n.getDate()?-1:0)},n[2]=function(n,t){return(t.getTime()-n.getTime())/864e5},n[3]=function(n,t){var i=new Date(t.getFullYear(),t.getMonth()+t.getDate()<n.getDate()?-1:0,n.getDate());return(t.getTime()-i.getTime())/864e5},n[4]=function(n,t){return t.getMonth()-n.getMonth()+(t.getMonth()<n.getMonth()||t.getMonth()===n.getMonth()&&t.getDate()<n.getDate()?12:0)+(t.getDate()<n.getDate()?-1:0)},n[5]=function(n,t){var i=new Date(t.getFullYear()+(t.getMonth()<n.getMonth()||t.getMonth()===n.getMonth()&&t.getDate()<n.getDate()?-1:0),n.getMonth(),n.getDate());return(t-i)/864e5},n}function ci(n,t){var i;switch(t){case"Y":i=0;break;case"M":i=1;break;case"D":i=2;break;case"MD":i=3;break;case"YM":i=4;break;case"YD":i=5;break;default:throw"NotSupportException";}return n[i]}function li(n){var r=i.Convert,f=r.toDateTime(n[0]),e=r.toDateTime(n[1]),o=r.toString(n[2]).toLocaleUpperCase(),u,t;if(e<f)return i.Errors.Number;u=hi(),t=ci(u,o);if(t)try{return t(f,e)}catch(s){return i.Errors.Value}return i.Errors.Number}function lr(n){return 0<=n&&n<=31||127===n||128<=n&&n<=159}function vu(n){for(var r=i.Convert.toString(n[0]),u=[],t=0;t<r.length;t++)lr(r.charCodeAt(t))||u.push(r[t]);return u.join("")}function kt(n){return n===" "||n==="\t"||n==="\n"}function pu(n){for(var f=i.Convert.toString(n[0]).trim(),u=[],e=!0,r,t=0;t<f.length;t++)r=f.charAt(t),(!kt(r)||e)&&u.push(r),e=!kt(r);return u.join("")}function bt(n){var f=n.toString(),u=f.split("."),t,r;if(u.length<1||u.length>2)return i.Errors.Value;for(t=[],u.length===2&&(t.push(u[1]),t.push(".")),f=u[0],r=f.length-3;r>=0;r=r-3)t.push(f.substr(r,3)),r>0&&t.push(",");return t.push(f.substring(0,r+3)),t.reverse(),t.join("")}function hu(n){var i=bt(n),t;return n<0&&(i=i.substr(1)),t=[],t.push("$"),t.push(i),n<0&&(t.push(")"),t.unshift("(")),t.join("")}function su(n){var t,u=i.Convert,f=i._Helper,r;if(isNaN(t=u.toDouble(n[0])))return i.Errors.Value;return r=f._argumentExists(n,1)?u.toInt(n[1]):2,r>99?i.Errors.Value:(t=u.toDouble(ft([t,r])),hu(t))}function lu(n){var t,u=i.Convert,o=i._Helper;if(isNaN(t=u.toDouble(n[0])))return i.Errors.Value;var f=o._argumentExists(n,1)?u.toInt(n[1]):2,s=o._argumentExists(n,2)?u.toBool(n[2]):!1,r=new Array(2),e=0;return f<0?(e=u.toInt(Math.pow(10,Math.abs(f))),t/=e,r[0]=t,r[1]=0):(r[0]=t,r[1]=f),t=u.toDouble(ft(r)),f<0&&(t*=e),s?t.toString():bt(t)}function cu(n){var t,i,u,r;if(n.indexOf("[")!==-1&&n.indexOf("]")!==-1){t=n.indexOf("["),i=n.indexOf("]",t);while(t!==-1&&i!==-1)u=n.substring(0,t-1),r=n.substring(i+1),n=u.concat(r),t=n.indexOf("["),i=t===-1?-1:n.indexOf("]",t)}return n}function wu(n){var u=n[0],e=i.Convert,o=h._StandardDateTimeFormatter,f=h._StandardNumberFormatter,t=i.Convert.toString(n[1]),r;if(t===""||t===null||t===undefined)return e.toString(u);(u===null||u===undefined)&&(u=0),t=cu(t);try{return r=new o(t),r.EvaluateFormat(t)||(r=new f(t),r.EvaluateFormat(t)||(r=new h.GeneralFormatter(t))),r.Format(u)}catch(s){return i.Errors.Value}}function tf(n){var f=i.Convert,e=h._DateTimeHelper,o=f.toString(n[0]),t=e.parseLocale(o),r,u;return t!==undefined&&t!==null?(r=new e(t).toOADate(),f.isError(r)?ct([t]):r):isNaN(u=parseFloat(o))?i.Errors.Value:u}function nf(n){var t=i.Convert.toString(n[0]);return t.toLowerCase()}function fr(n){var t=i.Convert.toString(n[0]);return t.toUpperCase()}function ku(n){var t=i.Convert.toInt(n[0]);return t<1||255<t?i.Errors.Value:String.fromCharCode(t)}function gu(n){var t=i.Convert.toString(n[0]);if(t===""||t===undefined||t===null)return i.Errors.Value;try{return t[0].charCodeAt(0)}catch(r){return i.Errors.Value}}function du(n){var u=i.Convert,f=u.toString(n[0]),t=u.toInt(n[1]),r=u.toInt(n[2]),s=u.toString(n[3]),e,o;return t<1||r<0?i.Errors.Value:(t=Math.min(t,f.length+1),r=Math.min(r,f.length-t+1),e=f.substring(0,t-1),o=f.substr(t-1+r),e.concat(s).concat(o))}function br(n){var f=i.Convert,u=f.toString(n[0]),t=f.toString(n[1]),l=f.toString(n[2]),s,o,r,e,c,h;if(t===""||t===undefined||t===null)return u;if(n.length>3){o=f.toInt(n[3]),r=0;if(o<1)return i.Errors.Value;for(e=0;e<o;e++){r=u.indexOf(t,r);if(r===-1)return u;r+=t.length}r-=t.length,c=u.substring(0,r),h=u.substr(r+t.length),s=c.concat(l).concat(h)}else s=u.replace(t,l);return s}function wr(n){for(var e=[],h=n.length,s=i.Convert,f=i._ArrayHelper,o,u,r,t=0;t<h;t++)for(o=f.getLength(n[t]),u=0;u<o;u++)r=f.getValueByIndex(n[t],u),r!==undefined&&r!==null&&e.push(s.toString(r));return e.join("")}function kr(n){var u=i.Convert,f=i._Helper,t=u.toString(n[0]),r=f._argumentExists(n,1)?u.toInt(n[1]):1;return r<0?i.Errors.Value:r<t.length?t.substr(0,r):t}function vr(n){var f=i.Convert,r=f.toString(n[0]),t=f.toInt(n[1])-1,u=f.toInt(n[2]);return t<0||u<0?i.Errors.Value:t<r.length?r.length<t+u?r.substr(t):r.substr(t,u):""}function ar(n){var u=i.Convert,f=i._Helper,t=u.toString(n[0]),r=f._argumentExists(n,1)?u.toInt(n[1]):1;return r<0?i.Errors.Value:t.length<r?t:t.substr(t.length-r,r)}function pr(n){var e=i.Convert,f=e.toString(n[0]),t=e.toInt(n[1]),r,u;if(t<0||32767<t*f.length)return i.Errors.Value;for(r=[],u=0;u<t;u++)r.push(f);return r.join("")}function yr(n){return i.Convert.toString(n[0]).length}function gr(n){var u=i.Convert,o=i._Helper,e=u.toString(n[0]),f=u.toString(n[1]),r=o._argumentExists(n,2)?u.toInt(n[2]):1,t;if(r<1||f.length<r)return i.Errors.Value;return t=f.indexOf(e,r-1),t===-1?i.Errors.Value:t+1}function uu(n){var e=i.Convert,h=i._Helper,r=e.toString(n[0]),o=e.toString(n[1]),u=h._argumentExists(n,2)?e.toInt(n[2]):1,t;u--;if(u<0)return i.Errors.Value;t=-1;try{if(r.indexOf("*")===-1&&r.indexOf("?")===-1)t=o.toLowerCase().indexOf(r.toLowerCase(),u);else{var c=le(r).toLowerCase(),s=new RegExp(c,"i"),f=s.exec(o);t=f!==undefined&&f!==null?f.index:-1}}catch(l){}return t===-1?i.Errors.Value:t+1}function ou(n){var t=i.Convert,u=t.toString(n[0]),r=t.toString(n[1]);return u===r}function tu(n){var t=n[0];return typeof t=="string"?t:""}function nu(n,t){if(i.Convert.isError(n))t.value=!0;else if(typeof n===w){var r=i.Error.parse(n);t.value=r!==undefined&&r!==null}t.value=!1}function iu(n,t){if(i.Convert.isError(n)&&n._code!==i.Errors.NotAvailable._code)t.value=!0;else if(typeof n===w){var r=i.Error.parse(n);t.value=r!==undefined&&r!==null&&r!==i.Errors.NotAvailable}t.value=!1}function o(n){if(n===undefined||n===null)throw d;else if(n.length<1||n.length>1)throw d;}function ru(n){o(n);var t={value:!1};return i.Convert.isError(n[0])?t.value=!0:y(n[0],nu,t),t.value}function eu(n){o(n);var r=i.Convert,t={value:!1};return r.isError(n[0])&&n[0]._code!==i.Errors.NotAvailable._code?t.value=!0:r.isError(n[0])&&n[0]._code===i.Errors.NotAvailable._code?t.value=!1:y(n[0],iu,t),t.value}function fu(n){return o(n),i.Convert.isError(n[0])?n[0]._code===i.Errors.NotAvailable._code:!1}function dr(n){o(n);var t=n[0];if(t!==undefined&&t!==null)if(i.Convert.isError(t))switch(t._code){case i.Errors.Null._code:return 1;case i.Errors.DivideByZero._code:return 2;case i.Errors.Value._code:return 3;case i.Errors.Reference._code:return 4;case i.Errors.Name._code:return 5;case i.Errors.Number._code:return 6;case i.Errors.NotAvailable._code:return 7;default:break}return i.Errors.NotAvailable}function bu(n){return o(n),i.Convert.isNumber(n[0])}function rf(n){o(n);var t;return isNaN(t=i.Convert.toDouble(n[0]))?i.Errors.Value:f._MathHelper.approxFloor(Math.abs(t))%2==0}function uf(n){o(n);var t;return isNaN(t=i.Convert.toDouble(n[0]))?i.Errors.Value:f._MathHelper.approxFloor(Math.abs(t))%2!=0}function yu(n){o(n);var t=n[0],r=i.Convert;if(r.isNumber(t))return r.toDouble(t);else if(typeof t===it)return t?1:0;else if(r.isError(t))return t;return 0}function au(n){return o(n),n[0]===undefined||n[0]===null}function ai(n){return o(n),typeof n[0]===it}function ii(n){return o(n),typeof n[0]===w}function ei(n){return o(n),typeof n[0]!==w}function oi(n){return o(n),i.Convert._isCalcReference(n[0])}function wi(n){o(n);var t=n[0],r=i.Convert;return r.isNumber(t)?1:typeof t===w?2:typeof t===it?4:r.isError(t)?16:r._isCalcArray(t)?64:i.Errors.Value}function rr(n){return i.Errors.NotAvailable}var p="undefined",w="string",it="boolean",d="Invalid arguments",e=n.GrapeCity,h,i,f,r,b,v;typeof e===p&&(e=n.GrapeCity={}),typeof e.UI===p&&(e.UI={}),h=e.UI,typeof e.Calc===p&&(e.Calc={}),i=e.Calc,typeof i.Functions===p&&(i.Functions={}),f=i.Functions,f._builtInFunctions=f._builtInFunctions||{},typeof f._defineBuildInFunction===p&&(f._defineBuildInFunction=function(n,t,i){var r,u;if(n===undefined||n===null)throw"Invalid function name";n=n.toUpperCase();if(f._builtInFunctions.hasOwnProperty(n)){r=f._builtInFunctions[n];if(r){if(!i||!i.override)throw"Attempt to override function while override is not allowed";}else f._builtInFunctions[n]=new f.Function(n,0,255),r=f[n.toUpperCase()]}else r=new f.Function(n,0,255),f._builtInFunctions[n]=r;t&&typeof t=="function"&&(r.evaluate=t);if(i)for(u in i)i.hasOwnProperty(u)&&u!=="override"&&(r[u]=i[u]);return r}),r=f._defineBuildInFunction,b=[/\\/g,/\(/g,/\[/g,/\{/g,/\^/g,/\$/g,/\|/g,/\)/g,/\+/g,/\./g],v={log:function(n,t){return isNaN(n)?n:isNaN(t)?t:t!==1&&n===1||t!==0&&t!==Number.POSITIVE_INFINITY?Math.log(n)/Math.log(t):NaN},log10:function(n){return v.log(n,10)}},f._DateTimeHelper={days360:yt,yearfrac:vt},f._MathHelper=function(){function e(n){var t=Math.floor(n);return f._MathHelper.approxEqual(n,t+1)?t+1:t}function u(n){var t=Math.ceil(n);return f._MathHelper.approxEqual(n,t-1)?t-1:t}function a(n,t){return n===t?!0:Math.abs(n-t)<Math.abs(n)/281474976710656}function l(){var n=new Array(17);return n[0]=1,n[1]=10,n[2]=100,n[3]=1e3,n[4]=1e4,n[5]=1e5,n[6]=1e6,n[7]=1e7,n[8]=1e8,n[9]=1e9,n[10]=1e10,n[11]=1e11,n[12]=1e12,n[13]=1e13,n[14]=1e14,n[15]=1e15,n[16]=1e16,n}function r(n){var i=l(),t=i[n];return t!==undefined&&t!==null?t:Math.pow(10,parseFloat(n))}function n(n,t){var u,r,e,f;switch(n){case 0:u=function(n,t){return n<=t},r=function(n,t){return n<=t};break;case 1:u=function(n,t){return n>=t},r=function(n,t){return n>=t};break;case 2:u=function(n,t){return n!==t},r=function(n,t){return n!==t};break;case 3:u=function(n,t){return n<t},r=function(n,t){return n<t};break;case 4:u=function(n,t){return n===t},r=function(n,t){return n===t};break;case 5:u=function(n,t){return n>t},r=function(n,t){return n>t};break;default:return function(n){return!1}}e=-1,f=!0;try{t===undefined||t===null?e=0:isNaN(e=i.Convert.toDouble(t.toString()))&&(f=!1)}catch(o){f=!1}return function(n){if(n===undefined||n===null)return!1;if(f){var o=-1;try{if(!isNaN(o=i.Convert.toDouble(n)))return r(o,e)}catch(s){}}return u(n.toString().toUpperCase(),t!==undefined&&t!==null?t.toString().toUpperCase():"")}}function p(t){var f,e;if(i.Convert.isNumber(t))return n(4,t);var o="=><",r=t!==undefined&&t!==null?t.toString().toUpperCase():"",u="\x00";for(f=0;f<2&&f<r.length;f++){e=r[f];if(o.indexOf(e)!==-1)if(e==="=")switch(u){case"<":return n(0,r.substring(2));case">":return n(1,r.substring(2));default:return n(4,u==="\x00"?r.substring(1):t)}else{if(u==="\x00"){u=e;continue}if(u==="<")return e===">"?n(2,r.substring(2)):n(3,r.substring(1));else if(u===">")return n(5,r.substring(1))}else switch(u){case"<":return n(3,r.substring(1));case">":return n(5,r.substring(1));default:break}}return n(4,t)}function y(n,t){if(isNaN(n))return i.Errors.Value;var f=r(Math.abs(t));return t<0?n/=f:n*=f,n=n<0?u(n-.5):e(n+.5),t<0?n*=f:n/=f,i.Convert.toResult(n)}function c(n,t){var u,r;if(isNaN(n)||isNaN(t))return i.Errors.Value;if(n<0||t<0||n<t)return i.Errors.Number;for(u=1,t=Math.min(n-t,t),r=1;r<=t;r++)u*=n-r+1,u/=r;return i.Convert.toResult(u)}function t(n){return Math.log(1+n)-(1+n-1-n)/(1+n)}function s(n,i){var r;return r=Math.abs(n)>.5?Math.pow(1+n,i):Math.exp(i*t(n)),isFinite(r)?isNaN(r)&&(r=494065645841247e-338):r===Number.POSITIVE_INFINITY?r=179769e303:r===Number.NEGATIVE_INFINITY&&(r=-179769e303),r}function o(n){return(Math.exp(n)+Math.exp(-n))/2}function h(n){return(Math.exp(n)-Math.exp(-n))/2}return{approxFloor:e,approxCeiling:u,approxEqual:a,pow10:r,parseCriteria:p,round:y,combin:c,log10:v.log10,log:v.log,pow1p:s,log1p:t,cosh:o,sinh:h}}(),r("ABS",se,{minArgs:1,maxArgs:1}),r("ACOS",us,{minArgs:1,maxArgs:1}),r("ASIN",ks,{minArgs:1,maxArgs:1}),r("ATAN",cs,{minArgs:1,maxArgs:1}),r("ATAN2",vs,{minArgs:2,maxArgs:2}),r("COS",ts,{minArgs:1,maxArgs:1}),r("CEILING",ue,{minArgs:2,maxArgs:2}),r("ODD",ye,{minArgs:1,maxArgs:1}),r("EVEN",de,{minArgs:1,maxArgs:1}),r("FLOOR",ef,{minArgs:2,maxArgs:2}),r("LN",ge,{minArgs:1,maxArgs:1}),r("SQRT",vf,{minArgs:1,maxArgs:1}),r("SIN",ps,{minArgs:1,maxArgs:1}),r("TAN",ls,{minArgs:1,maxArgs:1}),r("SIGN",re,{minArgs:1,maxArgs:1}),r("GCD",af,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("LCM",lf,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("PRODUCT",yf,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("POWER",we,{minArgs:2,maxArgs:2}),r("MOD",be,{minArgs:2,maxArgs:2}),r("QUOTIENT",cf,{minArgs:2,maxArgs:2}),r("SUBTOTAL",of,{minArgs:2,acceptsReference:wt,acceptsArray:wt}),r("INT",fe,{minArgs:1,maxArgs:1}),r("MROUND",hf,{minArgs:2,maxArgs:2}),r("ROUND",ft,{minArgs:2,maxArgs:2}),r("ROUNDDOWN",sf,{minArgs:2,maxArgs:2}),r("ROUNDUP",ne,{minArgs:2,maxArgs:2}),r("TRUNC",gf,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("EXP",ie,{minArgs:1,maxArgs:1}),r("LOG",te,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("LOG10",df,{minArgs:1,maxArgs:1}),r("SUM",pe,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("SUMIF",wf,{minArgs:2,maxArgs:3,acceptsMissingArgument:s,acceptsReference:dt,acceptsArray:dt}),r("SUMIFS",kf,{minArgs:3,acceptsReference:gt,acceptsArray:gt}),r("SUMPRODUCT",bf,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("SUMSQ",to,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("SUMX2MY2",os,{minArgs:2,maxArgs:2,acceptsReference:u,acceptsArray:u}),r("SUMX2PY2",es,{minArgs:2,maxArgs:2,acceptsReference:u,acceptsArray:u}),r("SUMXMY2",hs,{minArgs:2,maxArgs:2,acceptsReference:u,acceptsArray:u}),r("SERIESSUM",ss,{minArgs:4,maxArgs:4,acceptsReference:st,acceptsArray:st}),r("PI",ve,{minArgs:0,maxArgs:0}),r("SQRTPI",fs,{minArgs:1,maxArgs:1}),r("DEGREES",ee,{minArgs:1,maxArgs:1}),r("RADIANS",is,{minArgs:1,maxArgs:1}),r("COSH",rs,{minArgs:1,maxArgs:1}),r("ACOSH",ws,{minArgs:1,maxArgs:1}),r("SINH",bs,{minArgs:1,maxArgs:1}),r("ASINH",ys,{minArgs:1,maxArgs:1}),r("TANH",as,{minArgs:1,maxArgs:1}),r("ATANH",ns,{minArgs:1,maxArgs:1}),r("MDETERM",so,{minArgs:1,maxArgs:1,acceptsArray:u,acceptsReference:u}),r("MINVERSE",oo,{minArgs:1,maxArgs:1,acceptsArray:u,acceptsReference:u}),r("MMULT",co,{minArgs:2,maxArgs:2,acceptsArray:u,acceptsReference:u}),r("FACT",ke,{minArgs:1,maxArgs:1}),r("FACTDOUBLE",no,{minArgs:1,maxArgs:1}),r("MULTINOMIAL",ho,{minArgs:1,acceptsArray:u,acceptsReference:u}),r("RAND",eo,{minArgs:0,maxArgs:0,isVolatile:g}),r("RANDBETWEEN",ro,{minArgs:2,maxArgs:2,isVolatile:g}),r("COMBIN",oe,{minArgs:2,maxArgs:2}),r("ROMAN",fo,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("AND",uo,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("OR",bo,{minArgs:1,acceptsReference:u,acceptsArray:u}),r("NOT",wo,{minArgs:1,maxArgs:1}),r("IF",go,{minArgs:2,maxArgs:3,acceptsReference:nt,acceptsArray:nt,acceptsError:nt,acceptsMissingArgument:s,isBranch:ce,findTestArgument:he,findBranchArgument:ae}),r("IFERROR",po,{minArgs:2,maxArgs:2,acceptsReference:ni,acceptsError:ni}),r("TRUE",ao,{minArgs:0,maxArgs:0}),r("FALSE",lo,{minArgs:0,maxArgs:0}),r("DATE",yo,{minArgs:3,maxArgs:3}),r("TIME",vo,{minArgs:3,maxArgs:3}),r("DATEVALUE",ff,{minArgs:1,maxArgs:1}),r("TIMEVALUE",ct,{minArgs:1,maxArgs:1}),r("NOW",tr,{minArgs:0,maxArgs:0,isVolatile:g}),r("TODAY",ir,{minArgs:0,maxArgs:0,isVolatile:g}),r("HOUR",gi,{minArgs:1,maxArgs:1}),r("MINUTE",bi,{minArgs:1,maxArgs:1}),r("SECOND",ki,{minArgs:1,maxArgs:1}),r("DAY",di,{minArgs:1,maxArgs:1}),r("MONTH",sr,{minArgs:1,maxArgs:1}),r("YEAR",hr,{minArgs:1,maxArgs:1}),r("WEEKNUM",ur,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("WEEKDAY",ht,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("EDATE",er,{minArgs:2,maxArgs:2}),r("EOMONTH",ui,{minArgs:2,maxArgs:2}),r("WORKDAY",ti,{minArgs:2,maxArgs:3,acceptsMissingArgument:s,acceptsArray:s,acceptsReference:s}),r("DAYS360",yt,{minArgs:2,maxArgs:3,acceptsMissingArgument:s}),r("NETWORKDAYS",yi,{minArgs:2,maxArgs:3,acceptsMissingArgument:s,acceptsArray:s,acceptsReference:s}),r("YEARFRAC",vt,{minArgs:2,maxArgs:3,acceptsMissingArgument:s}),r("DATEDIF",li,{minArgs:3,maxArgs:3}),r("CLEAN",vu,{minArgs:1,maxArgs:1}),r("TRIM",pu,{minArgs:1,maxArgs:1}),r("DOLLAR",su,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("FIXED",lu,{minArgs:1,maxArgs:3,acceptsMissingArgument:nt}),r("TEXT",wu,{minArgs:2,maxArgs:2}),r("VALUE",tf,{minArgs:1,maxArgs:1}),r("LOWER",nf,{minArgs:1,maxArgs:1}),r("UPPER",fr,{minArgs:1,maxArgs:1}),r("CHAR",ku,{minArgs:1,maxArgs:1}),r("CODE",gu,{minArgs:1,maxArgs:1}),r("REPLACE",du,{minArgs:4,maxArgs:4,acceptsMissingArgument:s}),r("SUBSTITUTE",br,{minArgs:3,maxArgs:4,acceptsMissingArgument:st}),r("CONCATENATE",wr,{minArgs:2,acceptsArray:u}),r("LEFT",kr,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("MID",vr,{minArgs:3,maxArgs:3}),r("RIGHT",ar,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),r("REPT",pr,{minArgs:2,maxArgs:2}),r("LEN",yr,{minArgs:1,maxArgs:1}),r("FIND",gr,{minArgs:2,maxArgs:3,acceptsMissingArgument:s}),r("SEARCH",uu,{minArgs:2,maxArgs:3,acceptsMissingArgument:s}),r("EXACT",ou,{minArgs:2,maxArgs:2}),r("T",tu,{minArgs:1,maxArgs:1}),r("ISERROR",ru,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISERR",eu,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISNA",fu,{minArgs:1,maxArgs:1,acceptsError:u}),r("ERROR.TYPE",dr,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISNUMBER",bu,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISEVEN",rf,{minArgs:1,maxArgs:1}),r("ISODD",uf,{minArgs:1,maxArgs:1}),r("N",yu,{minArgs:1,maxArgs:1}),r("ISBLANK",au,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISLOGICAL",ai,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISTEXT",ii,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISNONTEXT",ei,{minArgs:1,maxArgs:1,acceptsError:u}),r("ISREF",oi,{minArgs:1,maxArgs:1,acceptsError:u,acceptsReference:u}),r("TYPE",wi,{minArgs:1,maxArgs:1,acceptsArray:u,acceptsError:u}),r("NA",rr,{minArgs:0,maxArgs:0})})(window,jQuery);(function(n,t){"use strict";function k(n,t,i){this.compareType=n,this.expected=t,this.formula=i}function it(n,i,r,u){this.operator=n,this.value1=typeof i=="string"?t.trim(i):i,this.value2=typeof r=="string"?t.trim(r):r,this.style=u}function ri(n,i,r){this.compareType=n,this.expected=i,this.formula=typeof r=="string"?t.trim(r).replace("=",""):r}function gt(n,i,r){this.compareType=n,this.expected=i,this.formula=typeof r=="string"?t.trim(r).replace("=",""):r,this.forceValue2Text=!1,this.useWildCards=!0,this.regex=null,this.ignoreCase=!1}function ht(n,t,i){this.operator=n,this.text=t,this.style=i}function ui(n,t){this.compareType=n,this.expected=t}function ti(n,i){var r,u;this.customValueType=n,this.expected=null,r=i,typeof r=="string"&&(u=t.trim(r),r=u[0]==="="?u.substr(1):u),this.formula=r,this.ignoreBlank=!1}function nt(n,t){if(typeof n!="string")throw new Error("ArgumentException");this.formula=n,this.style=t}function bt(n,i,r){this.compareType=n,this.expected=i,this.formula=typeof r=="string"?t.trim(r).replace("=",""):r}function l(n){this.ignoreBlank=!1,this.formula=null,this.expected=n,this.expectTypeId=0}function et(n,t){this.type=n,this.style=t}function fi(n,i,r){this.compareType=n,this.expected=i,this.formula=typeof r=="string"?t.trim(r).replace("=",""):r,this.ignoreBlank=!1}function rt(n,t,i){this.expected=t,this.type=n,this.isPercent=!1,this.ignoreBlank=!1,this.ranges=i}function ut(n,t,i){this.type=n,this.rank=t,this.style=i}function lt(n,t){this.expected=n,this.ranges=t}function ct(n){this.style=n}function vt(n){this.style=n}function at(n,t){this.type=n,this.ranges=t}function ot(n,t){this.type=n,this.style=t}function v(n,t){this.type=n,this.value=t}function tt(n,t,i){this.scales=[n,t,i],this.expected=[],this.lowestValueCached=null,this.highestValueCached=null,this.cached=!1}function ni(n,t,i,r,u,f){var o=new v(n,t),e=new v(r,u);tt.call(this,o,null,e),this.expected[0]=i,this.expected[2]=f}function dt(n,t,i,r,u,f,e,o,s){var l=new v(n,t),c=new v(r,u),h=new v(e,o);tt.call(this,l,c,h),this.expected[0]=i,this.expected[1]=f,this.expected[2]=s,this._evaluator=null}function ii(n){this.worksheet=n,this.rules=[]}var kt="undefined",b=n.GrapeCity,i,e,y,st,o,h,f;typeof b===kt&&(b=n.GrapeCity={}),typeof b.UI===kt&&(b.UI={}),i=b.UI,typeof b.Calc===kt&&(b.Calc={}),e=b.Calc,i.RelationCompareType={Or:0,And:1},i.ComparisonOperator={EqualsTo:0,NotEqualsTo:1,GreaterThan:2,GreaterThanOrEqualsTo:3,LessThan:4,LessThanOrEqualsTo:5,Between:6,NotBetween:7},i.GeneralCompareType={EqualsTo:0,NotEqualsTo:1,GreaterThan:2,GreaterThanOrEqualsTo:3,LessThan:4,LessThanOrEqualsTo:5},i.TextComparisonOperator={Contains:0,DoesNotContain:1,BeginsWith:2,EndsWith:3},i.TextCompareType={EqualsTo:0,NotEqualsTo:1,BeginsWith:2,DoesNotBeginWith:3,EndsWith:4,DoesNotEndWith:5,Contains:6,DoesNotContain:7},i.ColorCompareType={BackgroundColor:0,ForegroundColor:1},i.CustomValueType={Empty:0,NonEmpty:1,Error:2,NonError:3,Formula:4},i.DateCompareType={EqualsTo:0,NotEqualsTo:1,Before:2,BeforeEqualsTo:3,After:4,AfterEqualsTo:5},i.Top10ConditionType={Top:0,Bottom:1},i.DateOccurringType={Today:0,Yesterday:1,Tomorrow:2,Last7Days:3,ThisMonth:4,LastMonth:5,NextMonth:6,ThisWeek:7,LastWeek:8,NextWeek:9},i.QuarterType={Quarter1:0,Quarter2:1,Quarter3:2,Quarter4:3},i.SortState={None:0,Ascending:1,Descending:2},i.AverageConditionType={Above:0,Below:1,EqualOrAbove:2,EqualOrBelow:3,Above1StdDev:4,Below1StdDev:5,Above2StdDev:6,Below2StdDev:7,Above3StdDev:8,Below3StdDev:9},i.ScaleValueType={Number:0,LowestValue:1,HighestValue:2,Percent:3,Percentile:4,Automin:5,Formula:6,Automax:7};var g=i.RelationCompareType,p=i.ComparisonOperator,r=i.GeneralCompareType,wt=i.TextComparisonOperator,u=i.TextCompareType,ft=i.ColorCompareType,d=i.CustomValueType,w=i.DateCompareType,pt=i.Top10ConditionType,a=i.DateOccurringType,yt=i.QuarterType,ei=i.SortState,s=i.AverageConditionType,c=i.ScaleValueType;i.ConditionRuleBase=function(n){this.style=n},i.ConditionRuleBase.prototype={condition:null,ranges:null,style:null,hasNoReference:function(){return!(this.ranges&&this.ranges.length>0)},evaluate:function(n,t,i,r){var u,f;return this.contains(t,i)?(this.initCondition(),u={baseRow:0,baseCol:0},this.getBaseCoordinate(u),this.condition.adjustOffset(t-u.baseRow,i-u.baseCol),f=null,this.condition.evaluate(n,t,i,r)&&(f=this.getExpected()),this.condition.adjustOffset(0,0),f):null},contains:function(n,t){var i,r;if(this.ranges)for(i=0;i<this.ranges.length;i++){r=this.ranges[i];if(r.contains(n,t))return!0}return!1},createCondition:function(){},initCondition:function(){this.condition||(this.condition=this.createCondition())},getExpected:function(){return this.style},reset:function(){this.ranges=null,this.condition=null,this.style=null},intersects:function(n,t,i,r){var u,f;if(this.ranges)for(u=0;u<this.ranges.length;u++){f=this.ranges[u];if(f.intersect(n,t,i,r))return!0}return!1},isScaleRule:function(){return!1},getBaseCoordinate:function(n){var t,i;n.baseRow=Number.MAX_VALUE,n.baseCol=Number.MAX_VALUE;if(this.ranges&&this.ranges.length>0)for(t=0;t<this.ranges.length;t++)i=this.ranges[t],n.baseRow=Math.min(i.row,n.baseRow),n.baseCol=Math.min(i.col,n.baseCol);else n.baseRow=0,n.baseColumn=0},_addRows:function(n,t){var f,u,r;if(this.ranges)for(f=this.ranges.length,u=0;u<f;u++)r=this.ranges[u],r.row<n?r.row<n&&n<r.row+r.rowCount&&(this.ranges[u]=new i.Range(r.row,r.col,r.rowCount+t,r.colCount)):this.ranges[u]=new i.Range(r.row+t,r.col,r.rowCount,r.colCount)},_addColumns:function(n,t){var f,u,r;if(this.ranges)for(f=this.ranges.length,u=0;u<f;u++)r=this.ranges[u],r.col<n?r.col<n&&n<r.col+r.colCount&&(this.ranges[u]=new i.Range(r.row,r.col,r.rowCount,r.colCount+t)):this.ranges[u]=new i.Range(r.row,r.col+t,r.rowCount,r.colCount)},_removeRows:function(n,t){var f,h,u,r,o,c,e,s;if(this.ranges){for(f=[],h=this.ranges.length,u=0;u<h;u++)r=this.ranges[u],r.row>n?r.row+r.rowCount>n+t?this.ranges[u]=new i.Range(r.row-t,r.col,r.rowCount,r.colCount):f.push(r):r.row<=n&&n<r.row+r.rowCount&&(o=new i.Range(r.row,r.col,r.rowCount-Math.min(r.row+r.rowCount-n,t),r.colCount),o.colCount===0||o.rowCount===0?f.push(r):this.ranges[u]=o);for(c=f.length,e=0;e<c;e++)s=f[e],this.ranges.remove(s)}},_removeColumns:function(n,t){var f,h,u,r,o,c,e,s;if(this.ranges){for(f=[],h=this.ranges.length,u=0;u<h;u++)r=this.ranges[u],r.col>n?r.col+r.colCount>n+t?this.ranges[u]=new i.Range(r.row,r.col-t,r.rowCount,r.colCount):f.push(r):r.col<=n&&n<r.col+r.colCount&&(o=new i.Range(r.row,r.col,r.rowCount,r.colCount-Math.min(r.col+r.colCount-n,t)),o.colCount===0||o.rowCount===0?f.push(r):this.ranges[u]=o);for(c=f.length,e=0;e<c;e++)s=f[e],this.ranges.remove(s)}}},y=i.ConditionRuleBase,i.RelationCondition=function(n,t,i){this.compareType=n,this.item1=t,this.item2=i},i.RelationCondition.prototype={conditionType:"RelationCondition",compareType:g.And,item1:null,item2:null,ignoreBlank:!1,adjustOffset:function(n,t){},create:function(n,t,i){return new st(n,t,i)},_getActualValue:function(n,t,i,r,u){if(n&&t)if(t.conditionType==="ColorCondition"){var f=n.getActualStyle(i,r);f&&(t.compareType===ft.BackgroundColor?u=f.backColor:t.compareType===ft.ForegroundColor&&(u=f.foreColor))}return u},evaluate:function(n,t,i,r,u){var o,s,f,e;this.item1&&(this.item1.ignoreBlank=this.ignoreBlank,o=arguments.length<5?this._getActualValue(n,this.item1,t,i,r):r),this.item2&&(this.item2.ignoreBlank=this.ignoreBlank,s=arguments.length<5?this._getActualValue(n,this.item2,t,i,r):u);if(this.compareType===g.And)return f=this.item1===undefined||this.item1===null?!1:this.item1.evaluate(n,t,i,o),f?e=this.item2===undefined||this.item2===null?!1:this.item2.evaluate(n,t,i,s):!1;else if(this.compareType===g.Or)return f=this.item1===undefined||this.item1===null?!1:this.item1.evaluate(n,t,i,o),f?!0:e=this.item2===undefined||this.item2===null?!1:this.item2.evaluate(n,t,i,s);return!1},reset:function(){this.ignoreBlank=!1,this.compareType=g.And,this.item1=null,this.item2=null}},st=i.RelationCondition,it.prototype=new y,it.prototype.createCondition=function(){var e=this.isFormula(this.value1)?this.value1.replace("=",""):null,s=this.isFormula(this.value1)?null:this.value1,o=this.isFormula(this.value2)?this.value2.replace("=",""):null,h=this.isFormula(this.value2)?null:this.value2,u,i,n=this.operator,t=null,f;if(n===p.Between)return u=new k(r.GreaterThanOrEqualsTo,this.value1,e),u.treatNullValueAsZero=!0,i=new k(r.LessThanOrEqualsTo,this.value2,o),i.treatNullValueAsZero=!0,new st(g.And,u,i);else if(n===p.NotBetween)return u=new k(r.LessThan,this.value1,e),u.treatNullValueAsZero=!0,i=new k(r.GreaterThan,this.value2,o),i.treatNullValueAsZero=!0,new st(g.Or,u,i);else n===p.EqualsTo?t=r.EqualsTo:n===p.GreaterThan?t=r.GreaterThan:n===p.GreaterThanOrEqualsTo?t=r.GreaterThanOrEqualsTo:n===p.LessThan?t=r.LessThan:n===p.LessThanOrEqualsTo?t=r.LessThanOrEqualsTo:n===p.NotEqualsTo&&(t=r.NotEqualsTo);return t!==null?(f=new k(t,this.value1,e),f.treatNullValueAsZero=!0,f):null},it.prototype.reset=function(){this.operator=p.Between,this.value1=null,this.value2=null,this.style=null},it.prototype.isFormula=function(n){return n!==undefined&&n!==null&&n[0]==="="},i.CellValueRule=it,k.prototype={compareType:null,treatNullValueAsZero:!1,adjustOffset:function(n,t){},getExpected:function(n,t,i,r){if(this.formula&&this.formula.length>0){var u=n.getCalcService(),f=u.parse(this.formula,t,i);return u.evaluateParsedFormula(n._getSheetSource(),f,t,i)}else return this.expected},evaluate:function(n,t,i,r){var u=this.getExpected(n,t,i);return this.checkCondition(u,r)},isSatisfyingCondition:function(n){var t=this.getExpected(null,0,0);return this.checkCondition(t,n)},checkCondition:function(n,t){var i=0,h=!1,c=e.Convert.toDouble,s,u,f,o;if(typeof n=="boolean"){s=n;switch(this.compareType){case r.EqualsTo:return t===n;case r.NotEqualsTo:return t!==n;case r.GreaterThan:return this._compareBool(s,t)<0;case r.GreaterThanOrEqualsTo:return this._compareBool(s,t)<=0;case r.LessThan:return this._compareBool(s,t)>0;case r.LessThanOrEqualsTo:return this._compareBool(s,t);default:break}}try{i=c(t),h=!isNaN(i)}catch(a){h=!1}if((t===undefined||t===null)&&(n===undefined||n===null))switch(this.compareType){case r.EqualsTo:case r.GreaterThanOrEqualsTo:case r.LessThanOrEqualsTo:return!0;case r.NotEqualsTo:case r.GreaterThan:case r.LessThan:return!1;default:return!1}this.treatNullValueAsZero&&(t===undefined||t===null)&&(h=!0,i=0);if(h){u=0;try{u=c(n)}catch(l){switch(this.compareType){case r.EqualsTo:return!1;case r.NotEqualsTo:return!0}return!1}switch(this.compareType){case r.EqualsTo:return i===u;case r.NotEqualsTo:return i!==u;case r.GreaterThan:return i>u;case r.GreaterThanOrEqualsTo:return i>=u;case r.LessThan:return i<u;case r.LessThanOrEqualsTo:return i<=u}}else if(typeof t=="string"){f=null;if(typeof n=="string")f=n;else{switch(this.compareType){case r.EqualsTo:return!1;case r.NotEqualsTo:return!0}return!1}o=t;switch(this.compareType){case r.EqualsTo:return o===f;case r.NotEqualsTo:return o!==f;case r.GreaterThan:return f<o;case r.GreaterThanOrEqualsTo:return f<=o;case r.LessThan:return f>o;case r.LessThanOrEqualsTo:return f>=o}}return!1},_compareBool:function(n,t){return n===t?0:n===!1&&t===!0?-1:1}},i.CellValueCondition=k,ri.prototype={conditionType:"NumberCondition",ignoreBlank:!1,integerValue:!1,compareType:r.EqualsTo,evaluate:function(n,t,i,r){var u=this.getExpected(n,t,i);return this.integerValue&&(u=isNaN(u)?null:parseInt(u,10)),this.checkCondition(u,r)},checkCondition:function(n,t){var i,u;if((t===undefined||t===null||t==="")&&this.ignoreBlank)return!0;if(isNaN(t))return!1;if(n===undefined||n===null)if(this.ignoreBlank)return!0;else n=0;i=0;try{i=parseFloat(t)}catch(f){return!1}if(this.integerValue===!0){u=i-Math.floor(i)==0;if(u===!1)return!1}switch(this.compareType){case r.EqualsTo:return i===n;case r.NotEqualsTo:return i!==n;case r.GreaterThan:return i>n;case r.GreaterThanOrEqualsTo:return i>=n;case r.LessThan:return i<n;case r.LessThanOrEqualsTo:return i<=n}return!1},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService();return r.evaluate(n._getSheetSource(),this.formula,t,i)}else return this.expected},reset:function(){this.expected=null,this.ignoreBlank=!1,this.compareType=r.EqualsTo,this.integerValue=!1}},i.NumberCondition=ri,ht.prototype=new y,ht.prototype.createCondition=function(){var n,t;switch(this.operator){case wt.BeginsWith:n=u.BeginsWith;break;case wt.EndsWith:n=u.EndsWith;break;case wt.Contains:n=u.Contains;break;case wt.DoesNotContain:n=u.DoesNotContain;break;default:n=u.EqualsTo;break}return t=new gt(n,this.text,null),t.ignoreCase=!0,t},ht.prototype.reset=function(){this.operator=u.Contains,this.text="",this.style=null},i.SpecificTextRule=ht,gt.prototype={conditionType:"TextCondition",questionMarkWildcard:"?",questionMarkWildcardRegularExpression:".",asteriskWildcard:"*",asteriskWildcardRegularExpression:"[.\n]*",ignoreBlank:!1,adjustOffset:function(n,t){},evaluate:function(n,t,i,r){var f=null,e;if(this.forceValue2Text===!0||typeof r=="string"||typeof r=="number")f=r!==undefined&&r!==null?r.toString():"";else{if(r instanceof Date)return this.compareType===u.BeginsWith||this.compareType===u.EndsWith||this.compareType===u.Contains?!1:this.compareType===u.DoesNotBeginWith||this.compareType===u.DoesNotEndWith||this.compareType===u.DoesNotContain;f=r!==undefined&&r!==null?r.toString():""}if(this.ignoreBlank&&(f===undefined||f===null||f===""))return!0;e=this.getExpectedString(n,t,i);if(this.hasWildcard(e))if(typeof r=="number")return this.compareType===u.DoesNotBeginWith||this.compareType===u.DoesNotContain||this.compareType===u.DoesNotEndWith||this.compareType===u.NotEqualsTo;switch(this.compareType){case u.EqualsTo:return this.isEquals(e,f);case u.NotEqualsTo:return!this.isEquals(e,f);case u.BeginsWith:return this.isStartWith(e,f);case u.DoesNotBeginWith:return!this.isStartWith(e,f);case u.EndsWith:return this.isEndWith(e,f);case u.DoesNotEndWith:return!this.isEndWith(e,f);case u.Contains:return this.isContains(e,f);case u.DoesNotContain:return!this.isContains(e,f)}return!1},getExpectedString:function(n,t,i){var r=this.getExpected(n,t,i);return r===undefined||r===null?null:r.toString()},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService(),u=r.parse(this.formula,t,i);return r.evaluateParsedFormula(n._getSheetSource(),u,t,i)}else return this.expected},hasWildcard:function(n){return n===undefined||n===null||n===""?!1:n.indexOf(this.asteriskWildcard)>-1||n.indexOf(this.questionMarkWildcard)>-1},isEquals:function(n,t){var r,i,u;if(this.useWildCards&&this.hasWildcard(n)){r=this.createEqualsRegex(n);if(r){i=t===undefined&&t===null?"":t,r.lastIndex=-1;if(i!==undefined&&i!==null)return i.search(r)>-1}return!1}else return t!==undefined&&t!==null&&t!==""?(u=n!==undefined&&n!==null?n:"",this.ignoreCase?u.toLowerCase()===t.toLowerCase():u===t):n===undefined||n===null||n===""},createEqualsRegex:function(n){var t,i,r,u;if(this.regex)return this.regex;n=this.encodeExpression(n),t=n,i=new RegExp("\\"+this.questionMarkWildcard,"g"),t=t.replace(i,this.questionMarkWildcardRegularExpression),i=new RegExp("\\"+this.asteriskWildcard,"g"),t=t.replace(i,this.asteriskWildcardRegularExpression),r=null;try{u=this.ignoreCase?"ig":"g",r=new RegExp("^"+t+"$",u)}catch(f){return null}return r},encodeExpression:function(n){if(!n)return null;var t=n;return t=t.replace(/\^/g,"\\^"),t=t.replace(/\$/g,"\\$"),t=t.replace(/\(/g,"\\("),t=t.replace(/\)/g,"\\)"),t=t.replace(/\[/g,"\\["),t=t.replace(/\]/g,"\\]"),t=t.replace(/\{/g,"\\{"),t=t.replace(/\}/g,"\\}"),t=t.replace(/\./g,"\\."),t=t.replace(/\+/g,"\\+"),t=t.replace(/\|/g,"\\|")},isStartWith:function(n,t){var i,f,u,r;if(this.useWildCards&&this.hasWildcard(n)){f=this.createStartWithRegex(n);if(f){i=t===undefined||t===null?"":t,f.lastIndex=-1;if(i!==undefined&&i!==null)return i.search(f)>-1}return!1}else return t!==undefined&&t!==null&&t!==""?n===undefined||n===null?!1:(u=n,i=t,this.ignoreCase&&(u=u.toLowerCase(),i=i.toLowerCase()),r=i.match("^"+u),r!==undefined&&r!==null&&r.length>0?r[0]===u:!1):n===undefined||n===null||n===""},createStartWithRegex:function(n){var t,r,i,u;if(this.regex)return this.regex;n=this.encodeExpression(n),t=n,r=new RegExp("\\"+this.questionMarkWildcard,"g"),t=t.replace(r,this.questionMarkWildcardRegularExpression),r=new RegExp("\\"+this.asteriskWildcard,"g"),t=t.replace(r,this.asteriskWildcardRegularExpression),i=null;try{u=this.ignoreCase?"ig":"g",i=n[0]===this.asteriskWildcard?new RegExp(t,u):new RegExp("^"+t,u)}catch(f){return null}return i},isEndWith:function(n,t){var i,f,u,r;if(this.useWildCards&&this.hasWildcard(n)){f=this.createEndWithRegex(n);if(f){i=t===undefined||t===null?"":t,f.lastIndex=-1;if(i!==undefined&&i!==null)return i.search(f)>-1}return!1}else return t!==undefined&&t!==null&&t!==""?n===undefined||n===null?!1:(u=n,i=t,this.ignoreCase&&(u=u.toLowerCase(),i=i.toLowerCase()),r=i.match(u+"$"),r!==undefined&&r!==null&&r.length>0?r[0]===u:!1):n===undefined||n===null||n===""},createEndWithRegex:function(n){var t,r,i,u;if(this.regex)return this.regex;n=this.encodeExpression(n),t=n,r=new RegExp("\\"+this.questionMarkWildcard,"g"),t=t.replace(r,this.questionMarkWildcardRegularExpression),r=new RegExp("\\"+this.asteriskWildcard,"g"),t=t.replace(r,this.asteriskWildcardRegularExpression),i=null;try{u=this.ignoreCase?"ig":"g",i=n[n.length-1]===this.asteriskWildcard?new RegExp(t,u):new RegExp(t+"$",u)}catch(f){return null}return i},isContains:function(n,t){var i,u,r;if(this.useWildCards&&this.hasWildcard(n)){u=this.createContainsRegex(n);if(u){i=t===undefined||t===null?"":t,u.lastIndex=-1;if(i!==undefined&&i!==null)return i.search(u)>-1}return!1}else return t!==undefined&&t!==null&&t!==""?n===undefined||n===null?!1:(r=n,i=t,this.ignoreCase&&(r=r.toLowerCase(),i=i.toLowerCase()),i.indexOf(r)>-1):n===undefined||n===null||n===""},createContainsRegex:function(n){var t,i,r,u;if(this.regex)return this.regex;n=this.encodeExpression(n),t=n,i=new RegExp("\\"+this.questionMarkWildcard,"g"),t=t.replace(i,this.questionMarkWildcardRegularExpression),i=new RegExp("\\"+this.asteriskWildcard,"g"),t=t.replace(i,this.asteriskWildcardRegularExpression),r=null;try{u=this.ignoreCase?"ig":"g",r=new RegExp(t,u)}catch(f){return null}return r},reset:function(){this.expected=null,this.ignoreBlank=!1,this.compareType=u.EqualsTo,this.useWildCards=!0,this.ignoreCase=!1,this.forceValue2Text=!1}},i.TextCondition=gt,ui.prototype={conditionType:"ColorCondition",ignoreBlank:!1,evaluate:function(n,t,i,r){return this.isEqualsColor(n,r)},isEqualsColor:function(n,t){var i=this.getColorFromString(this.expected),r,u;if(i!==undefined&&i!==null&&i!==""){r=this.getColorFromString(t);if(r!==undefined&&r!==null&&r!=="")return r.a===i.a&&r.r===i.r&&r.g===i.g&&r.b===i.b;else{this.compareType===ft.BackgroundColor?n&&n.getDefaultStyle&&(u=n.getDefaultStyle().backColor):this.compareType===ft.ForegroundColor&&n&&n.getDefaultStyle&&(u=n.getDefaultStyle().foreColor);if(u)return i.a===u.a&&i.r===u.r&&i.g===u.g&&i.b===u.b}}else if(this.ignoreBlank)return!0;return!1},getColorFromString:function(n){return n===undefined||n===null||n===""?null:i._Color.parse(n)},reset:function(){this.expected=null,this.ignoreBlank=!1,this.compareType=ft.BackgroundColor}},i.ColorCondition=ui,nt.prototype=new y,nt.prototype.createCondition=function(){var n=new ti(d.Formula,!this.formula||this.formula===""?null:this.formula);return this.ranges&&this.ranges.length>0&&(n._baseRow=this.ranges[0].row,n._baseCol=this.ranges[0].col),n},nt.prototype.reset=function(){this.formula=null,this.style=null},nt.prototype.isFormula=function(n){return n&&n[0]==="="},i.FormulaRule=nt,ti.prototype={conditionType:"FormulaCondition",adjustOffset:function(n,t){},evaluate:function(n,t,i,r){var u,f;if(this.customValueType===d.Formula){u=this.getExpected(n,t,i);if(this.ignoreBlank&&(u===undefined||u===null||u===""))return!0;try{return e.Convert.toBool(u)}catch(o){return!1}}else{f=e.Convert.isError;switch(this.customValueType){case d.Empty:return r===undefined||r===null||r==="";case d.NonEmpty:return r!==undefined&&r!==null&&r!=="";case d.Error:return f(r);case d.NonError:return!f(r)}}return!1},getExpected:function(n,t,i){var c,r,s,h,o,u,f;if(this.formula&&this.formula.length>0){c=n.getCalcService(),this._expr||((this._baseRow===null||this._baseRow===null)&&(this._baseCol===undefined||this._baseCol===null)&&(this._baseRow=t,this._baseCol=i),this._expr=c.parse(this.formula,this._baseRow,this._baseCol)),r=c.evaluateParsedFormula(n._getSheetSource(),this._expr,t,i,!0);if(r instanceof e.Reference){for(s=r.getRowCount(0),h=r.getColumnCount(0),o=[],u=0;u<s;u++)for(o[u]=[],f=0;f<h;f++)o[u][f]=r.getValue(0,u,f);r=o}else if(r instanceof e.Array){for(s=r.getRowCount(),h=r.getColumnCount(),o=[],u=0;u<s;u++)for(o[u]=[],f=0;f<h;f++)o[u][f]=r.getValue(u,f);r=o}return r instanceof Array?(s=r.length,h=r[0].length,s===1&&h===1?r[0][0]:t-this._baseRow<s&&i-this._baseCol<h?r[0][0]:e.Errors.NotAvailable):r}else return this.expected},reset:function(){this.expected=null,this.ignoreBlank=!1,this.customValueType=d.Empty,this._expr=null,this._baseRow=null,this._baseCol=null}},i.FormulaCondition=ti,bt.prototype={conditionType:"DateCondition",ignoreBlank:!1,evaluate:function(n,t,i,r){if(r===undefined||r===null||r==="")if(this.ignoreBlank)return!0;if(!(r instanceof Date))return!1;var u=this.getExpectedDateTime(n,t,i);if(u===undefined||u===null)return!!this.ignoreBlank;switch(this.compareType){case w.EqualsTo:return this.isEquals(u,r);case w.NotEqualsTo:return!this.isEquals(u,r);case w.After:return this.isAfter(u,r);case w.AfterEqualsTo:return this.isAfter(u,r)||this.isEquals(u,r);case w.Before:return this.isBefore(u,r);case w.BeforeEqualsTo:return this.isBefore(u,r)||this.isEquals(u,r)}return!1},getExpectedDateTime:function(n,t,r){var u=this.getExpected(n,t,r);if(u instanceof Date)return u;else if(typeof u=="string")return i._DateTimeHelper.parseLocale(u);return null},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService(),u=r.parse(this.formula,t,i);return r.evaluateParsedFormula(n._getSheetSource(),u,t,i)}else return this.expected},isEquals:function(n,t){return n.getYear()===t.getYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()},isAfter:function(n,t){var i=this.createDayEnding(n);return t>i},createDayEnding:function(n){return n.setHours(23,59,59,999),n},isBefore:function(n,t){var i=this.createDayBeginning(n);return t<i},createDayBeginning:function(n){return n.setHours(0,0,0,0),n},reset:function(){this.expected=null,this.ignoreBlank=!1,this.compareType=w.EqualsTo}},i.DateCondition=bt,et.prototype=new y,et.prototype.createCondition=function(){return new l(this.type)},et.prototype.reset=function(){this.type=a.Today,this.style=null},i.DateOccurringRule=et,l.prototype={conditionType:"DateExCondition",adjustOffset:function(n,t){},evaluate:function(n,t,i,r){var u=this.getExpectedInt(n,t,i);return u!==undefined&&u!==null?this.checkCondition(u,r):!1},getExpectedInt:function(n,t,i){var r=this.getExpected(n,t,i);return r=parseInt(r,10),isNaN(r)?null:r},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService(),u=r.parse(this.formula,t,i);return r.evaluateParsedFormula(n._getSheetSource(),u,t,i)}else return this.expected},checkCondition:function(n,t){var s=t,u,d,k,b,it,tt,nt,l,p,y,h,v,c;if(this.ignoreBlank&&(s===undefined||s===null||s===""))return!0;try{s=e.Convert.toDateTime(s)}catch(et){return!1}if(this.expectTypeId===0){var f=null,o=null,r=new Date,i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds());switch(n){case a.Last7Days:i.setDate(i.getDate()-6),f=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),o=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);break;case a.Yesterday:i.setDate(i.getDate()-1),f=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),o=new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,999);break;case a.Today:f=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),o=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);break;case a.Tomorrow:i.setDate(i.getDate()+1),f=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),o=new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,999);break;case a.LastWeek:d=r,d.setDate(r.getDate()-r.getDay()-7),k=i,k.setDate(i.getDate()-i.getDay()-1),f=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0),o=new Date(k.getFullYear(),k.getMonth(),k.getDate(),23,59,59,999);break;case a.ThisWeek:b=r,b.setDate(r.getDate()-r.getDay()),it=i,it.setDate(i.getDate()-i.getDay()+6),f=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0),o=new Date(it.getFullYear(),it.getMonth(),it.getDate(),23,59,59,999);break;case a.NextWeek:tt=r,tt.setDate(r.getDate()-r.getDay()+7),nt=i,nt.setDate(i.getDate()-i.getDay()+13),f=new Date(tt.getFullYear(),tt.getMonth(),tt.getDate(),0,0,0,0),o=new Date(nt.getFullYear(),nt.getMonth(),nt.getDate(),23,59,59,999);break;case a.LastMonth:l=r,l.setDate(1),l.setMonth(r.getMonth()-1),p=i,p.setDate(0),f=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0),o=new Date(p.getFullYear(),p.getMonth(),p.getDate(),23,59,59,999);break;case a.ThisMonth:y=r,y.setDate(1),h=i,h.setDate(1),h.setMonth(i.getMonth()+1),h.setDate(0),f=new Date(y.getFullYear(),y.getMonth(),y.getDate(),0,0,0,0),o=new Date(h.getFullYear(),h.getMonth(),h.getDate(),23,59,59,999);break;case a.NextMonth:v=r,v.setDate(1),v.setMonth(r.getMonth()+1),c=i,c.setDate(1),c.setMonth(i.getMonth()+2),c.setDate(0),f=new Date(v.getFullYear(),v.getMonth(),v.getDate(),0,0,0,0),o=new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59,999);break}if(f!==undefined&&f!==null&&o!==undefined&&o!==null){var ft=new bt(w.AfterEqualsTo,f,null),ut=new bt(w.BeforeEqualsTo,o,null),rt=new st(g.And,ft,ut);return rt.evaluate(null,0,0,s)}}else if(this.expectTypeId===1){u=this.getExpectedInt(null,0,0);if(u!==undefined&&u!==null)return this.isEqualsYear(u,s)}else if(this.expectTypeId===2){u=this.getExpectedInt(null,0,0);if(u!==undefined&&u!==null)return this.isEqualsQuarter(u,s)}else if(this.expectTypeId===3){u=this.getExpectedInt(null,0,0);if(u!==undefined&&u!==null)return this.isEqualsMonth(u,s)}else if(this.expectTypeId===4){u=this.getExpectedInt(null,0,0);if(u!==undefined&&u!==null)return this.isEqualsWeek(u,s)}else if(this.expectTypeId===5){u=this.getExpectedInt(null,0,0);if(u!==undefined&&u!==null)return this.isEqualsDay(u,s)}return!1},isEqualsYear:function(n,t){return n===t.getFullYear()},isEqualsQuarter:function(n,t){switch(n){case yt.Quarter1:return t.getMonth()>=1&&t.getMonth()<=3;case yt.Quarter2:return t.getMonth()>=4&&t.getMonth()<=6;case yt.Quarter3:return t.getMonth()>=7&&t.getMonth()<=9;case yt.Quarter4:return t.getMonth()>=10&&t.getMonth()<=12}return!1},isEqualsMonth:function(n,t){return n===t.getMonth()},isEqualsWeek:function(n,t){return n===t.getDay()},isEqualsDay:function(n,t){return n===t.getDate()},reset:function(){this.expected=null,this.ignoreBlank=!1,this.expectTypeId=0}},l.fromDay=function(n){var t=new l(n);return t.expectTypeId=5,t},l.fromMonth=function(n){var t=new l(n);return t.expectTypeId=3,t},l.fromQuarter=function(n){var t=new l(n);return t.expectTypeId=2,t},l.fromWeek=function(n){var t=new l(n);return t.expectTypeId=4,t},l.fromYear=function(n){var t=new l(n);return t.expectTypeId=1,t},i.DateExCondition=l,fi.prototype={conditionType:"TextLengthCondition",evaluate:function(n,t,i,u){if(u===undefined||u===null||u==="")return this.ignoreBlank;var e=u===undefined||u===null?0:u.length,f=this.getExpectedInt(n,t,i);if(typeof f=="number")switch(this.compareType){case r.EqualsTo:return e===f;case r.GreaterThan:return e>f;case r.GreaterThanOrEqualsTo:return e>=f;case r.LessThan:return e<f;case r.LessThanOrEqualsTo:return e<=f;case r.NotEqualsTo:return e!==f}return!1},getExpectedInt:function(n,t,i){var r=this.getExpected(n,t,i);return r=parseInt(r,10),isNaN(r)?null:r},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService(),u=r.parse(this.formula,t,i);return r.evaluateParsedFormula(n._getSheetSource(),u,t,i)}else return this.expected},reset:function(){this.expected=null,this.ignoreBlank=!1,this.compareType=r.EqualsTo}},i.TextLengthCondition=fi,ut.prototype=new y,ut.prototype.createCondition=function(){return new rt(this.type,this.rank,this.ranges)},ut.prototype.reset=function(){this.type=pt.Top,this.rank=10,this.style=null},i.Top10Rule=ut,rt.prototype={conditionType:"Top10Condition",adjustOffset:function(n,t){},evaluate:function(n,t,i,r){var f,u,e;if(r===undefined||r===null||r==="")return this.ignoreBlank;f=this.getExpectedInt(n,t,i);if(f!==undefined&&f!==null){u=null,this.type===pt.Top?u=this.getMaxValues(n,f,this.ranges):this.type===pt.Bottom&&(u=this.getMinValues(n,f,this.ranges));if(u){e=0;try{e=this._toDouble(r)}catch(o){return!1}if(u.contains(e))return!0}}return!1},getExpectedInt:function(n,t,i){var r=this.getExpected(n,t,i);return r=parseInt(r,10),isNaN(r)||!isFinite(r)?null:r},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService(),u=r.parse(this.formula,t,i);return r.evaluateParsedFormula(n._getSheetSource(),u,t,i)}else return this.expected},getMaxValues:function(n,t,i){var f=[],r,a,h,o,c,v,s,e;if(i)for(r=Number.MAX_VALUE,a=0,h=0;h<i.length;h++)for(o=i[h],c=0;c<o.rowCount;c++)for(v=c+o.row,s=0;s<o.colCount;s++){var y=s+o.col,l=n.getValue(v,y),u=this._toDouble(l);if(l!==undefined&&l!==null&&u!==undefined&&u!==null)try{if(a<t)f.push(u),u<r&&(r=u),a++;else if(u>r){f.remove(r),f.push(u);if(f.indexOf(r)<0)for(r=u,e=0;e<f.length;e++)f[e]<r&&(r=f[e])}}catch(p){}}return f},getMinValues:function(n,t,i){var f=[],r,a,h,o,c,v,s,e;if(i)for(r=Number.MIN_VALUE,a=0,h=0;h<i.length;h++)for(o=i[h],c=0;c<o.rowCount;c++)for(v=c+o.row,s=0;s<o.colCount;s++){var y=s+o.col,l=n.getValue(v,y),u=this._toDouble(l);if(l!==undefined&&l!==null&&u!==undefined&&u!==null)try{if(a<t)f.push(u),u>r&&(r=u),a++;else if(u<r){f.remove(r),f.push(u);if(f.indexOf(r)<0)for(r=u,e=0;e<f.length;e++)f[e]>r&&(r=f[e])}}catch(p){}}return f},reset:function(){this.expected=null,this.ignoreBlank=!1,this.type=pt.Top,this.isPercent=!1,this.ranges=null},_toDouble:function(n){return typeof n=="number"||n instanceof Date?e.Convert.toDouble(n):null}},i.Top10Condition=rt,ct.prototype=new y,ct.prototype.createCondition=function(){return new lt(!1,this.ranges)},i.UniqueRule=ct,vt.prototype=new y,vt.prototype.createCondition=function(){return new lt(!0,this.ranges)},i.DuplicateRule=vt,lt.prototype={conditionType:"UniqueCondition",ignoreBlank:!1,adjustOffset:function(n,t){},evaluate:function(n,t,i,r){var u=r,s,f,o;if(u===undefined||u===null||u==="")return this.ignoreBlank;return s=e.Convert,s.isNumber(u)&&(u=s.toDouble(u)),f=this.getExpectedBoolean(n,t,i),f!==undefined&&f!==null?(o=this.getDuplicated(n,this.ranges),o!==undefined&&o!==null?o.contains(u)?f===!0:f!==!0:f!==!0):!1},getExpectedBoolean:function(n,t,i){var r=this.getExpected(n,t,i);try{return e.Convert.toBool(r)}catch(u){return null}},getExpected:function(n,t,i){if(this.formula&&this.formula.length>0){var r=n.getCalcService(),u=r.parse(this.formula,t,i);return r.evaluateParsedFormula(n._getSheetSource(),u,t,i)}else return this.expected},getDuplicated:function(n,t){var l=[],h=[],v,s,u,r,f,a,o,c,i;if(t)for(v=t.length,s=e.Convert,u=0;u<v;u++)for(r=t[u],f=0;f<r.rowCount;f++)for(a=f+r.row,o=0;o<r.colCount;o++)c=o+r.col,i=n.getValue(a,c,3),i!==undefined&&i!==null&&(s.isNumber(i)&&(i=s.toDouble(i)),this._containsKey(l,i)?h.contains(i)||h.push(i):l.push({key:i,value:!1}));return h},_containsKey:function(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i].key===t)return!0;return!1},reset:function(){this.expected=null,this.ignoreBlank=!1,this.ranges=null}},i.UniqueCondition=lt,ot.prototype=new y,ot.prototype.createCondition=function(){return new at(this.type,this.ranges)},ot.prototype.reset=function(){this.type=s.Above,this.style=null},i.AverageRule=ot,at.prototype={conditionType:"AverageCondition",ignoreBlank:!1,adjustOffset:function(n,t){},evaluate:function(n,t,i,r){var c,l,o;if(this.ignoreBlank&&(r===undefined||r===null||r===""))return!0;c=e.Convert,l=c.toDouble,this._rebuildFormula();var f=this.getExpectedDouble(n,t,i),u=null,h=this._stdevExpr?this._getExpectedByExpression(n,this._stdevExpr,t,i):null;if(h!==undefined&&h!==null)try{u=l(h)}catch(a){u=NaN}if(c.isNumber(r)){o=l(r);if(!isNaN(f))switch(this.type){case s.Above:return o>f;case s.Below:return o<f;case s.EqualOrAbove:return o>=f;case s.EqualOrBelow:return o<=f;case s.Above1StdDev:return isNaN(u)?!1:o>f+u;case s.Below1StdDev:return isNaN(u)?!1:o<f-u;case s.Above2StdDev:return isNaN(u)?!1:o>f+2*u;case s.Below2StdDev:return isNaN(u)?!1:o<f-2*u;case s.Above3StdDev:return isNaN(u)?!1:o>f+3*u;case s.Below3StdDev:return isNaN(u)?!1:o<f-3*u}}return!1},_rebuildFormula:function(){this.ranges&&(this._expr=this._createExpression("AVERAGE",this.ranges),(this.type===s.Above1StdDev||this.type===s.Below1StdDev||this.type===s.Above2StdDev||this.type===s.Below2StdDev||this.type===s.Above3StdDev||this.type===s.Below3StdDev)&&(this._stdevExpr=this._createExpression("STDEV",this.ranges)))},_createExpression:function(n,t){var o=e.Expressions,l=e.Functions,c=e.Convert,h=l.findGlobalFunction(n),f,s,u,r;if(h){for(f=[],s=t.length,u=0;u<s;u++){r=t[u];if(r instanceof o.Expression)f[u]=r;else if(r instanceof i.Range)f[u]=new o.RangeExpression(r.row,r.col,r.row+r.rowCount-1,r.col+r.colCount-1);else if(c.isNumber(r)&&!isNaN(r=c.toDouble(r)))f[u]=new o.DoubleExpression(r,r.toString());else throw"NotSupportedException";}return new o.FunctionExpression(h,f)}return null},getExpectedDouble:function(n,t,i){var r=this.getExpected(n,t,i);try{return e.Convert.toDouble(r)}catch(u){return NaN}},getExpected:function(n,t,i){var r=n.getCalcService(),u=r.unparse(this._expr,t,i);return this._expr=r.parse(u,t,i),r.evaluateParsedFormula(n._getSheetSource(),this._expr,t,i)},_getExpectedByExpression:function(n,t,i,r){var u=n.getCalcService(),f=u.unparse(t,i,r);return t=u.parse(f,i,r),u.evaluateParsedFormula(n._getSheetSource(),t,i,r)},reset:function(){this.expected=null,this.ignoreBlank=!1,this.type=s.Above,this.ranges=null,this._expr=null,this._stdevExpr=null}},i.AverageCondition=at,i.ScaleValue=v,o=new y,o.isScaleRule=function(){return!0},o.createCondition=function(){return null},o._calculateLowestValueEx=function(n){var t=(new rt).getMinValues(n,1,this.ranges);return t&&t.length>0?t[0]:null},o._calculateHighestValueEx=function(n){var t=(new rt).getMaxValues(n,1,this.ranges);return t&&t.length>0?t[0]:null},o._tryCache=function(n){this.cached===!1&&(this.lowestValueCached=this._calculateLowestValueEx(n),this.highestValueCached=this._calculateHighestValueEx(n),this.cached=!0)},o._calculateFormula=function(n,t,i,r){if(r&&r.length>0){var u=n.getCalcService(),f=u.parse(r,t,i);return u.evaluateParsedFormula(n._getSheetSource(),f,t,i)}return null},o._isFormula=function(n){return n&&n[0]==="="},o._trimFormula=function(n){return n===undefined||n===null||n===""?null:n[0]==="="?n.substr(1):n},o._calculateValue=function(n,t,i,r){var u=null;if(this._isFormula(r))u=this._calculateFormula(n,t,i,this._trimFormula(r.toString()));else try{u=e.Convert.toDouble(r)}catch(f){u=NaN}return u},o._getHighestValue=function(n){return this._tryCache(n),this.highestValueCached},o._getLowestValue=function(n){return this._tryCache(n),this.lowestValueCached},o._calculatePercent=function(n,t,i,r){var e=this._calculateValue(n,t,i,r),u,f;if(!isNaN(e))if(0<=e&&e<=100){u=this._getLowestValue(n),f=this._getHighestValue(n);if(u!==undefined&&u!==null&&f!==undefined&&f!==null)return u+(f-u)*e/100}return null},o._calculatePercentile=function(n,t,i,r){var f=this._calculateValue(n,t,i,r),h,l,u,c;if(!isNaN(f))if(0<=f&&f<=100){for(h=0,l=this.ranges.length,u=0;u<l;u++){var o=this._createExpression("PERCENTILE",[this.ranges[u],f/100]),s=n.getCalcService(),a=s.unparse(o,t,i);o=s.parse(a,t,i),c=s.evaluateParsedFormula(n._getSheetSource(),o,t,i);try{h+=e.Convert.toDouble(c)}catch(v){}}return h/this.ranges.length}return null},o._getActualValue=function(n,t,i,r){var u=this.scales[r],e,f;if(u)switch(u.type){case c.Formula:return this._calculateValue(n,t,i,u.value);case c.HighestValue:return this._getHighestValue(n);case c.LowestValue:return this._getLowestValue(n);case c.Number:return this._calculateValue(n,t,i,u.value);case c.Percent:return this._calculatePercent(n,t,i,u.value);case c.Percentile:return this._calculatePercentile(n,t,i,u.value);case c.Automax:return e=this._getHighestValue(n),e<0?0:e;case c.Automin:return f=this._getLowestValue(n),f>0?0:f}return null},o._evaluate2Scale=function(n,t,i){return n<=t?0:n>=i?1:(n-t)/(i-t)},o.evaluate=function(n,t,i,r){var h;this._tryCache(n);if(this.contains(t,i)){if(r===undefined||r===null)return null;try{var o=e.Convert.toDouble(r),u=this._getActualValue(n,t,i,0),s=this._getActualValue(n,t,i,1),f=this._getActualValue(n,t,i,2);if(isNaN(s)){if(!isNaN(u)&&!isNaN(f))return u>f?null:this._evaluate2Scale(o,u,f)}else if(!isNaN(u)&&!isNaN(f)&&!isNaN(s))return u>f?null:o<u?0:o>=f?2:(h=this._evaluate2Scale(s,u,f),u>o||o>s?1+this._evaluate2Scale(o,u,f):this._evaluate2Scale(o,u,s))}catch(c){return null}}return null},o._evaluateColor=function(n,t,r){if(0<=n&&n<=1){var e=i._Color,f=e.parse(t),u=e.parse(r),h=f.a*(1-n)+u.a*n,c=f.r*(1-n)+u.r*n,o=f.g*(1-n)+u.g*n,s=f.b*(1-n)+u.b*n;return new e(parseFloat(h/255),parseInt(c,10),parseInt(o,10),parseInt(s,10)).toString()}return null},o._createExpression=at.prototype._createExpression,tt.prototype=o,i.ScaleRule=tt,h=new tt,h.evaluate=function(n,t,i,r){var s,f,u,o;if(r!==undefined&&r!==null){try{s=e.Convert.toDouble(r)}catch(h){return null}f=this._getActualValue(n,t,i,0),u=this._getActualValue(n,t,i,2);if(f!==undefined&&f!==null&&u!==undefined&&u!==null)return o=this._evaluate2Scale(s,f,u),this._evaluateColor(o,this.expected[0],this.expected[2])}return null},h._init=function(){this.scales=new Array(3),this.scales[0]=new v(c.LowestValue,null),this.scales[2]=new v(c.HighestValue,null),this.expected=new Array(3);var n=i._Color;this.expected[0]=new n(0,255,255,255).toString(),this.expected[2]=new n(255,99,190,123).toString()},h.reset=function(){this.ranges=null,this.condition=null,this.style=null,this._init()},h.getMinimumType=function(){return this.scales&&this.scales.length===3?this.scales[0].type:null},h.setMinimumType=function(n){this.scales&&this.scales.length===3&&(this.scales[0].type=n)},h.getMinimumValue=function(){return this.scales&&this.scales.length===3?this.scales[0].value:null},h.setMinimumValue=function(n){this.scales&&this.scales.length===3&&(this.scales[0].value=n)},h.getMinimumColor=function(){return this.expected&&this.expected.length===3?this.expected[0]:null},h.setMinimumColor=function(n){this.expected&&this.expected.length===3&&(this.expected[0]=n)},h.getMaximumType=function(){return this.scales&&this.scales.length===3?this.scales[2].type:null},h.setMaximumType=function(n){this.scales&&this.scales.length===3&&(this.scales[2].type=n)},h.getMaximumValue=function(){return this.scales&&this.scales.length===3?this.scales[2].value:null},h.setMaximumValue=function(n){this.scales&&this.scales.length===3&&(this.scales[2].value=n)},h.getMaximumColor=function(){return this.expected&&this.expected.length===3?this.expected[2]:null},h.setMaximumColor=function(n){this.expected&&this.expected.length===3&&(this.expected[2]=n)},ni.prototype=h,i.TwoScaleRule=ni,f=new tt,f.evaluate=function(n,t,i,r){var u,h;this._evaluator=n;if(r!==undefined&&r!==null){try{u=e.Convert.toDouble(r)}catch(c){return null}var f=this._getActualValue(n,t,i,0),s=this._getActualValue(n,t,i,1),o=this._getActualValue(n,t,i,2);if(f!==undefined&&f!==null&&o!==undefined||o!==null&&s!==undefined&&s!==null)return f>o?null:u<f?this.expected[0]:u>=o?this.expected[2]:f>u||u>s?(h=this._evaluate2Scale(u,s,o),this._evaluateColor(h,this.expected[1],this.expected[2])):(h=this._evaluate2Scale(u,f,s),this._evaluateColor(h,this.expected[0],this.expected[1]))}return null},f._init=function(){this.scales=new Array(3),this.scales[0]=new v(c.LowestValue,null),this.scales[1]=new v(c.Percentile,50),this.scales[2]=new v(c.HighestValue,null),this.expected=new Array(3);var n=i._Color;this.expected[0]=new n(255,248,105,107).toString(),this.expected[1]=new n(255,255,235,132).toString(),this.expected[2]=new n(255,99,190,123).toString()},f.reset=function(){this.ranges=null,this.condition=null,this.style=null,this._init(),this._evaluator=null},f.getMinimumType=function(){return this.scales&&this.scales.length===3?this.scales[0].type:null},f.setMinimumType=function(n){this.scales&&this.scales.length===3&&(this.scales[0].type=n)},f.getMinimumValue=function(){return this.scales&&this.scales.length===3?this.scales[0].value:null},f.setMinimumValue=function(n){this.scales&&this.scales.length===3&&(this.scales[0].value=n)},f.getMinimumColor=function(){return this.expected&&this.expected.length===3?this.expected[0]:null},f.setMinimumColor=function(n){this.expected&&this.expected.length===3&&(this.expected[0]=n)},f.getMidpointType=function(){return this.scales&&this.scales.length===3?this.scales[1].type:null},f.setMidpointType=function(n){this.scales&&this.scales.length===3&&(this.scales[1].type=n)},f.getMidpointValue=function(){if(this.scales&&this.scales.length===3){if(this._evaluator)if(this.scales[1].type===c.HighestValue)return this._getHighestValue(this._evaluator);else if(this.scales[1].type===c.LowestValue)return this._getLowestValue(this._evaluator);return this.scales[1].value}return null},f.setMidpointValue=function(n){this.scales&&this.scales.length===3&&(this.scales[1].value=n)},f.getMidpointColor=function(){return this.expected&&this.expected.length===3?this.expected[1]:null},f.setMidpointColor=function(n){this.expected&&this.expected.length===3&&(this.expected[1]=n)},f.getMaximumType=function(){return this.scales&&this.scales.length===3?this.scales[2].type:null},f.setMaximumType=function(n){this.scales&&this.scales.length===3&&(this.scales[2].type=n)},f.getMaximumValue=function(){return this.scales&&this.scales.length===3?this.scales[2].value:null},f.setMaximumValue=function(n){this.scales&&this.scales.length===3&&(this.scales[2].value=n)},f.getMaximumColor=function(){return this.expected&&this.expected.length===3?this.expected[2]:null},f.setMaximumColor=function(n){this.expected&&this.expected.length===3&&(this.expected[2]=n)},dt.prototype=f,i.ThreeScaleRule=dt,ii.prototype={rules:null,worksheet:null,getRule:function(n){return this.rules[n]},count:function(){return this.rules.length},_cloneRanges:function(n){for(var i=[],r=n.length,t=0;t<r;t++)i.push(this.worksheet._getActualRange(n[t]));return i},addSpecificTextRule:function(n,t,i,r){var u=new ht(n,t,i);return u.ranges=r,this.addRule(u)},addCellValueRule:function(n,t,i,r,u){var f=new it(n,t,i,r);return f.ranges=u,this.addRule(f)},addDateOccurringRule:function(n,t,i){var r=new et(n,t);return r.ranges=i,this.addRule(r)},addFormulaRule:function(n,t,i){var r=new nt(n,t);return r.ranges=i,this.addRule(r)},addTop10Rule:function(n,t,i,r){var u=new ut(n,t,i);return u.ranges=r,this.addRule(u)},addUniqueRule:function(n,t){var i=new ct(n);return i.ranges=t,this.addRule(i)},addDuplicateRule:function(n,t){var i=new vt(n);return i.ranges=t,this.addRule(i)},addAverageRule:function(n,t,i){var r=new ot(n,t);return r.ranges=i,this.addRule(r)},add3ScaleRule:function(n,t,i,r,u,f,e,o,s,h){var c=new dt(n,t,i,r,u,f,e,o,s);return c.ranges=h,this.addRule(c)},add2ScaleRule:function(n,t,i,r,u,f,e){var o=new ni(n,t,i,r,u,f);return o.ranges=e,this.addRule(o)},addRule:function(n){if(this.worksheet){var t=this;return this.worksheet._bindToAutoRefresh(function(n){if(!n)throw new Error("rule");return n.ranges=t._cloneRanges(n.ranges),t.rules.push(n),n})(n)}},removeRule:function(n){if(this.worksheet){var t=this;this.worksheet._bindToAutoRefresh(function(n){n&&t.rules.remove(n)})(n)}},getRules:function(n,t){var u=[],i,r;if(this.rules)for(i=0;i<this.rules.length;i++)r=this.rules[i],r&&r.intersects(n,t,1,1)&&u.push(r);return u},containsRule:function(n,t,i){if(n)if(this.rules.contains(n))return n.contains(t,i);return!1},_clearNullRefRules:function(){var n,t;if(this.rules)for(n=this.count()-1;n>-1;n--)t=this.rules[n],t.hasNoReference()&&this.removeRule(t)},_addRows:function(n,t){var u,i,r;if(this.rules&&this.worksheet)for(u=this.rules.length,i=0;i<u;i++)r=this.rules[i],r&&r._addRows(n,t)},_addColumns:function(n,t){var u,i,r;if(this.rules&&this.worksheet)for(u=this.rules.length,i=0;i<u;i++)r=this.rules[i],r&&r._addColumns(n,t)},_removeRows:function(n,t){var u,i,r;if(this.rules&&this.worksheet)for(u=this.rules.length,i=0;i<u;i++)r=this.rules[i],r&&r._removeRows(n,t)},_removeColumns:function(n,t){var u,i,r;if(this.rules&&this.worksheet)for(u=this.rules.length,i=0;i<u;i++)r=this.rules[i],r&&r._removeColumns(n,t)}},i.ConditionalFormats=ii})(window,jQuery);(function(n){"use strict";function r(n){return n!==1}function o(n,t){this.criteriaOperator=n,this.criteriaValue=t}function u(n,t,i){this.database=n,this.criteria=i,this.row=0;if(arguments.length===3){this.column=this.columnIndex(n,t);if(n.getRowCount()<2||n.getColumnCount()<1)throw"InvalidCastException";if(i.getRowCount()<2||i.getColumnCount()<1)throw"InvalidCastException";if(this.column<0||this.database.getColumnCount()<=this.column)throw"InvalidCastException";}else if(arguments.length===2){this.column=-1;if(n.getRowCount()<2||n.getColumnCount()<1)throw"InvalidCastException";if(i.getRowCount()<2||i.getColumnCount()<1)throw"InvalidCastException";}else throw"InvalidNullException";}function w(n){var r,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var h=t.Convert._toArray(n[0]),c=n[1],l=t.Convert._toArray(n[2]),s=0,f=0,o=new u(h,c,l);while(o.moveNext()){r=o.current();if(i.Calc.Convert.isNumber(r)){if(isNaN(e=t.Convert.toDouble(r)))return t.Convert.Errors.Value;s+=e,f++}else if(t.Convert.isError(r))return r}return 0===f?t.Errors.DivideByZero:t.Convert.toResult(s/f)}function p(n){var e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var o=t.Convert._toArray(n[0]),h=n[1],s=t.Convert._toArray(n[2]),f=0,r=null;if(i.Calc._Helper._argumentExists(n,1)){r=new u(o,h,s);while(r.moveNext())e=r.current(),i.Calc.Convert.isNumber(e)&&f++}else{r=new u(o,s);while(r.moveNext())f++}return i.Calc.Convert.toResult(f)}function y(n){var e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var o=t.Convert._toArray(n[0]),h=n[1],s=t.Convert._toArray(n[2]),f=0,r=null;if(i.Calc._Helper._argumentExists(n,1)){r=new u(o,h,s);while(r.moveNext())e=r.current(),e&&f++}else{r=new u(o,s);while(r.moveNext())f++}return i.Calc.Convert.toResult(f)}function d(n){if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var o=t.Convert._toArray(n[0]),e=n[1],s=t.Convert._toArray(n[2]),f=null,r=new u(o,e,s);if(r.moveNext()){f=r.current();if(r.moveNext())return i.Calc.Errors.Number}else return i.Calc.Errors.Value;return f}function k(n){var r,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var h=t.Convert._toArray(n[0]),c=n[1],l=t.Convert._toArray(n[2]),o=!1,f=-179769e303,s=new u(h,c,l);while(s.moveNext()){r=s.current();if(i.Calc.Convert.isNumber(r)){if(isNaN(e=t.Convert.toDouble(r)))return i.Calc.Errors.Value;(!o||e>f)&&(f=e),o=!0}else if(t.Convert.isError(r))return r}return o?t.Convert.toResult(f):t.Errors.Value}function b(n){var r,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var h=t.Convert._toArray(n[0]),c=n[1],l=t.Convert._toArray(n[2]),o=!1,f=179769e303,s=new u(h,c,l);while(s.moveNext()){r=s.current();if(i.Calc.Convert.isNumber(r)){if(isNaN(e=t.Convert.toDouble(r)))return i.Calc.Errors.Value;(!o||e<f)&&(f=e),o=!0}else if(t.Convert.isError(r))return r}return o?t.Convert.toResult(f):t.Errors.Value}function c(n){var r,o;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var h=t.Convert._toArray(n[0]),c=n[1],s=t.Convert._toArray(n[2]),f=1,e=new u(h,c,s);while(e.moveNext()){r=e.current();if(i.Calc.Convert.isNumber(r)){if(isNaN(o=t.Convert.toDouble(r)))return t.Convert.Errors.Value;f*=o}else if(t.Convert.isError(r))return r}return i.Calc.Convert.toResult(f)}function h(n){var f,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var l=t.Convert._toArray(n[0]),a=n[1],c=t.Convert._toArray(n[2]),o=0,h=0,r=0,s=new u(l,a,c);while(s.moveNext()){f=s.current();if(i.Calc.Convert.isNumber(f)){if(isNaN(e=t.Convert.toDouble(f)))return t.Convert.Errors.Value;o+=e,h+=e*e,r++}else if(t.Convert.isError(f))return f}return r<=1?i.Calc.Errors.DivideByZero:i.Calc.Convert.toResult(Math.sqrt(Math.max(0,(r*h-o*o)/(r*(r-1)))))}function s(n){var f,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var l=t.Convert._toArray(n[0]),a=n[1],c=t.Convert._toArray(n[2]),o=0,h=0,r=0,s=new u(l,a,c);while(s.moveNext()){f=s.current();if(i.Calc.Convert.isNumber(f)){if(isNaN(e=t.Convert.toDouble(f)))return t.Convert.Errors.Value;o+=e,h+=e*e,r++}else if(t.Convert.isError(f))return f}return r<=0?i.Calc.Errors.DivideByZero:i.Calc.Convert.toResult(Math.sqrt(Math.max(0,(r*h-o*o)/(r*r))))}function v(n){var r,o;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var h=t.Convert._toArray(n[0]),c=n[1],s=t.Convert._toArray(n[2]),f=0,e=new u(h,c,s);while(e.moveNext()){r=e.current();if(i.Calc.Convert.isNumber(r)){if(isNaN(o=t.Convert.toDouble(r)))return t.Convert.Errors.Value;f+=o}else if(t.Convert.isError(r))return r}return i.Calc.Convert.toResult(f)}function a(n){var f,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var l=t.Convert._toArray(n[0]),a=n[1],c=t.Convert._toArray(n[2]),o=0,h=0,r=0,s=new u(l,a,c);while(s.moveNext()){f=s.current();if(i.Calc.Convert.isNumber(f)){if(isNaN(e=t.Convert.toDouble(f)))return t.Convert.Errors.Value;o+=e,h+=e*e,r++}else if(t.Convert.isError(f))return f}return r<=1?i.Calc.Errors.DivideByZero:i.Calc.Convert.toResult(Math.max(0,(r*h-o*o)/(r*(r-1))))}function l(n){var f,e;if(!n[0]||!n[1]||!n[2])throw"ArgumentNullException";var l=t.Convert._toArray(n[0]),a=n[1],c=t.Convert._toArray(n[2]),o=0,h=0,r=0,s=new u(l,a,c);while(s.moveNext()){f=s.current();if(i.Calc.Convert.isNumber(f)){if(isNaN(e=t.Convert.toDouble(f)))return t.Convert.Errors.Value;o+=e,h+=e*e,r++}else if(t.Convert.isError(f))return f}return r<=1?i.Calc.Errors.DivideByZero:i.Calc.Convert.toResult(Math.max(0,(r*h-o*o)/(r*r)))}var i=n.GrapeCity,t,f,e;typeof i=="undefined"&&(n.GrapeCity=i={}),typeof i.Calc=="undefined"&&(i.Calc={}),t=i.Calc,typeof t.Functions=="undefined"&&(t.Functions={}),f=t.Functions,f._builtInFunctions=f._builtInFunctions||{},typeof f._defineBuildInFunction=="undefined"&&(f._defineBuildInFunction=function(n,t,i){var r,u;if(!n)throw"Invalid function name";n=n.toUpperCase();if(f._builtInFunctions.hasOwnProperty(n)){r=f._builtInFunctions[n];if(r){if(!i||!i.override)throw"Attempt to override function while override is not allowed";}else f._builtInFunctions[n]=new f.Function(n,0,255),r=f[n.toUpperCase()]}else r=new f.Function(n,0,255),f._builtInFunctions[n]=r;t&&typeof t=="function"&&(r.evaluate=t);if(i)for(u in i)i.hasOwnProperty(u)&&u!=="override"&&(r[u]=i[u]);return r}),e=f._defineBuildInFunction,o.prototype={evaluate:function(n){var i=this.criteriaOperator.evaluate(n,this.criteriaValue,null);return typeof i=="boolean"?t.Convert.toBool(i):!1}},u.prototype={columnIndex:function(n,i){var r,u;if(typeof i=="string"){for(r=0;r<n.getColumnCount();r++){u=t.Convert.toString(n.getValue(0,r));if(u&&this.ignoreCaseEqual(u,i))return r}return-1}else return t.Convert.toInt(i)-1},current:function(){if(this.row<=0||this.database.getRowCount()<=this.row)throw"InvalidOperationException";return this.database.getValue(this.row,this.column)},moveNext:function(){var n=!1;while(!n&&this.row<this.database.getRowCount())this.row++,this.row<this.database.getRowCount()&&(n=this.rowMeetsCriteria());return n},createEvaluator:function(n){var r;if(typeof n=="string"){var t=i.Calc.Convert.toString(n),e=new i.UI._StringHelper(t),f=0;for(r=0;r<u.operators.length;r++)if(e.startsWith(u.operators[r].getName()))return t=t.substring(u.operators[r].getName().length),n=isNaN(f=i.UI._NumberHelper.parseInvariant(t))?this.ignoreCaseEqual("true",t)?!0:this.ignoreCaseEqual("false",t)?!1:t:f,new o(u.operators[r],n);return new o(i.Calc.Operators.equal,n)}else if(n)return new o(i.Calc.Operators.equal,n);return null},rowMeetsCriteria:function(){for(var t=!1,n,r,f,u,i=1;!t&&i<this.criteria.getRowCount();i++)for(t=!0,n=0;t&&n<this.criteria.getColumnCount();n++)r=this.createEvaluator(this.criteria.getValue(i,n)),r&&(f=this.columnIndex(this.database,this.criteria.getValue(0,n)),u=this.database.getValue(this.row,f),t=r.evaluate(u));return t},reset:function(){this.row=0},ignoreCaseEqual:function(n,t){return n=n.toLowerCase(),t=t.toLowerCase(),n===t}},u.operators=[i.Calc.Operators.equal,i.Calc.Operators.notEqual,i.Calc.Operators.lessThanOrEqual,i.Calc.Operators.greaterThanOrEqual,i.Calc.Operators.lessThan,i.Calc.Operators.greaterThan],e("DAVERAGE",w,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DCOUNT",p,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DCOUNTA",y,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DGET",d,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DMAX",k,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DMIN",b,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DPRODUCT",c,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DSTDEV",h,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DSTDEVP",s,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DSUM",v,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DVAR",a,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r}),e("DVARP",l,{minArgs:3,maxArgs:3,acceptsReference:r,acceptsArray:r})})(window);(function(n){"use strict";function oi(n){return n!==0}function c(n){return n===1}function sf(n){return n===2}function uo(n){var f,i,o,t,u,r,e=1,s=[1,.57721566490153287,-.65587807152025379,-.0420026350340952,.16653861138229151,-.0421977345555443,-.009621971527877,.007218943246663,-.0011651675918591,-.0002152416741149,.0001280502823882,-201348547807e-16,-12504934821e-16,1133027232e-15,-2056338417e-16,6116095e-15,50020075e-16,-11812746e-16,1043427e-16,77823e-16,-36968e-16,51e-14,-206e-16,-54e-16,14e-16];if(n>171)return 1e308;if(n===parseInt(n,10))if(n>0)for(t=1,f=2;f<n;f++)t*=f;else t=1e308;else{if(Math.abs(n)>1){for(r=Math.abs(n),o=parseInt(r,10),e=1,i=1;i<=o;i++)e*=r-i;r-=o}else r=n;for(u=s[24],i=23;i>=0;i--)u=u*r+s[i];t=1/(u*r),Math.abs(n)>1&&(t*=e,n<0&&(t=-Math.PI/(n*t*Math.sin(Math.PI*n))))}return t}function io(n){var t,o,s,f,r,i,u=0,e=[.083333333333333329,-.0027777777777777779,.00079365079365079365,-.00059523809523809518,.00084175084175084182,-.0019175269175269181,.00641025641025641,-.029550653594771239,.17964437236883071,-1.3924322169059];t=n;if(n>0)if(n===1||n===2)return 0;else n>7||(u=parseInt(7-n,10),t=n+u);else return 1e308;for(o=1/(t*t),s=2*Math.PI,r=e[9],i=8;i>=0;i--)r=r*o+e[i];f=r/t+.5*Math.log(s)+(t-.5)*Math.log(t)-t;if(n<=7)for(i=1;i<=u;i++)f-=Math.log(t-1),t-=1;return f}function ro(n,t){var i,u,r,f;return n=Math.abs(n),t<0&&(n=-n),r=.0078125*Math.floor(128*n+.5),f=n-r,i=r*r,u=2*r*f+f*f,t<0&&(i=-i,u=-u),i+u>Math.log(s)?hf:i=Math.exp(i)*Math.exp(u)}function h(n,t,i){var r,f,u=0;r=parseFloat(t[u++]),f=i;do r=r*n+parseFloat(t[u++]);while(--f!=0);return r}function w(n,t,i){var r,f,u=0;r=n+parseFloat(t[u++]),f=i-1;do r=r*n+parseFloat(t[u++]);while(--f!=0);return r}function g(n){var o=[],f,t,u,r,s,i,y,p,b,l,e,c,v;o[0]=.00079693672929734706,o[1]=.08283523921074408,o[2]=1.2395337164641429,o[3]=5.4472500305876874,o[4]=8.74716500199817,o[5]=5.3032403823539491,o[6]=1,f=[],f[0]=.00092440881055886367,f[1]=.08562884743544745,f[2]=1.2535274390105895,f[3]=5.4709774033041709,f[4]=8.7619088323706951,f[5]=5.3060528823539466,f[6]=1,t=[],t[0]=-.011366383889846916,t[1]=-1.2825271867050931,t[2]=-19.553954425773597,t[3]=-93.206015212376826,t[4]=-177.68116798048806,t[5]=-147.07750515495118,t[6]=-51.410532676659933,t[7]=-6.0501435060072852,u=[],u[0]=64.3178256118178,u[1]=856.43002597698057,u[2]=3882.4018360540163,u[3]=7240.4677419565251,u[4]=5930.7270118731694,u[5]=2062.0933166032783,u[6]=242.0057402402914,r=[],r[0]=15592.436785523574,r[1]=-14663929.590397161,r[2]=5435264770.5187654,r[3]=-982136065717.9115,r[4]=87590639439536.7,r[5]=-0xc5090e8ec6601,r[6]=0x9d4a5b305a0010,r[7]=-0x41b52d6418d9ec,s=[],s[0]=1041.2835366425984,s[1]=626107.330137135,s[2]=268919633.39381415,s[3]=86400248710.3935,s[4]=20297961275010.555,s[5]=3171577528429750.5,s[6]=0x37a4bf79f36ba00;var d=5.7831859629467841,k=30.471262343662087,a=[];return a[0]=-4794432209.7820177,a[1]=1956174919465.5657,a[2]=-249248344360967.72,a[3]=9708622510473064,i=[],i[0]=499.563147152651,i[1]=173785.40167637469,i[2]=48440965.833996207,i[3]=11185553704.535683,i[4]=2112775201154.8921,i[5]=310518229857422.56,i[6]=0x710505f9ecba70,i[7]=0x17be34c7b662cc00,y=.78539816339744828,p=.79788456080286541,n<0&&(n=-n),n<=5?(l=n*n,n<1e-5?1-l/4:(e=(l-d)*(l-k),e=e*h(l,a,3)/w(l,i,8))):(b=5/n,c=25/(n*n),e=h(c,o,6)/h(c,f,6),c=h(c,t,7)/w(c,u,7),v=n-y,e=e*Math.cos(v)-b*c*Math.sin(v),e*p/Math.sqrt(n))}function k(n){var s=[],u,i,e,o,f;s[0]=-899971225.70555937,s[1]=452228297998.19403,s[2]=-72749424522181.828,s[3]=0xd15a1534be241,u=[],u[0]=620.83647811805429,u[1]=256987.25675774884,u[2]=83514679.143194929,u[3]=22151159547.979248,u[4]=4749141220799.9141,u[5]=784369607876235.87,u[6]=89522233618462736,u[7]=0x49de55d9c0a4e400,i=[],i[0]=.051086259475017659,i[1]=4.9821387295123341,i[2]=75.823828413254532,i[3]=366.7796093601508,i[4]=710.85630499892613,i[5]=597.48961240061362,i[6]=211.68875710057213,i[7]=25.207020585802372,e=[],e[0]=74.237327703567516,e[1]=1056.4488603826283,e[2]=4986.4105833765361,e[3]=9562.3189240475622,e[4]=7997.0416044735066,e[5]=2826.1927851763908,e[6]=336.0936078106983,o=[],o[0]=.00076212561620817314,o[1]=.073139705694091756,o[2]=1.1271960812968493,o[3]=5.1120795114680764,o[4]=8.424045901417724,o[5]=5.2145159868236153,o[6]=1,f=[],f[0]=.00057132312807254865,f[1]=.068845590875449544,f[2]=1.105142326340617,f[3]=5.0738638612860152,f[4]=8.3998555432760416,f[5]=5.2098284868236178,f[6]=1;var p=14.681970642123893,b=49.2184563216946,t,r,c,a,l,y=.79788456080286541,v=2.3561944901923448;return t=n,n<0&&(t=-n),t<=5?(r=n*n,t=h(r,s,3)/w(r,u,8),t=t*n*(r-p)*(r-b)):(t=5/n,r=t*t,c=h(r,o,6)/h(r,f,6),a=h(r,i,7)/w(r,e,7),l=n-v,c=c*Math.cos(l)-t*a*Math.sin(l),c*y/Math.sqrt(n))}function fo(n,t){var s,f,i,h,o,r,e,u,c=11102230246251565e-32;n<0?(n=-n,u=(n&1)==0?1:-1):u=1,t<0&&((n&1)!=0&&(u=-u),t=-t);if(n===0)return u*g(t);if(n===1)return u*k(t);if(n===2)return u*(2*k(t)/t-g(t));if(t<c)return 0;e=56,i=2*(n+e),r=i,h=t*t;do i-=2,r=i-h/r;while(--e>0);r=t/r,i=1,f=1/r,e=n-1,o=2*e;do s=(f*o-i*t)/t,i=f,f=s,o-=2;while(--e>0);return r=Math.abs(i)>Math.abs(f)?k(t)/i:g(t)/f,u*r}function ef(n,t,i){n=Math.exp(-t)*Math.sqrt(Math.PI/(2*t))*i}function of(n,t,i,r,u,f,e,o,h,c,l,a,v,y){if(n>Math.log(s))return 0;i=t,r=4*i*i,u=1,f=8*n,e=1,o=1,h=o,c=s,l=0;do a=r-u*u,o=o*a/(e*f),y=Math.abs(o),l>=t&&y>c&&ef(v,n,h),c=y,h+=o,e+=1,u+=2,l+=1;while(Math.abs(o/h)>fi)}function lf(n,t){var f,w,a,g,k,u,i,p,d,c,y,e,l,h,b,v,o,r;r=n<0?-n:n;if(r>31)return s;if(t<=0)return s;t>9.55&&of(t,r,f,e,l,p,y,u,i,g,o,d,c,a),c=0,p=.25*t*t,y=1,e=0,h=1,v=2/t;if(r>0){for(e=-ui,f=1,o=1;o<r;o++)e+=1/f,f+=1,y*=f;h=v;if(r===1)c=1/t;else{for(a=y/r,w=1,i=a,d=-p,k=1,o=1;o<r;o++){a=a/(r-o),w=w*o,k*=d,u=a*k/w,i+=u;if(s-Math.abs(u)<Math.abs(i))return s;if(v>1&&s/v<h)return s;h*=v}i*=.5,u=Math.abs(i);if(h>1&&s/h<u)return s;if(u>1&&s/u<h)return s;c=i*h}}b=2*Math.log(.5*t),l=-ui,r===0?(e=l,u=1):(e=e+1/r,u=1/y),i=(l+e-b)*u,f=1;do u*=p/(f*(f+r)),l+=1/f,e+=1/(f+r),i+=(l+e-b)*u,f+=1;while(Math.abs(u/i)>fi);return i=.5*i/h,(r&1)!=0&&(i=-i),c+=i}function ei(n){var c,o,l,v,a,f=[],r,i,u,e,t;return f[0]=.051086259475017659,f[1]=4.9821387295123341,f[2]=75.823828413254532,f[3]=366.7796093601508,f[4]=710.85630499892613,f[5]=597.48961240061362,f[6]=211.68875710057213,f[7]=25.207020585802372,r=[],r[0]=74.237327703567516,r[1]=1056.4488603826283,r[2]=4986.4105833765361,r[3]=9562.3189240475622,r[4]=7997.0416044735066,r[5]=2826.1927851763908,r[6]=336.0936078106983,i=[],i[0]=.00076212561620817314,i[1]=.073139705694091756,i[2]=1.1271960812968493,i[3]=5.1120795114680764,i[4]=8.424045901417724,i[5]=5.2145159868236153,i[6]=1,u=[],u[0]=.00057132312807254865,u[1]=.068845590875449544,u[2]=1.105142326340617,u[3]=5.0738638612860152,u[4]=8.3998555432760416,u[5]=5.2098284868236178,u[6]=1,e=[],e[0]=1263204747.9017804,e[1]=-647355876379.16028,e[2]=114509511541823.73,e[3]=-8127702555013251,e[4]=0x2cf35a16e6cd620,e[5]=-0xacf20aeef158b80,t=[],t[0]=594.30159234612825,t[1]=235564.09294306856,t[2]=73481194.445972174,t[3]=18760131610.870617,t[4]=3882312774962.3857,t[5]=620557727146953.75,t[6]=0xf41f1e2a3d2440,t[7]=0x3721e321ece8fe00,n<=5?n<=0?-s:(o=n*n,c=n*(h(o,e,5)/w(o,t,8)),c+=ri*(k(n)*Math.log(n)-1/n)):(c=5/n,o=c*c,l=h(o,i,6)/h(o,u,6),v=h(o,f,7)/w(o,r,7),a=n-cf,l=l*Math.sin(a)+c*v*Math.cos(a),l*ti/Math.sqrt(n))}function ni(n){var c,e,l,v,a,o=[],r,t,u,i,f;return o[0]=.00079693672929734706,o[1]=.08283523921074408,o[2]=1.2395337164641429,o[3]=5.4472500305876874,o[4]=8.74716500199817,o[5]=5.3032403823539491,o[6]=1,r=[],r[0]=.00092440881055886367,r[1]=.08562884743544745,r[2]=1.2535274390105895,r[3]=5.4709774033041709,r[4]=8.7619088323706951,r[5]=5.3060528823539466,r[6]=1,t=[],t[0]=-.011366383889846916,t[1]=-1.2825271867050931,t[2]=-19.553954425773597,t[3]=-93.206015212376826,t[4]=-177.68116798048806,t[5]=-147.07750515495118,t[6]=-51.410532676659933,t[7]=-6.0501435060072852,u=[],u[0]=64.3178256118178,u[1]=856.43002597698057,u[2]=3882.4018360540163,u[3]=7240.4677419565251,u[4]=5930.7270118731694,u[5]=2062.0933166032783,u[6]=242.0057402402914,i=[],i[0]=15592.436785523574,i[1]=-14663929.590397161,i[2]=5435264770.5187654,i[3]=-982136065717.9115,i[4]=87590639439536.7,i[5]=-0xc5090e8ec6601,i[6]=0x9d4a5b305a0010,i[7]=-0x41b52d6418d9ec,f=[],f[0]=1041.2835366425984,f[1]=626107.330137135,f[2]=268919633.39381415,f[3]=86400248710.3935,f[4]=20297961275010.555,f[5]=3171577528429750.5,f[6]=0x37a4bf79f36ba00,n<=5?n<=0?-s:(e=n*n,c=h(e,i,7)/w(e,f,7),c+=ri*Math.log(n)*g(n)):(c=5/n,e=25/(n*n),l=h(e,o,6)/h(e,r,6),v=h(e,t,7)/w(e,u,7),a=n-ff,l=l*Math.sin(a)+c*v*Math.cos(a),l*ti/Math.sqrt(n))}function pf(n,t){var f,u,e,o,r,i;n<0?(n=-n,i=(n&1)==0?1:-1):i=1;if(n===0)return i*ni(t);if(n===1)return i*ei(t);if(t<=0)return-s;e=ni(t),u=ei(t),r=1,o=2*r;do f=o*u/t-e,e=u,u=f,o+=2,++r;while(r<n);return i*f}function wf(n){for(var i=1,t=n;t>1;t--)i*=t;return i}function ii(n,t,i){var r,a,f,e,h,c,u,s,o,l;if(t<0)return NaN;o=100,r=n*.5,a=r*r,r=Math.pow(r,parseFloat(t)),f=wf(t),h=0,e=1,c=parseFloat(t),u=r/f,s=u*.9;if(i)while(u!==s&&o!==0)r*=a,h++,f*=h,c++,e*=c,s=u,u+=r/f/e,o--;else{l=!1;while(u!==s&&o!==0)r*=a,h++,f*=h,c++,e*=c,s=u,l?u+=r/f/e:u-=r/f/e,o--,l=!l}return u}function v(n,i){var u=Math.pow(i,10),r=parseInt(n,i);return isNaN(r)?t.Errors.Number:(u/2>r||(r-=u),r)}function p(n,t,i){var r,f,u;n<0&&(n+=Math.pow(t,10)),r=n.toString(t);if(r.length<i)for(f=i-r.length,u=0;u<f;u++)r="0"+r;return r.toUpperCase()}function e(n,t){this._real=n,this._imag=t}function f(){}function i(n,t){this.str=n,this.c=t}function ut(n){for(var t=0;rt[t].str;t++)if(n.localeCompare(rt[t].str)===0)return!1;return!0}function lt(n,t,i){var r,o,s,e,u,f;for(b=0,nt=1,r=0;n[r].str;r++)if(i.localeCompare(n[r].str)===0)return b=n[r].c,!0;o=0;if(t)for(r=0;t[r].str;r++)s=i.substr(0,1).toLowerCase(),e=t[r].str.substr(0,1).toLowerCase(),s===e&&ut(i)&&(nt=t[r].c,o++);for(r=0;n[r].str;r++){u=i.substr(1,n[r].str.Length),f=n[r].str.substr(0,n[r].str.Length);if(u===f&&ut(i))return b=n[r].c,!0}return!1}function a(n,t,i,r,u){var e,o,s,f,c,h;return e=0,o=0,f=0,s=0,c=lt(n,t,i),e=b,o=nt,h=lt(n,t,r),f=nt,s=b,c?h?e===0||f===0?!1:(l=u*o/e*s/f,!0):!1:!1}function hi(n){var f=parseFloat(n[0]),i,u;if(isNaN(f))return t.Errors.Value;i=r.Calc.Convert.toString(n[1]),u=r.Calc.Convert.toString(n[2]);if(i&&i!==""&&u&&u!==""){if((i.localeCompare("C")===0||i.localeCompare("cel")===0)&&u.localeCompare("C")===0||u.localeCompare("cel")===0)return f;else if((i.localeCompare("F")===0||i.localeCompare("fah")===0)&&(u.localeCompare("F")===0||u.localeCompare("fah")===0))return f;else if((i.localeCompare("K")===0||i.localeCompare("kel")===0)&&(u.localeCompare("K")===0||u.localeCompare("kel")===0))return f;else if((i.localeCompare("C")===0||i.localeCompare("cel")===0)&&(u.localeCompare("F")===0||u.localeCompare("fah")===0))return f*9/5+32;else if((i.localeCompare("F")===0||i.localeCompare("fah")===0)&&(u.localeCompare("C")===0||u.localeCompare("cel")===0))return(f-32)*5/9;else if((i.localeCompare("F")===0||i.localeCompare("fah")===0)&&(u.localeCompare("F")===0||u.localeCompare("fah")===0))return f;else if((i.localeCompare("F")===0||i.localeCompare("fah")===0)&&(u.localeCompare("K")===0||u.localeCompare("kel")===0))return(f-32)*5/9+d;else if((i.localeCompare("K")===0||i.localeCompare("kel")===0)&&(u.localeCompare("F")===0||u.localeCompare("fah")===0))return(f-d)*9/5+32;else if((i.localeCompare("C")===0||i.localeCompare("cel")===0)&&(u.localeCompare("K")===0||u.localeCompare("kel")===0))return f+d;else if((i.localeCompare("K")===0||i.localeCompare("kel")===0)&&(u.localeCompare("C")===0||u.localeCompare("cel")===0))return f-d}else return t.Errors.NotAvailable;return a(li,y,i,u,f)?l:a(rr,y,i,u,f)?l:a(or,null,i,u,f)?l:a(er,y,i,u,f)?l:a(tr,y,i,u,f)?l:a(nr,y,i,u,f)?l:a(gi,y,i,u,f)?l:a(it,y,i,u,f)?l:a(di,y,i,u,f)?l:a(it,y,i,u,f)?l:t.Errors.NotAvailable}function ai(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;return i=r.Calc.Convert.toInt(n[1]),isNaN(i)?t.Errors.Value:i<0?t.Errors.Number:r.Calc.Convert.toResult(ii(u,i,!0))}function wi(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;return i=r.Calc.Convert.toInt(n[1]),isNaN(i)?t.Errors.Value:i<0?t.Errors.Number:r.Calc.Convert.toResult(ii(u,i,!1))}function bi(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;return i=r.Calc.Convert.toInt(n[1]),isNaN(i)?t.Errors.Value:u<=0?t.Errors.Number:i<0?t.Errors.Number:r.Calc.Convert.toResult(lf(i,u))}function vi(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;return i=r.Calc.Convert.toInt(n[1]),isNaN(i)?t.Errors.Value:u<=0?t.Errors.Number:i<0?t.Errors.Number:r.Calc.Convert.toResult(pf(i,u))}function yi(n){var u=r.Calc.Convert.toString(n[0]),i;if(u.length>10)return t.Errors.Number;return i=v(u,2),i.length<u.length?t.Errors.Number:i}function uu(n){var e=r.Calc.Convert.toString(n[0]),u=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,i,f;if(e.length>10)return t.Errors.Number;if(u<1||10<u)return t.Errors.Number;i=v(e,2);if(i.length<e.length)return t.Errors.Number;return f=p(i,16,u),u<f.length&&0<=i&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:f}function fu(n){var e=r.Calc.Convert.toString(n[0]),u=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,i,f;if(10<e.length)return t.Errors.Number;if(u<1||10<u)return t.Errors.Number;i=v(e,2);if(i.length<e.length)return t.Errors.Number;return f=p(i,8,u),0<=i&&u<f.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:f}function nu(n){var f=r.Calc.Convert.toDouble(n[0]),i=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,u;if(f<-512||511<f)return t.Errors.Number;if(i<1||10<i)return t.Errors.Number;return u=p(f,2,i),0<=u&&i<u.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:u}function iu(n){var f=r.Calc.Convert.toDouble(n[0]),i=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,u;if(f<-549755813888||549755813887<f)return t.Errors.Number;if(i<1||10<i)return t.Errors.Number;return u=p(f,16,i),0<=u&&i<u.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:u}function cu(n){var f=r.Calc.Convert.toDouble(n[0]),i=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,u;if(f<-536870912||536870911<f)return t.Errors.Number;if(i<1||10<i)return t.Errors.Number;return u=p(f,8,i),0<=u&&i<u.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:u}function ou(n){var e=r.Calc.Convert.toString(n[0]),u=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,i,f;if(10<e.length)return t.Errors.Number;if(u<1||10<u)return t.Errors.Number;i=v(e.toLowerCase(),16);if(i.length<e.length)return t.Errors.Number;if(i<-512||511<i)return t.Errors.Number;return f=p(i,2,u),0<=i&&u<f.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:f}function su(n){var u=r.Calc.Convert.toString(n[0]),i;if(10<u.length)return t.Errors.Number;return i=v(u.toLowerCase(),16),i.length<u.length?t.Errors.Number:r.Calc.Convert.toResult(i)}function gr(n){var e=r.Calc.Convert.toString(n[0]),u=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,i,f;if(10<e.length)return t.Errors.Number;if(u<1||10<u)return t.Errors.Number;i=v(e,16);if(i.length<e.length)return t.Errors.Number;if(i<-536870912||536870911<i)return t.Errors.Number;return f=p(i,8,u),0<=i&&u<f.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:f}function lr(n){var e=r.Calc.Convert.toString(n[0]),u=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,i,f;if(10<e.length)return t.Errors.Number;if(u<1||10<u)return t.Errors.Number;i=v(e,8);if(i.length<e.length)return t.Errors.Number;if(i<-512||511<i)return t.Errors.Number;return f=p(i,2,u),0<=i&&u<f.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:f}function vr(n){var u=r.Calc.Convert.toString(n[0]),i;if(10<u.length)return t.Errors.Number;return i=v(u,8),i.length<u.length?t.Errors.Number:r.Calc.Convert.toResult(i)}function hr(n){var e=r.Calc.Convert.toString(n[0]),u=r.Calc._Helper._argumentExists(n,1)?r.Calc.Convert.toInt(n[1]):1,i,f;if(10<e.length)return t.Errors.Number;if(u<1||10<u)return t.Errors.Number;i=v(e,8);if(i.length<e.length)return t.Errors.Number;if(i<-549755813888||549755813887<i)return t.Errors.Number;return f=p(i,16,u),0<=i&&u<f.length&&r.Calc._Helper._argumentExists(n,1)?t.Errors.Number:f}function ot(n){var f=r.Calc.Convert.toDouble(n[0]),u,e,i,s;if(isNaN(f))return t.Errors.Value;u=0;if(r.Calc._Helper._argumentExists(n,1)){u=r.Calc.Convert.toDouble(n[1]);if(isNaN(u))return t.Errors.Value}if(f<0||u<0)return t.Errors.Number;if(f>27||u>27)return t.Errors.Number;i=o.StatHelper.normsdist([f*Math.sqrt(2)]);if(typeof i===t.Errors)return NaN;e=parseFloat(i)*2-1;if(r.Calc._Helper._argumentExists(n,1)){i=o.StatHelper.normsdist([u*Math.sqrt(2)]);if(typeof i===t.Errors)return NaN;s=parseFloat(i)*2-1,e=s-e}return e}function dr(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;if(u<0)return t.Errors.Number;return i=ot([u]),typeof i===t.Errors?NaN:1-parseFloat(i)}function yr(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;i=0;if(r.Calc._Helper._argumentExists(n,1)){i=r.Calc.Convert.toDouble(n[1]);if(isNaN(i))return t.Errors.Value}return o._MathHelper.approxEqual(u,i)?1:0}function pr(n){var u=r.Calc.Convert.toDouble(n[0]),i;if(isNaN(u))return t.Errors.Value;i=0;if(r.Calc._Helper._argumentExists(n,1)){i=r.Calc.Convert.toDouble(n[1]);if(isNaN(i))return t.Errors.Value}return u>=i?1:0}function ci(n){var u=r.Calc.Convert.toDouble(n[0]),o=r.Calc.Convert.toDouble(n[1]),i;if(isNaN(u)||isNaN(o))return t.Errors.Value;return i=t._Helper._argumentExists(n,2)?t.Convert.toString(n[2]):"i",i!=="i"&&i!=="j"?t.Errors.Value:f._toResult(new e(u,o),i)}function wr(n){var u=f._toComplex(n[0]),i=u.real(),t=u.imag();return r.Calc.Convert.toResult(Math.sqrt(i*i+t*t))}function kr(n){var t=f._toComplex(n[0]);return r.Calc.Convert.toResult(t.imag())}function br(n){var e=f._toComplex(n[0]),u=e.real(),i=e.imag();return u===0&&i===0?t.Errors.DivideByZero:r.Calc.Convert.toResult(Math.atan2(i,u))}function cr(n){var t=f._toComplex(n[0]),r=t.real(),i=t.imag();return f._toResult(new e(r,-i))}function sr(n){var r=f._toComplex(n[0]),i=r.real(),t=r.imag();return f._toResult(new e(Math.cos(i)*o._MathHelper.cosh(t),-Math.sin(i)*o._MathHelper.sinh(t)))}function ar(n){var u=f._toComplex(n[0]),s=f._toComplex(n[1]),o=u.real(),h=u.imag(),r=s.real(),i=s.imag();return r===0&&i===0?t.Errors.Number:f._toResult(new e((o*r+h*i)/(r*r+i*i),(h*r-o*i)/(r*r+i*i)))}function eu(n){var r=f._toComplex(n[0]),i=r.real(),t=r.imag();return f._toResult(new e(Math.exp(i)*Math.cos(t),Math.exp(i)*Math.sin(t)))}function lu(n){var s=f._toComplex(n[0]),r=s.real(),i=s.imag(),o,u;return r===0&&i===0?t.Errors.Number:(o=Math.sqrt(r*r+i*i),u=Math.atan2(i,r),f._toResult(new e(Math.log(o),u)))}function hu(n){var s=f._toComplex(n[0]),r=s.real(),i=s.imag();if(r===0&&i===0)return t.Errors.Number;var h=Math.sqrt(r*r+i*i),c=Math.atan2(i,r),u=o._MathHelper.log10(Math.E);return f._toResult(new e(u*Math.log(h),u*c))}function tu(n){var s=f._toComplex(n[0]),r=s.real(),i=s.imag();if(r===0&&i===0)return t.Errors.Number;var h=Math.sqrt(r*r+i*i),c=Math.atan2(i,r),u=o._MathHelper.log(Math.E,2);return f._toResult(new e(u*Math.log(h),u*c))}function ru(n){var h=f._toComplex(n[0]),i=parseFloat(n[1]),u,r,s,o;if(isNaN(i))return t.Errors.Value;return u=h.real(),r=h.imag(),u===0&&r===0?i>0?f._toResult(new e(0,0)):t.Errors.Number:(s=Math.sqrt(u*u+r*r),o=Math.atan2(r,u),f._toResult(new e(Math.pow(s,i)*Math.cos(i*o),Math.pow(s,i)*Math.sin(i*o))))}function pi(n){for(var c=1,l=0,s,h,r,i,o,y,v,a,u=0;u<n.length;u++)if(n[u].constructor===t.Array)for(y=n[u],v=0;v<y.rowCount;v++)for(a=0;a<y.columnCount;a++)s=f._toComplex(y.getValue(v,a)),h=c,r=l,i=s.real(),o=s.imag(),c=h*i-r*o,l=h*o+r*i;else s=f._toComplex(n[u]),h=c,r=l,i=s.real(),o=s.imag(),c=h*i-r*o,l=h*o+r*i;return f._toResult(new e(c,l))}function si(n){var t=f._toComplex(n[0]);return r.Calc.Convert.toResult(t.real())}function ur(n){var r=f._toComplex(n[0]),i=r.real(),t=r.imag();return f._toResult(new e(Math.sin(i)*o._MathHelper.cosh(t),Math.cos(i)*o._MathHelper.sinh(t)))}function fr(n){var o=f._toComplex(n[0]),i=o.real(),t=o.imag(),u,r;return i===0&&t===0?f._toResult(new e(0,0)):(u=Math.sqrt(i*i+t*t),r=Math.atan2(t,i),f._toResult(new e(Math.sqrt(u)*Math.cos(r/2),Math.sqrt(u)*Math.sin(r/2))))}function ir(n){var i=f._toComplex(n[0]),t=f._toComplex(n[1]),o=i.real(),s=i.imag(),r=t.real(),u=t.imag();return f._toResult(new e(o-r,s-u))}function ki(n){for(var u=0,o=0,i,a,l,y,v,h,s,c,r=0;r<n.length;r++)if(n[r].constructor===t.Array)for(h=n[r],s=0;s<h.rowCount;s++)for(c=0;c<h.columnCount;c++)i=f._toComplex(h.getValue(s,c)),a=u,l=o,y=i.real(),v=i.imag(),u=a+y,o=l+v;else i=f._toComplex(n[r]),a=u,l=o,y=i.real(),v=i.imag(),u=a+y,o=l+v;return f._toResult(new e(u,o))}var r=n.GrapeCity,t,o,u;typeof r=="undefined"&&(n.GrapeCity=r={}),typeof r.Calc=="undefined"&&(r.Calc={}),t=r.Calc,typeof t.Functions=="undefined"&&(t.Functions={}),o=t.Functions,o._builtInFunctions=o._builtInFunctions||{},typeof o._defineBuildInFunction=="undefined"&&(o._defineBuildInFunction=function(n,t,i){var r,u;if(!n)throw"Invalid function name";n=n.toUpperCase();if(o._builtInFunctions.hasOwnProperty(n)){r=o._builtInFunctions[n];if(r){if(!i||!i.override)throw"Attempt to override function while override is not allowed";}else o._builtInFunctions[n]=new o.Function(n,0,255),r=o[n.toUpperCase()]}else r=new o.Function(n,0,255),o._builtInFunctions[n]=r;t&&typeof t=="function"&&(r.evaluate=t);if(i)for(u in i)i.hasOwnProperty(u)&&u!=="override"&&(r[u]=i[u]);return r}),u=o._defineBuildInFunction;var hf=17976931348623157e292,s=17976931348623157e292,ti=.79788456080286541,cf=2.3561944901923448,ri=.63661977236758138,ff=.78539816339744828,fi=11102230246251565e-32,ui=.57721566490153287;e.prototype={real:function(){return this._real},imag:function(){return this._imag},toString:function(n){n||(n="i");var t=new r.UI._StringBuilder;return(this._real!==0||this._imag===0)&&t.append(this._real.toString()),this._imag===-1?t.append("-"):this._real!==0&&this._imag>0&&t.append("+"),this._imag!==-1&&this._imag!==0&&this._imag!==1&&t.append(this._imag.toString()),this._imag!==0&&t.append(n),t.toString()}},e._parse=function(n){var h=0,o=0,u=!1,f=!1,s=!1,i=0,r=0,t=0;if(!n)throw"Argument Null";if(n.length===0)throw"Format";t<n.length&&(n.charAt(t)==="+"||n.charAt(t)==="-")&&t++;while(t<n.length&&!isNaN(Number(n.charAt(t))))t++,u=!0;t<n.length&&n.charAt(t)==="."&&t++;while(t<n.length&&!isNaN(Number(n.charAt(t))))t++,u=!0;if(t<n.length&&(n.charAt(t)==="E"||n.charAt(t)==="e")){t++,u=!1,t<n.length&&(n.charAt(t)==="+"||n.charAt(t)==="-")&&t++;while(t<n.length&&!isNaN(Number(n.charAt(t))))t++,u=!0}if(t<n.length&&(n.charAt(t)==="+"||n.charAt(t)==="-")){i=t,t++;while(t<n.length&&!isNaN(Number(n.charAt(t))))t++,f=!0;t<n.length&&n.charAt(t)==="."&&t++;while(t<n.length&&!isNaN(Number(n.charAt(t))))t++,f=!0;if(t<n.length&&(n.charAt(t)==="E"||n.charAt(t)==="e")){t++,f=!1,t<n.length&&(n.charAt(t)==="+"||n.charAt(t)==="-")&&t++;while(t<n.length&&!isNaN(Number(n.charAt(t))))t++,f=!0}t<n.length&&(n.charAt(t)==="i"||n.charAt(t)==="j")&&(t++,s=!0),r=t-i}else t<n.length&&(n.charAt(t)==="i"||n.charAt(t)==="j")?(t++,r=t,f=u,s=!0,u=!1):i=t;if(t<n.length)throw"Format";if(i>0)if(u)h=parseInt(n.substr(0,i),10);else throw"Format";if(r>0){if(!s)throw"Format";if(r===1)o=1;else if(r===2&&n.charAt(i)==="+")o=1;else if(r===2&&n.charAt(i)==="-")o=-1;else if(f)o=parseInt(n.substr(i,r-1),10);else throw"Format";}return new e(h,o)},f._toComplex=function(n){try{if(n)if(n.constructor===Number)return new e(parseFloat(n),0);else if(n.constructor===String)return e._parse(n);else throw"Invalid Cast";else return new e(0,0)}catch(t){throw"Invalid Cast";}},f._toResult=function(n,i){return isNaN(n.real())||n.real()===Number.POSITIVE_INFINITY||isNaN(n.imag())||n.imag()===Number.POSITIVE_INFINITY?t.Errors.Number:n.toString(i)};var bf=6852205001e-14,af=.002204622915,vf=602217e18,yf=.035273972,pu=1/1852,gt=1e4/254,et=gt/12,ft=et/3,wu=ft/1760,bu=1e10,au=2834.645669,vu=.001,ht=365.25,st=24*ht,ct=60*st,yu=60*ct,bt=9869233e-12,ku=.00750061708,wt=1e5,tf=.224808924,tt=745.701,rf=9999995.193,uf=.239006249,du=.238846191,dt=62146e14,kt=1/(3600*tt),pt=1/3600,gu=23.73042222,at=.000947815,nf=1e4,d=273.15,ve=1/3,ye=1/6,pe=1/48,vt=1/96,ce=1/192,le=1/768,yt=.004929994,ae=.008675585,we=1e24,to=1e21,no=1e18,be=1e15,ge=1e12,de=1e9,ke=1e6,ne=1e3,te=100,ie=10,kf=.1,df=.01,gf=.001,re=1e-6,oe=1e-9,se=1e-12,he=1e-15,ue=1e-18,fe=1e-21,ee=1e-24;var li=[new i("g",1),new i("sg",bf),new i("lbm",af),new i("u",vf),new i("ozm",yf),new i(null,0)],rr=[new i("m",1),new i("mi",wu),new i("Nmi",pu),new i("in",gt),new i("ft",et),new i("yd",ft),new i("ang",bu),new i("Pica",au),new i("km",vu),new i(null,0)],or=[new i("yr",1),new i("day",ht),new i("hr",st),new i("mn",ct),new i("sec",yu),new i(null,0)],er=[new i("Pa",1),new i("atm",bt),new i("mmHg",ku),new i("p",1),new i("at",bt),new i(null,0)],tr=[new i("N",1),new i("dyn",wt),new i("lbf",tf),new i("dy",wt),new i(null,0)],nr=[new i("J",1),new i("e",rf),new i("c",uf),new i("cal",du),new i("eV",dt),new i("HPh",kt),new i("Wh",pt),new i("flb",gu),new i("BTU",at),new i("ev",dt),new i("hh",kt),new i("wh",pt),new i("btu",at),new i(null,0)],gi=[new i("HP",1),new i("W",tt),new i("h",1),new i("w",tt),new i(null,0)],it=[new i("T",1),new i("ga",nf),new i(null,0)],di=[new i("tsp",1),new i("tbs",ve),new i("oz",ye),new i("cup",pe),new i("pt",vt),new i("qt",ce),new i("gal",le),new i("l",yt),new i("uk_pt",ae),new i("us_pt",vt),new i("lt",yt),new i(null,0)],y=[new i("Y",we),new i("Z",to),new i("E",no),new i("P",be),new i("T",ge),new i("G",de),new i("M",ke),new i("k",ne),new i("h",te),new i("e",ie),new i("d",kf),new i("c",df),new i("m",gf),new i("u",re),new i("n",oe),new i("p",se),new i("f",he),new i("a",ue),new i("z",fe),new i("y",ee),new i(null,0)],b=0,nt=0,l=0,rt=["cup","mmHg","J","sec","cel","kel","hh","Wh","wh","flb","BTU"];u("BESSELI",ai,{minArgs:2,maxArgs:2}),u("BESSELJ",wi,{minArgs:2,maxArgs:2}),u("BESSELK",bi,{minArgs:2,maxArgs:2}),u("BESSELY",vi,{minArgs:2,maxArgs:2}),u("BIN2DEC",yi,{minArgs:1,maxArgs:1}),u("BIN2HEX",uu,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("BIN2OCT",fu,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("DEC2BIN",nu,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("DEC2HEX",iu,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("DEC2OCT",cu,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("HEX2BIN",ou,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("HEX2DEC",su,{minArgs:1,maxArgs:1}),u("HEX2OCT",gr,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("OCT2BIN",lr,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("OCT2DEC",vr,{minArgs:1,maxArgs:1}),u("OCT2HEX",hr,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("ERF",ot,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("ERFC",dr,{minArgs:1,maxArgs:1}),u("DELTA",yr,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("GESTEP",pr,{minArgs:1,maxArgs:2,acceptsMissingArgument:c}),u("COMPLEX",ci,{minArgs:2,maxArgs:3,acceptsMissingArgument:sf}),u("IMABS",wr,{minArgs:1,maxArgs:1}),u("IMAGINARY",kr,{minArgs:1,maxArgs:1}),u("IMARGUMENT",br,{minArgs:1,maxArgs:1}),u("IMCONJUGATE",cr,{minArgs:1,maxArgs:1}),u("IMCOS",sr,{minArgs:1,maxArgs:1}),u("IMDIV",ar,{minArgs:2,maxArgs:2}),u("IMEXP",eu,{minArgs:1,maxArgs:1}),u("IMLN",lu,{minArgs:1,maxArgs:1}),u("IMLOG10",hu,{minArgs:1,maxArgs:1}),u("IMLOG2",tu,{minArgs:1,maxArgs:1}),u("IMPOWER",ru,{minArgs:2,maxArgs:2}),u("IMPRODUCT",pi,{minArgs:1,maxArgs:255,acceptsMissingArgument:oi}),u("IMREAL",si,{minArgs:1,maxArgs:1}),u("IMSIN",ur,{minArgs:1,maxArgs:1}),u("IMSQRT",fr,{minArgs:1,maxArgs:1}),u("IMSUB",ir,{minArgs:2,maxArgs:2}),u("IMSUM",ki,{minArgs:1,maxArgs:255,acceptsMissingArgument:oi}),u("CONVERT",hi,{minArgs:3,maxArgs:3})})(window);(function(n){"use strict";function si(n){return n!==0}function yt(n){return n===1}function nt(n){return n===3}function it(n){return n===3||n===4}function gt(n){return n>0}function w(n){return n===4}function wt(n){return n===4||n===5}function ht(n){return n===5}function st(n){return n===6}function ki(n){return n===8}function li(n){return n===7}function et(n){return n===0}function yf(n){return n===2}function vi(n){return n!==2}function pf(n){return n===5||n===6}function wf(n){return n===4||n===6||n===7}function lf(n){return n===3||n===4||n===5}function ct(n){return n%400==0||n%4==0&&n%100!=0||n===1900}function r(n,t){return n-t}function e(n){return new rt.UI._DateTimeHelper(n).toOADate()}function c(n,t,i){var w,v,o,y,c,p,f,a,h,b,s,l,r;o=n.getFullYear(),v=n.getMonth(),w=n.getDate(),p=t.getFullYear(),c=t.getMonth(),y=t.getDate(),h=p-o,f=c-v,a=y-w,f=h*12+f,b=ct(o);switch(i){case 0:return r=[],r[0]=n,r[1]=t,u._DateTimeHelper.days360(r);case 1:case 2:case 3:return l=e(n),s=e(t),s-l;case 4:return f*30+a;default:return-1}}function v(n,t){var i;switch(t){case 0:return 360;case 1:return i=ct(n.getFullYear()),i?366:365;case 2:return 360;case 3:return 365;case 4:return 360;default:return-1}}function pi(n,t,i,r,u){var e,f;return n===0?e=(i+r)/t:(f=Math.pow(1+n,t),e=u>0?(r*n/(f-1)+i*n/(1-1/f))/(1+n):r*n/(f-1)+i*n/(1-1/f)),-e}function ft(n,t,i,r,u){var e,f;return n===0?e=r+i*t:(f=Math.pow(1+n,t),e=u>0?r*f+i*(1+n)*(f-1)/n:r*f+i*(f-1)/n),-e}function af(n,t){var i=Math.pow(1+n,t);return isNaN(i)||!isFinite(i)?l.Calc.Errors.Number:i}function vf(n,t){if(n===0)return t;else{var r=Math.pow(1+n,t),u=r-1,i=u/n;return isNaN(i)||!isFinite(i)?l.Calc.Errors.Number:i}}function ai(n,i,r,u,f){var o,s;o=af(n,i),s=vf(n,i);var a=-r*o-u,h=1+n*t.Convert.toDouble(f),c=h*s,e=a/c;return isNaN(e)||!isFinite(e)?l.Calc.Errors.Number:e}function yi(n,t,i,r){var f=Math.pow(1+i,r),e=f-1,u=-(n*f*i+t*e);return isNaN(u)||!isFinite(u)?l.Calc.Errors.Number:u}function s(n,t){switch(t){case 0:case 2:case 4:case 6:case 7:case 9:case 11:return 31;case 1:return ct(n)?29:28;break;case 3:case 5:case 8:case 10:return 30}}function y(n,t,i,u){var h,e,c,f=new Date(1,0,1),o;f.setFullYear(1),o=0,c=t.getDate()===s(t.getFullYear(),t.getMonth()),h=12/i,e=t.getFullYear()-n.getFullYear(),e>0&&(e=(e-1)*i);do f=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e++,f.setMonth(f.getMonth()-e*h),c&&(o=s(f.getFullYear(),f.getMonth()),f=new Date(f.getFullYear(),f.getMonth(),o));while(r(n,f)<0);return u&&(f=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e--,f.setMonth(f.getMonth()-e*h),c&&(o=s(f.getFullYear(),f.getMonth()),f=new Date(f.getFullYear(),f.getMonth(),o))),f}function bf(n,t){var e,f,i,o,u,r;return e=n.getFullYear(),f=n.getMonth(),i=n.getDate(),o=t.getFullYear(),u=t.getMonth(),r=t.getDate(),i===31&&(i=30),r===31&&(r=30),(o-e)*360+(u-f)*30+(r-i)}function ne(n,t){var e,f,i,o,u,r;return e=n.getFullYear(),f=n.getMonth(),i=n.getDate(),o=t.getFullYear(),u=t.getMonth(),r=t.getDate(),i===31&&(i=30),r===31&&(r=1,u++),(o-e)*360+(u-f)*30+(r-i)}function te(n,t){var e,f,i,o,u,r;return e=n.getFullYear(),f=n.getMonth(),i=n.getDate(),o=t.getFullYear(),u=t.getMonth(),r=t.getDate(),f===2&&s(e,f)===i&&(i=30),u===2&&s(o,u)===r&&(r=30),r!==31||i<30||(r=30),i===31&&(i=30),(o-e)*360+(u-f)*30+(r-i)}function ie(n,t){var e,f,i,o,u,r;return e=n.getFullYear(),f=n.getMonth(),i=n.getDate(),o=t.getFullYear(),u=t.getMonth(),r=t.getDate(),f===2&&s(e,f)===i&&u===2&&s(o,u)===r&&(i=30,r=30),r!==31||i<30||(r=30),i===31&&(i=30),(o-e)*360+(u-f)*30+(r-i)}function o(n,i,u){var f=1,o;r(n,i)>0&&(o=n,n=i,i=o,f=-1);switch(u){case 1:case 2:case 3:return f*t.Convert.toInt(e(i)-e(n));case 4:return f*bf(n,i);case 5:return f*ne(n,i);case 6:return f*te(n,i);default:return f*ie(n,i)}}function lt(n,t,i,r){var u=y(n,t,i,!1);return o(u,n,r)}function a(n,t,i,r){var f,u;switch(r){case 0:case 2:case 4:case 5:return 360/i;case 3:return 365/i;default:return u=y(n,t,i,!0),f=y(n,t,i,!1),o(f,u,1)}}function vt(n,t,i,r){var u=y(n,t,i,!0);return o(n,u,r)}function kf(n,t,i){var r=y(n,t,i,!0);return e(r)}function tt(n,t,i){var u,r=new Date(t.getFullYear(),t.getMonth(),t.getDate());u=t.getMonth()-n.getMonth()+12*(t.getFullYear()-n.getFullYear()),r.setMonth(r.getMonth()-u);if(t.getDate()===s(t.getFullYear(),t.getMonth()))while(r.getDate()!==s(r.getFullYear(),r.getMonth()))r.setDate(r.getDate()+1);return n.getDate()<r.getDate()||u--,parseInt(1+u/(12/i),10)}function df(n,t,i){var r=y(n,t,i,!1);return e(r)}function wi(n,i,r,u,f,e,o){var h=0,s,l=0,c=100,a=t.Convert;for(r*=c/a.toDouble(f),u/=f,u+=1,s=1;s<o;s++)h+=s*r/Math.pow(u,s);for(h+=o*(r+c)/Math.pow(u,o),s=1;s<o;s++)l+=r/Math.pow(u,s);return l+=(r+c)/Math.pow(u,o),h/=l,h/=a.toDouble(f)}function ut(n){return n.havexpos=n.havexneg=!1,n.xmin=-1e10,n.xmax=1e10,n.precision=1e-10,n}function f(n,t,i){return t>0?(i.havexpos?i.havexneg?Math.abs(n-i.xneg)<Math.abs(i.xpos-i.xneg)&&(i.xpos=n,i.ypos=t):t<i.ypos&&(i.xpos=n,i.ypos=t):(i.xpos=n,i.ypos=t,i.havexpos=!0),[!1,i]):t<0?(i.havexneg?i.havexpos?Math.abs(n-i.xpos)<Math.abs(i.xpos-i.xneg)&&(i.xneg=n,i.yneg=t):-t<-i.yneg&&(i.xneg=n,i.yneg=t):(i.xneg=n,i.yneg=t,i.havexneg=!0),[!1,i]):(i.root=n,[!0,i])}function bi(n,t,i,r,u,f,e){for(var k,w,p=lt(n,t,f,e),v=vt(n,t,f,e),o=a(n,t,f,e),c=parseInt(tt(n,t,f),10),y=0,l=100*i/f,h=1+r/f,b=v/o,s=0;s<c;s++)y+=l/Math.pow(h,b+s);return k=u/Math.pow(h,c-1+v/o),w=p/o*l,k+y-w}function h(n,t,i,u,f){var e,s,h;e=y(n,i,u,!0),s=y(n,i,u,!1);if(r(e,t)>=0)return o(n,t,f)/a(s,e,u,f);h=o(n,e,f)/a(s,e,u,f);for(;;){s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),e.setMonth(e.getMonth()+12/u);if(r(e,t)>=0)return h+=o(s,t,f)/a(s,e,u,f);h+=1}}function bt(n,t,i,u,f,e,s,c,l){var g=o(i,n,l),b=o(n,u,l),it=o(i,u,l),v=a(n,t,c,l),p=parseInt(tt(n,t,c),10),et=100*f/c,w=1+e/c,ut,ft,rt,d,y,nt,k;if(b>v)switch(l){case 0:case 4:d=o(u,t,l),p=1+parseInt(Math.ceil(d/v),10);break;default:for(y=new Date(u.getFullYear(),u.getMonth(),u.getDate()),nt=32767,p=0;p<nt;p++){k=new Date(y.getFullYear(),y.getMonth(),y.getDate()),y.setMonth(y.getMonth()+12/c);if(r(y,t)>=0){p+=parseInt(Math.ceil(o(k,t,l))/a(k,y,c,l),10)+1;break}}g=v*h(i,n,u,c,l),b=v*h(n,u,u,c,l),it=v*h(i,u,u,c,l);break}return ft=s/Math.pow(w,p-1+b/v),rt=it/v/Math.pow(w,b/v),ut=Math.pow(w,-b/v)*(Math.pow(w,-p)-1/w)/(1/w-1),ft+et*(rt+ut-g/v)}function at(n,t){var i=n.substr(0,3),r=u._MathHelper.round;switch(n[0]){case"A":if(i==="ATS")return r(13.7603,t);break;case"B":if(i==="BEF")return r(40.3399,t);break;case"D":if(i==="DEM")return r(1.95583,t);break;case"E":if(i==="ESP")return r(166.386,t);else if(i==="EUR")return r(1,t);break;case"F":if(i==="FIM")return r(5.94573,t);else if(i==="FRF")return r(6.55957,t);break;case"G":if(i==="GRD")return r(340.75,t);break;case"I":if(i==="IEP")return r(.787564,t);else if(i==="ITL")return r(1936.27,t);break;case"L":if(i==="LUX"||i==="LUF")return r(40.3399,t);break;case"N":if(i==="NLG")return r(2.20371,t);break;case"P":if(i==="PTE")return r(200.482,t);break;default:break}return-1}function gf(n){var t=n.substr(0,3);switch(n[0]){case"A":if(t==="ATS")return 2;break;case"B":if(t==="BEF")return 0;break;case"D":if(t==="DEM")return 2;break;case"E":if(t==="ESP")return 0;else if(t==="EUR")return 2;break;case"F":if(t==="FIM")return 2;else if(t==="FRF")return 2;break;case"G":if(t==="GRD")return 2;break;case"I":if(t==="IEP")return 2;else if(t==="ITL")return 0;break;case"L":if(t==="LUX"||t==="LUF")return 0;break;case"N":if(t==="NLG")return 2;break;case"P":if(t==="PTE")return 1;break;default:break}return 2}function nf(n){var t=n.substr(0,3);switch(n[0]){case"A":if(t==="ATS")return 2;break;case"B":if(t==="BEF")return 0;break;case"D":if(t==="DEM")return 2;break;case"E":if(t==="ESP")return 0;else if(t==="EUR")return 2;break;case"F":if(t==="FIM")return 2;else if(t==="FRF")return 2;break;case"G":if(t==="GRD")return 2;break;case"I":if(t==="IEP")return 2;else if(t==="ITL")return 0;break;case"L":if(t==="LUX"||t==="LUF")return 0;break;case"N":if(t==="NLG")return 2;break;case"P":if(t==="PTE")return 2;break;default:break}return 2}function tf(n){var i=t.Convert,e=t._Helper,r=i.toDouble(n[0]),u=i.toDouble(n[1]),s=i.toDouble(n[2]),o=e._argumentExists(n,3)?i.toDouble(n[3]):0,f=e._argumentExists(n,4)?i.toDouble(n[4]):0;return f!==0&&(f=1),r===0?i.toResult(-(s*u+o)):i.toResult(-(o*Math.pow(1+r,u)+s*(1+r*f)*(Math.pow(1+r,u)-1)/r))}function rf(n){for(var f=t.Convert,e=t._ArrayHelper,u=f.toDouble(n[0]),r,i=0;i<e.getLength(n[1]);i++)r=f.toDouble(e.getValueByIndex(n[1],i)),u*=1+r;return u}function ku(n){for(var r=t.Convert,e=t._ArrayHelper,c=r.toDouble(n[0]),h=0,s=1,o=0,f,u,i=1;i<n.length;i++){if(r.isError(n[i]))return n[i];if(e.isArrayOrReference(n[i]))for(f=0;f<e.getLength(n[i]);f++){u=e.getValueByIndex(n[i],f);if(r.isError(u))return u;if(r.isNumber(u))o=r.toDouble(e.getValueByIndex(n[i],f)),h+=o/Math.pow(1+c,s),s++;else if(r.isError(u))return u}else o=r.toDouble(n[i]),h+=o/Math.pow(1+c,s),s++}return h}function du(n){var i=t.Convert,e=t._Helper,r=i.toDouble(n[0]),u=i.toDouble(n[1]),s=i.toDouble(n[2]),o=e._argumentExists(n,3)?i.toDouble(n[3]):0,f=e._argumentExists(n,4)?i.toDouble(n[4]):0;return f!==0&&(f=1),r===0?i.toResult(-(s*u+o)):r===-1?t.Errors.DivideByZero:i.toResult(-(o+s*(1+r*f)*(Math.pow(1+r,u)-1)/r)/Math.pow(1+r,u))}function gu(n){var i=t.Convert,y=t._Helper,s=i.toDateTime(n[0]),a=i.toDateTime(n[1]),h=i.toDouble(n[2]),l=i.toDouble(n[3]),u=y._argumentExists(n,4)?i.toInt(n[4]):0,e,f,o;if(r(s,a)>=0)return t.Errors.Number;if(h<=0||l<=0||u<0||4<u)return t.Errors.Number;e=c(s,a,u),f=v(s,u);if(e<=0||f<=0)return t.Errors.Number;return o=1-l*e/f,o<=0?t.Errors.Number:h/o}function uf(n){var s=t.Convert,u=t._ArrayHelper,f=u.getLength(n[1]),h=u.getLength(n[2]),i,r;if(f!==h)return t.Errors.Number;var a=s.toDouble(n[0]),l=new Array(f),o=new Array(h),c=0;for(i=0;i<f;i++)l[i]=s.toDouble(u.getValueByIndex(n[1],i));for(i=0;i<h;i++)o[i]=s.toDateTime(u.getValueByIndex(n[2],i));for(r=0;r<f;r++)c+=l[r]/Math.pow(1+a,(e(o[r])-e(o[0]))/365);return c}function sf(n,t,i,r,u,f){var s,e,o;for(s=pi(n,t,i,0,f),e=0,r===1&&(f>0||(e=-i),r++),o=r;o<=u;o++)e+=f>0?ft(n,o-2,s,i,1)-s:ft(n,o-1,s,i,0);return e*=n}function hf(n){var i=t.Convert,o=i.toDouble(n[0]),e=i.toInt(n[1]),s=i.toDouble(n[2]),r=i.toInt(n[3]),u=i.toInt(n[4]),f=i.toInt(n[5]);return r<1||u<r||o<=0||u>e||e<=0||s<=0||f!==0&&f!==1?t.Errors.Number:sf(o,e,s,r,u,f)}function cf(n,t,i,r,u,f){var e,o,s;for(e=pi(n,t,i,0,f),o=0,r===1&&(o=f>0?e:e+i*n,r++),s=r;s<=u;s++)o+=f>0?e-(ft(n,s-2,e,i,1)-e)*n:e-ft(n,s-1,e,i,0)*n;return o}function ff(n){var i=t.Convert,o=i.toDouble(n[0]),e=i.toInt(n[1]),s=i.toDouble(n[2]),r=i.toInt(n[3]),u=i.toInt(n[4]),f=i.toInt(n[5]);return r<1||u<r||o<=0||u>e||e<=0||s<=0||f!==0&&f!==1?t.Errors.Number:cf(o,e,s,r,u,f)}function ef(n){var i=t.Convert,s=t._Helper,o=i.toDouble(n[0]),r=i.toDouble(n[1]),u=i.toDouble(n[2]),f=i.toDouble(n[3]),h=s._argumentExists(n,4)?i.toDouble(n[4]):0,c=s._argumentExists(n,5)?i.toInt(n[5]):0,e;return r<1||r>=u+1||u<1?t.Errors.Number:(e=ai(o,u,f,h,c),yi(f,e,o,r-1))}function of(n){var i=t.Convert,f=i.toDouble(n[0]),e=i.toInt(n[1]),r=i.toInt(n[2]),u=i.toDouble(n[3]);return r===0?t.Errors.DivideByZero:i.toResult(u*f*(i.toDouble(e)/i.toDouble(r)-1))}function re(n){var i=t.Convert,e=t._Helper,u=i.toDouble(n[0]),r=i.toDouble(n[1]),s=i.toDouble(n[2]),o=e._argumentExists(n,3)?i.toDouble(n[3]):0,f=e._argumentExists(n,4)?i.toDouble(n[4]):0;return f!==0&&(f=1),u===0?r===0?t.Errors.DivideByZero:i.toResult(-(s+o)/r):r===0?t.Errors.DivideByZero:i.toResult(-(s*Math.pow(1+u,r)+o)/((1+u*f)*(Math.pow(1+u,r)-1)/u))}function ge(n){var i=t.Convert,o=t._Helper,s=i.toDouble(n[0]),u=i.toDouble(n[1]),h=i.toDouble(n[2]),f=i.toDouble(n[3]),l=o._argumentExists(n,4)?i.toDouble(n[4]):0,c=o._argumentExists(n,5)?i.toBool(n[5]):!1,r,e;return u<1||u>=h+1?t.Errors.Number:(r=ai(s,h,f,l,c?1:0),e=yi(f,r,s,u-1),r-e)}function no(n){var u=t.Convert,h=t._Helper,o=u.toDateTime(n[0]),s=u.toDateTime(n[1]),i=u.toInt(n[2]),f=h._argumentExists(n,3)?u.toInt(n[3]):0,e=t.Errors.Number;return f<0||f>4?e:i!==1&&i!==2&&i!==4?e:r(o,s)>=0?e:lt(o,s,i,f)}function to(n){var u=t.Convert,h=t._Helper,o=u.toDateTime(n[0]),s=u.toDateTime(n[1]),i=u.toInt(n[2]),f=h._argumentExists(n,3)?u.toInt(n[3]):0,e=t.Errors.Number;return f<0||f>4?e:i!==1&&i!==2&&i!==4?e:r(o,s)>=0?e:a(o,s,i,f)}function be(n){var u=t.Convert,s=t._Helper,e=u.toDateTime(n[0]),o=u.toDateTime(n[1]),i=u.toInt(n[2]),f=s._argumentExists(n,3)?u.toInt(n[3]):0;return f<0||f>4?t.Errors.Number:i!==1&&i!==2&&i!==4?t.Errors.Number:r(e,o)>=0?t.Errors.Number:vt(e,o,i,f)}function ke(n){var u=t.Convert,s=t._Helper,o=u.toDateTime(n[0]),e=u.toDateTime(n[1]),i=u.toInt(n[2]),f=s._argumentExists(n,3)?u.toInt(n[3]):0;return f<0||f>4?t.Errors.Number:i!==1&&i!==2&&i!==4?t.Errors.Number:r(o,e)>=0?t.Errors.Number:kf(o,e,i)}function de(n){var u=t.Convert,s=t._Helper,o=u.toDateTime(n[0]),e=u.toDateTime(n[1]),i=u.toInt(n[2]),f=s._argumentExists(n,3)?u.toInt(n[3]):0;return f<0||f>4?t.Errors.Number:i!==1&&i!==2&&i!==4?t.Errors.Number:r(o,e)>=0?t.Errors.Number:tt(o,e,i)}function io(n){var u=t.Convert,s=t._Helper,o=u.toDateTime(n[0]),e=u.toDateTime(n[1]),i=u.toInt(n[2]),f=l.Calc._Helper._argumentExists(n,3)?u.toInt(n[3]):0;return f<0||f>4?t.Errors.Number:i!==1&&i!==2&&i!==4?t.Errors.Number:r(o,e)>=0?t.Errors.Number:df(o,e,i)}function eo(n){var i=t.Convert,c=t._Helper,o=i.toDateTime(n[0]),e=i.toDateTime(n[1]),h=i.toDouble(n[2]),l=i.toDouble(n[3]),u=i.toInt(n[4]),f=c._argumentExists(n,5)?i.toInt(n[5]):0,s;return f<0||f>4?t.Errors.Number:u!==1&&u!==2&&u!==4?t.Errors.Number:r(o,e)>0?t.Errors.Number:(s=tt(o,e,u),wi(o,e,h,l,u,f,s))}function oo(n,i,r,u,f,e,o){var s=wi(n,i,r,u,f,e,o);return s/=1+u/t.Convert.toDouble(f)}function so(n){var i=t.Convert,c=t._Helper,o=i.toDateTime(n[0]),e=i.toDateTime(n[1]),h=i.toDouble(n[2]),l=i.toDouble(n[3]),u=i.toInt(n[4]),f=c._argumentExists(n,5)?i.toInt(n[5]):0,s;return f<0||f>4?t.Errors.Number:u!==1&&u!==2&&u!==4?t.Errors.Number:r(o,e)>0?t.Errors.Number:(s=tt(o,e,u),oo(o,e,h,l,u,f,s))}function ro(n){var r=t.Convert,e=t._Helper,i=r.toDouble(n[0]),f=r.toDouble(n[1]),s=r.toDouble(n[2]),o=e._argumentExists(n,3)?r.toDouble(n[3]):0,u=e._argumentExists(n,4)?r.toDouble(n[4]):0;return u!==0&&(u=1),i===0?f===0?t.Errors.DivideByZero:r.toResult(-(s+o)/f):i<=-1?t.Errors.Number:r.toResult(Math.log((f*(1+i*u)-o*i)/(s*i+f*(1+i*u)))/Math.log(1+i))}function d(n,t,i,r,u,f,e,o,s){return t=bi(i,r,u,n,e,o,s)-f,[!0,t]}function ui(n,t,i,r,u,f,e,o,s,h,c){var v,y,l,p=0,w=0,a;v=n-i,v<r.xmin&&(v=n),y=n+i,y>r.xmax&&(y=n);if(v===y)return[!1,t,r];a=d(v,p,u,f,e,o,s,h,c),p=a[1],l=a[0];if(!l)return[l,t,r];return a=d(y,w,u,f,e,o,s,h,c),w=a[1],l=a[0],l?(t=(w-p)/(y-v),[!0,t,r]):[l,t,r]}function uo(n,t,i,r,u,e,o,s,h){for(var l,g=n.precision/2,y,k,v,a,c,p,w,b=0;b<20;b++){v=0,a=0;if(h<n.xmin||h>n.xmax)return[!1,n];c=d(h,v,t,i,r,u,e,o,s),v=c[1],l=c[0];if(!l)return[l,n];c=f(h,v,n),n=c[1];if(c[0])return[!0,n];p=Math.abs(h)<1e-10?n.havexneg&&n.havexpos?Math.abs(n.xpos-n.xneg)/1e6:(n.xmax-n.xmin)/1e6:Math.abs(h)/1e6,w=ui(h,a,p,n,t,i,r,u,e,o,s),n=w[2],a=w[1],l=w[0];if(!l)return[l,n];if(a===0)return[!1,n];y=h-1.000001*v/a;if(y===h)return n.root=h,[!0,n];k=Math.abs(y-h)/(Math.abs(h)+Math.abs(y)),h=y;if(k<g)return n.root=h,[!0,n]}return[!1,n]}function fo(n,t,i,r,u,e,o,s,h){var l,a=0,c;if(h<n.xmin||h>n.xmax)return[!1,n];c=d(h,a,t,i,r,u,e,o,s),a=c[1],l=c[0];if(!l)return[l,n];return c=f(h,a,n),n=c[1],c[0]?[!0,n]:[!1,n]}function ei(n,t,i,r,u,e,o,s,h,c,l,a,v,y){var nt,tt,g,k;switch(y){case 0:l=n.xpos-n.ypos*((n.xneg-n.xpos)/(n.yneg-n.ypos));break;case 1:l=(n.xpos+n.xneg)/2,tt=d(l,a,t,i,r,u,e,o,s),a=tt[1],v=tt[0];if(!v)return[null,n,c,l,a,y];if(a===0)return n=f(l,a,n)[1],[!0,n,c,l,a,y];nt=Math.sqrt(a*a-n.ypos*n.yneg);if(nt===0)return[null,n,c,l,a,y];l+=(l-n.xpos)*a/nt;break;case 3:l=(n.xpos+n.xneg)/2;break;case 2:var p=0,w=0,it=0,b=0;if(h>.1)return y=3,ei(n,t,i,r,u,e,o,s,h,c,l,a,v,y);switch(c++%4){case 0:p=n.xpos,p=n.ypos;break;case 2:p=n.xneg,w=n.yneg;break;default:case 3:case 1:p=(n.xpos+n.xneg)/2,g=d(p,w,t,i,r,u,e,o,s),w=g[1],v=g[0];if(!v)return[null,n,c,l,a,y];break}it=Math.abs(n.xpos-n.xneg)/1e6,k=ui(p,b,it,n,t,i,r,u,e,o,s),n=k[2],b=k[1],v=k[0];if(!v)return[null,n,c,l,a,y];if(b===0)return[null,n,c,l,a,y];l=p-1.01*w/b;if(l<n.xpos&&l<n.xneg||l>n.xpos&&l>n.xneg)return[null,n,c,l,a,y];break;default:break}return[!1,n,c,l,a,y]}function oe(n,t,i,r,u,e,o,s){var a,v,k=0,c,h,b,w,l,y,p;if(!n.havexpos||!n.havexneg)return[!1,n];for(v=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg)),a=0;a<108;a++){c=0,h=0,w=a%4==0?1:a%4==2?2:3,l=ei(n,t,i,r,u,e,o,s,v,k,c,h,b,w),n=l[1],k=l[2],c=l[3],h=l[4],w=l[5];if(l[0]){if(l[0])return[!0,n]}else continue;y=d(c,h,t,i,r,u,e,o,s),h=y[1],b=y[0];if(!b)continue;p=f(c,h,n),n=p[1];if(p[0])return[!0,n];v=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg));if(v<n.precision)return n.yneg<h&&(h=n.yneg,c=n.xneg),n.ypos<h&&(h=n.ypos,c=n.xpos),n.root=c,[!0,n]}return[!1,n]}function se(n){var s=t.Convert,g=t._Helper,o=s.toDateTime(n[0]),e=s.toDateTime(n[1]),h=s.toDouble(n[2]),v=s.toDouble(n[3]),y=s.toDouble(n[4]),u=s.toInt(n[5]),f=g._argumentExists(n,6)?s.toInt(n[6]):0,b,i,p,l,c;if(f<0||f>4||!(u===1||u===2||u===4)||r(o,e)>0)return t.Errors.Number;if(h<0||v<0||y<=0)return t.Errors.Number;b=tt(o,e,u);if(b>1){i={},l=.1,i.xmin=0,i.xmax=0,i.precision=0,i.havexpos=!1,i.xpos=0,i.ypos=0,i.havexneg=!1,i.xneg=0,i.yneg=0,i.root=0,i=ut(i),i.xmin=Math.max(i.xmin,0),i.xmax=Math.min(i.xmax,1e3),c=uo(i,o,e,h,v,y,u,f,l),i=c[1],p=c[0];if(!p){for(l=1e-10;l<i.xmax;l*=2)i=fo(i,o,e,h,v,y,u,f,l)[1];c=oe(i,o,e,h,v,y,u,f),i=c[1],p=c[0]}return p?i.root:t.Errors.Number}else{var k=lt(o,e,u,f),rt=vt(o,e,u,f),w=a(o,e,u,f),nt=u*w/rt,d=y/100+h/u-(v/100+k/w*h/u),it=v/100+k/w*h/u;return d/it*nt}}function he(n){var i=t.Convert,a=t._Helper,h=i.toDateTime(n[0]),c=i.toDateTime(n[1]),l=i.toDouble(n[2]),e=i.toDouble(n[3]),f=a._argumentExists(n,4)?i.toInt(n[4]):0,s,o;return f<0||f>4?t.Errors.Number:e<=0||l<=0||r(h,c)>=0?t.Errors.Number:(s=e/l-1,o=u._DateTimeHelper.yearfrac([h,c,f]),s/o)}function ue(n,t,i,r,f,e){var s=u._DateTimeHelper.yearfrac,l=s([i,t,e]),h=s([i,n,e]),c=s([n,t,e]),o=1+l*r;return o/=f/100+h*r,o--,o/=c}function fe(n){var i=t.Convert,s=t._Helper,o=i.toDateTime(n[0]),f=i.toDateTime(n[1]),h=i.toDateTime(n[2]),u=i.toDouble(n[3]),e=i.toDouble(n[4]),r=s._argumentExists(n,5)?i.toInt(n[5]):0;return r<0||r>4||u<0?t.Errors.Number:ue(o,f,h,u,e,r)}function b(n,t,i,r,u,f,e,o,s,h,c){return t=bt(i,r,u,f,e,n,s,h,c)-o,[!0,t]}function ii(n,t,i,r,u,f,e,o,s,h,c,l,a){var p,w,v,k=0,d=0,y;p=n-i,p<r.xmin&&(p=n),w=n+i,w>r.xmax&&(w=n);if(p===w)return[!1,t,r];y=b(p,k,u,f,e,o,s,h,c,l,a),k=y[1],v=y[0];if(!v)return[v,t,r];return y=b(w,d,u,f,e,o,s,h,c,l,a),d=y[1],v=y[0],v?(t=(d-k)/(w-p),[!0,t,r]):[v,t,r]}function ee(n,t,i,r,u,e,o,s,h,c,l){for(var v,tt=n.precision/2,w,nt,y,p,a,d,k,g=0;g<20;g++){y=0,p=0;if(l<n.xmin||l>n.xmax)return[!1,n];a=b(l,y,t,i,r,u,e,o,s,h,c),y=a[1],v=a[0];if(!v)return[v,n];a=f(l,y,n),n=a[1];if(a[0])return[!0,n];d=Math.abs(l)<1e-10?n.havexneg&&n.havexpos?Math.abs(n.xpos-n.xneg)/1e6:(n.xmax-n.xmin)/1e6:Math.abs(l)/1e6,k=ii(l,p,d,n,t,i,r,u,e,o,s,h,c),n=k[2],p=k[1],v=k[0];if(!v)return[v,n];if(p===0)return[!1,n];w=l-1.000001*y/p;if(w===l)return n.root=l,[!0,n];nt=Math.abs(w-l)/(Math.abs(l)+Math.abs(w)),l=w;if(nt<tt)return n.root=l,[!0,n]}return[!1,n]}function ce(n,t,i,r,u,e,o,s,h,c,l){var v,y=0,a;if(l<n.xmin||l>n.xmax)return[!1,n];a=b(l,y,t,i,r,u,e,o,s,h,c),y=a[1],v=a[0];if(!v)return[v,n];return a=f(l,y,n),n=a[1],a[0]?[!0,n]:[!1,n]}function ni(n,t,i,r,u,e,o,s,h,c,l,a,v,y,p,w){var rt,it,tt,nt;switch(w){case 0:v=n.xpos-n.ypos*((n.xneg-n.xpos)/(n.yneg-n.ypos));break;case 1:v=(n.xpos+n.xneg)/2,it=b(v,y,t,i,r,u,e,o,s,h,c),y=it[1],p=it[0];if(!p)return[null,n,a,v,y,w];if(y===0)return n=f(v,y,n)[1],[!0,n,a,v,y,w];rt=Math.sqrt(y*y-n.ypos*n.yneg);if(rt===0)return[null,n,a,v,y,w];v+=(v-n.xpos)*y/rt;break;case 3:v=(n.xpos+n.xneg)/2;break;case 2:var k=0,g=0,ut=0,d=0;if(l>.1)return w=3,ni(n,t,i,r,u,e,o,s,h,c,l,a,v,y,p,w);switch(a++%4){case 0:k=n.xpos,k=n.ypos;break;case 2:k=n.xneg,g=n.yneg;break;default:case 3:case 1:k=(n.xpos+n.xneg)/2,tt=b(k,g,t,i,r,u,e,o,s,h,c),g=tt[1],p=tt[0];if(!p)return[null,n,a,v,y,w];break}ut=Math.abs(n.xpos-n.xneg)/1e6,nt=ii(k,d,ut,n,t,i,r,u,e,o,s,h,c),n=nt[2],d=nt[1],p=nt[0];if(!p)return[null,n,a,v,y,w];if(d===0)return[null,n,a,v,y,w];v=k-1.01*g/d;if(v<n.xpos&&v<n.xneg||v>n.xpos&&v>n.xneg)return[null,n,a,v,y,w];break;default:break}return[!1,n,a,v,y,w]}function ye(n,t,i,r,u,e,o,s,h,c){var y,p,nt=0,v,l,g,d,a,w,k;if(!n.havexpos||!n.havexneg)return[!1,n];for(p=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg)),y=0;y<108;y++){v=0,l=0,d=y%4==0?1:y%4==2?2:3,a=ni(n,t,i,r,u,e,o,s,h,c,p,nt,v,l,g,d),n=a[1],nt=a[2],v=a[3],l=a[4],d=a[5];if(a[0]===undefined||a[0]===null)continue;else if(a[0])return[!0,n];w=b(v,l,t,i,r,u,e,o,s,h,c),l=w[1],g=w[0];if(!g)continue;k=f(v,l,n),n=k[1];if(k[0])return[!0,n];p=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg));if(p<n.precision)return n.yneg<l&&(l=n.yneg,v=n.xneg),n.ypos<l&&(l=n.ypos,v=n.xpos),n.root=v,[!0,n]}return[!1,n]}function pe(n){var u=t.Convert,b=t._Helper,h=u.toDateTime(n[0]),v=u.toDateTime(n[1]),a=u.toDateTime(n[2]),c=u.toDateTime(n[3]),y=u.toDouble(n[4]),w=u.toDouble(n[5]),p=u.toDouble(n[6]),f=u.toInt(n[7]),s=b._argumentExists(n,8)?u.toInt(n[8]):0,o=.1,i={},e,l;if(s<0||s>4||!(f===1||f===2||f===4)||r(a,h)>0||r(h,c)>0||r(c,v)>0)return t.Errors.Number;if(y<0||w<=0||p<=0)return t.Errors.Number;i.xmin=0,i.xmax=0,i.precision=0,i.havexpos=!1,i.xpos=0,i.ypos=0,i.havexneg=!1,i.xneg=0,i.yneg=0,i.root=0,i=ut(i),i.xmin=Math.max(i.xmin,0),i.xmax=Math.min(i.xmax,1e3),e=ee(i,h,v,a,c,y,w,p,f,s,o),i=e[1],l=e[0];if(l){for(o=1e-10;o<i.xmax;o*=2)i=ce(i,h,v,a,c,y,w,p,f,s,o)[1];e=ye(i,h,v,a,c,y,w,p,f,s),i=e[1],l=e[0]}return l?i.root:t.Errors.Number}function we(n,t,i,u,f,e,o,s){var c=new Date(i.getFullYear(),i.getMonth(),i.getDate()),a,v,l;do c.setMonth(c.getMonth()+12/o);while(r(c,t)<0);return a=h(i,n,c,o,s),v=h(i,t,c,o,s),l=h(n,t,c,o,s),(o*(e-f)+100*u*(v-a))/(l*f+100*u*a*l/o)}function le(n){var i=t.Convert,a=t._Helper,e=i.toDateTime(n[0]),c=i.toDateTime(n[1]),s=i.toDateTime(n[2]),l=i.toDouble(n[3]),h=i.toDouble(n[4]),o=i.toDouble(n[5]),u=i.toInt(n[6]),f=a._argumentExists(n,7)?i.toInt(n[7]):0;return f<0||f>4||!(u===1||u===2||u===4)||r(e,c)>0||r(s,e)>0?t.Errors.Number:l<0||h<0||o<=0?t.Errors.Number:we(e,c,s,l,h,o,u,f)}function ae(n){var u=t.Convert,c=u.toDateTime(n[0]),s=u.toDateTime(n[1]),o=u.toDouble(n[2]),f,h,i;if(r(c,s)>=0)return t.Errors.Number;if(o<=0)return t.Errors.Number;f=e(s)-e(c);if(f>365)return t.Errors.Number;h=365*o,i=360-o*f;if(i===0)return t.Errors.DivideByZero;else if(i<0)return t.Errors.Number;return u.toResult(h/i)}function ve(n){var f=t.Convert,o=f.toDateTime(n[0]),s=f.toDateTime(n[1]),i=f.toDouble(n[2]),u;if(r(o,s)>=0)return t.Errors.Number;if(i<=0)return t.Errors.Number;return u=e(s)-e(o),u>365?t.Errors.Number:(100-i)/i*(360/u)}function p(n,t,i){for(var e=i.length,f=0,u=1,o=1/(n+1),r=0;r<e;r++)f+=i[r]*u,u*=o;return t=f,[!0,t]}function cr(n,t,i){for(var e=i.length,f=0,u=1,o=1/(n+1),r=1;r<e;r++)f+=i[r]*-r*u,u*=o;return t=f,[!0,t]}function sr(n,t,i){for(var l=n.precision/2,s,c,u,e,o,r,h=0;h<20;h++){e=0,o=0;if(i<n.xmin||i>n.xmax)return[!1,n];r=p(i,e,t),e=r[1],u=r[0];if(!u)return[u,n];r=f(i,e,n),n=r[1];if(r[0])return[!0,n];r=cr(i,o,t),o=r[1],u=r[0];if(!u)return[u,n];if(o===0)return[!1,n];s=i-1.000001*e/o;if(s===i)return n.root=i,[!0,n];c=Math.abs(s-i)/(Math.abs(i)+Math.abs(s)),i=s;if(c<l)return n.root=i,[!0,n]}return[!1,n]}function dt(n,t,i){var u,e=0,r;if(i<n.xmin||i>n.xmax)return[!1,n];r=p(i,e,t),e=r[1],u=r[0];if(!u)return[u,n];return r=f(i,e,n),n=r[1],r[0]?[!0,n]:[!1,n]}function or(n,t,i,r,u){var o,s,f,h=0,c=0,e;o=n-i,o<r.xmin&&(o=n),s=n+i,s>r.xmax&&(s=n);if(o===s)return[!1,t,r];e=p(o,h,u),h=e[1],f=e[0];if(!f)return[f,t,r];return e=p(s,c,u),c=e[1],f=e[0],f?(t=(c-h)/(s-o),[!0,t,r]):[f,t,r]}function ti(n,t,i,r,u,e,o,s){var w,y,h,b,l,c,v,a;switch(s){case 0:u=n.xpos-n.ypos*((n.xneg-n.xpos)/(n.yneg-n.ypos));break;case 1:u=(n.xpos+n.xneg)/2,y=p(u,e,t),e=y[1],o=y[0];if(!o)return[null,n,r,u,e,s];if(e===0)return n=f(u,e,n)[1],[!0,n,r,u,e,s];w=Math.sqrt(e*e-n.ypos*n.yneg);if(w===0)return[null,n,r,u,e,s];u+=(u-n.xpos)*e/w;break;case 3:u=(n.xpos+n.xneg)/2;break;case 2:l=0,c=0;if(i>.1)return s=3,ti(n,t,i,r,u,e,o,s);switch(r++%4){case 0:h=n.xpos,h=n.ypos;break;case 2:h=n.xneg,l=n.yneg;break;default:case 3:case 1:h=(n.xpos+n.xneg)/2,v=p(h,l,t),l=v[1],o=v[0];if(!o)return[null,n,r,u,e,s];break}b=Math.abs(n.xpos-n.xneg)/1e6,a=or(h,c,b,n,t),n=a[2],c=a[1],o=a[0];if(!o)return[null,n,r,u,e,s];if(c===0)return[null,n,r,u,e,s];u=h-1.01*l/c;if(u<n.xpos&&u<n.xneg||u>n.xpos&&u>n.xneg)return[null,n,r,u,e,s];break;default:return[!1,n,r,u,e,s]}return[!1,n,r,u,e,s]}function pr(n,t){var o,h,l=0,u,i,c,s,r,e;if(!n.havexpos||!n.havexneg)return[!1,n];for(h=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg)),o=0;o<160;o++){i=0,s=0,s=o%4==0?1:o%4==2?2:3,r=ti(n,t,h,l,u,i,c,s),n=r[1],l=r[2],u=r[3],i=r[4],s=r[5];if(r[0]){if(r[0])return[!0,n]}else continue;e=p(u,i,t),i=e[1],c=e[0];if(!c)continue;e=f(u,i,n),n=e[1];if(e[0])return[!0,n];h=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg));if(h<n.precision)return n.yneg<i&&(i=n.yneg,u=n.xneg),n.ypos<i&&(i=n.ypos,u=n.xpos),n.root=u,[!0,n]}return[!1,n]}function vr(n){var i={},s,b,r,p,w,o,e,a,u,l,f;i.xmin=0,i.xmax=0,i.precision=0,i.havexpos=!1,i.xpos=0,i.ypos=0,i.havexneg=!1,i.xneg=0,i.yneg=0,i.root=0,i=ut(i);var v=n[0],c=t.Convert,k=t._Helper,y=t._ArrayHelper,h=k._argumentExists(n,1)?c.toDouble(n[1]):.1;Math.abs(h)>1&&(h=.1),s=y.getLength(v);if(!y.isArrayOrReference(v)||s<2)return t.Errors.Number;for(b=179769e303,r=new Array(s),i.xmin=-1,i.xmax=Math.min(i.xmax,Math.pow(b/1e10,1/s)-1),p=!1,w=!1,o=0;o<s;o++){e=y.getValueByIndex(v,o);if(c.isNumber(e))a=c.toDouble(e),r[o]=a,a>0&&(p=!0),a<0&&(w=!0);else if(c.isError(e))return e}if(!p||!w)return t.Errors.Number;u=sr(i,r,h),i=u[1],l=u[0];if(!l){for(f=2;!(i.havexneg&&i.havexpos)&&f<100;f*=2)i=dt(i,r,h*f)[1],i=dt(i,r,h/f)[1];u=pr(i,r),i=u[1],l=u[0]}return l?i.root:t.Errors.Number}function fr(n){var f=t.Convert,h=t._ArrayHelper,d=f.toDouble(n[1]),o=f.toDouble(n[2]),v=0,y=0,e=0,a=0,l=0,k=h.getLength(n[0]),w=new Array(k),b,r,u,c,i,s,p;if(!h.isArrayOrReference(n[0]))return t.Errors.DivideByZero;for(b=h.getLength(n[0]),r=0;r<b;r++){u=h.getValueByIndex(n[0],r);if(f.isNumber(u))c=f.toDouble(u),w[r]=c,c<0?y++:v++;else if(f.isError(u))return u}for(e=y+v,i=0;i<e;i++)s=w[i],s<0?l+=s/Math.pow(1+d,i):a+=s/Math.pow(1+o,i);return l===0||a===0||o<=-1?t.Errors.DivideByZero:p=Math.pow(-a*Math.pow(1+o,e)/(l*(1+o)),1/(e-1))-1}function k(n,t,i,r){for(var f=0,h=r.length,s,o=0;o<h;o++){s=e(i[o])-e(i[0]);if(s<0)return[!1,t];f+=r[o]/u._MathHelper.pow1p(n,s/365)}return isFinite(f)?t=isNaN(f)?494065645841247e-338:f:f===Number.POSITIVE_INFINITY?t=179769e303:f===Number.NEGATIVE_INFINITY&&(t=-179769e303),[!0,t]}function hi(n,t,i,r,u,f){var s,h,e,c=0,l=0,o;s=n-i,s<r.xmin&&(s=n),h=n+i,h>r.xmax&&(h=n);if(s===h)return[!1,t,r];o=k(s,c,u,f),c=o[1],e=o[0];if(!e)return[e,t,r];return o=k(h,l,u,f),l=o[1],e=o[0],e?(t=(l-c)/(h-s),[!0,t,r]):[e,t,r]}function nr(n,t,i,r){for(var u,y=n.precision/2,h,l,a=0;a<20;a++){var o,v,c=0,s=0,e=k(r,c,t,i);c=e[1],u=e[0];if(!u)return[u,n];e=f(r,c,n),n=e[1];if(e[0])return[!0,n];h=Math.abs(r)<1e-10?n.havexneg&&n.havexpos?Math.abs(n.xpos-n.xneg)/1e6:(n.xmax-n.xmin)/1e6:Math.abs(r)/1e6,l=hi(r,s,h,n,t,i),u=l[0],s=l[1],n=l[2];if(!u)return[u,n];if(s===0)return[!1,n];o=r-1.000001*c/s;if(o===r)return n.root=r,[!0,n];v=Math.abs(o-r)/(Math.abs(r)+Math.abs(o)),r=o;if(v<y)return n.root=r,[!0,n]}return[!1,n]}function fi(n,t,i,r,u){var o,s=0,e;if(t<n.xmin||t>n.xmax)return[!1,n,i];e=k(t,i,r,u),i=e[1],o=e[0];if(!o)return[o,n,i];return e=f(t,s,n),n=e[1],e[0]?[!0,n,i]:[!1,n,i]}function ri(n,t,i,r,u,e,o,s,h){var p,w,y,a;switch(h){case 0:e=n.xpos-n.ypos*((n.xneg-n.xpos)/(n.yneg-n.ypos));break;case 1:e=(n.xpos+n.xneg)/2,w=k(e,o,t,i),o=w[1],s=w[0];if(!s)return[null,n,u,e,o,h];if(o===0)return n=f(e,o,n)[1],[!0,n,u,e,o,h];p=Math.sqrt(o*o-n.ypos*n.yneg);if(p===0)return[null,n,u,e,o,h];e+=(e-n.xpos)*o/p;break;case 3:e=(n.xpos+n.xneg)/2;break;case 2:var c=0,v=0,b=0,l=0;if(r>.1)return h=3,ri(n,t,i,r,u,e,o,s,h);switch(u++%4){case 0:c=n.xpos,c=n.ypos;break;case 2:c=n.xneg,v=n.yneg;break;default:case 3:case 1:c=(n.xpos+n.xneg)/2,y=k(c,v,t,i),v=y[1],s=y[0];if(!s)return[null,n,u,e,o,h];break}b=Math.abs(n.xpos-n.xneg)/1e6,a=hi(c,l,b,n,t,i),n=a[2],l=a[1],s=a[0];if(!s)return[null,n,u,e,o,h];if(l===0)return[null,n,u,e,o,h];e=c-1.01*v/l;if(e<n.xpos&&e<n.xneg||e>n.xpos&&e>n.xneg)return[null,n,u,e,o,h];break;default:break}return[!1,n,u,e,o,h]}function tr(n,t,i){var s,h,a=0,u,r,l,c,e,o;if(!n.havexpos||!n.havexneg)return[!1,n];for(h=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg)),s=0;s<108;s++){u=0,r=0,c=s%4==0?1:s%4==2?2:3,e=ri(n,t,i,h,a,u,r,l,c),n=e[1],a=e[2],u=e[3],r=e[4],c=e[5];if(e[0]){if(e[0])return[!0,n]}else continue;o=k(u,r,t,i),r=o[1],l=o[0];if(!l)continue;o=f(u,r,n),n=o[1];if(o[0])return[!0,n];h=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg));if(h<n.precision)return n.yneg<r&&(r=n.yneg,u=n.xneg),n.ypos<r&&(r=n.ypos,u=n.xpos),n.root=u,[!0,n]}return[!1,n]}function rr(n){var c=t._ArrayHelper.getLength(n[0]),a=t._ArrayHelper.getLength(n[1]),o=new Array(c),s=new Array(a),l=t._Helper._argumentExists(n,2)?t.Convert.toDouble(n[2]):.1,r,i,v,u,p,h;if(c!==a)return t.Errors.Number;for(r=0;r<c;r++)o[r]=t.Convert.toDouble(t._ArrayHelper.getValueByIndex(n[0],r));for(r=0;r<a;r++)s[r]=t.Convert.toDateTime(t._ArrayHelper.getValueByIndex(n[1],r));i={},i.xmin=0,i.xmax=0,i.precision=0,i.havexpos=!1,i.xpos=0,i.ypos=0,i.havexneg=!1,i.xneg=0,i.yneg=0,i.root=0,i=ut(i),i.xmin=-1,i.xmax=Math.min(1e3,i.xmax),v=nr(i,s,o,l),i=v[1];if(v[0])return i.root;else{for(u=1;u<=1024;u+=u){var y=t.Convert.toDouble(u),f=9/(y+9),e=fi(i,l,f,s,o);i=e[1],f=e[2],f=y,e=fi(i,l,f,s,o),i=e[1],f=e[2],h=tr(i,s,o),i=h[1],p=h[0];if(p)return i.root}return t.Errors.Number}}function wr(n,i,r,f,e,o,s){var a,c,h,y,l,v,p;l=1/o,c=l<3?1:l<5?1.5:l>6?2.5:2,o*=c,v=u._DateTimeHelper.yearfrac([i,r,s]);if(t.Convert.isError(v))return 0;for(p=v,h=Math.floor(p*o*n+.5),n-=h,y=n-f,a=0;a<e;a++){h=Math.floor(o*n+.5),y-=h;if(y<0)switch(e-a){case 0:case 1:return Math.floor(n*.5+.5);default:return 0}n-=h}return h}function cu(n){var h=t.Convert.toDouble(n[0]),e=t.Convert.toDateTime(n[1]),o=t.Convert.toDateTime(n[2]),s=t.Convert.toDouble(n[3]),c=t.Convert.toInt(n[4]),f=t.Convert.toDouble(n[5]),u=t._Helper._argumentExists(n,6)?t.Convert.toInt(n[6]):0,i=1/f;return i>0&&i<1||i>1&&i<2||i>2&&i<3||i>4&&i<5?t.Errors.Number:r(e,o)>0?t.Errors.Number:u<0||u>4||f<=0||u===2?t.Errors.Number:wr(h,e,o,s,c,f,u)}function lu(n,i,r,f,e,o,s){var c=n*o,p=n-f,y=u._DateTimeHelper.yearfrac([i,r,s]);if(t.Convert.isError(y))return 0;var w=y,l=w*o*n,v=(n-f-l)/c,a=t.Convert.toInt((n-f-l)/c),h;return h=e===0?l:e>a?e===a+1?p-c*a-l:0:c*(v<1?v:1)}function hu(n){var s=t.Convert.toDouble(n[0]),e=t.Convert.toDateTime(n[1]),u=t.Convert.toDateTime(n[2]),o=t.Convert.toDouble(n[3]),h=t.Convert.toInt(n[4]),f=t.Convert.toDouble(n[5]),i=t._Helper._argumentExists(n,6)?t.Convert.toInt(n[6]):0;return r(e,u)>0?t.Errors.Number:i<0||i>4||f<=0||i===2?t.Errors.Number:lu(s,e,u,o,h,f,i)}function ou(n){var i=t.Convert.toDouble(n[0]),l=t.Convert.toDouble(n[1]),o=t.Convert.toInt(n[2]),c=t.Convert.toInt(n[3]),r=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):12,a=o+(r<12?1:0),e;if(i<0||o<1||c<1||a<c||r<1||12<r)return t.Errors.Number;if(i===0)return 0;var h=u._MathHelper.round(1-Math.pow(l/i,1/o),3),s=0,f=0;for(e=1;e<=c;e++)f=e===1?i*h*r/12:e===o+1?(i-s)*h*(12-r)/12:(i-s)*h,s+=f;return f}function su(n){var r=t.Convert.toDouble(n[0]),s=t.Convert.toDouble(n[1]),e=t.Convert.toInt(n[2]),o=t.Convert.toInt(n[3]),h=t._Helper._argumentExists(n,4)?t.Convert.toDouble(n[4]):2,u=0,i=0,f;if(e<=0||r<0)return t.Errors.Number;if(e<o)return t.Errors.Number;if(h<=0)return t.Errors.Number;if(o<=0)return t.Errors.Number;if(r<=s)return 0;for(f=1;f<=o;f++)i=(r-u)*(h/e),i=Math.min(i,r-u-s),u+=i;return i}function au(n){var r=t.Convert.toDouble(n[0]),u=t.Convert.toDouble(n[1]),i=t.Convert.toInt(n[2]);return i===0?t.Errors.DivideByZero:(r-u)/i}function wu(n){var f=t.Convert.toDouble(n[0]),u=t.Convert.toDouble(n[1]),i=t.Convert.toInt(n[2]),r=t.Convert.toInt(n[3]);return u<0||i<1||r<=0||r>i?t.Errors.Number:(f-u)*(i-r+1)*2/(i*(i+1))}function ci(n,t,i,r,u){var o,e,f,s;return e=u/i,e<1?f=n*Math.pow(1-e,r-1):(e=1,f=r===1?n:0),s=n*Math.pow(1-e,r),o=s<t?f-t:f-s,o<0&&(o=0),o}function oi(n,i,r,u,f,e){for(var y=0,a=Math.ceil(f),v=t.Convert.toInt(a),s,p=n-i,l=!1,c,h=0,o=1;o<=v;o++)l?s=h:(c=ci(n,i,r,o,e),h=p/(u-(o-1)),h>c?(s=h,l=!0):(s=c,p-=c)),o===v&&(s*=f+1-a),y+=s;return y}function vu(n,i,r,u,f,e,o){var c,p=Math.floor(u),y=Math.ceil(f),s,w=t.Convert.toInt(p),v=t.Convert.toInt(y),h,l,a;c=0;if(o)for(s=w+1;s<=v;s++)h=ci(n,i,r,s,e),s===w+1?h*=Math.min(f,p+1)-u:s===v&&(h*=f+1-y),c+=h;else l=r,u!==Math.floor(u)&&e>1&&(u<r/2||(a=u-r/2,u=r/2,f-=a,l+=1)),n-=oi(n,i,r,l,u,e),c=oi(n,i,r,r-u,f-u,e);return c}function yu(n){var u=t.Convert.toDouble(n[0]),f=t.Convert.toDouble(n[1]),e=t.Convert.toInt(n[2]),r=t.Convert.toDouble(n[3]),i=t.Convert.toDouble(n[4]),s=t._Helper._argumentExists(n,5)?t.Convert.toDouble(n[5]):2,o=t._Helper._argumentExists(n,6)?t.Convert.toBool(n[6]):!1;return u<0||f<0||e<0||r<0||i<0||i<r?t.Errors.Number:u<f&&r===0&&i===1?u-f:vu(u,f,e,r,i,s,o)}function gr(n){var e=t.Convert.toDateTime(n[0]),p=t.Convert.toDateTime(n[1]),l=t.Convert.toDateTime(n[2]),y=t.Convert.toDouble(n[3]),a=t._Helper._argumentExists(n,4)?t.Convert.toDouble(n[4]):1e3,i=t.Convert.toInt(n[5]),u=t._Helper._argumentExists(n,6)?t.Convert.toInt(n[6]):0,w=t._Helper._argumentExists(n,7)?t.Convert.toBool(n[7]):!0,f,o,s,h;if(y<=0||a<=0)return t.Errors.Number;if(u<0||4<u)return t.Errors.Number;if(!(i===1||i===2||i===4))return t.Errors.Number;if(r(e,l)>=0)return t.Errors.Number;return f=c(e,l,u),o=v(e,u),f<0||o<=0?t.Errors.Number:(s=a*y/t.Convert.toDouble(i),h=f/o,s*t.Convert.toDouble(i)*h)}function nu(n){var e=t.Convert.toDateTime(n[0]),h=t.Convert.toDateTime(n[1]),o=t.Convert.toDouble(n[2]),s=t._Helper._argumentExists(n,3)?t.Convert.toDouble(n[3]):1e3,i=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):0,u,f;if(o<=0||s<=0||i<0||4<i)return t.Errors.Number;if(r(e,h)>0)return t.Errors.Number;return u=c(e,h,i),f=v(e,i),u<0||f<=0?t.Errors.Number:s*o*u/f}function dr(n){var e=t.Convert.toDateTime(n[0]),h=t.Convert.toDateTime(n[1]),s=t.Convert.toDouble(n[2]),u=t.Convert.toDouble(n[3]),i=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):0,f,o;if(r(e,h)>=0)return t.Errors.Number;if(s<=0||u<=0||i<0||4<i)return t.Errors.Number;return o=v(e,i),f=c(e,h,i),f<=0||o<=0?t.Errors.Number:(u-s)/u*(o/f)}function br(n){var r=t.Convert.toDouble(n[0]),i=t.Convert.toInt(n[1]);return r<=0||i<1?t.Errors.Number:Math.pow(1+r/i,i)-1}function hr(n){var e=t.Convert.toDateTime(n[0]),h=t.Convert.toDateTime(n[1]),o=t.Convert.toDouble(n[2]),s=t.Convert.toDouble(n[3]),i=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):0,f,u;if(r(e,h)>=0)return t.Errors.Number;if(o<=0||s<=0||i<0||4<i)return t.Errors.Number;return f=c(e,h,i),u=v(e,i),f<=0||u<=0?t.Errors.Number:(s-o)/o*(u/f)}function tu(n){var r=t.Convert.toDouble(n[0]),i=t.Convert.toInt(n[1]);return r<=0||i<1?t.Errors.Number:i*(Math.pow(1+r,1/i)-1)}function g(n,t,i){if(n>-1&&n!==0){var r=i,f=Math.pow(1+n,r.nper),u=(Math.pow(1+n,r.nper)-1)/n;return t=r.pv*f+r.pmt*(1+n*r.type)*u+r.fv,[!0,t,i]}else return[!1,t,i]}function fu(n,t,i){if(n>-1&&n!==0){var r=i,f=Math.pow(1+n,r.nper-1),u=(Math.pow(1+n,r.nper)-1)/n;return t=-r.pmt*u/n+f*r.nper*(r.pv+r.pmt*(r.type+1/n)),[!0,t,i]}else return[!1,t,i]}function eu(n,t,i){for(var a=n.precision/2,s,l,u,o,e,r,c,h=0;h<100;h++){o=0,e=0;if(i<n.xmin||i>n.xmax)return[!1,n,t];r=g(i,o,t),t=r[2],o=r[1],u=r[0];if(!u)return[u,n,t];c=f(i,o,n),n=c[1];if(c[0])return[!0,n,t];r=fu(i,e,t),t=r[2],e=r[1],u=r[0];if(!u)return[u,n,t];if(e===0)return[!1,n,t];s=i-1.000001*o/e;if(s===i)return n.root=i,[!0,n,t];l=Math.abs(s-i)/(Math.abs(i)+Math.abs(s)),i=s;if(l<a)return n.root=i,[!0,n,t]}return[!1,n,t]}function pt(n,t,i){var e,o=0,r,u;if(i<n.xmin||i>n.xmax)return[!1,n,t];r=g(i,o,t),t=r[2],o=r[1],e=r[0];if(!e)return[e,n,t];return u=f(i,o,n),n=u[1],u[0]?[!0,n,t]:[!1,n,t]}function iu(n,t,i,r,u){var e,s,o,h=0,c=0,f;e=n-i,e<r.xmin&&(e=n),s=n+i,s>r.xmax&&(s=n);if(e===s)return[!1,t,r,u];f=g(e,h,u),u=f[2],h=f[1],o=f[0];if(!o)return[o,t,r,u];return f=g(s,c,u),u=f[2],c=f[1],o=f[0],o?(t=(c-h)/(s-e),[!0,t,r,u]):[o,t,r,u]}function kt(n,t,i,r,u,e,o,s){var y,h,c,p,l,a,v;switch(s){case 0:u=n.xpos-n.ypos*((n.xneg-n.xpos)/(n.yneg-n.ypos));break;case 1:u=(n.xpos+n.xneg)/2,h=g(u,e,t),t=h[2],e=h[1],o=h[0];if(!o)return[null,n,t,r,u,e,s];if(e===0)return n=f(u,e,n)[1],[!0,n,t,r,u,e,s];y=Math.sqrt(e*e-n.ypos*n.yneg);if(y===0)return[null,n,t,r,u,e,s];u+=(u-n.xpos)*e/y;break;case 3:u=(n.xpos+n.xneg)/2;break;case 2:l=0,a=0;if(i>.1)return s=3,kt(n,t,i,r,u,e,o,s);switch(r++%4){case 0:c=n.xpos,c=n.ypos;break;case 2:c=n.xneg,l=n.yneg;break;default:case 3:case 1:c=(n.xpos+n.xneg)/2,h=g(c,l,t),t=h[2],l=h[1],o=h[0];if(!o)return[null,n,t,r,u,e,s];break}p=Math.abs(n.xpos-n.xneg)/1e6,v=iu(c,a,p,n,t),t=v[3],n=v[2],a=v[1],o=v[0];if(!o)return[null,n,t,r,u,e,s];if(a===0)return[null,n,t,r,u,e,s];u=c-1.01*l/a;if(u<n.xpos&&u<n.xneg||u>n.xpos&&u>n.xneg)return[null,n,t,r,u,e,s];break;default:return[!1,n,t,r,u,e,s]}return[!1,n,t,r,u,e,s]}function ru(n,t){var e,h,a=0,u,i,c,o,r,s,l;if(!n.havexpos||!n.havexneg)return[!1,n,t];for(h=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg)),e=0;e<160;e++){i=0,o=0,o=e%4==0?1:e%4==2?2:3,r=kt(n,t,h,a,u,i,c,o),n=r[1],t=r[2],a=r[3],u=r[4],i=r[5],o=r[6];if(r[0]){if(r[0])return[!0,n,t]}else continue;s=g(u,i,t),t=s[2],i=s[1],c=s[0];if(!c)continue;l=f(u,i,n),n=l[1];if(l[0])return[!0,n,t];h=Math.abs(n.xpos-n.xneg)/(Math.abs(n.xpos)+Math.abs(n.xneg));if(h<n.precision)return n.yneg<i&&(i=n.yneg,u=n.xneg),n.ypos<i&&(i=n.ypos,u=n.xpos),n.root=u,[!0,n,t]}return[!1,n,t]}function uu(n){var i={},s=t.Convert.toDouble(n[0]),a=t.Convert.toDouble(n[1]),l=t.Convert.toDouble(n[2]),c=t._Helper._argumentExists(n,3)?t.Convert.toDouble(n[3]):0,o=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):0,h=t._Helper._argumentExists(n,5)?t.Convert.toDouble(n[5]):.1,r,u,e,f;if(s<=0)return t.Errors.Number;if(o<0)return t.Errors.Value;o>1&&(o=1),i.xmin=0,i.xmax=0,i.precision=0,i.havexpos=!1,i.xpos=0,i.ypos=0,i.havexneg=!1,i.xneg=0,i.yneg=0,i.root=0,i=ut(i),i.xmin=Math.max(i.xmin,-Math.pow(17976931348623157e292/1e10,1/s)+1),i.xmax=Math.min(i.xmax,Math.pow(17976931348623157e292/1e10,1/s)-1),r={},r.nper=s,r.pmt=a,r.pv=l,r.fv=c,r.type=t.Convert.toInt(o),u=eu(i,r,h),r=u[2],i=u[1],e=u[0];if(!e){for(f=2;!(i.havexneg&&i.havexpos)&&f<100;f*=2)u=pt(i,r,h*f),r=u[2],i=u[1],u=pt(i,r,h/f),r=u[2],i=u[1];u=ru(i,r),r=u[2],i=u[1],e=u[0]}return e?i.root:t.Errors.Number}function kr(n){var r=t.Convert.toDouble(n[0]),i=t.Convert.toInt(n[1]);if(i===0)return t.Errors.DivideByZero;if(i<0)return t.Errors.Number;var f=r<0?Math.ceil(r):Math.floor(r),o=r-f,e=Math.pow(10,Math.ceil(u._MathHelper.log10(i)));return t.Convert.toResult(f+o*e/i)}function bu(n){var r=t.Convert.toDouble(n[0]),i=t.Convert.toInt(n[1]);if(i===0)return t.Errors.DivideByZero;if(i<0)return t.Errors.Number;var f=r<0?Math.ceil(r):Math.floor(r),o=r-f,e=Math.pow(10,Math.ceil(u._MathHelper.log10(i)));return t.Convert.toResult(f+o*i/e)}function ur(n){var f=t.Convert.toDateTime(n[0]),s=t.Convert.toDateTime(n[1]),e=t.Convert.toDouble(n[2]),h=t.Convert.toDouble(n[3]),o=t.Convert.toDouble(n[4]),i=t.Convert.toInt(n[5]),u=t._Helper._argumentExists(n,6)?t.Convert.toInt(n[6]):0;return h<0||e<0||o===0?t.Errors.Number:u<0||u>4?t.Errors.Number:i!==1&&i!==2&&i!==4?t.Errors.Number:r(f,s)>0?t.Errors.Number:bi(f,s,e,h,o,i,u)}function ir(n){var e=t.Convert.toDateTime(n[0]),h=t.Convert.toDateTime(n[1]),s=t.Convert.toDouble(n[2]),u=t.Convert.toDouble(n[3]),i=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):0,f,o;if(r(e,h)>=0)return t.Errors.Number;if(s<=0||u<=0||i<0||4<i)return t.Errors.Number;return f=c(e,h,i),o=v(e,i),f<=0||o<=0?t.Errors.Number:u-s*u*f/o}function di(n){var f=t.Convert.toDateTime(n[0]),h=t.Convert.toDateTime(n[1]),p=t.Convert.toDateTime(n[2]),l=t.Convert.toDouble(n[3]),y=t.Convert.toDouble(n[4]),i=t._Helper._argumentExists(n,5)?t.Convert.toInt(n[5]):0,o,u,e,s,a;if(r(f,h)>=0)return t.Errors.Number;if(l<0||y<0||i<0||4<i)return t.Errors.Number;e=c(f,h,i),s=c(p,h,i),o=c(p,f,i),u=v(f,i);if(o<=0||u<=0||e<=0||s<=0)return t.Errors.Number;return a=1+e/u*y,a===0?t.Errors.Number:(100+s/u*l*100)/a-o/u*l*100}function ar(n){var e=t.Convert.toDateTime(n[0]),o=t.Convert.toDateTime(n[1]),s=t.Convert.toDateTime(n[2]),u=t.Convert.toDateTime(n[3]),c=t.Convert.toDouble(n[4]),l=t.Convert.toDouble(n[5]),h=t.Convert.toDouble(n[6]),i=t.Convert.toInt(n[7]),f=t._Helper._argumentExists(n,8)?t.Convert.toInt(n[8]):0;return f<0||f>4||!(i===1||i===2||i===4)||r(s,e)>0||r(e,u)>0||r(u,o)>0?t.Errors.Number:c<0||l<0||h<=0?t.Errors.Number:bt(e,o,s,u,c,l,h,i,f)}function lr(n,t,i,u,f,e,o,s){var c=new Date(i.getFullYear(),i.getMonth(),i.getDate()),a,v,l;do c.setMonth(c.getMonth()+12/o);while(r(c,t)<0);return a=h(i,n,c,o,s),v=h(i,t,c,o,s),l=h(n,t,c,o,s),(e*o+100*u*(v-a*(1+f*l/o)))/(f*l+o)}function er(n){var f=t.Convert.toDateTime(n[0]),h=t.Convert.toDateTime(n[1]),s=t.Convert.toDateTime(n[2]),o=t.Convert.toDouble(n[3]),c=t.Convert.toDouble(n[4]),e=t.Convert.toDouble(n[5]),i=t.Convert.toInt(n[6]),u=t._Helper._argumentExists(n,7)?t.Convert.toInt(n[7]):0;return u<0||u>4||!(i===1||i===2||i===4)||r(f,h)>0||r(s,f)>0?t.Errors.Number:o<0||c<0||e<=0?t.Errors.Number:lr(f,h,s,o,c,e,i,u)}function yr(n){var o=t.Convert.toDateTime(n[0]),u=t.Convert.toDateTime(n[1]),f=t.Convert.toDouble(n[2]),i;if(r(o,u)>=0)return t.Errors.Number;if(f<=0)return t.Errors.Number;return i=e(u)-e(o),i>365?t.Errors.Number:100*(1-f*i/360)}function gi(n){var r=t.Convert.toString(n[0]),i=at(r,2);return i<0?t.Errors.Number:i}function pu(n){var l=t.Convert.toDouble(n[0]),s=t.Convert.toString(n[1]),h=t.Convert.toString(n[2]),c=t._Helper._argumentExists(n,3)?t.Convert.toBool(n[3]):!1,r=t._Helper._argumentExists(n,4)?t.Convert.toInt(n[4]):3,e=0;if(r<3)return t.Errors.Value;c||(e=nf(h)),t._Helper._argumentExists(n,4)||(r=gf(s));var i=0,f=at(s,r),o=at(h,r);if(f<0||o<0)return t.Errors.Value;else i=l*o/f;return c||(i=u._MathHelper.round(i,e)),i}var ot="undefined",l=n.GrapeCity,rt,t,u,i;typeof l===ot&&(n.GrapeCity=l={}),rt=l,typeof rt.Calc===ot&&(rt.Calc={}),t=rt.Calc,typeof t.Functions===ot&&(t.Functions={}),u=t.Functions,u._builtInFunctions=u._builtInFunctions||{},typeof u._defineBuildInFunction===ot&&(u._defineBuildInFunction=function(n,t,i){var r,f;if(!n)throw"Invalid function name";n=n.toUpperCase();if(u._builtInFunctions.hasOwnProperty(n)){r=u._builtInFunctions[n];if(r){if(!i||!i.override)throw"Attempt to override function while override is not allowed";}else u._builtInFunctions[n]=new u.Function(n,0,255),r=u[n.toUpperCase()]}else r=new u.Function(n,0,255),u._builtInFunctions[n]=r;t&&typeof t=="function"&&(r.evaluate=t);if(i)for(f in i)i.hasOwnProperty(f)&&f!=="override"&&(r[f]=i[f]);return r}),i=u._defineBuildInFunction,u._FinancialHelper={days_between_basis:o,annual_year_basis:v},i("FV",tf,{minArgs:3,maxArgs:5,acceptsMissingArgument:it}),i("FVSCHEDULE",rf,{minArgs:2,maxArgs:2,acceptsArray:yt,acceptsReference:yt}),i("NPV",ku,{minArgs:2,acceptsArray:gt,acceptsReference:gt}),i("PV",du,{minArgs:3,maxArgs:5,acceptsMissingArgument:it}),i("RECEIVED",gu,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("XNPV",uf,{minArgs:3,maxArgs:3,acceptsArray:si,acceptsReference:si}),i("CUMIPMT",hf,{minArgs:6,maxArgs:6}),i("CUMPRINC",ff,{minArgs:6,maxArgs:6}),i("IPMT",ef,{minArgs:4,maxArgs:6,acceptsMissingArgument:wt}),i("ISPMT",of,{minArgs:4,maxArgs:4}),i("PMT",re,{minArgs:3,maxArgs:5,acceptsMissingArgument:it}),i("PPMT",ge,{minArgs:4,maxArgs:6,acceptsMissingArgument:wt}),i("COUPDAYBS",no,{minArgs:3,maxArgs:4,acceptsMissingArgument:nt}),i("COUPDAYS",to,{minArgs:3,maxArgs:4,acceptsMissingArgument:nt}),i("COUPDAYSNC",be,{minArgs:3,maxArgs:4,acceptsMissingArgument:nt}),i("COUPNCD",ke,{minArgs:3,maxArgs:4,acceptsMissingArgument:nt}),i("COUPNUM",de,{minArgs:3,maxArgs:4,acceptsMissingArgument:nt}),i("COUPPCD",io,{minArgs:3,maxArgs:4,acceptsMissingArgument:nt}),i("DURATION",eo,{minArgs:5,maxArgs:6,acceptsMissingArgument:ht}),i("MDURATION",so,{minArgs:5,maxArgs:6,acceptsMissingArgument:ht}),i("NPER",ro,{minArgs:3,maxArgs:5,acceptsMissingArgument:it}),i("YIELD",se,{minArgs:6,maxArgs:7,acceptsMissingArgument:st}),i("YIELDDISC",he,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("YIELDMAT",fe,{minArgs:5,maxArgs:6,acceptsMissingArgument:ht}),i("ODDFYIELD",pe,{minArgs:8,maxArgs:9,acceptsMissingArgument:ki}),i("ODDLYIELD",le,{minArgs:7,maxArgs:8,acceptsMissingArgument:li}),i("TBILLEQ",ae,{minArgs:3,maxArgs:3}),i("TBILLYIELD",ve,{minArgs:3,maxArgs:3}),i("IRR",vr,{minArgs:1,maxArgs:2,acceptsMissingArgument:yt,acceptsArray:et,acceptsReference:et}),i("MIRR",fr,{minArgs:3,maxArgs:3,acceptsArray:et,acceptsReference:et}),i("XIRR",rr,{minArgs:2,maxArgs:3,acceptsMissingArgument:yf,acceptsArray:vi,acceptsReference:vi}),i("AMORDEGRC",cu,{minArgs:6,maxArgs:7,acceptsMissingArgument:st}),i("AMORLINC",hu,{minArgs:6,maxArgs:7,acceptsMissingArgument:st}),i("DB",ou,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("DDB",su,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("SLN",au,{minArgs:3,maxArgs:3}),i("SYD",wu,{minArgs:4,maxArgs:4}),i("VDB",yu,{minArgs:5,maxArgs:7,acceptsMissingArgument:pf}),i("ACCRINT",gr,{minArgs:6,maxArgs:8,acceptsMissingArgument:wf}),i("ACCRINTM",nu,{minArgs:3,maxArgs:5,acceptsMissingArgument:it}),i("DISC",dr,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("EFFECT",br,{minArgs:2,maxArgs:2}),i("INTRATE",hr,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("NOMINAL",tu,{minArgs:2,maxArgs:2}),i("RATE",uu,{minArgs:3,maxArgs:6,acceptsMissingArgument:lf}),i("DOLLARDE",kr,{minArgs:2,maxArgs:2}),i("DOLLARFR",bu,{minArgs:2,maxArgs:2}),i("PRICE",ur,{minArgs:6,maxArgs:7,acceptsMissingArgument:st}),i("PRICEDISC",ir,{minArgs:4,maxArgs:5,acceptsMissingArgument:w}),i("PRICEMAT",di,{minArgs:5,maxArgs:6,acceptsMissingArgument:ht}),i("ODDFPRICE",ar,{minArgs:8,maxArgs:9,acceptsMissingArgument:ki}),i("ODDLPRICE",er,{minArgs:7,maxArgs:8,acceptsMissingArgument:li}),i("TBILLPRICE",yr,{minArgs:3,maxArgs:3}),i("EURO",gi,{minArgs:1,maxArgs:1}),i("EUROCONVERT",pu,{minArgs:3,maxArgs:5,acceptsMissingArgument:it})})(window);(function(n,t){"use strict";function nt(n,t,r){var f,u;return n?i._ArrayHelper.isArrayOrReference(n)?(t>i._ArrayHelper.getColumnCount(n)&&(f=t,t=r,r=f),u=r*i._ArrayHelper.getColumnCount(n)+t,i._ArrayHelper.getValueByIndex(n,u,0)):n:null}function d(n,t){return t?i.Convert.isNumber(n)&&i.Convert.isNumber(t)?!0:typeof n=="bool"&&typeof t=="bool"?!0:typeof n=="string"&&typeof t=="string"?!0:!1:!1}function ht(n,t,i,r,u){if(n<0)return-1;if(t<0)return-1;if(t<n)return-1;if(i<n)return-1;if(i>t)return-1;if(u)return g=n,tt=t,e=i,rt=i,s=r,k=r,e;if(s){e++;if(e>tt&&s===k)e=rt-1,s=!1;else if(e>tt&&s!==k)return-1}else{e--;if(e<g&&s===k)e=rt+1,s=!0;else if(e<g&&s!==k)return-1}return e}function c(n,t,u){var f,e,s,o;if(n===t)return 0;f=null;if(typeof n=="string")return t||n.toString().length!==0?i.Convert.isNumber(t)?1:typeof t=="bool"?2:typeof t=="string"?(e=u?n.toString().localeCompare(t.toString()):n.toLowerCase().localeCompare(t.toLowerCase()),e===0?0:e>0?1:2):t instanceof Date?(f=r.UI._DateTimeHelper._parseDate(n),isNaN(f)?1:f===t?0:f>t?1:2):-1:0;else if(typeof t=="string")return n||t.toString().length!==0?i.Convert.isNumber(n)?2:typeof n=="bool"?1:n instanceof Date?(f=r.UI._DateTimeHelper._parseDate(n),isNaN(f)?2:f===t?0:f>t?1:2):-1:0;return typeof n=="bool"&&i.Convert.isNumber(t)?1:typeof t=="bool"&&i.Convert.isNumber(n)?2:(s=i.Convert.toDouble(n),o=i.Convert.toDouble(t),s===o?0:s<o?2:1)}function o(n,t,i){var r=nt(n,t,i);return r?r:0}function a(n,t,r,u){var s=-1,h,a=0,p=-1,f=-1,e,w,l,y,v;h=u?i._ArrayHelper.getRowCount(t):i._ArrayHelper.getColumnCount(t),h--;if(h<a)return-1;while(a<=h){e=null,r>=1!=(s===2)&&(p=f),f=i.Convert.toInt((a+h)/2),f=ht(a,h,f,r>=0,!0),w=f,l=n,n instanceof i.Array?l=n.getValue(0,0):n instanceof i._SheetRangeReference?l=n.getValue(0,0,0,0):n instanceof i.Reference&&(l=n.getValue(0,0,0));while(!d(l,e)&&f!==-1){y=!1,e=u?nt(t,0,f):nt(t,f,0);if(d(l,e))break;f=ht(0,0,0,!1,!1),y||r<0||f>=w?!y&&r<0&&f>w&&(a=f,y=!0):(h=f,y=!0)}if(f===-1&&r>=1!=(s===2))return p;else if(f===-1)return-1;s=c(l,e,!1);if(r<1||s!==1)if(r<1||s!==2)if(r>-1||s!==1)if(r>-1||s!==2){if(s===0){while(r<=-1&&f>a||r>=0&&f<h){v=0,v=r<0?f-1:f+1,e=u?o(t,0,v):o(t,v,0);if(!e)return-1;if(!d(l,e))break;s=c(l,e,!1);if(s!==0)break;f=v}return f}}else a=f+1;else h=f-1;else h=f-1;else a=f+1}return r>=1!=(s===2)?f:p}function it(n,t,r,u){for(var a=null,f,e=-1,s,l,v=u?i._ArrayHelper.getRowCount(t):i._ArrayHelper.getColumnCount(t),h=0;h<v;h++){s=u?o(t,0,h):o(t,h,0);if(!s)return-1;l=n,n instanceof i.Array?l=n.getValue(0,0):n instanceof i.Reference&&(l=n.getValue(0,0,0));if(!d(l,s))continue;f=c(l,s,!1);if(r<1||f!==1)if(r>-1||f!==2){if(f===0)return h}else f=-1,e<0||(f=c(s,a,!1)),(e<0||e>=0&&f===2)&&(e=h,a=s);else f=-1,e<0||(f=c(s,a,!1)),(e<0||e>=0&&f===1)&&(e=h,a=s)}return e}function pi(n){var i,t;if(!n||n==="")return n;i=[/\(/,/\[/,/\{/,/\\/,/\^/,/\$/,/\|/,/\)/,/\+/,/\./];for(t in i)t&&(n=n.replace(i[t],i[t].source));return n=n.replace("~?","{113E2532-EAF5-444c-A5CB-3D7446971C4D}"),n=n.replace("~*","{E21523B3-0F1F-458f-B547-23D25713D0EC}"),n=n.replace("?","."),n=n.replace("*","((.|\\n)*)"),n=n.replace("{113E2532-EAF5-444c-A5CB-3D7446971C4D}","\\?"),n=n.replace("{E21523B3-0F1F-458f-B547-23D25713D0EC}","\\*"),n.toString()}function h(n){return!0}function st(n){return n!==0}function l(n){return n===1}function ei(n){return n>=1}function oi(n){return n===2}function ki(n){return n===0||n===2}function bi(n){return n===0||n%2==1}function lt(n){return n===3}function si(){return!0}function wi(n){return n===1||n===2}function ri(n){return n===2||n===3||n===4}function ui(n){return n===1||n===2||n===3}function fi(n){return n===3||n===4}function ai(){return!0}function b(n){return n===0}function ct(){return!0}function yi(n,i,u){var o,e,f;if(r.Calc.Convert.isError(n))return u.value=n,!1;else if(r.Calc.Convert._isCalcReference(n)){for(o=0;o<n.getRowCount(0);o++)for(e=0;e<n.getColumnCount(0);e++)if(!i(n.getValue(0,o,e),u))return!1}else if(r.Calc.Convert._isCalcArray(n)){for(f=0;f<n.length();f++)if(!i(n.getValueByIndex(f),u))return!1}else if(t.isArray(n))t.each(n,function(n,t){return i(t,u)});else if(!i(n,u))return!1;return!0}function vi(){return 0}function hi(n){if(r.Calc.Convert.isError(n))return-1;try{return r.Calc.Convert.toInt(n)}catch(t){}return-1}function w(n){if(n){if(n.length<1||n.length>1)throw"Invalid arguments";}else throw"Invalid arguments";}function y(n,t,i,u,f,e){this._source=n,this._ranges=[new r.UI.Range(t,i,u,f)],this._row=t,this._column=i,this._rowCount=u,this._columnCount=f,this._type=e}function v(n){this._array=n}function ci(n,t){w([n]);if(!t)return i.Errors.value;var u=t.arrayFormulaMode,r=i._Helper._argumentExists(n,0)?n[0]:t.getReference(t.source,t.row,t.column,t.rowCount,t.columnCount);return!r||r.getRangeCount()!==1?i.Errors.value:u?new y(r.getSource(),r.getRow(0),r.getColumn(0),r.getRowCount(0),r.getColumnCount(0),p.row):r.getRow(0)+1}function li(n,t){w([n]);if(!t)return i.Errors.value;var u=t.arrayFormulaMode,r=i._Helper._argumentExists(n,0)?n[0]:t.getReference(t.source,t.row,t.column,t.rowCount,t.columnCount);return!r||r.getRangeCount()!==1?i.Errors.value:u?new y(r.getSource(),r.getRow(0),r.getColumn(0),r.getRowCount(0),r.getColumnCount(0),p.column):r.getColumn(0)+1}function yt(n){return w([n]),i._ArrayHelper.getRowCount(n[0])}function at(n){return w([n]),i._ArrayHelper.getColumnCount(n[0])}function vt(n){return w([n]),new v(n[0])}function ut(n){var s=n[0],f=n[1],r=i.Convert.toInt(n[2]),e=i._Helper._argumentExists(n,3)?i.Convert.toBool(n[3]):!0,t=-1,u;if(r<=0)return i.Errors.Value;if(r>i._ArrayHelper.getRowCount(f))return i.Errors.Reference;return t=e?a(n[0],n[1],1,!1):it(n[0],n[1],0,!1),t>=0?u=o(n[1],t,r-1):i.Errors.NotAvailable}function ot(n){var s=n[0],f=n[1],r=i.Convert.toInt(n[2]),e=i._Helper._argumentExists(n,3)?i.Convert.toBool(n[3]):!0,t=-1,u;if(r<=0)return i.Errors.Value;if(r>i._ArrayHelper.getColumnCount(f))return i.Errors.Reference;return t=e?a(n[0],n[1],1,!0):it(n[0],n[1],0,!0),t>=0?u=o(n[1],r-1,t):i.Errors.NotAvailable}function ni(n){var s=-1,t,f=i._ArrayHelper.getColumnCount(n[1]),u=i._ArrayHelper.getRowCount(n[1]),r,h,c,e;if(n.length>2)t=n[2];else return r=null,f>u?(r=ut([n[0],n[1],u]),r instanceof i.Error?i.Errors.NotAvailable:r):(r=ot([n[0],n[1],f]),r instanceof i.Error?i.Errors.NotAvailable:r);if(t){h=i._ArrayHelper.getColumnCount(t),c=i._ArrayHelper.getRowCount(t);if(h>1&&c>1)return i.Errors.NotAvailable}else t=n[1];return s=a(n[0],n[1],1,f>u?!1:!0),s>=0?(e=null,f=i._ArrayHelper.getColumnCount(t),u=i._ArrayHelper.getRowCount(t),e=f>u?o(t,s,u-1):o(t,f-1,s)):i.Errors.NotAvailable}function gt(n){var t=i.Convert.toInt(n[0]);return t<1||n.length<=t?i.Errors.Value:n[t]?n[t]:0}function et(n,t){for(var e=i._ArrayHelper.getLength(n),r=0;r<e;r++)if(r>0){var o=i._ArrayHelper.getValue(n,r-1),u=i._ArrayHelper.getValue(n,r),f=c(o,u,!1);if(f===2&&!t)return!1}return!0}function ii(n){var f=i._ArrayHelper.getColumnCount(n[1]),u=i._ArrayHelper.getRowCount(n[1]),r=i._Helper._argumentExists(n,2)?i.Convert.toInt(n[2]):1,t;if(f>1&&u>1)return i.Errors.NotAvailable;if(r!==1||et(n[1],!0)){if(r===-1&&!et(n[1],!1))return i.Errors.NotAvailable}else return i.Errors.NotAvailable;return t=-1,r===1?t=a(n[0],n[1],1,u>1):r===0?t=it(n[0],n[1],0,u>1):r===-1&&(t=a(n[0],n[1],-1,u>1)),t===-1?i.Errors.NotAvailable:t+1}function ft(n,t,i,r){n.append(t),r?i!==0&&(n.append("["),n.append(i.toString()),n.append("]")):n.append(i)}function ti(n,t,i){return i||n.append("$"),n.append(t),n}function dt(n,t,i){i||n.append("$");for(var r=n.toString().length;t>.1;t=(t-1)/26)n.insert(String.fromCharCode("A".charCodeAt(0)+(t-1)%26),r);return n}function wt(n,t){var u,i;if(t&&0<t.length){for(u=!r.Calc.Parser._isLetter(t[0])&&t[0]!=="_",i=1;!u&&i<t.length;i++)u=!r.Calc.Parser._isLetterOrDigit(t[i])&&t[i]!=="_";u?(n.append("'"),n.append(t.replace("'","''")),n.append("'")):n.append(t),n.append("!")}return n}function pt(n){var f=i.Convert.toInt(n[0]),e=i.Convert.toInt(n[1]),t=i._Helper._argumentExists(n,2)?i.Convert.toInt(n[2]):1,h=i._Helper._argumentExists(n,3)?i.Convert.toBool(n[3]):!0,c=i._Helper._argumentExists(n,4)?i.Convert.toString(n[4]):"",s=t===3||t===4||t===7||t===8,o=t===2||t===4||t===6||t===8,u=new r.UI._StringBuilder;return f<1&&(h||!s)||f>i.Parser.maxRowCount?i.Errors.Value:e<1&&(h||!o)||e>i.Parser.maxColumnCount?i.Errors.Value:t<1||8<t?i.Errors.Value:(wt(u,c),h?(dt(u,e,o),ti(u,f,s)):(ft(u,"R",f,s),ft(u,"C",e,o)),u.toString())}function kt(n){var t=n[0],f=i._ArrayHelper.getRowCount(t),e=i._ArrayHelper.getColumnCount(t),o;if(n.length===2)return o=i._Helper._argumentExists(n,1)?i.Convert.toInt(n[1]):0,f!==1&&e!==1?i.Errors.Reference:o<0?i.Errors.Value:f*e<o?i.Errors.Reference:o===0?new i._SliceArray(t,0,0,f,e):i._ArrayHelper.getValue(t,o-1);else{var r=i._Helper._argumentExists(n,1)?i.Convert.toInt(n[1]):0,u=i._Helper._argumentExists(n,2)?i.Convert.toInt(n[2]):0,s=i._Helper._argumentExists(n,3)?i.Convert.toInt(n[3]):1;return r<0||u<0||s<1?i.Errors.Value:f<r||e<u||1<s?i.Errors.Reference:r===0&&u===0?new i._SliceArray(t,0,0,f,e):r===0?new i._SliceArray(t,0,u-1,f,1):u===0?new i._SliceArray(t,r-1,0,1,e):i._ArrayHelper.getValue(t,r-1,u-1)}}function bt(n){var r=n[0];if(!r||r.getRangeCount()!==1)return i.Errors.Value;var s=i.Convert.toInt(n[1]),h=i.Convert.toInt(n[2]),o=i._Helper._argumentExists(n,3)?i.Convert.toInt(n[3]):r.getRowCount(0),e=i._Helper._argumentExists(n,4)?i.Convert.toInt(n[4]):r.getColumnCount(0),t=r.getSource(),f=r.getRow(0)+s,u=r.getColumn(0)+h;return o<=0||e<=0?i.Errors.Reference:f<t.getRow(0)||t.getRow(0)+t.getRowCount(0)<f+o?i.Errors.Reference:u<t.getColumn(0)||t.getColumn(0)+t.getColumnCount(0)<u+e?i.Errors.Reference:new i._ConcreteReference(t,[{row:f,column:u,rowCount:o,columnCount:e}])}var r=n.GrapeCity,i,f,u,g,tt,e,rt,s,k,p;typeof r=="undefined"&&(n.GrapeCity=r={}),typeof r.Calc=="undefined"&&(r.Calc={}),i=r.Calc,typeof i.Functions=="undefined"&&(i.Functions={}),f=i.Functions,f._builtInFunctions=f._builtInFunctions||{},typeof f._defineBuildInFunction=="undefined"&&(f._defineBuildInFunction=function(n,t,i){if(!n)throw"Invalid function name";var r,u;n=n.toUpperCase();if(f._builtInFunctions.hasOwnProperty(n)){r=f._builtInFunctions[n];if(r){if(!i||!i.override)throw"Attempt to override function while override is not allowed";}else f._builtInFunctions[n]=new f.Function(n,0,255),r=f[n.toUpperCase()]}else r=new f.Function(n,0,255),f._builtInFunctions[n]=r;t&&typeof t=="function"&&(r.evaluate=t);if(i)for(u in i)i.hasOwnProperty(u)&&u!=="override"&&(r[u]=i[u]);return r}),u=f._defineBuildInFunction,p={row:0,column:1},y.prototype=new i._ConcreteReference,y.prototype.type=function(){return this._type},y.prototype.getValue=function(n,t,i){switch(this._type){case p.row:return this.getRow(0)+1+t;case p.column:return this.getColumn(0)+1+i;default:return this.getActualValue(n,t,i)}},v.prototype=new i.Array,v.prototype.rowCount=function(){return i._ArrayHelper.getColumnCount(this._array)},v.prototype.columnCount=function(){return i._ArrayHelper.getRowCount(this._array)},v.prototype.getValue=function(n,t){return i._ArrayHelper.getValue(this._array,t,n)},u("ADDRESS",pt,{minArgs:2,maxArgs:5,acceptsMissingArgument:ri}),u("INDEX",kt,{minArgs:2,maxArgs:4,acceptsReference:b,acceptsArray:b,acceptsMissingArgument:ui}),u("OFFSET",bt,{minArgs:3,maxArgs:5,acceptsMissingArgument:fi,acceptsReference:b,acceptsArray:b,isVolatile:si}),u("ROW",ci,{minArgs:0,maxArgs:1,acceptsReference:h,isContextSensitive:ct}),u("COLUMN",li,{minArgs:0,maxArgs:1,acceptsMissingArgument:b,acceptsReference:h,isContextSensitive:ct}),u("ROWS",yt,{minArgs:1,maxArgs:1,acceptsReference:h,acceptsArray:h}),u("COLUMNS",at,{minArgs:1,maxArgs:1,acceptsReference:h,acceptsArray:h}),u("TRANSPOSE",vt,{minArgs:1,maxArgs:1,acceptsReference:h,acceptsArray:h}),u("LOOKUP",ni,{minArgs:2,maxArgs:3,acceptsArray:st,acceptsReference:st}),u("HLOOKUP",ut,{minArgs:3,maxArgs:4,acceptsMissingArgument:lt,acceptsArray:l,acceptsReference:l}),u("VLOOKUP",ot,{minArgs:3,maxArgs:4,acceptsMissingArgument:lt,acceptsArray:l,acceptsReference:l}),u("CHOOSE",gt,{minArgs:2,maxArgs:255,acceptsError:ei,isBranch:ai,findTestArgument:vi,findBranchArgument:hi}),u("MATCH",ii,{minArgs:2,maxArgs:3,acceptsMissingArgument:oi,acceptsReference:l,acceptsArray:l})})(window,jQuery);(function(n){"use strict";function r(n){return!0}function ci(n){return n>0}function li(n){return n===1}function nt(n){return n===1||n===2||n===3}function g(n){return n===2}function oi(n){return n===0||n===2}function e(n){return n===0||n===1}function si(n){return n===0||n%2==1}function f(n){return n===0}function wi(n){return n===0||n===1||n===2}function vi(n){return n%2==0}function hr(n){return n===3}function hi(n){return n!==3}function ki(n){return n===3||n===4}function ai(n,i){for(var h=!1,e=0,o=t.Convert,c=t._ArrayHelper,f,u,l,s,r=0;r<n.length;r++){if(o.isError(n[r]))return n[r];if(c.isArrayOrReference(n[r])){for(f=0;f<c.getLength(n[r]);f++)if(i||!c.isSubtotalByIndex(n[r],f)){u=c.getValueByIndex(n[r],f);if(o.isNumber(u))l=o.toDouble(u),(!h||l>e)&&(e=l),h=!0;else if(o.isError(u))return u}}else{s=o.toDouble(n[r]);if(isNaN(s))return t.Errors.Value;(!h||s>e)&&(e=s),h=!0}}return e}function gf(n){return ai(n,!0)}function bf(n){for(var e=!1,f=0,i,o=t.Convert,h=t._ArrayHelper,s,u,r=0;r<n.length;r++){if(o.isError(n[r]))return n[r];if(h.isArrayOrReference(n[r]))for(s=0;s<h.getLength(n[r]);s++){u=h.getValueByIndex(n[r],s);if(o.isNumber(u)||typeof u===d)i=o.toDouble(u),(!e||i>f)&&(f=i),e=!0;else if(typeof u===k)i=0,(!e||i>f)&&(f=i),e=!0;else if(o.isError(u))return u}else{if(isNaN(i=o.toDouble(n[r])))return t.Errors.Value;(!e||i>f)&&(f=i),e=!0}}return f}function yi(n,i){for(var c=!1,o=0,u,s=t.Convert,h=t._ArrayHelper,e,f,r=0;r<n.length;r++){if(s.isError(n[r]))return n[r];if(h.isArrayOrReference(n[r])){for(e=0;e<h.getLength(n[r]);e++)if(i||!h.isSubtotalByIndex(n[r],e)){f=h.getValueByIndex(n[r],e);if(s.isNumber(f))u=s.toDouble(f),(!c||u<o)&&(o=u),c=!0;else if(s.isError(f))return f}}else{if(isNaN(u=s.toDouble(n[r])))return t.Errors.Value;(!c||u<o)&&(o=u),c=!0}}return o}function vf(n){return yi(n,!0)}function wf(n){for(var e=!1,f=0,i,o=t.Convert,h=t._ArrayHelper,s,u,r=0;r<n.length;r++){if(o.isError(n[r]))return n[r];if(h.isArrayOrReference(n[r]))for(s=0;s<h.getLength(n[r]);s++){u=h.getValueByIndex(n[r],s);if(o.isNumber(u)||typeof u===d)i=o.toDouble(u),(!e||i<f)&&(f=i),e=!0;else if(typeof u===k)i=0,(!e||i<f)&&(f=i),e=!0;else if(o.isError(u))return u}else{if(isNaN(i=o.toDouble(n[r])))return t.Errors.Value;(!e||i<f)&&(f=i),e=!0}}return f}function pf(n){var r=t.Convert,s=t._ArrayHelper,e,i,o,f,u;if(r.isError(n[0]))return n[0];if(r.isError(n[1]))return n[1];e=r.toInt(n[1]),i=[];if(s.isArrayOrReference(n[0]))for(f=0;f<s.getLength(n[0]);f++){u=s.getValueByIndex(n[0],f);if(r.isNumber(u))o=r.toDouble(u),i.push(o);else if(r.isError(u))return u}else{if(isNaN(o=r.toDouble(n[0])))return t.Errors.Value;i.push(o)}return i.sort(function(n,t){return n-t}),e<=0||i.length<e?t.Errors.Number:i[i.length-e]}function te(n){var i=t.Convert,s=t._ArrayHelper,e,r,o,f,u;if(i.isError(n[0]))return n[0];if(i.isError(n[1]))return n[1];if(isNaN(e=i.toInt(n[1])))return t.Errors.Value;r=[];if(s.isArrayOrReference(n[0]))for(f=0;f<s.getLength(n[0]);f++){u=s.getValueByIndex(n[0],f);if(i.isNumber(u))o=i.toDouble(u),r.push(o);else if(i.isError(u))return u}else{if(isNaN(o=i.toDouble(n[0])))return t.Errors.Value;r.push(o)}return r.sort(function(n,t){return n-t}),e<=0||r.length<e?t.Errors.Number:r[e-1]}function pi(n,i){for(var c=0,h=0,f=t.Convert,s=t._ArrayHelper,u,e,o,l,r=0;r<n.length;r++){if(f.isError(n[r]))return n[r];if(s.isArrayOrReference(n[r])){for(u=0;u<s.getRangeCount(n[r]);u++)for(e=0;e<s.getLength(n[r],u);e++)if(i||!s.isSubtotal(n[r],e,u)){o=s.getValueByIndex(n[r],e,u);if(f.isNumber(o))c+=f.toDouble(o),h++;else if(f.isError(o))return o}}else{if(isNaN(l=f.toDouble(n[r])))return t.Errors.Value;c+=l,h++}}return h===0?t.Errors.DivideByZero:f.toResult(c/h)}function se(n){return pi(n,!0)}function oe(n){for(var o=0,f=0,u=t.Convert,s=t._ArrayHelper,e,r,h,i=0;i<n.length;i++){if(u.isError(n[i]))return n[i];if(s.isArrayOrReference(n[i]))for(e=0;e<s.getLength(n[i]);e++){r=s.getValueByIndex(n[i],e);if(u.isNumber(r)||typeof r===d)o+=u.toDouble(r),f++;else if(typeof r===k)o+=0,f++;else if(u.isError(r))return r}else{if(isNaN(h=u.toDouble(n[i])))return t.Errors.Value;o+=h,f++}}return f===0?t.Errors.DivideByZero:u.toResult(o/f)}function et(n,i,r){var a=0,h=0,c=u._MathHelper.parseCriteria(i),s=t.Convert,f=t._ArrayHelper,e,l,o;if(f.getRowCount(n)!==f.getRowCount(r)||f.getColumnCount(n)!==f.getColumnCount(r))return t.Errors.Value;for(e=0;e<f.getLength(n);e++){l=f.getValueByIndex(n,e);if(c&&c(l)){o=f.getValueByIndex(r,e);if(s.isNumber(o))a+=s.toDouble(o),h++;else if(s.isError(o))return o}}return h===0?t.Errors.DivideByZero:s.toResult(a/h)}function he(n){var h=n[0],a=n[1],c=t._Helper._argumentExists(n,2)?n[2]:n[0],l=t.Convert,o=n[1],s,f,u,i,r,e;if(l._isCalcReference(o)){for(s=o.getRowCount(0),f=o.getColumnCount(0),u=[],i=0;i<s;i++)for(u[i]=new Array(f),r=0;r<f;r++)u[i][r]=et(h,o.getValue(0,i,r),c);return new t._ConcreteArray(u)}e=n[1];if(l._isCalcArray(e)){for(s=e.getRowCount(),f=e.getColumnCount(),u=[],i=0;i<s;i++)for(u[i]=new Array(f),r=0;r<f;r++)u[i][r]=et(h,e.getValue(i,r),c);return new t._ConcreteArray(u)}return et(h,a,c)}function ee(n){for(var c=0,h=0,y=n[0],o=t.Convert,s=t._ArrayHelper,p=s.getLength(n[0]),i,e,r,f=0;f<p;f++){for(e=!0,r=1;r<n.length;r=r+2){var v=n[r],a=n[r+1],l=u._MathHelper.parseCriteria(a);i=s.getValueByIndex(v,f),e=l(i);if(!e)break}if(e){i=s.getValueByIndex(y,f);if(o.isNumber(i))c+=o.toDouble(i),h++;else if(o.isError(i))return i}}return h===0?t.Errors.DivideByZero:o.toResult(c/h)}function re(n){for(var i=[],o,u=t.Convert,s=t._ArrayHelper,e,f,r=0;r<n.length;r++){if(u.isError(n[r]))return n[r];if(s.isArrayOrReference(n[r]))for(e=0;e<s.getLength(n[r]);e++){f=s.getValueByIndex(n[r],e);if(u.isNumber(f))o=u.toDouble(f),i.push(o);else if(u.isError(f))return f}else{if(isNaN(o=u.toDouble(n[r])))return t.Errors.Value;i.push(o)}}return i.sort(function(n,t){return n-t}),i.length===0?t.Errors.Number:i.length%2==0?(u.toDouble(i[i.length/2-1])+u.toDouble(i[i.length/2]))/2:i[parseInt(i.length/2,10)]}function ie(n){for(var l=null,c=0,u=[],f=t.Convert,h=t._ArrayHelper,r,o,e,s,i=0;i<n.length;i++){if(f.isError(n[i]))return n[i];if(h.isArrayOrReference(n[i]))for(r=0;r<h.getLength(n[i]);r++){e=h.getValueByIndex(n[i],r);if(f.isNumber(e))o=f.toDouble(e),u.push(o);else if(f.isError(e))return e}else{if(isNaN(o=f.toDouble(n[i])))return t.Errors.Value;u.push(o)}}for(i=0;i<u.length;i++){for(s=0,r=0;r<u.length;r++)r!==i&&f.toDouble(u[r])===f.toDouble(u[i])&&s++;s>c&&(c=s,l=u[i])}return c===0?t.Errors.NotAvailable:l}function fe(n){for(var u,h=1,o=0,r=t.Convert,s=t._ArrayHelper,e,f,i=0;i<n.length;i++){if(r.isError(n[i]))return n[i];if(s.isArrayOrReference(n[i]))for(e=0;e<s.getLength(n[i]);e++){f=s.getValueByIndex(n[i],e);if(r.isNumber(f)){u=r.toDouble(f);if(u<=0)return t.Errors.Number;h*=u,o++}else if(r.isError(f))return f}else{if(isNaN(u=r.toDouble(n[i])))return t.Errors.Value;if(u<=0)return t.Errors.Number;h*=u,o++}}return o<=0?t.Errors.DivideByZero:r.toResult(Math.pow(h,1/o))}function du(n){for(var u,o=0,s=0,r=t.Convert,h=t._ArrayHelper,e,f,i=0;i<n.length;i++){if(r.isError(n[i]))return n[i];if(h.isArrayOrReference(n[i]))for(e=0;e<h.getLength(n[i]);e++){f=h.getValueByIndex(n[i],e);if(r.isNumber(f)){u=r.toDouble(f);if(u<=0)return t.Errors.Number;o+=1/u,s++}else if(r.isError(f))return f}else{if(isNaN(u=r.toDouble(n[i])))return t.Errors.Value;if(u<=0)return t.Errors.Number;o+=1/u,s++}}return o===0?t.Errors.DivideByZero:r.toResult(s/o)}function vu(n){var o,u=t.Convert,c=t._ArrayHelper,h,r,i,e,f,s;if(isNaN(o=u.toDouble(n[1])))return t.Errors.Value;h=0,r=[];if(o<0||1<=o)return t.Errors.Number;if(u.isError(n[0]))return n[0];if(c.isArrayOrReference(n[0]))for(i=0;i<c.getLength(n[0]);i++){f=c.getValueByIndex(n[0],i);if(u.isNumber(f))e=u.toDouble(f),r.push(e);else if(u.isError(f))return f}else{if(isNaN(e=u.toDouble(n[0])))return t.Errors.Value;r.push(e)}for(r.sort(function(n,t){return n-t}),s=parseInt(r.length*o/2,10),i=s;i<r.length-s;i++)h+=u.toDouble(r[i]);return h/(r.length-2*s)}function wu(n){for(var f=t.Convert,c=f._toArray(n[0]),a=f._toArray(n[1]),e=0,r,u,p=a.getRowCount(),b=a.getColumnCount(),y,v,h,o,k,w,l,s,i=0;i<p;i++)for(r=0;r<b;r++){u=a.getValue(i,r);if(f.isError(u))return u;f.isNumber(u)&&e++}for(y=c.getRowCount(),v=c.getColumnCount(),i=0;i<y;i++)for(r=0;r<v;r++){u=c.getValue(i,r);if(f.isError(u))return u}for(h=new Array(e),o=new Array(e+1),e=0,i=0;i<p;i++)for(r=0;r<b;r++)u=a.getValue(i,r),f.isNumber(u)&&(h[e++]=f.toDouble(u));for(h.sort(function(n,t){return n-t}),k=o.length,i=0;i<k;i++)o[i]=0;for(i=0;i<y;i++)for(r=0;r<v;r++){u=c.getValue(i,r);if(f.isNumber(u)){for(w=f.toDouble(u),l=!1,s=0;!l&&s<e;s++)w>h[s]||(o[s]++,l=!0);l||o[e]++}}return new t._OneDimensionalArray(o)}function of(n){var r=t.Convert,h=t._ArrayHelper,o,s,e,i,f,u;if(isNaN(o=r.toDouble(n[0])))return t.Errors.Value;s=n[1],e=0;if(t._Helper._argumentExists(n,2))if(isNaN(e=r.toDouble(n[2])))return t.Errors.Value;var c=0,l=0,a=0;for(i=0;i<h.getLength(s);i++)f=h.getValueByIndex(n[1],i),r.isNumber(f)&&(u=r.toDouble(f),u<o?c++:o<u?a++:l++);return l===0?t.Errors.NotAvailable:e===0?a+1:c+1}function lf(n){for(var u,h=0,v=0,a=0,l,c,i=0,e=t.Convert,s=t._ArrayHelper,o,f,r=0;r<n.length;r++)if(s.isArrayOrReference(n[r]))for(o=0;o<s.getLength(n[r]);o++){f=s.getValueByIndex(n[r],o);if(e.isNumber(f))u=e.toDouble(f),h+=u,v+=u*u,i++;else if(e.isError(f))return f}else{if(isNaN(u=e.toDouble(n[r])))return t.Errors.Value;h+=u,v+=u*u,i++}if(i<=3)return t.Errors.DivideByZero;l=h/i,c=Math.sqrt((i*v-h*h)/(i*(i-1)));if(c===0)return t.Errors.DivideByZero;for(r=0;r<n.length;r++)if(s.isArrayOrReference(n[r]))for(o=0;o<s.getLength(n[r]);o++){f=s.getValueByIndex(n[r],o);if(e.isNumber(f))u=e.toDouble(f),a+=Math.pow((u-l)/c,4);else if(e.isError(f))return f}else{if(isNaN(u=e.toDouble(n[r])))return t.Errors.Value;a+=Math.pow((u-l)/c,4)}return e.toResult(i*(i+1)*a/((i-1)*(i-2)*(i-3))-3*(i-1)*(i-1)/((i-2)*(i-3)))}function bi(n){var o,r=t.Convert,c=t._ArrayHelper,i,s,e,f,u,h;if(isNaN(o=r.toDouble(n[1])))return t.Errors.Value;i=[];if(r.isError(n[0]))return n[0];if(c.isArrayOrReference(n[0]))for(e=0;e<c.getLength(n[0]);e++){f=c.getValueByIndex(n[0],e);if(r.isNumber(f))s=r.toDouble(f),i.push(s);else if(r.isError(f))return f}else{if(isNaN(s=r.toDouble(n[0])))return t.Errors.Value;i.push(s)}return i.sort(function(n,t){return n-t}),i.length===0?t.Errors.Number:o<0||1<o?t.Errors.Number:(u=o*(i.length-1),h=u%1,u=parseInt(u,10),h===0?i[u]:r.toDouble(i[u])+h*(r.toDouble(i[u+1])-r.toDouble(i[u])))}function tf(n){var b=n[0],k,s=t.Convert,w=t._ArrayHelper,c,f,v,a,y,o,p;if(isNaN(k=s.toDouble(n[1])))return t.Errors.Value;c=3;if(t._Helper._argumentExists(n,2))if(isNaN(c=s.toInt(n[2])))return t.Errors.Value;f=k;var i=0,e=0,r=0,h=f,l=f;if(c<1)return t.Errors.Number;for(a=0;a<w.getLength(b);a++){y=w.getValueByIndex(b,a);if(y!==undefined&&y!==null){if(isNaN(o=s.toDouble(y)))return t.Errors.Value;o<f?(i++,(h===f||h<o)&&(h=o)):o>f?(e++,(l===f||l>o)&&(l=o)):r++}}if(i+r===0||e+r===0)return t.Errors.NotAvailable;else if(e===0&&i===0&&r!==0)return 1;return i=s.toDouble(i),e=s.toDouble(e),r=s.toDouble(r),r===1?v=i/(i+e):r===0?(p=(f-h)/(l-h),v=(i+p-1)/(e+i-1)):v=(i+.5*r)/(i+r+e),u._MathHelper.round(v,c>15?15:c)}function ff(n){var f=n[0],r=t.Convert,u=r.toInt(n[1]),i=0;switch(u){case 0:i=0;break;case 1:i=.25;break;case 2:i=.5;break;case 3:i=.75;break;case 4:i=1;break;default:return t.Errors.Number}return bi([f,i])}function ei(n,i){for(var l=0,o=t.Convert,c,h,u,f,v,e,a,s,r=0;r<n.length;r++)if(o._isCalcArray(n[r]))for(h=n[r].getColumnCount(),c=n[r].getRowCount(),f=0;f<h;f++)for(u=0;u<c;u++)o.isNumber(n[r].getValue(u,f))&&l++;else if(o._isCalcReference(n[r]))for(v=n[r].getRangeCount(),h=0,c=0,e=0;e<v;e++)for(h=n[r].getColumnCount(e),f=0;f<h;f++)for(c=n[r].getRowCount(e),u=0;u<c;u++){if(n[r]instanceof t._SheetRangeReference)for(s=0;s<n[r].getSheetCount();s++)(i||!n[r].isSubtotal(s,e,u,f))&&(a=n[r].getValue(s,e,u,f));else(i||!n[r].isSubtotal(e,u,f))&&(a=n[r].getValue(e,u,f));o.isNumber(a)&&l++}else o.isNumber(n[r])&&l++;return o.toResult(l)}function ne(n){return ei(n,!0)}function ct(n,i){for(var o=0,h=t.Convert,e=t._ArrayHelper,u,f,s,r=0;r<n.length;r++)if(e.isArrayOrReference(n[r]))for(u=0;u<e.getRangeCount(n[r]);u++)for(f=0;f<e.getLength(n[r],u);f++)(i||!e.isSubtotal(n[r],f,u))&&(s=e.getValue(n[r],f,u),s!==undefined&&s!==null&&o++);else n[r]!==undefined&&n[r]!==null&&o++;return h.toResult(o)}function ef(n){return ct(n,!0)}function uf(n){for(var f=0,e=t.Convert,u=t._ArrayHelper,r,i=0;i<u.getRangeCount(n[0]);i++)for(r=0;r<u.getLength(n[0],i);r++)u.getValue(n[0],r,i)===null&&f++;return e.toDouble(f)}function st(n,i){for(var o=0,s=u._MathHelper.parseCriteria(i),c=t.Convert,e=t._ArrayHelper,f,h,r=0;r<e.getRangeCount(n);r++)for(f=0;f<e.getLength(n,r);f++)h=e.getValue(n,f,r),s&&s(h)&&o++;return c.toResult(o)}function rf(n){var a=n[0],u=n[1],c=t.Convert,e=t._ArrayHelper,i,r,f,l,h;if(e.isArrayOrReference(u)){var v=e.getRowCount(u),o=e.getColumnCount(u),s=[];for(i=0;i<v;i++)for(s[i]=[o],r=0;r<o;r++){f=st(a,e.getValue(u,i,r));if(c.isError(f))return f;if(isNaN(l=c.toDouble(f)))return t.Errors.Value;s[i][r]=l}for(h=0,i=0;i<v;i++)for(r=0;r<o;r++)h+=s[i][r];return h}return st(a,u)}function cf(n){for(var s=0,l=t.Convert,o=t._ArrayHelper,a=o.getLength(n[0]),f,i,r=0;r<a;r++){for(f=!0,i=0;i<n.length;i=i+2){var v=n[i],h=n[i+1],e=u._MathHelper.parseCriteria(h),c=o.getValueByIndex(v,r);f=e&&e(c);if(!f)break}f&&s++}return l.toResult(s)}function a(n,i,r){for(var o=t.Convert,c=t._ArrayHelper,e,f,h,s,u=0;u<n.length;u++)if(o.isError(n[u]))return n[u];else if(c.isArrayOrReference(n[u])){for(e=0;e<c.getLength(n[u]);e++)if(r||!c.isSubtotalByIndex(n[u],e)){f=c.getValueByIndex(n[u],e);if(o.isNumber(f))h=o.toDouble(f),i.sumx+=h,i.sumx2+=h*h,i.n++;else if(o.isError(f))return f}}else{if(isNaN(s=o.toDouble(n[u])))return t.Errors.Value;i.sumx+=s,i.sumx2+=s*s,i.n++}}function y(n,i){for(var e=t.Convert,s=t._ArrayHelper,r,o,f,u=0;u<n.length;u++)if(e.isError(n[u]))return n[u];else if(s.isArrayOrReference(n[u]))for(o=0;o<s.getLength(n[u]);o++){f=s.getValueByIndex(n[u],o);if(e.isNumber(f)||typeof f===d)r=e.toDouble(f),i.sumx+=r,i.sumx2+=r*r,i.n++;else if(typeof f===k)r=0,i.sumx+=r,i.sumx2+=r*r,i.n++;else if(e.isError(f))return f}else{if(isNaN(r=e.toDouble(n[u])))return t.Errors.Value;i.sumx+=r,i.sumx2+=r*r,i.n++}}function hf(n){for(var f,c,h=0,l=0,s=0,e,u,r=t.Convert,o=t._ArrayHelper,i=0;i<n.length;i++){if(r.isError(n[i]))return n[i];if(o.isArrayOrReference(n[i]))for(e=0;e<o.getLength(n[i]);e++){u=o.getValueByIndex(n[i],e);if(r.isNumber(u))f=r.toDouble(u),h+=f,s++;else if(r.isError(u))return u}else{if(isNaN(f=r.toDouble(n[i])))return t.Errors.Value;h+=f,s++}}for(c=h/s,i=0;i<n.length;i++){if(r.isError(n[i]))return n[i];if(o.isArrayOrReference(n[i]))for(e=0;e<o.getLength(n[i]);e++){u=o.getValueByIndex(n[i],e);if(r.isNumber(u))f=r.toDouble(u),l+=Math.abs(f-c);else if(r.isError(u))return u}else{if(isNaN(f=r.toDouble(n[i])))return t.Errors.Value;l+=Math.abs(f-c)}}return s===0?t.Errors.DivideByZero:r.toResult(l/s)}function ot(n,i){var r={sumx:0,sumx2:0,n:0},f=a(n,r,i),u=t.Convert;return u.isError(f)?f:r.n<=1?t.Errors.DivideByZero:u.toResult(Math.sqrt(Math.max(0,(r.n*r.sumx2-r.sumx*r.sumx)/(r.n*(r.n-1)))))}function sf(n){return ot(n,!0)}function pu(n){var i={sumx:0,sumx2:0,n:0},u=y(n,i),r=t.Convert;return r.isError(u)?u:i.n<=1?t.Errors.DivideByZero:r.toResult(Math.sqrt(Math.max(0,(i.n*i.sumx2-i.sumx*i.sumx)/(i.n*(i.n-1)))))}function ht(n,i){var r={sumx:0,sumx2:0,n:0},f=a(n,r,i),u=t.Convert;return u.isError(f)?f:r.n<=0?t.Errors.DivideByZero:u.toResult(Math.sqrt(Math.max(0,(r.n*r.sumx2-r.sumx*r.sumx)/(r.n*r.n))))}function yu(n){return ht(n,!0)}function au(n){var i={sumx:0,sumx2:0,n:0},u=y(n,i),r=t.Convert;return r.isError(u)?u:i.n<=0?t.Errors.DivideByZero:r.toResult(Math.sqrt(Math.max(0,(i.n*i.sumx2-i.sumx*i.sumx)/(i.n*i.n))))}function at(n,i){var r={sumx:0,sumx2:0,n:0},f=a(n,r,i),u=t.Convert;return u.isError(f)?f:r.n<=1?t.Errors.DivideByZero:u.toResult(Math.max(0,(r.n*r.sumx2-r.sumx*r.sumx)/(r.n*(r.n-1))))}function gu(n){return at(n,!0)}function nf(n){var i={sumx:0,sumx2:0,n:0},u=y(n,i),r=t.Convert;return r.isError(u)?u:i.n<=1?t.Errors.DivideByZero:r.toResult(Math.max(0,(i.n*i.sumx2-i.sumx*i.sumx)/(i.n*(i.n-1))))}function lt(n,i){var r={sumx:0,sumx2:0,n:0},f=a(n,r,i),u=t.Convert;return u.isError(f)?f:r.n<=0?t.Errors.DivideByZero:u.toResult(Math.max(0,(r.n*r.sumx2-r.sumx*r.sumx)/(r.n*r.n)))}function bu(n){return lt(n,!0)}function ku(n){var i={sumx:0,sumx2:0,n:0},u=y(n,i),r=t.Convert;return r.isError(u)?u:i.n<=0?t.Errors.DivideByZero:r.toResult(Math.max(0,(i.n*i.sumx2-i.sumx*i.sumx)/(i.n*i.n)))}function af(n){var e,o,p,a,y=0,v=0,l=0,i=t.Convert,s=t._ArrayHelper,c=s.getLength(n[0]),h,f,u,r;if(c===0)return t.Errors.DivideByZero;if(c!==s.getLength(n[1]))return t.Errors.NotAvailable;h=0;if(s.isArrayOrReference(n[0]))for(f=0;f<c;f++){u=s.getValueByIndex(n[0],f),r=s.getValueByIndex(n[1],f);if(i.isNumber(u)&&i.isNumber(r))e=i.toDouble(u),o=i.toDouble(r),y+=e,v+=o,h++;else if(i.isError(u))return u;else if(i.isError(r))return r}else{if(isNaN(e=i.toDouble(n[0]))||isNaN(o=i.toDouble(n[1])))return t.Errors.Value;y+=e,v+=o,h++}p=y/h,a=v/h;if(s.isArrayOrReference(n[0]))for(f=0;f<c;f++){u=s.getValueByIndex(n[0],f),r=s.getValueByIndex(n[1],f);if(i.isNumber(u)&&i.isNumber(r))e=i.toDouble(u),o=i.toDouble(r),l+=(e-p)*(o-a);else if(i.isError(u))return u;else if(i.isError(r))return r}else{if(isNaN(e=i.toDouble(n[0]))||isNaN(o=i.toDouble(n[1])))return t.Errors.Value;l+=(e-p)*(o-a)}return h<=1?t.Errors.DivideByZero:i.toResult(l/h)}function ue(n){for(var f,s,l=0,c=0,h=0,r,e,u=t.Convert,o=t._ArrayHelper,i=0;i<n.length;i++){if(u.isError(n[i]))return n[i];if(o.isArrayOrReference(n[i]))for(r=0;r<o.getLength(n[i]);r++){e=o.getValueByIndex(n[i],r);if(u.isNumber(e))f=u.toDouble(o.getValueByIndex(n[i],r)),l+=f,h++;else if(u.isError(e))return e}else{if(isNaN(f=u.toDouble(n[i])))return t.Errors.Value;l+=f,h++}}for(s=l/h,i=0;i<n.length;i++)if(o.isArrayOrReference(n[i]))for(r=0;r<o.getLength(n[i]);r++){e=o.getValueByIndex(n[i],r);if(u.isNumber(e))f=u.toDouble(o.getValueByIndex(n[i],r)),c+=(f-s)*(f-s);else if(u.isError(e))return e}else{if(isNaN(f=u.toDouble(n[i])))return t.Errors.Value;c+=(f-s)*(f-s)}return u.toResult(c)}function s(n){var f,o=t.Convert,e,i,u,r;return isNaN(f=o.toDouble(n[0]))?t.Errors.Value:(e=6,f===0?u=0:(i=.5*Math.abs(f),i<e*.5?i<1?(r=i*i,u=((((((((.000124818987*r-.001075204047)*r+.005198775019)*r-.019198292004)*r+.059054035642)*r-.151968751364)*r+.319152932694)*r-.5319230073)*r+.797884560593)*i*2):(i-=2,u=(((((((((((((-45255659e-12*i+.00015252929)*i-19538132e-12)*i-.000676904986)*i+.001390604284)*i-.00079462082)*i-.002034254874)*i+.006549791214)*i-.010557625006)*i+.011630447319)*i-.009279453341)*i+.005353579108)*i-.002141268741)*i+.000535310849)*i+.999936657524):u=1),f>0?(u+1)*.5:(1-u)*.5)}function ut(n){var f,u,i,r=t.Convert,o,e;return isNaN(f=r.toDouble(n[0]))||isNaN(u=r.toDouble(n[1]))||isNaN(i=r.toDouble(n[2]))?t.Errors.Value:isNaN(o=r.toBool(n[3]))?t.Errors.Value:i<=0?t.Errors.Number:o?(e=[],e[0]=(f-u)/i,s(e)):r.toResult(Math.exp(-((f-u)*(f-u))/(2*i*i))/(Math.sqrt(2*Math.PI)*i))}function rt(n){var f,h,o,e=t.Convert,u,i,r;if(isNaN(f=e.toDouble(n[0]))||isNaN(h=e.toDouble(n[1]))||isNaN(o=e.toDouble(n[2])))return t.Errors.Value;if(f<0||1<f)return t.Errors.Number;if(o<=0)return t.Errors.Number;u=f-.5;if(Math.abs(u)>.42){i=f,u>0&&(i=1-f);if(i>22204460492503131e-32)i=Math.sqrt(-Math.log(i)),r=(((2.32121276858*i+4.85014127135)*i-2.29796479134)*i-2.78718931138)/((1.63706781897*i+3.54388924762)*i+1),u<0&&(r=-r);else return i>1e-300?(r=-2*Math.log(f),i=Math.log(6.2831853071795862*r),i=i/r+(2-i)/(r*r)+(-14+6*i-i*i)/(2*r*r*r),r=Math.sqrt(r*(1-i)),u<0&&(r=-r),r):u<0?-179769e303:179769e303}else i=u*u,r=u*(((-25.44106049637*i+41.39119773534)*i-18.61500062529)*i+2.50662823884)/((((3.13082909833*i-21.06224101826)*i+23.08336743743)*i+-8.4735109309)*i+1);var c=+r/1,l=.3989422804014327*Math.exp(-.5*c*c)/1,s=ut([r,0,1,!0]);return e.isError(s)?s:(r=r-(s-f)/l,h+o*r)}function l(n){var i,r=t.Convert;return isNaN(i=r.toDouble(n[0]))?t.Errors.Value:i<0||1<i?t.Errors.Number:rt([i,0,1])}function ce(n){var u,f,r=t.Convert,o,e,i;if(isNaN(u=r.toDouble(n[0]))||isNaN(f=r.toDouble(n[1])))return t.Errors.Value;o=r.toInt(n[2]);if(u<=0||u>=1)return t.Errors.Number;if(f<=0)return t.Errors.Number;if(o<1)return t.Errors.Number;return e=[],e[0]=u/2,i=l(e),r.isError(i)?i:(i=r.toDouble(i),-i*(f/Math.sqrt(o)))}function it(n){var r,i,t,u;return r=n,i=r+5.5,i=i-(r+.5)*Math.log(i),t=1.0000000001900149+76.180091729471457/(n+1),t-=86.505320329416776/(n+2),t+=24.014098240830911/(n+3),t-=1.231739572450155/(n+4),t+=.001208650973866179/(n+5),t-=5395239384953e-18/(n+6),u=Math.log(2.5066282746310011*t/r),u-i}function ti(n,t,i){var e,s,h,o,u,r,l,a,v,c,p=300,f=1e-50,y=1e-20;for(a=n+t,c=n+1,v=n-1,u=1,r=1-a*i/c,Math.abs(r)<f&&(r=f),r=1/r,h=r,e=1;e<=p;e++){s=e+e,o=(t-e)*e*i/((v+s)*(n+s)),r=1+o*r,Math.abs(r)<f&&(r=f),u=1+o/u,Math.abs(u)<f&&(u=f),r=1/r,h*=r*u,o=0-(n+e)*(a+e)*i/((n+s)*(c+s)),r=1+o*r,Math.abs(r)<f&&(r=f),u=1+o/u,Math.abs(u)<f&&(u=f),r=1/r,l=r*u,h*=l;if(Math.abs(l-1)<y)break}return h}function ni(n){for(var u=t.Convert,a=t._Helper,c,r,i,f,e,h,l,s=0;s<n.length;s++)if(u.isError(n[s]))return n[s];if(isNaN(c=u.toDouble(n[0]))||isNaN(r=u.toDouble(n[1]))||isNaN(i=u.toDouble(n[2])))return t.Errors.Value;f=0;if(a._argumentExists(n,3))if(isNaN(f=u.toDouble(n[3])))return t.Errors.Value;e=1;if(a._argumentExists(n,4))if(isNaN(e=u.toDouble(n[4])))return t.Errors.Value;if(r<=0||i<=0)return t.Errors.Number;if(c<f||e<c||f===e)return t.Errors.Number;var o=(c-f)/(e-f),w=!1,b=it(r+i),k=it(r),v=it(i),y=Math.log(o),p=Math.log(1-o);return l=Math.exp(b-k-v+r*y+i*p),h=o<(r+1)/(r+i+2)?l*ti(i,r,1-o)/i:1-l*ti(i,r,1-o)/i,w&&(h=-1),u.toResult(h)}function o(n){var t=[];t[0]=2;switch(n){case 1:return 22250738585072014e-324;case 2:return 17976931348623157e292;case 3:return Math.pow(2,-53);case 4:return Math.pow(2,-52);case 5:return u._MathHelper.log10(t);default:return 0}}function gt(n,i,r){var u,f,e,o;if(i<1)return 0;for(e=0,u=0,o=t.Convert,f=1;f<=i;f++){u=i-f,e+=Math.abs(o.toDouble(n[u]));if(e>r)return u}return u}function ii(n,i,r){var e,o,u,h,f,s;if(r<1||r>1e3)return NaN;if(n<-1.1||n>1.1)return NaN;for(h=n*2,u=o=0,e=0,s=t.Convert,f=1;f<=r;f++)u=o,o=e,e=h*o-u+s.toDouble(i[r-f]);return(e-u)*.5}function c(n){var t=[];t[0]=.16663894804518634,t[1]=-13849481760675638e-21,t[2]=981082564692473e-23,t[3]=-18091294755724941e-27,t[4]=62210980418926055e-30,t[5]=-3399615005417722e-31,t[6]=26831819984826989e-34,t[7]=-28680424353346431e-36,t[8]=39628370610464347e-38,t[9]=-68318887539857674e-40,t[10]=14292273559424982e-41,t[11]=-35475981581010704e-43,t[12]=10256800580104709e-44,t[13]=-34011022543167484e-46,t[14]=1276642195630063e-46;var r=0,u=0,f=0,i;return r===0&&(r=gt(t,15,o(3)),u=1/Math.sqrt(o(3)),f=Math.exp(Math.min(Math.log(o(2)/12),-Math.log(12*o(1))))),n<10?NaN:n<f?n<u?(i=10/n,ii(i*i*2-1,t,r)/n):1/(n*12):22204460492503131e-32*22204460492503131e-32}function fi(n){var t=[],i,r;return t[0]=1.037869356274377,t[1]=-.13364301504908918,t[2]=.019408249135520562,t[3]=-.0030107551127535777,t[4]=.00048694614797154852,t[5]=-81054881893175362e-21,t[6]=13778847799559525e-21,t[7]=-2380221089435897e-21,t[8]=41640416213865184e-23,t[9]=-73595828378075992e-24,t[10]=13117611876241675e-24,t[11]=-23546709317742423e-25,t[12]=42522773276035e-23,t[13]=-771908941348408e-25,t[14]=1407574648135907e-26,t[15]=-25769072058024682e-28,t[16]=47342406666294419e-29,t[17]=-87249012674742641e-30,t[18]=16124614902740551e-30,t[19]=-29875652015665774e-31,t[20]=55480701209082887e-32,t[21]=-10324619158271569e-32,t[22]=19250239203049852e-33,t[23]=-35955073465265147e-34,t[24]=6726454253787686e-34,t[25]=-1260262416873522e-34,t[26]=23644884408606211e-36,t[27]=-44419377050807936e-37,t[28]=83546594464034255e-38,t[29]=-15731559416479563e-38,t[30]=29653128740247425e-39,t[31]=-55949583481815949e-40,t[32]=10566354268835681e-40,t[33]=-19972483680670205e-41,t[34]=37782977818839361e-42,t[35]=-71531586889081743e-43,t[36]=13552488463674214e-43,t[37]=-25694673048487566e-44,t[38]=48747756066216946e-45,t[39]=-9254211253084972e-45,t[40]=17578597841760237e-46,t[41]=-3341002667773101e-46,t[42]=63533936180236182e-48,i=0,r=0,i===0&&(i=gt(t,43,.1*o(3)),r=-1+Math.sqrt(o(4))),n<=-1?NaN:Math.abs(n)>.375?Math.log(n+1):n*(1-n*ii(n/.375,t,i))}function p(n){var e,r,h,i,f,u,s=1,c=[1,.57721566490153287,-.65587807152025379,-.0420026350340952,.16653861138229151,-.0421977345555443,-.009621971527877,.007218943246663,-.0011651675918591,-.0002152416741149,.0001280502823882,-201348547807e-16,-12504934821e-16,1133027232e-15,-2056338417e-16,6116095e-15,50020075e-16,-11812746e-16,1043427e-16,77823e-16,-36968e-16,51e-14,-206e-16,-54e-16,14e-16],o;if(n>171)return 1e308;o=t.Convert;if(n===o.toInt(n))if(n>0)for(i=1,e=2;e<n;e++)i*=e;else i=1e308;else{if(Math.abs(n)>1){for(u=Math.abs(n),h=o.toInt(u),s=1,r=1;r<=h;r++)s*=u-r;u-=h}else u=n;for(f=c[24],r=23;r>=0;r--)f=f*u+c[r];i=1/(f*u),Math.abs(n)>1&&(i*=s,n<0&&(i=-Math.PI/(n*i*Math.sin(Math.PI*n))))}return i}function yf(n){var i,c,h,e,u,r,f=0,o=[.083333333333333329,-.0027777777777777779,.00079365079365079365,-.00059523809523809518,.00084175084175084182,-.0019175269175269181,.00641025641025641,-.029550653594771239,.17964437236883071,-1.3924322169059],s;i=n,s=t.Convert;if(n>0)if(n===1||n===2)return 0;else n>7||(f=s.toInt(7-n),i=n+f);else return 1e308;for(c=1/(i*i),h=2*Math.PI,u=o[9],r=8;r>=0;r--)u=u*c+o[r];e=u/i+.5*Math.log(h)+(i-.5)*Math.log(i)-i;if(n<=7)for(r=1;r<=f;r++)e-=Math.log(i-1),i-=1;return e}function h(n){var i,r=t.Convert;return isNaN(i=r.toDouble(n[0]))?t.Errors.Value:i<=0?t.Errors.Number:yf(i)}function v(n,i){var f,r,u,s,o,e;r=u=n,i<r&&(r=i),i>u&&(u=i);if(r<0)return NaN;else if(r===0)return 179769e303;if(r<10)if(u<10){var v=p(r),a=p(u),l=p(r+u);return Math.log(v*(a/l))}else return f=c(u)-c(r+u),s=[],s[0]=r,o=h(s),e=t.Convert,e.isError(o)?NaN:e.toDouble(o)+f+r-r*Math.log(r+u)+(u-.5)*fi(-r/(r+u));else return f=c(r)+c(u)-c(r+u),Math.log(u)*-.5+.91893853320467278+f+(r-.5)*Math.log(r/(r+u))+u*fi(-r/(r+u))}function ui(n,i,r){var e,tt,k,u,p,it,f,h,c,a,s,y,l,w,b=0,rt=0,g=0,d=0,nt;b===0&&(b=o(3),rt=Math.log(b),g=o(1),d=Math.log(g)),s=n,u=i,f=r,u/(u+f)<n&&(s=1-s,u=r,f=i);if((u+f)*s/(u+1)<b)e=0,c=u*Math.log(Math.max(s,g))-Math.log(u)-v(u,f),c>d&&s!==0&&(e=Math.exp(c)),(s!==n||u!==i)&&(e=1-e);else{p=f-Math.floor(f),p===0&&(p=1),c=u*Math.log(s)-v(p,u)-Math.log(u),e=0,nt=t.Convert;if(c>=d){e=Math.exp(c),h=e*u;if(p!==1)for(y=nt.toInt(Math.max(rt/Math.log(s),4)),l=1;l<=y;l++)a=l,h=h*(a-p)*s/a,e=e+h/(u+a)}if(f>1){for(c=u*Math.log(s)+f*Math.log(1-s)-v(u,f)-Math.log(f),w=nt.toInt(Math.max(c/d,0)),h=Math.exp(c-w*d),tt=1/(1-s),it=f*tt/(u+f-1),k=0,y=nt.toInt(f),f===y&&(y=y-1),l=1;l<=y;l++){if(it<=1&&h/b<=k)break;a=l,h=(f-a+1)*tt*h/(u+f-a),h>1&&(w=w-1,h=h*g),w===0&&(k=k+h)}e=e+k}(s!==n||u!==i)&&(e=1-e),e=Math.max(Math.min(e,1),0)}return e}function le(n,t,i){return t<=0||i<=0?NaN:n<=0?0:n>=1?1:ui(n,t,i)}function ri(n){for(var l=t.Convert,vt=t._Helper,s,p,b,c,k,lt,d=0;d<n.length;d++)if(l.isError(n[d]))return n[d];if(isNaN(s=l.toDouble(n[0]))||isNaN(p=l.toDouble(n[1]))||isNaN(b=l.toDouble(n[2])))return t.Errors.Value;c=0;if(vt._argumentExists(n,3))if(isNaN(c=l.toDouble(n[3])))return t.Errors.Value;k=1;if(vt._argumentExists(n,4))if(isNaN(k=l.toDouble(n[4])))return t.Errors.Value;if(s<=0||1<=s)return t.Errors.Number;if(p<=0||b<=0)return t.Errors.Number;var wt=2.30753,dt=.27061,ti=.99229,ni=.04481,h=0,at=3e-308,kt=1e-300,yt=at,pt=1-222e-18,gt=5,bt=6,st=2,w,ht,ct,a,g,tt,ot,nt,u,it,e,f,et,r,y,ft,o,rt,ut,i;i=s;if(p<h||b<h||s<h||s>1)return NaN;if(s===h||s===1)return s;for(tt=v(p,b),s>.5?(a=1-s,u=b,e=p,w=1):(a=s,u=p,e=b,w=0),f=Math.sqrt(-Math.log(a*a)),o=f-(wt+dt*f)/(1+(ti+ni*f)*f),u>1&&e>1?(f=(o*o-3)/6,et=1/(u+u-1),r=1/(e+e-1),nt=2/(et+r),ft=o*Math.sqrt(nt+f)/nt-(r-et)*(f+gt/bt-st/(3*nt)),i=u/(u+e*Math.exp(ft+ft))):(f=e+e,r=1/(9*e),r=f*Math.pow(1-r+o*Math.sqrt(r),3),r>h?(r=(4*u+f-st)/r,i=r>1?1-st/(r+1):Math.exp((Math.log(a*u)+tt)/u)):i=1-Math.exp((Math.log((1-a)*e)+tt)/e)),f=1-u,r=1-e,rt=h,g=1,i<yt?i=yt:i>pt&&(i=pt),ut=Math.max(kt,Math.pow(10,-13-2.5/(u*u)-.5/(a*a))),y=it=h,ht=0;ht<1e3;ht++){for(o=ui(i,u,e),o=(o-a)*Math.exp(tt+f*Math.log(i)+r*Math.log(1-i)),o*rt>h||(it=Math.max(Math.abs(g),at)),ot=1,ct=0;ct<1e3;ct++){g=ot*o;if(Math.abs(g)<it){y=i-g;if(y>=h&&y<=1){if(it<=ut)return w!==0&&(i=1-i),l.toResult((k-c)*i+c);if(Math.abs(o)<=ut)return w!==0&&(i=1-i),l.toResult((k-c)*i+c);if(y!==h&&y!==1)break}}ot/=3}lt=y;if(lt===i)return w!==0&&(i=1-i),l.toResult((k-c)*i+c);i=y,rt=o}return w!==0&&(i=1-i),l.toResult((k-c)*i+c)}function kf(n){var o,u,f=t.Convert,e,c,s,i,r,h;if(isNaN(o=f.toInt(n[0]))||isNaN(u=f.toInt(n[1])))return t.Errors.Value;if(isNaN(e=f.toDouble(n[2])))return t.Errors.Value;if(isNaN(c=f.toBool(n[3])))return t.Errors.Value;if(o<0||u<0||u<o||e<0||1<e)return t.Errors.Number;if(c)if(u===o)return 1;else{s=1-e,i=Math.pow(s,u);if(i===0){i=Math.pow(e,u);if(i===0)return t.Errors.Number;else{for(h=1-i,r=0;r<u-o&&i>0;r++)i*=f.toDouble(u-r)/f.toDouble((r+1)*s/e),h-=i;return h<0?0:h}}else{for(h=i,r=0;r<o&&i>0;r++)i*=f.toDouble(u-r)/f.toDouble((r+1)*e/s),h+=i;return h}}else{s=1-e,i=Math.pow(s,u);if(i===0){i=Math.pow(e,u);if(i===0)return t.Errors.Number;else{for(r=0;r<u-o&&i>0;r++)i*=f.toDouble(u-r)/f.toDouble((r+1)*s/e);return i}}else{for(r=0;r<o&&i>0;r++)i*=f.toDouble(u-r)/f.toDouble((r+1)*e/s);return i}}}function df(n){var o,f,i=t.Convert,r,e;if(isNaN(o=i.toInt(n[0]))||isNaN(f=i.toInt(n[1])))return t.Errors.Value;if(isNaN(r=i.toDouble(n[2])))return t.Errors.Value;if(r<0||r>=1)return t.Errors.Number;if(o+f-1<=0)return t.Errors.Number;e=u._MathHelper.combin(o+f-1,f-1);if(i.isError(e))return e;var c=i.toDouble(e),h=Math.pow(r,f),s=Math.pow(1-r,o);return i.toResult(c*h*s)}function lu(n){var f,u=t.Convert,e,s,h,r,o,i;if(isNaN(f=u.toInt(n[0])))return t.Errors.Value;if(isNaN(e=u.toDouble(n[1]))||isNaN(s=u.toDouble(n[2])))return t.Errors.Value;if(f<0||e<0||1<e||s<=0||1<=s)return t.Errors.Number;else{h=1-e,r=Math.pow(h,f);if(r===0){r=Math.pow(e,f);if(r===0)return t.Errors.Number;else{for(o=1-r,i=0;i<f&&o>=s;i++)r*=u.toDouble(f-i)/u.toDouble((i+1)*h/e),o-=r;return u.toDouble(f-i)}}else{for(o=r,i=0;i<f&&o<s;i++)r*=u.toDouble(f-i)/u.toDouble((i+1)*e/h),o+=r;return u.toDouble(i)}}}function pt(n){for(var l=t.Convert,y,u,h,p,v,b,a=0;a<n.length;a++)if(l.isError(n[a]))return n[a];if(isNaN(y=l.toDouble(n[0]))||isNaN(u=l.toDouble(n[1])))return t.Errors.Value;if(y<0)return t.Errors.Number;if(u<1||u>Math.pow(10,10))return t.Errors.Number;var d=Math.log(Math.sqrt(Math.PI)),k=1/Math.sqrt(Math.PI),i,c,r,e,f,w=0,o=y;f=.5*o,h=u%2==0,u>1&&(w=Math.exp(-f)),p=[],p[0]=-Math.sqrt(o),v=s(p);if(l.isError(v))return v;b=l.toDouble(v),c=h?w:2*b;if(u>2){o=.5*(u-1),r=h?1:.5;if(f>20){i=h?0:d,e=Math.log(f);while(r<=o)i=Math.log(r)+i,c+=Math.exp(e*r-f-i),r+=1;return c}else{i=h?1:k/Math.sqrt(f),e=0;while(r<=o)i=i*(f/r),e=e+i,r+=1;return e*w+c}}else return c}function yt(n){var i,r,w,o=t.Convert,et,g,rt,ft;if(isNaN(i=o.toDouble(n[0]))||isNaN(r=o.toDouble(n[1]))||isNaN(w=o.toDouble(n[2])))return t.Errors.Value;if(isNaN(et=o.toBool(n[3])))return t.Errors.Value;if(i<0||r<=0||w<=0)return t.Errors.Number;if(et===!1){g=Math.pow(w,r);if(isNaN(g)||!isFinite(g))return t.Errors.DivideByZero;var at=1/(g*p(r)),ct=Math.pow(i,r-1),lt=Math.exp(-(i/w)),st=ct*lt;return at*st}else{var v,k,l,a,nt,tt,e,c,d,s,y,it,u,f,yt=1/3,vt=1e8,b=1e37,ht=1e3,ot=-88;i=i/w;if(i<=0)return t.Errors.Number;if(r>ht)return v=Math.sqrt(r)*3*(Math.pow(i/r,yt)+1/(r*9)-1),f=ut([v,0,1,!0]),o.isError(f)?f:o.toDouble(f);if(i>vt)return 1;if(i<=1||i<r){rt=[],rt[0]=r+1,f=h(rt);if(o.isError(f))return f;e=r*Math.log(i)-i-o.toDouble(f),c=1,u=1,s=r;do s=s+1,c=c*i/s,u=u+c;while(c>22204460492503131e-32);e=e+Math.log(u),u=0,e<ot||(u=Math.exp(e))}else{ft=[],ft[0]=r,f=h(ft);if(o.isError(f))return f;for(e=r*Math.log(i)-i-o.toDouble(f),s=1-r,y=s+i+1,c=0,v=1,k=i,l=i+1,a=i*y,u=l/a;;){s=s+1,y=y+2,c=c+1,it=s*c,nt=y*l-it*v,tt=y*a-it*k;if(Math.abs(tt)>0){d=nt/tt;if(Math.abs(u-d)<=Math.min(22204460492503131e-32,22204460492503131e-32*d))break;u=d}v=l,k=a,l=nt,a=tt,Math.abs(nt)<b||(v=v/b,k=k/b,l=l/b,a=a/b)}e=e+Math.log(u),u=1,e<ot||(u=1-Math.exp(e))}return u}}function vt(n){var f,o,b,c=t.Convert,d,u;if(isNaN(f=c.toDouble(n[0]))||isNaN(o=c.toDouble(n[1]))||isNaN(b=c.toDouble(n[2])))return t.Errors.Value;var ft=4.67,si=6.66,et=6.73,oi=13.32,ei=60,li=70,at=84,ci=105,hi=120,ii=127,ti=140,ni=1175,ht=210,fi=252,ui=2264,ri=294,ai=346,vt=420,nr=462,gi=606,di=672,rr=707,ir=735,tr=889,pi=932,yi=966,kt=1141,vi=1182,ki=1278,bi=1740,g=2520,ut=5040,wi=5e-7,wt=.01,pt=5e-7,dt=20,gt=2e-6,bt=.999998,r,l,e,i,p,s,v,y,w,k,st,it,ot,ct,lt,a,tt,nt;if(f<0||1<f||o<=0||b<=0)return t.Errors.Number;if(f<gt)return 0;if(f>bt)return 179769e303;v=2*o,e=o-1,d=[],d[0]=o,u=h(d);if(c.isError(u))return u;p=c.toDouble(u);if(v<-1.24*Math.log(f)){i=Math.pow(f*o*Math.exp(p+o*.69314718055994529),1/o);if(i<wi)return NaN}else if(v>.32){u=rt([f,0,1]);if(c.isError(u))return u;tt=c.toDouble(u),s=.222222/v,i=v*Math.pow(tt*Math.sqrt(s)+1-s,3),i>2.2*v+6&&(i=-2*(Math.log(1-f)-e*Math.log(.5*i)+p))}else{i=.4,r=Math.log(1-f)+p+e*.69314718055994529;do w=i,s=1+i*(ft+i),y=i*(et+i*(si+i)),a=-.5+(ft+2*i)/s-(et+i*(oi+3*i))/y,i-=(1-Math.exp(r+.5*i)*y/s)/a;while(Math.abs(w/i-1)>wt)}for(nt=1;nt<=dt;nt++){w=i,s=.5*i,u=yt([s,o,1,!0]);if(c.isError(u))return u;y=f-c.toDouble(u),a=y*Math.exp(o*.69314718055994529+p+s-e*Math.log(i)),l=a/i,r=.5*a-l*e,k=(ht+r*(ti+r*(ci+r*(at+r*(li+ei*r)))))/vt,st=(vt+r*(ir+r*(yi+r*(kt+ki*r))))/g,it=(ht+r*(nr+r*(rr+pi*r)))/g,ot=(fi+r*(di+vi*r)+e*(ri+r*(tr+bi*r)))/ut,ct=(at+ui*r+e*(ni+gi*r))/g,lt=(hi+e*(ai+ii*e))/ut,i=i+a*(1+.5*a*k-l*e*(k-l*(st-l*(it-l*(ot-l*(ct-l*lt))))));if(Math.abs(w/i-1)>pt)return.5*b*i}return.5*b*i}function er(n){for(var f=t.Convert,u,r,o,e,i=0;i<n.length;i++)if(f.isError(n[i]))return n[i];return isNaN(u=f.toDouble(n[0]))?t.Errors.Value:isNaN(r=f.toInt(n[1]))?t.Errors.Value:u<0||u>1?t.Errors.Number:r<1||r>Math.pow(10,10)?t.Errors.Number:(o=1-u,e=vt([o,.5*r,2]),f.toDouble(e))}function ar(n){var v=0,l,h=t.Convert,u=t._ArrayHelper,i=u.getRowCount(n[0]),r=u.getColumnCount(n[0]),o,e,c,s,a,f;if(i!==u.getRowCount(n[1])||r!==u.getColumnCount(n[1]))return t.Errors.NotAvailable;if(i>1&&r>1)l=(i-1)*(r-1);else if(i>1&&r===1)l=i-1;else if(i===1&&r>1)l=r-1;else return t.Errors.NotAvailable;for(o=0;o<i;o++)for(e=0;e<r;e++){c=u.getValue(n[0],o,e);if(h.isError(c))return c;s=u.getValue(n[1],o,e);if(h.isError(s))return s;if(isNaN(a=h.toDouble(c))||isNaN(f=h.toDouble(s)))return t.Errors.Value;if(f===0)return t.Errors.DivideByZero;v+=(a-f)*(a-f)/f}return pt([v,l])}function vr(n){var c=0,l=0,b=0,d=0,k=0,w,p,y,a,r=t.Convert,o=t._ArrayHelper,v=o.getLength(n[0]),i,u,h,s,e,f;if(v!==o.getLength(n[1]))return t.Errors.NotAvailable;for(i=0,u=0;u<v;u++){e=o.getValueByIndex(n[0],u),f=o.getValueByIndex(n[1],u);if(r.isNumber(e)&&r.isNumber(f))h=r.toDouble(e),s=r.toDouble(f),c+=h,l+=s,b+=h*h,d+=s*s,i++;else if(r.isError(e))return e;else if(r.isError(f))return f}if(i<=1)return t.Errors.DivideByZero;w=c/i,p=l/i,y=Math.sqrt((i*b-c*c)/(i*(i-1))),a=Math.sqrt((i*d-l*l)/(i*(i-1)));if(y===0||a===0)return t.Errors.DivideByZero;for(u=0;u<v;u++)e=o.getValueByIndex(n[0],u),f=o.getValueByIndex(n[1],u),r.isNumber(e)&&r.isNumber(f)&&(h=r.toDouble(e),s=r.toDouble(f),k+=(h-w)*(s-p));return r.toResult(k/r.toDouble((i-1)*y*a))}function cr(n){for(var r=t.Convert,e,u,o,f,i=0;i<n.length;i++)if(r.isError(n[i]))return n[i];return isNaN(e=r.toDouble(n[0]))||isNaN(u=r.toDouble(n[1]))?t.Errors.Value:isNaN(o=r.toDouble(n[2]))?t.Errors.Value:e<0?t.Errors.Number:u<=0?t.Errors.Number:(f=Math.exp(-u*e),r.toResult(o?1-f:u*f))}function wt(n){var f,i,u,r=t.Convert;if(isNaN(f=r.toDouble(n[0]))||isNaN(i=r.toDouble(n[1]))||isNaN(u=r.toDouble(n[2])))return t.Errors.Value;if(f<0||i<1||i>=Math.pow(10,10)||u<1||u>=Math.pow(10,10))return t.Errors.Number;var h=i*f/(i*f+u),o=.5*i,s=.5*u,e=ni([h,o,s]);return r.isError(e)?e:1-r.toDouble(e)}function nr(n){var e,u,i,r=t.Convert,o,f;if(isNaN(e=r.toDouble(n[0]))||isNaN(u=r.toDouble(n[1]))||isNaN(i=r.toDouble(n[2])))return t.Errors.Value;if(e<0||1<e||u<1||u>=Math.pow(10,10)||i<1||i>=Math.pow(10,10))return t.Errors.Number;return o=1-e,f=ri([1-o,i/2,u/2]),r.isError(f)?f:(1/r.toDouble(f)-1)*(i/u)}function gi(n){var i,r=t.Convert;return isNaN(i=r.toDouble(n[0]))?t.Errors.Value:i<=-1||1<=i?t.Errors.Number:Math.log((1+i)/(1-i))/2}function di(n){var u,f=t.Convert,i,r;if(isNaN(u=f.toDouble(n[0])))return t.Errors.Value;return i=Math.exp(2*u)-1,r=Math.exp(2*u)+1,!isFinite(i)&&i>0&&!isFinite(r)&&r>0?1:i/r}function dt(n,i){for(var o,e,f,h=t.Convert,u=t._ArrayHelper,c=u.getLength(i),s,r=0;r<u.getLength(i);r++)s=u.getValueByIndex(i,r),h.isNumber(s)&&(o=h.toDouble(u.getValueByIndex(i,r)),e=o-n.M,f=e/(n.N+1),n.M+=f,n.Q+=n.N*e*f,n.N++,n.sum+=o)}function tr(n){for(var a=n[0],l=n[1],o=t.Convert,s=t._ArrayHelper,u,i,h,c,f,v,y,e,r=0;r<s.getLength(a);r++){u=s.getValueByIndex(a,r);if(o.isError(u))return u}for(r=0;r<s.getLength(l);r++){u=s.getValueByIndex(l,r);if(o.isError(u))return u}i={N:0,M:0,Q:0,afun_flag:!1,sum:0},dt(i,a),v=i.N-1;if(i.N===1)return t.Errors.DivideByZero;h=i.Q/(i.N-1);if(h===0)return t.Errors.DivideByZero;i.N=0,i.M=0,i.Q=0,i.afun_flag=!1,i.sum=0,dt(i,l),y=i.N-1;if(i.N===1)return t.Errors.DivideByZero;c=i.Q/(i.N-1);if(c===0)return t.Errors.DivideByZero;return e=wt([h/c,v,y]),o.isError(e)?e:(f=(1-o.toDouble(e))*2,f>1&&(f=2-f),f)}function ir(n){var r=t.Convert,s=r.toInt(n[0]),o=r.toInt(n[1]),e=r.toInt(n[2]),f=r.toInt(n[3]),i,l,c,h;if(s<0||s>Math.min(o,e))return t.Errors.Number;if(s<Math.max(0,o-f+e))return t.Errors.Number;if(o<0||o>f)return t.Errors.Number;if(e<0||e>f)return t.Errors.Number;if(f<0)return t.Errors.Number;i=u._MathHelper.combin(e,s);if(r.isError(i))return i;l=r.toDouble(i),i=u._MathHelper.combin(f-e,o-s);if(r.isError(i))return i;return c=r.toDouble(i),i=u._MathHelper.combin(f,o),r.isError(i)?i:(h=r.toDouble(i),r.toResult(l*c/h))}function yr(n){var u,e,i,r=t.Convert,f;return isNaN(u=r.toDouble(n[0]))||isNaN(e=r.toDouble(n[1]))||isNaN(i=r.toDouble(n[2]))?t.Errors.Value:u<=0||i<=0?t.Errors.Number:(f=[],f[0]=(Math.log(u)-e)/i,s(f))}function fu(n){var u,s,e,i=t.Convert,f,r,o;if(isNaN(u=i.toDouble(n[0]))||isNaN(s=i.toDouble(n[1]))||isNaN(e=i.toDouble(n[2])))return t.Errors.Value;if(e<=0||u<0||u>1)return t.Errors.Number;return f=[],f[0]=u,r=l(f),i.isError(r)?r:(o=i.toDouble(r),i.toResult(Math.exp(s+e*o)))}function eu(n){var u=0,r=0,c=0,a=0,p=0,h=t.Convert,s=t._ArrayHelper,y=s.getLength(n[0]),i,o,v,l,e,f;if(y!==s.getLength(n[1]))return t.Errors.NotAvailable;for(i=0,o=0;o<y;o++)v=s.getValueByIndex(n[0],o),l=s.getValueByIndex(n[1],o),h.isNumber(v)&&h.isNumber(l)&&(e=h.toDouble(v),f=h.toDouble(l),u+=e,r+=f,c+=e*e,a+=f*f,p+=e*f,i++);return i*c-u*u==0||i*a-r*r==0?t.Errors.DivideByZero:(i*p-u*r)/Math.sqrt((i*c-u*u)*(i*a-r*r))}function ru(n){var p=n[0],w=n[1],o=0,h=0,y=0,b=0,k=0,e=0,r=t.Convert,s=t._ArrayHelper,d=s.getLength(w),i,c,l,f,u,a,v;if(d!==s.getLength(p))return t.Errors.NotAvailable;for(i=0;i<d;i++)c=s.getValueByIndex(w,i),l=s.getValueByIndex(p,i),r.isNumber(c)&&r.isNumber(l)&&(f=r.toDouble(c),u=r.toDouble(l),o+=f,h+=u,y+=f*f,b+=u*u,k+=f*u,e++);return a=Math.sqrt((e*y-o*o)*(e*b-h*h)),a===0?t.Errors.DivideByZero:(v=(e*k-o*h)/a,r.toResult(v*v))}function kt(n){for(var i=1,t=n;t>1;t--)i*=t;return i}function hu(n){var r,e=t.Convert,i,o,f,u;if(isNaN(r=e.toInt(n[0])))return t.Errors.Value;if(isNaN(i=e.toDouble(n[1])))return t.Errors.Value;if(isNaN(o=e.toBool(n[2])))return t.Errors.Value;f=0;if(r<=0||i<=0)return t.Errors.Number;if(o)for(u=0;u<=r;u++)f+=Math.exp(-i)*Math.pow(i,u)/kt(u);else f=Math.exp(-i)*Math.pow(i,r)/kt(r);return e.toResult(f)}function sr(n){var o,f=t.Convert,r=t._ArrayHelper,s,i,e,u;if(isNaN(o=f.toDouble(n[2])))return t.Errors.Value;s=o;if(t._Helper._argumentExists(n,3))if(isNaN(s=f.toDouble(n[3])))return t.Errors.Value;var h=0,c=0,l=r.getLength(n[0]);if(l!==r.getLength(n[1]))return t.Errors.NotAvailable;for(i=0;i<l;i++)if(r.getValueByIndex(n[0],i)!==null&&r.getValueByIndex(n[1],i)!==null){if(isNaN(e=f.toDouble(r.getValueByIndex(n[0],i)))||isNaN(u=f.toDouble(r.getValueByIndex(n[1],i))))return t.Errors.Value;if(u<=0||1<u)return t.Errors.Number;o>e||e>s||(h+=u),c+=u}return c!==1?t.Errors.Number:h}function cu(n){var c;if(n[0]===undefined||n[0]===null)throw"Invalid arguments";for(var h=0,y=0,v=0,a,l,r=0,e,o,f,u=t.Convert,s=t._ArrayHelper,i=0;i<n.length;i++)if(s.isArrayOrReference(n[i]))for(e=0;e<s.getLength(n[i]);e++){f=s.getValueByIndex(n[i],e);if(u.isNumber(f))o=u.toDouble(f),h+=o,y+=o*o,r++;else if(u.isError(f))return f}else if(u.isError(n[i]))return n[i];else{if(isNaN(c=u.toDouble(n[i])))return t.Errors.Value;h+=c,y+=c*c,r++}if(r<=2)return t.Errors.DivideByZero;a=h/r,l=Math.sqrt((r*y-h*h)/(r*(r-1)));if(l===0)return t.Errors.DivideByZero;for(i=0;i<n.length;i++)if(s.isArrayOrReference(n[i]))for(e=0;e<s.getLength(n[i]);e++){f=s.getValueByIndex(n[i],e);if(u.isNumber(f))o=u.toDouble(f),v+=Math.pow((o-a)/l,3);else if(u.isError(f))return f}else{if(isNaN(o=u.toDouble(n[i])))return t.Errors.Value;v+=Math.pow((o-a)/l,3)}return u.toResult(r*v/((r-1)*(r-2)))}function ou(n){var f,u,i,r=t.Convert;return isNaN(f=r.toDouble(n[0]))||isNaN(u=r.toDouble(n[1]))||isNaN(i=r.toDouble(n[2]))?t.Errors.Value:i<=0?t.Errors.Number:(f-u)/i}function su(n){var u,s=t.Convert,h,f,c,o,e;if(isNaN(u=s.toDouble(n[0])))return t.Errors.Value;if(isNaN(h=s.toInt(n[1]))||isNaN(f=s.toInt(n[2])))return t.Errors.Value;if(h<1||f!==1&&f!==2||u<0)return t.Errors.Number;var i=h,v=u/Math.sqrt(i),l=i/(i+u*u),y=i-2,p=i%2,r=1,a=1;i=1,c=2+p,o=c;if(y>=2)for(e=s.toInt(c);e<=y;e=e+2){a=a*l*(o-1)/o,r+=a;if(r===i)break;i=r,o+=2}return p!==1?f*(1-(.5+.5*v*Math.sqrt(l)*r)):(h===1&&(r=0),f*(1-(.5+(v*l*r+Math.atan(v))*.3183098862)))}function iu(n){var v,h=t.Convert,r,k,e,c,s,y,nt,f,o,u,i,d,g,a,b,w,p;if(isNaN(v=h.toDouble(n[0])))return t.Errors.Value;if(isNaN(r=h.toInt(n[1])))return t.Errors.Value;k=1e-12;if(v<0||1<v||r<1||r>Math.pow(10,10))return t.Errors.Number;g=v/2,a=g;if(r>1e20)return b=[],b[0]=g,l(b);a<.5?(d=0,f=2*a):(d=1,f=2*(1-a));if(Math.abs(r-2)<k)o=f>0?Math.sqrt(2/(f*(2-f))-2):179769e303;else if(h.toDouble(r)<1+k)f>0?(nt=(f+1)*1.5707963267948966,o=-Math.tan(nt)):o=179769e303;else{e=1/(r-.5),c=48/(e*e),s=((20700*e/c-98)*e-16)*e+96.36,y=((94.5/(c+s)-3)/c+1)*Math.sqrt(e*1.5707963267948966)*r,i=Math.pow(y*f,2/r);if(i>.05+e){w=[],w[0]=.5*f,p=l(w);if(h.isError(p))return p;u=h.toDouble(p),i=u*u,r<5&&(s=s+.3*(r-4.5)*(u+.6)),s=(((.05*y*u-5)*u-7)*u-2)*u+c+s,i=(((((.4*i+6.3)*i+36)*i+94.5)/s-i-3)/c+1)*u,i=e*i*i,i=i>.002?Math.exp(i)-1:.5*i*i+i}else i=((1/(((r+6)/(r*i)-.089*y-.822)*(r+2)*3)+.5/(r+4))*i-1)*(r+1)/(r+2)+1/i;o=Math.sqrt(r*i)}return d!==0&&(o=-o),h.toResult(o)}function bt(n,i){for(var f,e,u,s=t.Convert,o=t._ArrayHelper,h=o.getLength(i),r=0;r<h;r++)f=s.toDouble(o.getValueByIndex(i,r)),e=f-n.M,u=e/(n.N+1),n.M+=u,n.Q+=n.N*e*u,n.N++,n.sum+=f}function ft(n){var f=[76.180091729471457,-86.505320329416776,24.014098240830911,-1.231739572450155,.001208650973866179,-5395239384953e-18],u=n,r=n+5.5,i,t;for(r-=(n+.5)*Math.log(r),i=1.0000000001900149,t=0;t<=5;t++)i+=f[t]/++u;return-r+Math.log(2.5066282746310007*i/n)}function pr(n,i){var h=t.Convert,u=t._ArrayHelper,e=u.getLength(n),c=u.getLength(i),f,r,o,s;if(e!==c)return t.Errors.NotAvailable;for(f=new Array(e),r=0;r<e;r++){if(isNaN(o=h.toDouble(u.getValueByIndex(n,r)))||isNaN(s=h.toDouble(u.getValueByIndex(i,r))))return t.Errors.Value;f[r]=o-s}return f}function wr(n,i,r){var d=r===0||r===1?0:Math.exp(ft(n+i)-ft(n)-ft(i)+n*Math.log(r)+i*Math.log(1-r)),y=r<(n+1)/(n+i+2),v,c,p,o,s,h,l,a;y&&(v=n,n=i,i=v,r=1-r);var f=44501477170144028e-324,g=100,b=n+i,w=n+1,k=n-1,e=1,u=1-b*r/w;for(Math.abs(u)<f&&(u=f),u=1/u,c=u,p=t.Convert,o=1,s=2;o<=g;o++,s+=2){h=o*(i-o)*r/((k+s)*(n+s)),u=1+h*u,Math.abs(u)<f&&(u=f),e=1+h/e,Math.abs(e)<f&&(e=f),u=1/u,c*=u*e,h=-(n+o)*(b+o)*r/((n+s)*(w+s)),u=1+h*u,Math.abs(u)<f&&(u=f),e=1+h/e,Math.abs(e)<f&&(e=f),u=1/u,l=u*e,c*=l;if(Math.abs(p.toDouble(l-1))<494065645841247e-338)return a=d*c/n,y?1-a:a}return t.Errors.Number}function nu(n){var f=n[0],st=n[1],et=n[2],ut=n[3],r=t.Convert,d,y,a,tt,nt,u,ot,v,g,c,l;if(!r.isNumber(et)||!r.isNumber(ut))return t.Errors.Value;var it=r.toInt(et),b=r.toInt(ut),k,ft,e,w,p,rt,o,i={N:0,M:0,Q:0,sum:0,afun_flag:!1},s,h;if(it!==1&&it!==2||b<1||3<b)return t.Errors.Number;if(b===1){f=pr(f,st);if(r.isError(f))return f;for(y=a=tt=nt=u=d=0,ot=f.length,v=0;v<ot;v++){if(isNaN(g=r.toDouble(f[v])))return t.Errors.Value;y=g-tt,a=y/(u+1),tt+=a,nt+=u*y*a,u++,d+=g}if(u-1==0||u===0)return t.Errors.DivideByZero;w=Math.sqrt(nt/(u-1));if(isNaN(w)||!isFinite(w))return t.Errors.Number;k=d/u,e=k/(w/Math.sqrt(u)),o=u-1}else i.N=0,i.M=0,i.Q=0,i.afun_flag=!1,i.sum=0,bt(i,f),p=i.Q/(i.N-1),k=i.sum/i.N,s=i.N,i.N=0,i.M=0,i.Q=0,i.afun_flag=!1,i.sum=0,bt(i,st),rt=i.Q/(i.N-1),ft=i.sum/i.N,h=i.N,b!==2?(c=p/s/(p/s+rt/h),o=1/(c*c/r.toDouble(s-1)+(1-c)*(1-c)/r.toDouble(h-1))):o=r.toDouble(s+h-2),e=(k-ft)/Math.sqrt(p/r.toDouble(s)+rt/r.toDouble(h));return e=Math.abs(e),l=wr(.5*o,.5,o/(o+e*e)),r.isError(l)?l:.5*it*r.toDouble(l)}function tu(n){var w,r=t.Convert,c=t._ArrayHelper,a,o,e,l,h;if(isNaN(w=r.toDouble(n[1])))return t.Errors.Value;a=0;if(t._Helper._argumentExists(n,2))if(isNaN(a=r.toDouble(n[2])))return t.Errors.Value;var f=0,y=0,p,v,i=0,u;if(c.isArrayOrReference(n[0]))for(o=0;o<c.getLength(n[0]);o++){e=c.getValueByIndex(n[0],o);if(r.isNumber(e))u=r.toDouble(e),f+=u,y+=u*u,i++;else if(r.isError(e))return e}else{if(isNaN(u=r.toDouble(n[0])))return t.Errors.Value;f+=u,y+=u*u,i++}if(i===0)return t.Errors.NotAvailable;if(i===1)return t.Errors.DivideByZero;p=f/i,v=t._Helper._argumentExists(n,2)?a:Math.sqrt((i*y-f*f)/(i*(i-1)));if(v===0)return t.Errors.DivideByZero;return l=[],l[0]=(p-w)/(v/Math.sqrt(i)),h=s(l),r.isError(h)?h:r.toResult(1-r.toDouble(h))}function dr(n){var f,i,u,r=t.Convert,e;return isNaN(f=r.toDouble(n[0]))||isNaN(i=r.toDouble(n[1]))||isNaN(u=r.toDouble(n[2]))?t.Errors.Value:isNaN(e=r.toBool(n[3]))?t.Errors.Value:f<0||i<=0||u<=0?t.Errors.Number:e?r.toResult(1-Math.exp(-Math.pow(f/u,i))):r.toResult(i/Math.pow(u,i)*Math.pow(f,i-1)*Math.exp(-Math.pow(f/u,i)))}function gr(n){var i=t.Convert,u=i.toDouble(i.toInt(n[0])),f=i.toDouble(i.toInt(n[1])),e=1,r;if(u<0||f<0||u<f)return t.Errors.Number;for(r=u-f+1;r<=u;r++)e*=r;return i.toResult(e)}function kr(n){var y,i=t.Convert,h=t._ArrayHelper,r,f,o,e;if(isNaN(y=i.toDouble(n[0])))return t.Errors.Value;var c,s,v=0,u=0,l=0,b=0,w,a,p=h.getLength(n[1]);if(p!==h.getLength(n[2]))return t.Errors.NotAvailable;for(r=0,f=0;f<p;f++){o=h.getValueByIndex(n[1],f),e=h.getValueByIndex(n[2],f);if(i.isNumber(o)&&i.isNumber(e))c=i.toDouble(o),s=i.toDouble(e),v+=c,u+=s,l+=s*s,b+=s*c,r++;else if(i.isError(o))return o;else if(i.isError(e))return e}return r===0?t.Errors.DivideByZero:r*l-u*u==0?t.Errors.DivideByZero:(a=(r*b-u*v)/(r*l-u*u),w=v/r-a*(u/r),i.toResult(w+a*y))}function br(n){var l,s,c=0,u=0,a=0,y=0,v,r=t.Convert,h=t._ArrayHelper,p=h.getLength(n[0]),i,o,e,f;if(p!==h.getLength(n[1]))return t.Errors.NotAvailable;for(i=0,o=0;o<p;o++){e=h.getValueByIndex(n[0],o),f=h.getValueByIndex(n[1],o);if(r.isNumber(e)&&r.isNumber(f))l=r.toDouble(e),s=r.toDouble(f),c+=l,u+=s,a+=s*s,y+=s*l,i++;else if(r.isError(e))return e;else if(r.isError(f))return f}return i===0?t.Errors.DivideByZero:i*a-u*u==0?t.Errors.DivideByZero:(v=(i*y-u*c)/(i*a-u*u),r.toResult(c/i-v*(u/i)))}function uu(n){for(var c=t.Convert,kt=t._Helper,v=c._toArray(n[0]),l=new t.Array,tt,u,r,f,s,y,w,a,k,e,rt,it,b,et,o,d,h,g,at,ht,l=kt._argumentExists(n,1)?c._toArray(n[1]):v,st=kt._argumentExists(n,2)?c.toBool(n[2]):!0,p=kt._argumentExists(n,3)?c.toBool(n[3]):!1,i=0;i<v.getRowCount();i++)for(u=0;u<v.getColumnCount();u++)if(c.isError(v.getValue(i,u)))return v.getValue(i,u);else if(!c.isNumber(v.getValue(i,u)))return t.Errors.Value;for(i=0;i<l.getRowCount();i++)for(u=0;u<l.getColumnCount();u++){if(c.isError(l.getValue(i,u)))return l.getValue(i,u);if(!c.isNumber(l.getValue(i,u)))return t.Errors.Value}if(v.getRowCount()===l.getRowCount()&&v.getColumnCount()===l.getColumnCount()&&(st||!p)){s=c.toDouble(l.getRowCount()*l.getColumnCount());var nt=0,ft=0,ut=0,bt=0,ot=0,lt;for(i=0;i<l.getRowCount();i++)for(u=0;u<l.getColumnCount();u++){if(isNaN(y=c.toDouble(l.getValue(i,u)))||isNaN(w=c.toDouble(v.getValue(i,u))))return t.Errors.Value;nt+=y,ft+=y*y,ut+=w,bt+=w*w,ot+=y*w}st?(f=(s*ot-nt*ut)/(s*ft-nt*nt),lt=(ut*ft-nt*ot)/(s*ft-nt*nt)):(f=ot/ft,lt=0),e=[],e[0]=[],e[0][0]=f,e[0][1]=lt;if(p){e[1]=[],e[2]=[],e[3]=[],e[4]=[];var ct=s*ft-nt*nt,wt=s*bt-ut*ut,vt=s*ot-nt*ut,yt=bt-lt*ut-f*ot,pt=vt*vt/(ct*wt);s<3?(e[1][0]=t.Errors.Number,e[1][1]=t.Errors.Number,e[2][1]=t.Errors.Number,e[3][0]=t.Errors.Number):(e[1][0]=Math.sqrt(yt*s/(ct*(s-2))),e[1][1]=Math.sqrt(yt*ft/(ct*(s-2))),e[2][1]=Math.sqrt((wt-vt*vt/ct)/(s*(s-2))),e[3][0]=pt===1?t.Errors.Number:pt*(s-2)/(1-pt)),e[2][0]=pt,e[3][1]=s-2,e[4][0]=wt/s-yt,e[4][1]=yt}return e}else if(v.getColumnCount()===1&&v.getRowCount()===l.getRowCount()||v.getRowCount()===1&&v.getColumnCount()===l.getColumnCount()){w=[],y=[];if(v.getColumnCount()===1){for(s=l.getRowCount(),f=l.getColumnCount(),i=0;i<s;i++){if(isNaN(tt=c.toDouble(v.getValue(i,0))))return t.Errors.Value;w[i]=tt}for(i=0;i<s;i++)for(y[i]=[],u=0;u<f;u++){if(isNaN(tt=c.toDouble(l.getValue(i,u))))return t.Errors.Value;y[i][u]=tt}}else{for(s=l.getColumnCount(),f=l.getRowCount(),y=[],w=[],i=0;i<s;i++){if(isNaN(tt=c.toDouble(v.getValue(0,i))))return t.Errors.Value;w[i]=tt}for(i=0;i<s;i++)for(y[i]=[],u=0;u<f;u++){if(isNaN(tt=c.toDouble(l.getValue(u,i))))return t.Errors.Value;y[i][u]=tt}}for(o=[],r=0;r<f+1;r++)o[r]=[];for(a=0;a<f+1;a++)for(k=0;k<f+2;k++)o[a][k]=0;for(d=[],a=0;a<f+2;a++)d[a]=0;for(h=p?[]:null,r=0;r<s;r++)for(d[f+1]=d[f+1]+w[r]*w[r],o[0][f+1]=o[0][f+1]+w[r],d[0]=o[0][f+1],i=0;i<f;i++)for(o[0][i+1]=o[0][i+1]+y[r][i],o[i+1][0]=o[0][i+1],o[i+1][f+1]=o[i+1][f+1]+y[r][i]*w[r],d[i+1]=o[i+1][f+1],u=i;u<f;u++)o[u+1][i+1]=o[u+1][i+1]+y[r][i]*y[r][u],o[i+1][u+1]=o[u+1][i+1];o[0][0]=s;if(p){for(a=0;a<f+1;a++)for(h[a]=[],k=0;k<f+1;k++)h[a][k]=0;for(i=0;i<f+1;i++)h[i][i]=1}if(st)for(i=0;i<f+1;i++){if(o[i][i]===0){for(rt=!1,u=i+1;!rt&&u<f+1;u++)if(o[u][i]!==0){for(r=0;r<f+2;r++)it=o[i][r],o[i][r]=o[u][r],o[u][r]=it;if(p)for(r=0;r<f+1;r++)it=h[i][r],h[i][r]=h[u][r],h[u][r]=it;rt=!0}if(!rt)return t.Errors.Number}for(b=1/o[i][i],r=0;r<f+2;r++)o[i][r]=o[i][r]*b;if(p)for(r=0;r<f+1;r++)h[i][r]=h[i][r]*b;for(u=0;u<f+1;u++)if(u!==i){for(b=-o[u][i],r=0;r<f+2;r++)o[u][r]=o[u][r]+b*o[i][r];if(p)for(r=0;r<f+1;r++)h[u][r]=h[u][r]+b*h[i][r]}}else for(i=1;i<f+1;i++){if(o[i][i]===0){for(rt=!1,u=i+1;!rt&&u<f+1;u++)if(o[u][i]!==0){for(r=0;r<f+2;r++)it=o[i][r],o[i][r]=o[u][r],o[u][r]=it;if(p)for(r=0;r<f+1;r++)it=h[i][r],h[i][r]=h[u][r],h[u][r]=it;rt=!0}if(!rt)return t.Errors.Number}for(b=1/o[i][i],r=1;r<f+2;r++)o[i][r]=o[i][r]*b;if(p)for(r=1;r<f+1;r++)h[i][r]=h[i][r]*b;for(u=1;u<f+1;u++)if(u!==i){for(b=-o[u][i],r=1;r<f+2;r++)o[u][r]=o[u][r]+b*o[i][r];if(p)for(r=1;r<f+1;r++)h[u][r]=h[u][r]+b*h[i][r]}o[0][f+1]=0}for(e=[p?5:1,f+1],e[0]=[],i=0;i<f+1;i++)e[0][i]=o[f-i][f+1];if(p){for(a=1;a<5;a++)for(e[a]=[],k=0;k<f+1;k++)e[a][k]=0;for(at=d[f+1]-d[0]*d[0]/s,g=d[f+1],i=0;i<f+1;i++)g-=o[i][f+1]*d[i];ht=at-g,e[2][0]=at===0?t.Errors.Number:ht/at,e[4][0]=ht,e[4][1]=g;if(st){if(s-f-1==0)for(e[2][1]=t.Errors.Number,i=0;i<f+1;i++)e[1][i]=t.Errors.Number;else{for(et=g/(s-f-1),i=0;i<f+1;i++)e[1][f-i]=Math.sqrt(et*h[i][i]);e[2][1]=Math.sqrt(et)}e[3][0]=g===0?t.Errors.Number:c.toDouble(s-f-1)*ht/(g*c.toDouble(f)),e[3][1]=c.toDouble(s-f-1)}else{if(s-f==0){for(i=0;i<f+1;i++)e[1][i]=t.Errors.Number;e[2][1]=t.Errors.Number}else{for(et=g/c.toDouble(s-f),e[1][f]=t.Errors.NotAvailable,i=1;i<f+1;i++)e[1][f-i]=Math.sqrt(et*h[i][i]);e[2][1]=Math.sqrt(et)}e[3][0]=g===0?t.Errors.Number:c.toDouble(s-f)*ht/(g*c.toDouble(f)),e[3][1]=c.toDouble(s-f)}for(i=2;i<5;i++)for(u=2;u<f+1;u++)e[i][u]=t.Errors.NotAvailable}return e}return t.Errors.Number}function ur(n){var p=n[0],w=n[1],y=0,i=0,l=0,v=0,o=0,r=t.Convert,e=t._ArrayHelper,a=e.getLength(n[0]),f,h,s,c,u;if(a!==e.getLength(n[1]))return t.Errors.NotAvailable;for(f=0;f<a;f++)h=e.getValueByIndex(p,f),s=e.getValueByIndex(w,f),r.isNumber(h)&&r.isNumber(s)&&(c=r.toDouble(h),u=r.toDouble(s),y+=c,i+=u,l+=u*u,v+=u*c,o++);return o*l-i*i==0?t.Errors.DivideByZero:r.toResult((o*v-i*y)/(o*l-i*i))}function rr(n){for(var h=t.Convert,ut=t._Helper,c=h._toArray(n[0]),o=new t.Array,r,a,u,e,y,s,w,v,b,l,it,f,g,tt,o=ut._argumentExists(n,1)?h._toArray(n[1]):c,p=ut._argumentExists(n,2)?h._toArray(n[2]):o,rt=ut._argumentExists(n,3)?h.toBool(n[3]):!0,i=0;i<c.getRowCount();i++)for(r=0;r<c.getColumnCount();r++)if(!h.isNumber(c.getValue(i,r)))return t.Errors.Value;for(i=0;i<o.getRowCount();i++)for(r=0;r<o.getColumnCount();r++)if(!h.isNumber(o.getValue(i,r)))return t.Errors.Value;for(i=0;i<p.getRowCount();i++)for(r=0;r<p.getColumnCount();r++)if(!h.isNumber(p.getValue(i,r)))return t.Errors.Value;if(c.getRowCount()===o.getRowCount()&&c.getColumnCount()===o.getColumnCount()){y=o.getRowCount()*o.getColumnCount();var k=0,d=0,ft=0,nt=0,et;for(i=0;i<o.getRowCount();i++)for(r=0;r<o.getColumnCount();r++){if(isNaN(s=h.toDouble(o.getValue(i,r)))||isNaN(w=h.toDouble(c.getValue(i,r))))return t.Errors.Value;k+=s,d+=s*s,ft+=w,nt+=s*w}for(rt?(e=(y*nt-k*ft)/(y*d-k*k),et=(ft*d-k*nt)/(y*d-k*k)):(e=nt/d,et=0),v=[],i=0;i<p.getRowCount();i++)for(v[i]=[],r=0;r<p.getColumnCount();r++){if(isNaN(s=h.toDouble(p.getValue(i,r))))return t.Errors.Value;v[i][r]=e*s+et}return v}else if(c.getColumnCount()===1&&c.getRowCount()===o.getRowCount()||c.getRowCount()===1&&c.getColumnCount()===o.getColumnCount()){w=[],s=[];if(c.getColumnCount()===1){for(y=o.getRowCount(),e=o.getColumnCount(),i=0;i<y;i++){if(isNaN(a=h.toDouble(c.getValue(i,0))))return t.Errors.Value;w[i]=a}for(i=0;i<y;i++)for(s[i]=[],r=0;r<e;r++){if(isNaN(a=h.toDouble(o.getValue(i,r))))return t.Errors.Value;s[i][r]=a}}else{for(y=o.getColumnCount(),e=o.getRowCount(),s=[],w=[],i=0;i<y;i++){if(isNaN(a=h.toDouble(c.getValue(0,i))))return t.Errors.Value;w[i]=a}for(i=0;i<y;i++)for(s[i]=[],r=0;r<e;r++){if(isNaN(a=h.toDouble(o.getValue(r,i))))return t.Errors.Value;s[i][r]=a}}for(f=[],u=0;u<e+1;u++)f[u]=[];for(g=0;g<e+1;g++)for(tt=0;tt<e+2;tt++)f[g][tt]=0;for(u=0;u<y;u++)for(f[0][e+1]=f[0][e+1]+w[u],i=0;i<e;i++)for(f[0][i+1]=f[0][i+1]+s[u][i],f[i+1][0]=f[0][i+1],f[i+1][e+1]=f[i+1][e+1]+s[u][i]*w[u],r=i;r<e;r++)f[r+1][i+1]=f[r+1][i+1]+s[u][i]*s[u][r],f[i+1][r+1]=f[r+1][i+1];f[0][0]=y;if(rt)for(i=0;i<e+1;i++){if(f[i][i]===0){for(b=!1,r=i+1;!b&&r<e+1;r++)if(f[r][i]!==0){for(u=0;u<e+2;u++)it=f[i][u],f[i][u]=f[r][u],f[r][u]=it;b=!0}if(!b)return t.Errors.NotAvailable}for(l=1/f[i][i],u=0;u<e+2;u++)f[i][u]=f[i][u]*l;for(r=0;r<e+1;r++)if(r!==i)for(l=-f[r][i],u=0;u<e+2;u++)f[r][u]=f[r][u]+l*f[i][u]}else for(i=1;i<e+1;i++){if(f[i][i]===0){for(b=!1,r=i+1;!b&&r<e+1;r++)if(f[r][i]!==0){for(u=0;u<e+2;u++)it=f[i][u],f[i][u]=f[r][u],f[r][u]=it;b=!0}if(!b)return t.Errors.NotAvailable}for(l=1/f[i][i],u=1;u<e+2;u++)f[i][u]=f[i][u]*l;for(r=1;r<e+1;r++)if(r!==i)for(l=-f[r][i],u=1;u<e+2;u++)f[r][u]=f[r][u]+l*f[i][u];f[0][e+1]=0}if(c.getColumnCount()===1){for(v=[],i=0;i<p.getRowCount();i++){for(v[i]=[],l=f[0][e+1],r=0;r<e;r++){if(isNaN(a=h.toDouble(p.getValue(i,r))))return t.Errors.Value;l+=f[r+1][e+1]*a}v[i][0]=l}return v}else{for(v=[],v[0]=[],i=0;i<p.getColumnCount;i++){for(l=f[0][e+1],r=0;r<e;r++){if(isNaN(a=h.toDouble(p.getValue(r,i))))return t.Errors.Value;l+=f[r+1][e+1]*a}v[0][i]=l}return v}}return t.Errors.NotAvailable}function fr(n){for(var c=t.Convert,ut=t._Helper,a=c._toArray(n[0]),h=[],w,k,r,f,p,l,v,d,it,y,s,e,o,u,nt,h=ut._argumentExists(n,1)?c._toArray(n[1]):a,b=ut._argumentExists(n,2)?c._toArray(n[2]):h,ft=ut._argumentExists(n,3)?c.toBool(n[3]):!0,i=0;i<a.getRowCount();i++)for(r=0;r<a.getColumnCount();r++){e=a.getValue(i,r);if(c.isError(e))return e;else if(c.isNumber(e)){if(c.toDouble(e)<=0)return t.Errors.Number}else return t.Errors.Value}for(i=0;i<h.getRowCount();i++)for(r=0;r<h.getColumnCount();r++){e=h.getValue(i,r);if(c.isError(e))return e;else if(!c.isNumber(e))return t.Errors.Value}for(i=0;i<b.getRowCount();i++)for(r=0;r<b.getColumnCount();r++){e=b.getValue(i,r);if(c.isError(e))return e;else if(!c.isNumber(e))return t.Errors.Value}if(a.getRowCount()===h.getRowCount()&&a.getColumnCount()===h.getColumnCount()){p=h.getRowCount()*h.getColumnCount();var g=0,tt=0,et=0,rt=0,ot;for(i=0;i<h.getRowCount();i++)for(r=0;r<h.getColumnCount();r++){if(isNaN(l=c.toDouble(h.getValue(i,r)))||isNaN(v=c.toDouble(a.getValue(i,r))))return t.Errors.Value;v=Math.log(v),g+=l,tt+=l*l,et+=v,rt+=l*v}for(ft?(f=(p*rt-g*et)/(p*tt-g*g),ot=(et*tt-g*rt)/(p*tt-g*g)):(f=rt/tt,ot=0),y=[],i=0;i<b.getRowCount();i++)for(y[i]=[],r=0;r<b.getColumnCount();r++){if(isNaN(l=c.toDouble(b.getValue(i,r))))return t.Errors.Value;y[i][r]=Math.exp(f*l+ot)}return y}else if(a.getColumnCount()===1&&a.getRowCount()===h.getRowCount()||a.getRowCount()===1&&a.getColumnCount()===h.getColumnCount()){v=[],l=[];if(a.getColumnCount()===1){for(p=h.getRowCount(),f=h.getColumnCount(),i=0;i<p;i++){if(isNaN(w=c.toDouble(a.getValue(i,0))))return t.Errors.Value;v[i]=Math.log(w)}for(i=0;i<p;i++)for(l[i]=[],r=0;r<f;r++){if(isNaN(w=c.toDouble(h.getValue(i,r))))return t.Errors.Value;l[i][r]=w}}else{for(p=h.getColumnCount(),f=h.getRowCount(),l=[],v=[],i=0;i<p;i++){if(isNaN(w=c.toDouble(a.getValue(0,i))))return t.Errors.Value;v[i]=w}for(i=0;i<p;i++)for(l[i]=[],r=0;r<f;r++){if(isNaN(w=c.toDouble(h.getValue(r,i))))return t.Errors.Value;l[i][r]=w}}for(u=[],d=0;d<f+1;d++)for(u[d]=[],it=0;it<f+2;it++)u[d][it]=0;for(nt=[],d=0;d<f+2;d++)nt[d]=0;for(k=0;k<p;k++)for(nt[f+1]=nt[f+1]+v[k]*v[k],u[0][f+1]=u[0][f+1]+v[k],nt[0]=u[0][f+1],i=0;i<f;i++)for(u[0][i+1]=u[0][i+1]+l[k][i],u[i+1][0]=u[0][i+1],u[i+1][f+1]=u[i+1][f+1]+l[k][i]*v[k],nt[i+1]=u[i+1][f+1],r=i;r<f;r++)u[r+1][i+1]=u[r+1][i+1]+l[k][i]*l[k][r],u[i+1][r+1]=u[r+1][i+1];u[0][0]=p;if(ft)for(s=0;s<f+1;s++){i=s;while(i<f+1&&u[i][s]===0)i++;if(i>=f+1)return t.Errors.NotAvailable;for(o=0;o<f+2;o++)e=u[s][o],u[s][o]=u[i][o],u[i][o]=e;for(e=1/u[s][s],o=0;o<f+2;o++)u[s][o]=u[s][o]*e;for(i=0;i<f+1;i++)if(i!==s)for(e=-u[i][s],o=0;o<f+2;o++)u[i][o]=u[i][o]+e*u[s][o]}else for(s=1;s<f+1;s++){i=s;while(i<f+1&&u[i][s]===0)i++;if(i>=f+1)return t.Errors.NotAvailable;for(o=1;o<f+2;o++)e=u[s][o],u[s][o]=u[i][o],u[i][o]=e;for(e=1/u[s][s],u[s][o]=u[s][o]*e,i=1;i<f+1;i++)i!==s&&(e=-u[i][s],u[i][o]=u[i][o]+e*u[s][o]);u[0][f+1]=0}if(a.getColumnCount()===1){for(y=[],i=0;i<b.getRowCount();i++){for(y[i]=[],e=u[0][f+1],r=0;r<f;r++){if(isNaN(w=c.toDouble(b.getValue(i,r))))return t.Errors.Value;e+=u[r+1][f+1]*w}y[i][0]=Math.exp(e)}return y}else{for(y=[],y[0]=[],i=0;i<b.getColumnCount();i++){for(e=u[0][f+1],r=0;r<f;r++){if(isNaN(w=c.toDouble(b.getValue(r,i))))return t.Errors.Value;e+=u[r+1][f+1]*w}y[0][i]=Math.exp(e)}return y}}return t.Errors.NotAvailable}function lr(n){for(var c=t.Convert,kt=t._Helper,a=c._toArray(n[0]),l=kt._argumentExists(n,1)?c._toArray(n[1]):a,ct=kt._argumentExists(n,2)?c.toBool(n[2]):!0,b=kt._argumentExists(n,3)?c.toBool(n[3]):!1,u,rt,r,f,s,v,y,p,tt,e,w,it,nt,ot,o,k,h,g,lt,st,i=0;i<a.getRowCount();i++)for(u=0;u<a.getColumnCount();u++)if(c.isError(a.getValue(i,u)))return a.getValue(i,u);else if(!c.isNumber(a.getValue(i,u)))return t.Errors.Value;for(i=0;i<l.getRowCount();i++)for(u=0;u<l.getColumnCount();u++)if(c.isError(l.getValue(i,u)))return l.getValue(i,u);else if(!c.isNumber(l.getValue(i,u)))return t.Errors.Value;if(a.getRowCount()===l.getRowCount()&&a.getColumnCount()===l.getColumnCount()&&(ct||!b)){s=l.getRowCount()*l.getColumnCount();var d=0,ft=0,ut=0,bt=0,et=0,ht;for(i=0;i<l.getRowCount();i++)for(u=0;u<l.getColumnCount();u++){if(isNaN(v=c.toDouble(l.getValue(i,u)))||isNaN(y=c.toDouble(a.getValue(i,u))))return t.Errors.Value;y=Math.log(y),d+=v,ft+=v*v,ut+=y,bt+=y*y,et+=v*y}ct?(f=(s*et-d*ut)/(s*ft-d*d),ht=(ut*ft-d*et)/(s*ft-d*d)):(f=et/ft,ht=0),e=[],e[0]=[],e[0][0]=Math.exp(f),e[0][1]=Math.exp(ht);if(b){e[1]=[],e[2]=[],e[3]=[],e[4]=[];var yt=s*ft-d*d,wt=s*bt-ut*ut,vt=s*et-d*ut,pt=bt-ht*ut-f*et,at=vt*vt/(yt*wt);s<3?(e[1][0]=t.Errors.Number,e[1][1]=t.Errors.Number,e[2][1]=t.Errors.Number,e[3][0]=t.Errors.Number):(e[1][0]=Math.sqrt(pt*s/(yt*(s-2))),e[1][1]=Math.sqrt(pt*ft/(yt*(s-2))),e[2][1]=Math.sqrt((wt-vt*vt/yt)/(s*(s-2))),e[3][0]=at===1?t.Errors.Number:at*(s-2)/(1-at)),e[2][0]=at,e[3][1]=s-2,e[4][0]=wt/s-pt,e[4][1]=pt}return e}else if(a.getColumnCount()===1&&a.getRowCount()===l.getRowCount()||a.getRowCount()===1&&a.getColumnCount()===l.getColumnCount()){y=[],v=[];if(a.getColumnCount()===1){for(s=l.getRowCount(),f=l.getColumnCount(),i=0;i<s;i++){if(isNaN(rt=c.toDouble(a.getValue(i,0))))return t.Errors.Value;y[i]=Math.log(rt)}for(i=0;i<s;i++)for(v[i]=[],u=0;u<f;u++){if(isNaN(rt=c.toDouble(l.getValue(i,u))))return t.Errors.Value;v[i][u]=rt}}else{for(s=l.getColumnCount(),f=l.getRowCount(),v=[],y=[],i=0;i<s;i++){if(isNaN(rt=c.toDouble(a.getValue(0,i))))return t.Errors.Value;y[i]=Math.log(rt)}for(i=0;i<s;i++)for(v[i]=[],u=0;u<f;u++){if(isNaN(rt=c.toDouble(l.getValue(u,i))))return t.Errors.Value;v[i][u]=rt}}for(o=[],p=0;p<f+1;p++)for(o[p]=[],tt=0;tt<f+2;tt++)o[p][tt]=0;for(k=[],p=0;p<f+2;p++)k[p]=0;for(h=b?[]:null,r=0;r<s;r++)for(k[f+1]=k[f+1]+y[r]*y[r],o[0][f+1]=o[0][f+1]+y[r],k[0]=o[0][f+1],i=0;i<f;i++)for(o[0][i+1]=o[0][i+1]+v[r][i],o[i+1][0]=o[0][i+1],o[i+1][f+1]=o[i+1][f+1]+v[r][i]*y[r],k[i+1]=o[i+1][f+1],u=i;u<f;u++)o[u+1][i+1]=o[u+1][i+1]+v[r][i]*v[r][u],o[i+1][u+1]=o[u+1][i+1];o[0][0]=s;if(b){for(p=0;p<f+1;p++)for(h[p]=[],tt=0;tt<f+1;tt++)h[p][tt]=0;for(i=0;i<f+1;i++)h[i][i]=1}if(ct)for(i=0;i<f+1;i++){if(o[i][i]===0){for(nt=!1,u=i+1;!nt&&u<f+1;u++)if(o[u][i]!==0){for(r=0;r<f+2;r++)it=o[i][r],o[i][r]=o[u][r],o[u][r]=it;if(b)for(r=0;r<f+1;r++)it=h[i][r],h[i][r]=h[u][r],h[u][r]=it;nt=!0}if(!nt)return t.Errors.Number}for(w=1/o[i][i],r=0;r<f+2;r++)o[i][r]=o[i][r]*w;if(b)for(r=0;r<f+1;r++)h[i][r]=h[i][r]*w;for(u=0;u<f+1;u++)if(u!==i){for(w=-o[u][i],r=0;r<f+2;r++)o[u][r]=o[u][r]+w*o[i][r];if(b)for(r=0;r<f+1;r++)h[u][r]=h[u][r]+w*h[i][r]}}else for(i=1;i<f+1;i++){if(o[i][i]===0){for(nt=!1,u=i+1;!nt&&u<f+1;u++)if(o[u][i]!==0){for(r=0;r<f+2;r++)it=o[i][r],o[i][r]=o[u][r],o[u][r]=it;if(b)for(r=0;r<f+1;r++)it=h[i][r],h[i][r]=h[u][r],h[u][r]=it;nt=!0}if(!nt)return t.Errors.Number}for(w=1/o[i][i],r=1;r<f+2;r++)o[i][r]=o[i][r]*w;if(b)for(r=1;r<f+1;r++)h[i][r]=h[i][r]*w;for(u=1;u<f+1;u++)if(u!==i){for(w=-o[u][i],r=1;r<f+2;r++)o[u][r]=o[u][r]+w*o[i][r];if(b)for(r=1;r<f+1;r++)h[u][r]=h[u][r]+w*h[i][r]}o[0][f+1]=0}for(e=[],e[0]=[],i=0;i<f+1;i++)e[0][i]=Math.exp(o[f-i][f+1]);if(b){for(e[1]=[],e[2]=[],e[3]=[],e[4]=[],lt=k[f+1]-k[0]*k[0]/s,g=k[f+1],i=0;i<f+1;i++)g-=o[i][f+1]*k[i];st=lt-g,e[2][0]=lt===0?t.Errors.Number:st/lt,e[4][0]=st,e[4][1]=g;if(ct){if(s-f-1==0)for(e[2][1]=t.Errors.Number,i=0;i<f+1;i++)e[1][i]=t.Errors.Number;else{for(ot=g/(s-f-1),i=0;i<f+1;i++)e[1][f-i]=Math.sqrt(ot*h[i][i]);e[2][1]=Math.sqrt(ot)}e[3][0]=g===0?t.Errors.Number:c.toDouble(s-f-1)*st/(g*c.toDouble(f)),e[3][1]=c.toDouble(s-f-1)}else{if(s-f==0){for(i=0;i<f+1;i++)e[1][i]=t.Errors.Number;e[2][1]=t.Errors.Number}else{for(ot=g/c.toDouble(s-f),e[1][f]=t.Errors.NotAvailable,i=1;i<f+1;i++)e[1][f-i]=Math.sqrt(ot*h[i][i]);e[2][1]=Math.sqrt(ot)}e[3][0]=g===0?t.Errors.Number:c.toDouble(s-f)*st/(g*c.toDouble(f)),e[3][1]=c.toDouble(s-f)}for(i=2;i<5;i++)for(u=2;u<f+1;u++)e[i][u]=t.Errors.NotAvailable}return e}return t.Errors.Number}function or(n){var h,s,c=0,y=0,r=0,v=0,a=0,i=0,u=t.Convert,l=t._ArrayHelper,p=l.getLength(n[0]),o,e,f;if(p!==l.getLength(n[1]))return t.Errors.NotAvailable;for(o=0;o<p;o++){e=l.getValueByIndex(n[0],o),f=l.getValueByIndex(n[1],o);if(u.isNumber(e)&&u.isNumber(f))s=u.toDouble(e),h=u.toDouble(f),c+=s,y+=s*s,r+=h,v+=h*h,a+=h*s,i++;else if(u.isError(e))return e;else if(u.isError(f))return f}return i*(i-2)==0?t.Errors.DivideByZero:i*v-r*r==0?t.Errors.DivideByZero:Math.sqrt((i*y-c*c-(i*a-r*c)*(i*a-r*c)/(i*v-r*r))/(i*(i-2)))}var w="undefined",d="boolean",k="string",tt=n.GrapeCity,b,t,u,i;typeof tt===w&&(tt=n.GrapeCity={}),b=tt,typeof b.Calc===w&&(b.Calc={}),t=b.Calc,typeof t.Functions===w&&(t.Functions={}),u=t.Functions,u._builtInFunctions=u._builtInFunctions||{},typeof u._defineBuildInFunction===w&&(u._defineBuildInFunction=function(n,t,i){var r,f;if(n===undefined||n===null)throw"Invalid function name";n=n.toUpperCase();if(u._builtInFunctions.hasOwnProperty(n)){r=u._builtInFunctions[n];if(r){if(!i||!i.override)throw"Attempt to override function while override is not allowed";}else u._builtInFunctions[n]=new u.Function(n,0,255),r=u[n.toUpperCase()]}else r=new u.Function(n,0,255),u._builtInFunctions[n]=r;t&&typeof t=="function"&&(r.evaluate=t);if(i)for(f in i)i.hasOwnProperty(f)&&f!=="override"&&(r[f]=i[f]);return r}),i=u._defineBuildInFunction,u.StatHelper={normsdist:s,__averageIncludeSubtotals:pi,__countIncludeSubtotals:ei,__countaIncludeSubtotals:ct,__maxIncludeSubtotals:ai,__minIncludeSubtotals:yi,__stdevIncludeSubtotals:ot,__stdevpIncludeSubtotals:ht,__varrIncludeSubtotals:at,__varpIncludeSubtotals:lt},i("MAX",gf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("MAXA",bf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("MIN",vf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("MINA",wf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("LARGE",pf,{minArgs:2,maxArgs:2,acceptsArray:f,acceptsReference:f}),i("SMALL",te,{minArgs:2,maxArgs:2,acceptsArray:f,acceptsReference:f}),i("AVERAGE",se,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("AVERAGEA",oe,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("AVERAGEIF",he,{minArgs:2,maxArgs:3,acceptsMissingArgument:g,acceptsArray:oi,acceptsReference:oi}),i("AVERAGEIFS",ee,{minArgs:3,acceptsArray:si,acceptsReference:si}),i("MEDIAN",re,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("MODE",ie,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("GEOMEAN",fe,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("HARMEAN",du,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("TRIMMEAN",vu,{minArgs:2,maxArgs:2,acceptsArray:f,acceptsReference:f}),i("FREQUENCY",wu,{minArgs:2,maxArgs:2,acceptsArray:r,acceptsReference:r}),i("RANK",of,{minArgs:2,maxArgs:3,acceptsMissingArgument:g,acceptsArray:li,acceptsReference:li}),i("KURT",lf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("PERCENTILE",bi,{minArgs:2,maxArgs:2,acceptsArray:f,acceptsReference:f}),i("PERCENTRANK",tf,{minArgs:2,maxArgs:3,acceptsMissingArgument:g,acceptsArray:f,acceptsReference:f}),i("QUARTILE",ff,{minArgs:2,maxArgs:2,acceptsArray:f,acceptsReference:f}),i("COUNT",ne,{minArgs:1,acceptsError:r,acceptsArray:r,acceptsReference:r}),i("COUNTA",ef,{minArgs:1,acceptsError:r,acceptsArray:r,acceptsReference:r}),i("COUNTBLANK",uf,{minArgs:1,maxArgs:1,acceptsArray:r,acceptsReference:r}),i("COUNTIF",rf,{minArgs:2,maxArgs:2,acceptsArray:f,acceptsReference:f}),i("COUNTIFS",cf,{minArgs:2,acceptsArray:vi,acceptsReference:vi}),i("AVEDEV",hf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("STDEV",sf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("STDEVA",pu,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("STDEVP",yu,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("STDEVPA",au,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("VAR",gu,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("VARA",nf,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("VARP",bu,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("VARPA",ku,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("COVAR",af,{minArgs:2,maxArgs:2,acceptsArray:r,acceptsReference:r}),i("DEVSQ",ue,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("CONFIDENCE",ce,{minArgs:3,maxArgs:3}),i("FORECAST",kr,{minArgs:3,maxArgs:3,acceptsArray:ci,acceptsReference:ci}),i("INTERCEPT",br,{minArgs:2,maxArgs:2,acceptsArray:r,acceptsReference:r}),i("LINEST",uu,{minArgs:1,maxArgs:4,acceptsReference:e,acceptsArray:e,acceptsMissingArgument:nt}),i("SLOPE",ur,{minArgs:2,maxArgs:2,acceptsArray:r,acceptsReference:r}),i("TREND",rr,{minArgs:1,maxArgs:4,acceptsReference:wi,acceptsArray:wi,acceptsMissingArgument:nt}),i("GROWTH",fr,{minArgs:1,maxArgs:4,acceptsReference:hi,acceptsArray:hi,acceptsMissingArgument:nt}),i("LOGEST",lr,{minArgs:1,maxArgs:4,acceptsReference:e,acceptsArray:e,acceptsMissingArgument:nt}),i("STEYX",or,{minArgs:2,maxArgs:2,acceptsArray:r,acceptsReference:r}),i("BETADIST",ni,{minArgs:3,maxArgs:5,acceptsMissingArgument:ki}),i("BETAINV",ri,{minArgs:3,maxArgs:5,acceptsMissingArgument:ki}),i("BINOMDIST",kf,{minArgs:4,maxArgs:4}),i("NEGBINOMDIST",df,{minArgs:3,maxArgs:3}),i("CRITBINOM",lu,{minArgs:3,maxArgs:3}),i("CHIDIST",pt,{minArgs:2,maxArgs:2}),i("CHIINV",er,{minArgs:2,maxArgs:2}),i("CHITEST",ar,{minArgs:2,maxArgs:2,acceptsReference:r,acceptsArray:r}),i("CORREL",vr,{minArgs:2,maxArgs:2,acceptsReference:r,acceptsArray:r}),i("EXPONDIST",cr,{minArgs:3,maxArgs:3}),i("FDIST",wt,{minArgs:3,maxArgs:3}),i("FINV",nr,{minArgs:3,maxArgs:3}),i("FISHER",gi,{minArgs:1,maxArgs:1}),i("FISHERINV",di,{minArgs:1,maxArgs:1}),i("FTEST",tr,{minArgs:2,maxArgs:2,acceptsArray:r,acceptsReference:r}),i("GAMMADIST",yt,{minArgs:4,maxArgs:4}),i("GAMMAINV",vt,{minArgs:3,maxArgs:3}),i("GAMMALN",h,{minArgs:1,maxArgs:1}),i("HYPGEOMDIST",ir,{minArgs:4,maxArgs:4}),i("LOGNORMDIST",yr,{minArgs:3,maxArgs:3}),i("LOGINV",fu,{minArgs:3,maxArgs:3}),i("NORMDIST",ut,{minArgs:4,maxArgs:4}),i("NORMINV",rt,{minArgs:3,maxArgs:3}),i("NORMSDIST",s,{minArgs:1,maxArgs:1}),i("NORMSINV",l,{minArgs:1,maxArgs:1}),i("PEARSON",eu,{minArgs:2,maxArgs:2,acceptsReference:r,acceptsArray:r}),i("RSQ",ru,{minArgs:2,maxArgs:2,acceptsReference:e,acceptsArray:e}),i("POISSON",hu,{minArgs:3,maxArgs:3}),i("PROB",sr,{minArgs:3,maxArgs:4,acceptsMissingArgument:hr,acceptsReference:e,acceptsArray:e}),i("SKEW",cu,{minArgs:1,acceptsArray:r,acceptsReference:r}),i("STANDARDIZE",ou,{minArgs:3,maxArgs:3}),i("TDIST",su,{minArgs:3,maxArgs:3}),i("TINV",iu,{minArgs:2,maxArgs:2}),i("TTEST",nu,{minArgs:4,maxArgs:4,acceptsReference:e,acceptsArray:e}),i("WEIBULL",dr,{minArgs:4,maxArgs:4}),i("ZTEST",tu,{minArgs:2,maxArgs:3,acceptsReference:f,acceptsArray:f,acceptsMissingArgument:g}),i("PERMUT",gr,{minArgs:2,maxArgs:2})})(window);(function(n,t){"use strict";function h(n){if(n===undefined||n===null)return 0;else if(typeof n=="number")return n;else if(typeof n=="string"){var t=parseFloat(n);if(!isNaN(t))if(t.toString()===n.toString())return t}return null}function o(n){if(n instanceof Date)return n;else if(typeof n=="string")return new Date(n);return null}function f(n,i){this.expected=n,this.formula=typeof i=="string"?t.trim(i).replace("=",""):i}function r(n){this._init(),this.condition=n,this.type=u.AnyValue}var e=n.GrapeCity,i;typeof e=="undefined"&&(e=n.GrapeCity={}),typeof e.UI=="undefined"&&(e.UI={}),i=e.UI,i.CriteriaType={AnyValue:0,WholeNumber:1,DecimalValues:2,List:3,Date:4,Time:5,TextLength:6,Custom:7},i.DataValidationResult={ForceApply:0,Discard:1,Retry:2},i.ErrorStyle={Stop:0,Warning:1,Information:2};var u=i.CriteriaType,c=i.DataValidationResult,s=i.ErrorStyle;f.prototype={ignoreBlank:!1,_concatArray:function(n,t){var i,r;if(t.length===1){i=t[0];if(i instanceof Array)for(r=0;r<i.length;r++)n.push(i[r]);else n.push(i)}else for(r=0;r<t.length;r++)i=t[r],i instanceof Array?i.length>0&&n.push(i[0]):n.push(i)},getValidList:function(n,r,u){var o=[],h,l,c,a,s,e,f;if(this.formula&&this.formula.length>0)h=this.getExpected(n,r,u),h instanceof Array?this._concatArray(o,h):o.push(h);else if(this.expected&&this.expected.length>0){l=this.expected,c=l.split(",");if(c)for(a=new i.GeneralFormatter,s=0;s<c.length;s++){e=c[s];if(e===undefined||e===null||e==="")continue;f=t.trim(e);if(f!==undefined&&f!==null&&f!=="")try{o.push(a.Parse(f))}catch(v){o.push(f)}}}return o},_equals:function(n,t){return n instanceof Date&&t instanceof Date?n.valueOf()===t.valueOf():n===t},evaluate:function(n,t,i,r){var f,e,u;if(r===undefined||r===null||r==="")return this.ignoreBlank===!0;f=this.getValidList(n,t,i);if(f)for(e=0;e<f.length;e++){u=f[e];if((u===undefined||u===null)&&(r===undefined||r===null))return!0;else if(u!==undefined&&u!==null&&this._equals(u,r))return!0}return!1},getExpected:function(n,t,i){if(this.formula){var h,s,r,u,o=[],c=n.getCalcService(),l=c.parse(this.formula,t,i),f=c.evaluateParsedFormula(n._getSheetSource(),l,t,i,!0);if(f instanceof e.Calc.Reference)for(h=f.getRowCount(0),s=f.getColumnCount(0),r=0;r<h;r++)for(o[r]=[],u=0;u<s;u++)o[r][u]=f.getValue(0,r,u);else if(f instanceof e.Calc.Array)for(h=f.getRowCount(),s=f.getColumnCount(),r=0;r<h;r++)for(o[r]=[],u=0;u<s;u++)o[r][u]=f.getValue(r,u);return o}else return this.expected}},f.fromSource=function(n){return new f(n,null)},f.fromFormula=function(n){return new f("",n)},r.prototype={condition:null,type:null,ignoreBlank:!1,IgnoreBlank:function(n){return arguments.length>0?(this.ignoreBlank=n,this.condition&&(this.condition.ignoreBlank=n),this):this.ignoreBlank},_init:function(){this.errorStyle=s.Stop,this.ignoreBlank=!0,this.inCellDropdown=!0,this.showInputMessage=!0,this.showErrorMessage=!0,this.inputTitle="",this.errorTitle="",this.inputMessage="",this.errorMessage="",this.comparisonOperator=i.ComparisonOperator.Between},value1:function(){var n=this.condition&&this.condition.item1?this.condition.item1:this.condition;return n?n.formula&&n.formula.length>0?"="+n.formula.toString().toUpperCase():n.expected:null},value2:function(){var n=this.condition&&this.condition.item2?this.condition.item2:this.condition;return n?n.formula&&n.formula.length>0?"="+n.formula.toString().toUpperCase():n.expected:null},isValid:function(n,t,i,r){if(this.condition){if(this.condition.ignoreBlank&&(r===undefined||r===null||r===""))return!0;var e=r,f;if(r!==undefined&&r!==null)switch(this.type){case u.AnyValue:return!0;case u.DecimalValues:case u.WholeNumber:f=h(r),f!==undefined&&f!==null&&(e=f);break;case u.Date:case u.Time:f=o(r),f!==undefined&&f!==null&&(e=f);break;case u.Custom:case u.List:case u.TextLength:break}return this.IgnoreBlank(this.ignoreBlank),this.condition.evaluate(n,t,i,e,e)}return!0},reset:function(){this._init(),this.type=u.AnyValue,this.condition=null}},i.DefaultDataValidator=r,r.isFormula=function(n){return n&&n[0]==="="},i.DefaultDataValidator.createNumberValidator=function(n,t,f,e){var l=r.isFormula(t)?t.replace("=",""):null,a=r.isFormula(t)?null:t,d=r.isFormula(f)?f.replace("=",""):null,k=r.isFormula(f)?null:f,o=null,y,v,c=i.ComparisonOperator,h=i.GeneralCompareType,b=i.RelationCompareType,s=i.NumberCondition,w=i.RelationCondition,p;switch(n){case c.Between:y=new s(h.GreaterThanOrEqualsTo,a,l),y.integerValue=e,v=new s(h.LessThanOrEqualsTo,k,d),v.integerValue=e,o=new w(b.And,y,v);break;case c.NotBetween:y=new s(h.LessThan,a,l),y.integerValue=e,v=new s(h.GreaterThan,k,d),v.integerValue=e,o=new w(b.Or,y,v);break;case c.EqualsTo:o=new s(h.EqualsTo,a,l),o.integerValue=e;break;case c.NotEqualsTo:o=new s(h.NotEqualsTo,a,l),o.integerValue=e;break;case c.GreaterThan:o=new s(h.GreaterThan,a,l),o.integerValue=e;break;case c.GreaterThanOrEqualsTo:o=new s(h.GreaterThanOrEqualsTo,a,l),o.integerValue=e;break;case c.LessThan:o=new s(h.LessThan,a,l),o.integerValue=e;break;case c.LessThanOrEqualsTo:o=new s(h.LessThanOrEqualsTo,a,l),o.integerValue=e;break}return p=new r(o),p.type=e?u.WholeNumber:u.DecimalValues,p.comparisonOperator=n,p},i.DefaultDataValidator.createDateValidator=function(n,t,f){var c=r.isFormula(t)?t.replace("=",""):null,h=r.isFormula(t)?null:t,k=r.isFormula(f)?f.replace("=",""):null,w=r.isFormula(f)?null:f,s=null,v,y,l=i.ComparisonOperator,e=i.DateCompareType,b=i.RelationCompareType,o=i.DateCondition,p=i.RelationCondition,a;switch(n){case l.Between:v=new o(e.AfterEqualsTo,h,c),y=new o(e.BeforeEqualsTo,w,k),s=new p(b.And,v,y);break;case l.NotBetween:v=new o(e.Before,h,c),y=new o(e.After,w,k),s=new p(b.Or,v,y);break;case l.EqualsTo:s=new o(e.EqualsTo,h,c);break;case l.NotEqualsTo:s=new o(e.NotEqualsTo,h,c);break;case l.GreaterThan:s=new o(e.After,h,c);break;case l.GreaterThanOrEqualsTo:s=new o(e.AfterEqualsTo,h,c);break;case l.LessThan:s=new o(e.Before,h,c);break;case l.LessThanOrEqualsTo:s=new o(e.BeforeEqualsTo,h,c);break}return a=new r(s),a.type=u.Date,a.comparisonOperator=n,a},i.DefaultDataValidator.createTextLengthValidator=function(n,t,f){var c=r.isFormula(t)?t.replace("=",""):null,h=r.isFormula(t)?null:t,k=r.isFormula(f)?f.replace("=",""):null,w=r.isFormula(f)?null:f,s=null,v,y,l=i.ComparisonOperator,e=i.GeneralCompareType,b=i.RelationCompareType,o=i.TextLengthCondition,p=i.RelationCondition,a;switch(n){case l.Between:v=new o(e.GreaterThanOrEqualsTo,h,c),y=new o(e.LessThanOrEqualsTo,w,k),s=new p(b.And,v,y);break;case l.NotBetween:v=new o(e.LessThan,h,c),y=new o(e.GreaterThan,w,k),s=new p(b.Or,v,y);break;case l.EqualsTo:s=new o(e.EqualsTo,h,c);break;case l.NotEqualsTo:s=new o(e.NotEqualsTo,h,c);break;case l.GreaterThan:s=new o(e.GreaterThan,h,c);break;case l.GreaterThanOrEqualsTo:s=new o(e.GreaterThanOrEqualsTo,h,c);break;case l.LessThan:s=new o(e.LessThan,h,c);break;case l.LessThanOrEqualsTo:s=new o(e.LessThanOrEqualsTo,h,c);break}return a=new r(s),a.type=u.TextLength,a.comparisonOperator=n,a},i.DefaultDataValidator.createFormulaValidator=function(n){var f=n,t;return f=f.replace("=",""),t=new r(new i.FormulaCondition(i.CustomValueType.Formula,f)),t.type=u.Custom,t},i.DefaultDataValidator.createFormulaListValidator=function(n){var t=new r(f.fromFormula(n));return t.type=u.List,t},i.DefaultDataValidator.createListValidator=function(n){var t=new r(f.fromSource(n));return t.type=u.List,t}})(window,jQuery);(function(n,t,i){"use strict";var f=n.GrapeCity,r,u;typeof f=="undefined"&&(f=n.GrapeCity={}),typeof f.UI=="undefined"&&(f.UI={}),typeof f.Calc=="undefined"&&(f.Calc={}),r=t.wijmo.wijspread,u=f.UI,r.Spread=u.GcSpread,r.Key=u.Key,r.KeyMap=u.KeyMap,r.Direction=u.Direction,r.HorizontalAlign=u.HorizontalAlign,r.VerticalAlign=u.VerticalAlign,r.HorizontalPosition=u.HorizontalPosition,r.VerticalPosition=u.VerticalPosition,r.HeaderAutoText=u.HeaderAutoText,r.ClipboardPasteOptions=u.ClipboardPasteOptions,r.TextFileOpenFlags=u.TextFileOpenFlags,r.VisualState=u.VisualState,r.ReferenceStyle=u.ReferenceStyle,r.LineStyle=u.LineStyle,r.LineBorder=u.LineBorder,r.SpreadActions=u.SpreadActions,r.UndoRedo=u.UndoRedo,r.Sheet=u.GcSheet,r.Cell=u.Cell,r.Row=u.Row,r.Column=u.Col,r.Range=u.Range,r.SheetArea=u.SheetArea,r.StorageType=u.StorageType,r.Style=u.Style,r.CopyToOption=u.CopyToOption,r.Events=u.Events,r.DataContext=u.DataContext,r.FontFactory=u.FontFactory,r.ThemeColor=u.ThemeColor,r.ThemeColors=u.ThemeColors,r.SpreadTheme=u.SpreadTheme,r.SpreadThemes=u.SpreadThemes,r.CellsEnumerator=u.CellsEnumerator,r.SearchFlags=u.SearchFlags,r.SearchOrder=u.SearchOrder,r.SearchFoundFlags=u.SearchFoundFlags,r.SearchCondition=u.SearchCondition,r.SearchResult=u.SearchResult,r.AutoFillType=u.AutoFillType,r.FillDirection=u.FillDirection,r.FillSeries=u.FillSeries,r.FillType=u.FillType,r.FillDateUnit=u.FillDateUnit,r.DragFillDirection=u.DragFillDirection,r.FormatMode=u.FormatMode,r.NumberFormatType=u.NumberFormatType,r.FormatConverter=u.FormatConverter,r.GeneralFormatter=u.GeneralFormatter,r.AutoFormatter=u.AutoFormatter,r.RowFilterBase=u.RowFilterBase,r.HideRowFilter=u.HideRowFilter,r.RangeGroup=u.RangeGroup,r.RangeGroupItemInfo=u.RangeGroupItemInfo,r.GroupedItemIndexEnumerator=u.GroupedItemIndexEnumerator,r.GroupState=u.GroupState,r.RangeGroupDirection=u.RangeGroupDirection,r.RangeGroupInfo=u.RangeGroupInfo,r.EmptyValueStyle=u.EmptyValueStyle,r.SparklineAxisMinMax=u.SparklineAxisMinMax,r.SparklineType=u.SparklineType,r.DataOrientation=u.DataOrientation,r.SparklineSetting=u.SparklineSetting,r.SparklineGroup=u.SparklineGroup,r.Sparkline=u.Sparkline,r.CriteriaType=u.CriteriaType,r.DataValidationResult=u.DataValidationResult,r.ErrorStyle=u.ErrorStyle,r.DefaultDataValidator=u.DefaultDataValidator,r.RelationCompareType=u.RelationCompareType,r.ComparisonOperator=u.ComparisonOperator,r.GeneralCompareType=u.GeneralCompareType,r.TextComparisonOperator=u.TextComparisonOperator,r.TextCompareType=u.TextCompareType,r.ColorCompareType=u.ColorCompareType,r.CustomValueType=u.CustomValueType,r.DateCompareType=u.DateCompareType,r.Top10ConditionType=u.Top10ConditionType,r.DateOccurringType=u.DateOccurringType,r.QuarterType=u.QuarterType,r.SortState=u.SortState,r.AverageConditionType=u.AverageConditionType,r.ScaleValueType=u.ScaleValueType,r.ConditionalFormats=u.ConditionalFormats,r.ConditionRuleBase=u.ConditionRuleBase,r.CellValueRule=u.CellValueRule,r.RelationCondition=u.RelationCondition,r.NumberCondition=u.NumberCondition,r.SpecificTextRule=u.SpecificTextRule,r.TextCondition=u.TextCondition,r.ColorCondition=u.ColorCondition,r.FormulaRule=u.FormulaRule,r.FormulaCondition=u.FormulaCondition,r.DateCondition=u.DateCondition,r.DateOccurringRule=u.DateOccurringRule,r.DateExCondition=u.DateExCondition,r.TextLengthCondition=u.TextLengthCondition,r.Top10Rule=u.Top10Rule,r.Top10Condition=u.Top10Condition,r.UniqueRule=u.UniqueRule,r.DuplicateRule=u.DuplicateRule,r.UniqueCondition=u.UniqueCondition,r.AverageRule=u.AverageRule,r.AverageCondition=u.AverageCondition,r.ScaleValue=u.ScaleValue,r.TwoScaleRule=u.TwoScaleRule,r.ThreeScaleRule=u.ThreeScaleRule,r.Calc=f.Calc})(this,jQuery)